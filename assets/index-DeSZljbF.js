(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const u of s)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function t(s){const u={};return s.integrity&&(u.integrity=s.integrity),s.referrerPolicy&&(u.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?u.credentials="include":s.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function o(s){if(s.ep)return;s.ep=!0;const u=t(s);fetch(s.href,u)}})();function Ch(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var rc={exports:{}},or={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sp;function fT(){if(Sp)return or;Sp=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(o,s,u){var f=null;if(u!==void 0&&(f=""+u),s.key!==void 0&&(f=""+s.key),"key"in s){u={};for(var g in s)g!=="key"&&(u[g]=s[g])}else u=s;return s=u.ref,{$$typeof:a,type:o,key:f,ref:s!==void 0?s:null,props:u}}return or.Fragment=e,or.jsx=t,or.jsxs=t,or}var bp;function mT(){return bp||(bp=1,rc.exports=fT()),rc.exports}var E=mT(),sc={exports:{}},Fe={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _p;function pT(){if(_p)return Fe;_p=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),f=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),T=Symbol.iterator;function C(P){return P===null||typeof P!="object"?null:(P=T&&P[T]||P["@@iterator"],typeof P=="function"?P:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,I={};function b(P,j,Z){this.props=P,this.context=j,this.refs=I,this.updater=Z||S}b.prototype.isReactComponent={},b.prototype.setState=function(P,j){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,j,"setState")},b.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function A(){}A.prototype=b.prototype;function M(P,j,Z){this.props=P,this.context=j,this.refs=I,this.updater=Z||S}var L=M.prototype=new A;L.constructor=M,w(L,b.prototype),L.isPureReactComponent=!0;var R=Array.isArray,$={H:null,A:null,T:null,S:null,V:null},V=Object.prototype.hasOwnProperty;function Q(P,j,Z,ie,fe,ce){return Z=ce.ref,{$$typeof:a,type:P,key:j,ref:Z!==void 0?Z:null,props:ce}}function te(P,j){return Q(P.type,j,void 0,void 0,void 0,P.props)}function F(P){return typeof P=="object"&&P!==null&&P.$$typeof===a}function ae(P){var j={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(Z){return j[Z]})}var W=/\/+/g;function z(P,j){return typeof P=="object"&&P!==null&&P.key!=null?ae(""+P.key):j.toString(36)}function ue(){}function re(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(ue,ue):(P.status="pending",P.then(function(j){P.status==="pending"&&(P.status="fulfilled",P.value=j)},function(j){P.status==="pending"&&(P.status="rejected",P.reason=j)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function se(P,j,Z,ie,fe){var ce=typeof P;(ce==="undefined"||ce==="boolean")&&(P=null);var de=!1;if(P===null)de=!0;else switch(ce){case"bigint":case"string":case"number":de=!0;break;case"object":switch(P.$$typeof){case a:case e:de=!0;break;case v:return de=P._init,se(de(P._payload),j,Z,ie,fe)}}if(de)return fe=fe(P),de=ie===""?"."+z(P,0):ie,R(fe)?(Z="",de!=null&&(Z=de.replace(W,"$&/")+"/"),se(fe,j,Z,"",function(K){return K})):fe!=null&&(F(fe)&&(fe=te(fe,Z+(fe.key==null||P&&P.key===fe.key?"":(""+fe.key).replace(W,"$&/")+"/")+de)),j.push(fe)),1;de=0;var le=ie===""?".":ie+":";if(R(P))for(var me=0;me<P.length;me++)ie=P[me],ce=le+z(ie,me),de+=se(ie,j,Z,ce,fe);else if(me=C(P),typeof me=="function")for(P=me.call(P),me=0;!(ie=P.next()).done;)ie=ie.value,ce=le+z(ie,me++),de+=se(ie,j,Z,ce,fe);else if(ce==="object"){if(typeof P.then=="function")return se(re(P),j,Z,ie,fe);throw j=String(P),Error("Objects are not valid as a React child (found: "+(j==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":j)+"). If you meant to render a collection of children, use an array instead.")}return de}function U(P,j,Z){if(P==null)return P;var ie=[],fe=0;return se(P,ie,"","",function(ce){return j.call(Z,ce,fe++)}),ie}function X(P){if(P._status===-1){var j=P._result;j=j(),j.then(function(Z){(P._status===0||P._status===-1)&&(P._status=1,P._result=Z)},function(Z){(P._status===0||P._status===-1)&&(P._status=2,P._result=Z)}),P._status===-1&&(P._status=0,P._result=j)}if(P._status===1)return P._result.default;throw P._result}var J=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var j=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(j))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)};function he(){}return Fe.Children={map:U,forEach:function(P,j,Z){U(P,function(){j.apply(this,arguments)},Z)},count:function(P){var j=0;return U(P,function(){j++}),j},toArray:function(P){return U(P,function(j){return j})||[]},only:function(P){if(!F(P))throw Error("React.Children.only expected to receive a single React element child.");return P}},Fe.Component=b,Fe.Fragment=t,Fe.Profiler=s,Fe.PureComponent=M,Fe.StrictMode=o,Fe.Suspense=h,Fe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$,Fe.__COMPILER_RUNTIME={__proto__:null,c:function(P){return $.H.useMemoCache(P)}},Fe.cache=function(P){return function(){return P.apply(null,arguments)}},Fe.cloneElement=function(P,j,Z){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var ie=w({},P.props),fe=P.key,ce=void 0;if(j!=null)for(de in j.ref!==void 0&&(ce=void 0),j.key!==void 0&&(fe=""+j.key),j)!V.call(j,de)||de==="key"||de==="__self"||de==="__source"||de==="ref"&&j.ref===void 0||(ie[de]=j[de]);var de=arguments.length-2;if(de===1)ie.children=Z;else if(1<de){for(var le=Array(de),me=0;me<de;me++)le[me]=arguments[me+2];ie.children=le}return Q(P.type,fe,void 0,void 0,ce,ie)},Fe.createContext=function(P){return P={$$typeof:f,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:u,_context:P},P},Fe.createElement=function(P,j,Z){var ie,fe={},ce=null;if(j!=null)for(ie in j.key!==void 0&&(ce=""+j.key),j)V.call(j,ie)&&ie!=="key"&&ie!=="__self"&&ie!=="__source"&&(fe[ie]=j[ie]);var de=arguments.length-2;if(de===1)fe.children=Z;else if(1<de){for(var le=Array(de),me=0;me<de;me++)le[me]=arguments[me+2];fe.children=le}if(P&&P.defaultProps)for(ie in de=P.defaultProps,de)fe[ie]===void 0&&(fe[ie]=de[ie]);return Q(P,ce,void 0,void 0,null,fe)},Fe.createRef=function(){return{current:null}},Fe.forwardRef=function(P){return{$$typeof:g,render:P}},Fe.isValidElement=F,Fe.lazy=function(P){return{$$typeof:v,_payload:{_status:-1,_result:P},_init:X}},Fe.memo=function(P,j){return{$$typeof:p,type:P,compare:j===void 0?null:j}},Fe.startTransition=function(P){var j=$.T,Z={};$.T=Z;try{var ie=P(),fe=$.S;fe!==null&&fe(Z,ie),typeof ie=="object"&&ie!==null&&typeof ie.then=="function"&&ie.then(he,J)}catch(ce){J(ce)}finally{$.T=j}},Fe.unstable_useCacheRefresh=function(){return $.H.useCacheRefresh()},Fe.use=function(P){return $.H.use(P)},Fe.useActionState=function(P,j,Z){return $.H.useActionState(P,j,Z)},Fe.useCallback=function(P,j){return $.H.useCallback(P,j)},Fe.useContext=function(P){return $.H.useContext(P)},Fe.useDebugValue=function(){},Fe.useDeferredValue=function(P,j){return $.H.useDeferredValue(P,j)},Fe.useEffect=function(P,j,Z){var ie=$.H;if(typeof Z=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ie.useEffect(P,j)},Fe.useId=function(){return $.H.useId()},Fe.useImperativeHandle=function(P,j,Z){return $.H.useImperativeHandle(P,j,Z)},Fe.useInsertionEffect=function(P,j){return $.H.useInsertionEffect(P,j)},Fe.useLayoutEffect=function(P,j){return $.H.useLayoutEffect(P,j)},Fe.useMemo=function(P,j){return $.H.useMemo(P,j)},Fe.useOptimistic=function(P,j){return $.H.useOptimistic(P,j)},Fe.useReducer=function(P,j,Z){return $.H.useReducer(P,j,Z)},Fe.useRef=function(P){return $.H.useRef(P)},Fe.useState=function(P){return $.H.useState(P)},Fe.useSyncExternalStore=function(P,j,Z){return $.H.useSyncExternalStore(P,j,Z)},Fe.useTransition=function(){return $.H.useTransition()},Fe.version="19.1.0",Fe}var Np;function kc(){return Np||(Np=1,sc.exports=pT()),sc.exports}var Y=kc();const cr=Ch(Y);var lc={exports:{}},rr={},uc={exports:{}},cc={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ap;function gT(){return Ap||(Ap=1,function(a){function e(U,X){var J=U.length;U.push(X);e:for(;0<J;){var he=J-1>>>1,P=U[he];if(0<s(P,X))U[he]=X,U[J]=P,J=he;else break e}}function t(U){return U.length===0?null:U[0]}function o(U){if(U.length===0)return null;var X=U[0],J=U.pop();if(J!==X){U[0]=J;e:for(var he=0,P=U.length,j=P>>>1;he<j;){var Z=2*(he+1)-1,ie=U[Z],fe=Z+1,ce=U[fe];if(0>s(ie,J))fe<P&&0>s(ce,ie)?(U[he]=ce,U[fe]=J,he=fe):(U[he]=ie,U[Z]=J,he=Z);else if(fe<P&&0>s(ce,J))U[he]=ce,U[fe]=J,he=fe;else break e}}return X}function s(U,X){var J=U.sortIndex-X.sortIndex;return J!==0?J:U.id-X.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;a.unstable_now=function(){return u.now()}}else{var f=Date,g=f.now();a.unstable_now=function(){return f.now()-g}}var h=[],p=[],v=1,T=null,C=3,S=!1,w=!1,I=!1,b=!1,A=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,L=typeof setImmediate<"u"?setImmediate:null;function R(U){for(var X=t(p);X!==null;){if(X.callback===null)o(p);else if(X.startTime<=U)o(p),X.sortIndex=X.expirationTime,e(h,X);else break;X=t(p)}}function $(U){if(I=!1,R(U),!w)if(t(h)!==null)w=!0,V||(V=!0,z());else{var X=t(p);X!==null&&se($,X.startTime-U)}}var V=!1,Q=-1,te=5,F=-1;function ae(){return b?!0:!(a.unstable_now()-F<te)}function W(){if(b=!1,V){var U=a.unstable_now();F=U;var X=!0;try{e:{w=!1,I&&(I=!1,M(Q),Q=-1),S=!0;var J=C;try{t:{for(R(U),T=t(h);T!==null&&!(T.expirationTime>U&&ae());){var he=T.callback;if(typeof he=="function"){T.callback=null,C=T.priorityLevel;var P=he(T.expirationTime<=U);if(U=a.unstable_now(),typeof P=="function"){T.callback=P,R(U),X=!0;break t}T===t(h)&&o(h),R(U)}else o(h);T=t(h)}if(T!==null)X=!0;else{var j=t(p);j!==null&&se($,j.startTime-U),X=!1}}break e}finally{T=null,C=J,S=!1}X=void 0}}finally{X?z():V=!1}}}var z;if(typeof L=="function")z=function(){L(W)};else if(typeof MessageChannel<"u"){var ue=new MessageChannel,re=ue.port2;ue.port1.onmessage=W,z=function(){re.postMessage(null)}}else z=function(){A(W,0)};function se(U,X){Q=A(function(){U(a.unstable_now())},X)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(U){U.callback=null},a.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):te=0<U?Math.floor(1e3/U):5},a.unstable_getCurrentPriorityLevel=function(){return C},a.unstable_next=function(U){switch(C){case 1:case 2:case 3:var X=3;break;default:X=C}var J=C;C=X;try{return U()}finally{C=J}},a.unstable_requestPaint=function(){b=!0},a.unstable_runWithPriority=function(U,X){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var J=C;C=U;try{return X()}finally{C=J}},a.unstable_scheduleCallback=function(U,X,J){var he=a.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?he+J:he):J=he,U){case 1:var P=-1;break;case 2:P=250;break;case 5:P=1073741823;break;case 4:P=1e4;break;default:P=5e3}return P=J+P,U={id:v++,callback:X,priorityLevel:U,startTime:J,expirationTime:P,sortIndex:-1},J>he?(U.sortIndex=J,e(p,U),t(h)===null&&U===t(p)&&(I?(M(Q),Q=-1):I=!0,se($,J-he))):(U.sortIndex=P,e(h,U),w||S||(w=!0,V||(V=!0,z()))),U},a.unstable_shouldYield=ae,a.unstable_wrapCallback=function(U){var X=C;return function(){var J=C;C=X;try{return U.apply(this,arguments)}finally{C=J}}}}(cc)),cc}var wp;function hT(){return wp||(wp=1,uc.exports=gT()),uc.exports}var dc={exports:{}},sn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ip;function yT(){if(Ip)return sn;Ip=1;var a=kc();function e(h){var p="https://react.dev/errors/"+h;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)p+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+h+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var o={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function u(h,p,v){var T=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:T==null?null:""+T,children:h,containerInfo:p,implementation:v}}var f=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function g(h,p){if(h==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return sn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,sn.createPortal=function(h,p){var v=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(e(299));return u(h,p,null,v)},sn.flushSync=function(h){var p=f.T,v=o.p;try{if(f.T=null,o.p=2,h)return h()}finally{f.T=p,o.p=v,o.d.f()}},sn.preconnect=function(h,p){typeof h=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,o.d.C(h,p))},sn.prefetchDNS=function(h){typeof h=="string"&&o.d.D(h)},sn.preinit=function(h,p){if(typeof h=="string"&&p&&typeof p.as=="string"){var v=p.as,T=g(v,p.crossOrigin),C=typeof p.integrity=="string"?p.integrity:void 0,S=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;v==="style"?o.d.S(h,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:T,integrity:C,fetchPriority:S}):v==="script"&&o.d.X(h,{crossOrigin:T,integrity:C,fetchPriority:S,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},sn.preinitModule=function(h,p){if(typeof h=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var v=g(p.as,p.crossOrigin);o.d.M(h,{crossOrigin:v,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&o.d.M(h)},sn.preload=function(h,p){if(typeof h=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var v=p.as,T=g(v,p.crossOrigin);o.d.L(h,v,{crossOrigin:T,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},sn.preloadModule=function(h,p){if(typeof h=="string")if(p){var v=g(p.as,p.crossOrigin);o.d.m(h,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:v,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else o.d.m(h)},sn.requestFormReset=function(h){o.d.r(h)},sn.unstable_batchedUpdates=function(h,p){return h(p)},sn.useFormState=function(h,p,v){return f.H.useFormState(h,p,v)},sn.useFormStatus=function(){return f.H.useHostTransitionStatus()},sn.version="19.1.0",sn}var Rp;function vT(){if(Rp)return dc.exports;Rp=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),dc.exports=yT(),dc.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mp;function TT(){if(Mp)return rr;Mp=1;var a=hT(),e=kc(),t=vT();function o(n){var i="https://react.dev/errors/"+n;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)i+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+n+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function u(n){var i=n,r=n;if(n.alternate)for(;i.return;)i=i.return;else{n=i;do i=n,(i.flags&4098)!==0&&(r=i.return),n=i.return;while(n)}return i.tag===3?r:null}function f(n){if(n.tag===13){var i=n.memoizedState;if(i===null&&(n=n.alternate,n!==null&&(i=n.memoizedState)),i!==null)return i.dehydrated}return null}function g(n){if(u(n)!==n)throw Error(o(188))}function h(n){var i=n.alternate;if(!i){if(i=u(n),i===null)throw Error(o(188));return i!==n?null:n}for(var r=n,l=i;;){var m=r.return;if(m===null)break;var y=m.alternate;if(y===null){if(l=m.return,l!==null){r=l;continue}break}if(m.child===y.child){for(y=m.child;y;){if(y===r)return g(m),n;if(y===l)return g(m),i;y=y.sibling}throw Error(o(188))}if(r.return!==l.return)r=m,l=y;else{for(var x=!1,N=m.child;N;){if(N===r){x=!0,r=m,l=y;break}if(N===l){x=!0,l=m,r=y;break}N=N.sibling}if(!x){for(N=y.child;N;){if(N===r){x=!0,r=y,l=m;break}if(N===l){x=!0,l=y,r=m;break}N=N.sibling}if(!x)throw Error(o(189))}}if(r.alternate!==l)throw Error(o(190))}if(r.tag!==3)throw Error(o(188));return r.stateNode.current===r?n:i}function p(n){var i=n.tag;if(i===5||i===26||i===27||i===6)return n;for(n=n.child;n!==null;){if(i=p(n),i!==null)return i;n=n.sibling}return null}var v=Object.assign,T=Symbol.for("react.element"),C=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),M=Symbol.for("react.consumer"),L=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),$=Symbol.for("react.suspense"),V=Symbol.for("react.suspense_list"),Q=Symbol.for("react.memo"),te=Symbol.for("react.lazy"),F=Symbol.for("react.activity"),ae=Symbol.for("react.memo_cache_sentinel"),W=Symbol.iterator;function z(n){return n===null||typeof n!="object"?null:(n=W&&n[W]||n["@@iterator"],typeof n=="function"?n:null)}var ue=Symbol.for("react.client.reference");function re(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===ue?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case w:return"Fragment";case b:return"Profiler";case I:return"StrictMode";case $:return"Suspense";case V:return"SuspenseList";case F:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case S:return"Portal";case L:return(n.displayName||"Context")+".Provider";case M:return(n._context.displayName||"Context")+".Consumer";case R:var i=n.render;return n=n.displayName,n||(n=i.displayName||i.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Q:return i=n.displayName||null,i!==null?i:re(n.type)||"Memo";case te:i=n._payload,n=n._init;try{return re(n(i))}catch{}}return null}var se=Array.isArray,U=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J={pending:!1,data:null,method:null,action:null},he=[],P=-1;function j(n){return{current:n}}function Z(n){0>P||(n.current=he[P],he[P]=null,P--)}function ie(n,i){P++,he[P]=n.current,n.current=i}var fe=j(null),ce=j(null),de=j(null),le=j(null);function me(n,i){switch(ie(de,i),ie(ce,n),ie(fe,null),i.nodeType){case 9:case 11:n=(n=i.documentElement)&&(n=n.namespaceURI)?jm(n):0;break;default:if(n=i.tagName,i=i.namespaceURI)i=jm(i),n=Qm(i,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}Z(fe),ie(fe,n)}function K(){Z(fe),Z(ce),Z(de)}function Ve(n){n.memoizedState!==null&&ie(le,n);var i=fe.current,r=Qm(i,n.type);i!==r&&(ie(ce,n),ie(fe,r))}function Te(n){ce.current===n&&(Z(fe),Z(ce)),le.current===n&&(Z(le),er._currentValue=J)}var we=Object.prototype.hasOwnProperty,Me=a.unstable_scheduleCallback,Ge=a.unstable_cancelCallback,be=a.unstable_shouldYield,Ke=a.unstable_requestPaint,Ze=a.unstable_now,Wt=a.unstable_getCurrentPriorityLevel,kt=a.unstable_ImmediatePriority,xt=a.unstable_UserBlockingPriority,St=a.unstable_NormalPriority,en=a.unstable_LowPriority,Wn=a.unstable_IdlePriority,Ta=a.log,Zi=a.unstable_setDisableYieldValue,Yn=null,Jt=null;function yn(n){if(typeof Ta=="function"&&Zi(n),Jt&&typeof Jt.setStrictMode=="function")try{Jt.setStrictMode(Yn,n)}catch{}}var on=Math.clz32?Math.clz32:qe,Ne=Math.log,Ie=Math.LN2;function qe(n){return n>>>=0,n===0?32:31-(Ne(n)/Ie|0)|0}var pe=256,Pe=4194304;function Be(n){var i=n&42;if(i!==0)return i;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function Se(n,i,r){var l=n.pendingLanes;if(l===0)return 0;var m=0,y=n.suspendedLanes,x=n.pingedLanes;n=n.warmLanes;var N=l&134217727;return N!==0?(l=N&~y,l!==0?m=Be(l):(x&=N,x!==0?m=Be(x):r||(r=N&~n,r!==0&&(m=Be(r))))):(N=l&~y,N!==0?m=Be(N):x!==0?m=Be(x):r||(r=l&~n,r!==0&&(m=Be(r)))),m===0?0:i!==0&&i!==m&&(i&y)===0&&(y=m&-m,r=i&-i,y>=r||y===32&&(r&4194048)!==0)?i:m}function ht(n,i){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&i)===0}function et(n,i){switch(n){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Le(){var n=pe;return pe<<=1,(pe&4194048)===0&&(pe=256),n}function Ut(){var n=Pe;return Pe<<=1,(Pe&62914560)===0&&(Pe=4194304),n}function ft(n){for(var i=[],r=0;31>r;r++)i.push(n);return i}function Ae(n,i){n.pendingLanes|=i,i!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function Kt(n,i,r,l,m,y){var x=n.pendingLanes;n.pendingLanes=r,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=r,n.entangledLanes&=r,n.errorRecoveryDisabledLanes&=r,n.shellSuspendCounter=0;var N=n.entanglements,k=n.expirationTimes,H=n.hiddenUpdates;for(r=x&~r;0<r;){var ee=31-on(r),oe=1<<ee;N[ee]=0,k[ee]=-1;var q=H[ee];if(q!==null)for(H[ee]=null,ee=0;ee<q.length;ee++){var B=q[ee];B!==null&&(B.lane&=-536870913)}r&=~oe}l!==0&&ve(n,l,0),y!==0&&m===0&&n.tag!==0&&(n.suspendedLanes|=y&~(x&~i))}function ve(n,i,r){n.pendingLanes|=i,n.suspendedLanes&=~i;var l=31-on(i);n.entangledLanes|=i,n.entanglements[l]=n.entanglements[l]|1073741824|r&4194090}function lt(n,i){var r=n.entangledLanes|=i;for(n=n.entanglements;r;){var l=31-on(r),m=1<<l;m&i|n[l]&i&&(n[l]|=i),r&=~m}}function tt(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function un(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function vn(){var n=X.p;return n!==0?n:(n=window.event,n===void 0?32:yp(n.type))}function ut(n,i){var r=X.p;try{return X.p=n,i()}finally{X.p=r}}var yt=Math.random().toString(36).slice(2),rt="__reactFiber$"+yt,ct="__reactProps$"+yt,Tn="__reactContainer$"+yt,fo="__reactEvents$"+yt,Qs="__reactListeners$"+yt,Ws="__reactHandles$"+yt,vr="__reactResources$"+yt,Xi="__reactMarker$"+yt;function it(n){delete n[rt],delete n[ct],delete n[fo],delete n[Qs],delete n[Ws]}function Zt(n){var i=n[rt];if(i)return i;for(var r=n.parentNode;r;){if(i=r[Tn]||r[rt]){if(r=i.alternate,i.child!==null||r!==null&&r.child!==null)for(n=np(n);n!==null;){if(r=n[rt])return r;n=np(n)}return i}n=r,r=n.parentNode}return null}function _t(n){if(n=n[rt]||n[Tn]){var i=n.tag;if(i===5||i===6||i===13||i===26||i===27||i===3)return n}return null}function $t(n){var i=n.tag;if(i===5||i===26||i===27||i===6)return n.stateNode;throw Error(o(33))}function vt(n){var i=n[vr];return i||(i=n[vr]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function Qe(n){n[Xi]=!0}var He=new Set,Nt={};function dt(n,i){Cn(n,i),Cn(n+"Capture",i)}function Cn(n,i){for(Nt[n]=i,n=0;n<i.length;n++)He.add(i[n])}var ei=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Vc={},qc={};function oy(n){return we.call(qc,n)?!0:we.call(Vc,n)?!1:ei.test(n)?qc[n]=!0:(Vc[n]=!0,!1)}function Tr(n,i,r){if(oy(i))if(r===null)n.removeAttribute(i);else{switch(typeof r){case"undefined":case"function":case"symbol":n.removeAttribute(i);return;case"boolean":var l=i.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){n.removeAttribute(i);return}}n.setAttribute(i,""+r)}}function Cr(n,i,r){if(r===null)n.removeAttribute(i);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(i);return}n.setAttribute(i,""+r)}}function ti(n,i,r,l){if(l===null)n.removeAttribute(r);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(r);return}n.setAttributeNS(i,r,""+l)}}var el,Fc;function Ca(n){if(el===void 0)try{throw Error()}catch(r){var i=r.stack.trim().match(/\n( *(at )?)/);el=i&&i[1]||"",Fc=-1<r.stack.indexOf(`
    at`)?" (<anonymous>)":-1<r.stack.indexOf("@")?"@unknown:0:0":""}return`
`+el+n+Fc}var tl=!1;function nl(n,i){if(!n||tl)return"";tl=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(i){var oe=function(){throw Error()};if(Object.defineProperty(oe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(oe,[])}catch(B){var q=B}Reflect.construct(n,[],oe)}else{try{oe.call()}catch(B){q=B}n.call(oe.prototype)}}else{try{throw Error()}catch(B){q=B}(oe=n())&&typeof oe.catch=="function"&&oe.catch(function(){})}}catch(B){if(B&&q&&typeof B.stack=="string")return[B.stack,q.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=l.DetermineComponentFrameRoot(),x=y[0],N=y[1];if(x&&N){var k=x.split(`
`),H=N.split(`
`);for(m=l=0;l<k.length&&!k[l].includes("DetermineComponentFrameRoot");)l++;for(;m<H.length&&!H[m].includes("DetermineComponentFrameRoot");)m++;if(l===k.length||m===H.length)for(l=k.length-1,m=H.length-1;1<=l&&0<=m&&k[l]!==H[m];)m--;for(;1<=l&&0<=m;l--,m--)if(k[l]!==H[m]){if(l!==1||m!==1)do if(l--,m--,0>m||k[l]!==H[m]){var ee=`
`+k[l].replace(" at new "," at ");return n.displayName&&ee.includes("<anonymous>")&&(ee=ee.replace("<anonymous>",n.displayName)),ee}while(1<=l&&0<=m);break}}}finally{tl=!1,Error.prepareStackTrace=r}return(r=n?n.displayName||n.name:"")?Ca(r):""}function ry(n){switch(n.tag){case 26:case 27:case 5:return Ca(n.type);case 16:return Ca("Lazy");case 13:return Ca("Suspense");case 19:return Ca("SuspenseList");case 0:case 15:return nl(n.type,!1);case 11:return nl(n.type.render,!1);case 1:return nl(n.type,!0);case 31:return Ca("Activity");default:return""}}function Yc(n){try{var i="";do i+=ry(n),n=n.return;while(n);return i}catch(r){return`
Error generating stack: `+r.message+`
`+r.stack}}function In(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Bc(n){var i=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function sy(n){var i=Bc(n)?"checked":"value",r=Object.getOwnPropertyDescriptor(n.constructor.prototype,i),l=""+n[i];if(!n.hasOwnProperty(i)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var m=r.get,y=r.set;return Object.defineProperty(n,i,{configurable:!0,get:function(){return m.call(this)},set:function(x){l=""+x,y.call(this,x)}}),Object.defineProperty(n,i,{enumerable:r.enumerable}),{getValue:function(){return l},setValue:function(x){l=""+x},stopTracking:function(){n._valueTracker=null,delete n[i]}}}}function Er(n){n._valueTracker||(n._valueTracker=sy(n))}function zc(n){if(!n)return!1;var i=n._valueTracker;if(!i)return!0;var r=i.getValue(),l="";return n&&(l=Bc(n)?n.checked?"true":"false":n.value),n=l,n!==r?(i.setValue(n),!0):!1}function xr(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var ly=/[\n"\\]/g;function Rn(n){return n.replace(ly,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function il(n,i,r,l,m,y,x,N){n.name="",x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?n.type=x:n.removeAttribute("type"),i!=null?x==="number"?(i===0&&n.value===""||n.value!=i)&&(n.value=""+In(i)):n.value!==""+In(i)&&(n.value=""+In(i)):x!=="submit"&&x!=="reset"||n.removeAttribute("value"),i!=null?al(n,x,In(i)):r!=null?al(n,x,In(r)):l!=null&&n.removeAttribute("value"),m==null&&y!=null&&(n.defaultChecked=!!y),m!=null&&(n.checked=m&&typeof m!="function"&&typeof m!="symbol"),N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?n.name=""+In(N):n.removeAttribute("name")}function Jc(n,i,r,l,m,y,x,N){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(n.type=y),i!=null||r!=null){if(!(y!=="submit"&&y!=="reset"||i!=null))return;r=r!=null?""+In(r):"",i=i!=null?""+In(i):r,N||i===n.value||(n.value=i),n.defaultValue=i}l=l??m,l=typeof l!="function"&&typeof l!="symbol"&&!!l,n.checked=N?n.checked:!!l,n.defaultChecked=!!l,x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(n.name=x)}function al(n,i,r){i==="number"&&xr(n.ownerDocument)===n||n.defaultValue===""+r||(n.defaultValue=""+r)}function Ea(n,i,r,l){if(n=n.options,i){i={};for(var m=0;m<r.length;m++)i["$"+r[m]]=!0;for(r=0;r<n.length;r++)m=i.hasOwnProperty("$"+n[r].value),n[r].selected!==m&&(n[r].selected=m),m&&l&&(n[r].defaultSelected=!0)}else{for(r=""+In(r),i=null,m=0;m<n.length;m++){if(n[m].value===r){n[m].selected=!0,l&&(n[m].defaultSelected=!0);return}i!==null||n[m].disabled||(i=n[m])}i!==null&&(i.selected=!0)}}function Kc(n,i,r){if(i!=null&&(i=""+In(i),i!==n.value&&(n.value=i),r==null)){n.defaultValue!==i&&(n.defaultValue=i);return}n.defaultValue=r!=null?""+In(r):""}function Zc(n,i,r,l){if(i==null){if(l!=null){if(r!=null)throw Error(o(92));if(se(l)){if(1<l.length)throw Error(o(93));l=l[0]}r=l}r==null&&(r=""),i=r}r=In(i),n.defaultValue=r,l=n.textContent,l===r&&l!==""&&l!==null&&(n.value=l)}function xa(n,i){if(i){var r=n.firstChild;if(r&&r===n.lastChild&&r.nodeType===3){r.nodeValue=i;return}}n.textContent=i}var uy=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Xc(n,i,r){var l=i.indexOf("--")===0;r==null||typeof r=="boolean"||r===""?l?n.setProperty(i,""):i==="float"?n.cssFloat="":n[i]="":l?n.setProperty(i,r):typeof r!="number"||r===0||uy.has(i)?i==="float"?n.cssFloat=r:n[i]=(""+r).trim():n[i]=r+"px"}function jc(n,i,r){if(i!=null&&typeof i!="object")throw Error(o(62));if(n=n.style,r!=null){for(var l in r)!r.hasOwnProperty(l)||i!=null&&i.hasOwnProperty(l)||(l.indexOf("--")===0?n.setProperty(l,""):l==="float"?n.cssFloat="":n[l]="");for(var m in i)l=i[m],i.hasOwnProperty(m)&&r[m]!==l&&Xc(n,m,l)}else for(var y in i)i.hasOwnProperty(y)&&Xc(n,y,i[y])}function ol(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cy=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),dy=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Sr(n){return dy.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}var rl=null;function sl(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Sa=null,ba=null;function Qc(n){var i=_t(n);if(i&&(n=i.stateNode)){var r=n[ct]||null;e:switch(n=i.stateNode,i.type){case"input":if(il(n,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name),i=r.name,r.type==="radio"&&i!=null){for(r=n;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll('input[name="'+Rn(""+i)+'"][type="radio"]'),i=0;i<r.length;i++){var l=r[i];if(l!==n&&l.form===n.form){var m=l[ct]||null;if(!m)throw Error(o(90));il(l,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(i=0;i<r.length;i++)l=r[i],l.form===n.form&&zc(l)}break e;case"textarea":Kc(n,r.value,r.defaultValue);break e;case"select":i=r.value,i!=null&&Ea(n,!!r.multiple,i,!1)}}}var ll=!1;function Wc(n,i,r){if(ll)return n(i,r);ll=!0;try{var l=n(i);return l}finally{if(ll=!1,(Sa!==null||ba!==null)&&(ls(),Sa&&(i=Sa,n=ba,ba=Sa=null,Qc(i),n)))for(i=0;i<n.length;i++)Qc(n[i])}}function mo(n,i){var r=n.stateNode;if(r===null)return null;var l=r[ct]||null;if(l===null)return null;r=l[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(n=n.type,l=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!l;break e;default:n=!1}if(n)return null;if(r&&typeof r!="function")throw Error(o(231,i,typeof r));return r}var ni=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ul=!1;if(ni)try{var po={};Object.defineProperty(po,"passive",{get:function(){ul=!0}}),window.addEventListener("test",po,po),window.removeEventListener("test",po,po)}catch{ul=!1}var vi=null,cl=null,br=null;function ed(){if(br)return br;var n,i=cl,r=i.length,l,m="value"in vi?vi.value:vi.textContent,y=m.length;for(n=0;n<r&&i[n]===m[n];n++);var x=r-n;for(l=1;l<=x&&i[r-l]===m[y-l];l++);return br=m.slice(n,1<l?1-l:void 0)}function _r(n){var i=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&i===13&&(n=13)):n=i,n===10&&(n=13),32<=n||n===13?n:0}function Nr(){return!0}function td(){return!1}function fn(n){function i(r,l,m,y,x){this._reactName=r,this._targetInst=m,this.type=l,this.nativeEvent=y,this.target=x,this.currentTarget=null;for(var N in n)n.hasOwnProperty(N)&&(r=n[N],this[N]=r?r(y):y[N]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Nr:td,this.isPropagationStopped=td,this}return v(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Nr)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Nr)},persist:function(){},isPersistent:Nr}),i}var ji={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ar=fn(ji),go=v({},ji,{view:0,detail:0}),fy=fn(go),dl,fl,ho,wr=v({},go,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pl,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ho&&(ho&&n.type==="mousemove"?(dl=n.screenX-ho.screenX,fl=n.screenY-ho.screenY):fl=dl=0,ho=n),dl)},movementY:function(n){return"movementY"in n?n.movementY:fl}}),nd=fn(wr),my=v({},wr,{dataTransfer:0}),py=fn(my),gy=v({},go,{relatedTarget:0}),ml=fn(gy),hy=v({},ji,{animationName:0,elapsedTime:0,pseudoElement:0}),yy=fn(hy),vy=v({},ji,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Ty=fn(vy),Cy=v({},ji,{data:0}),id=fn(Cy),Ey={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function by(n){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(n):(n=Sy[n])?!!i[n]:!1}function pl(){return by}var _y=v({},go,{key:function(n){if(n.key){var i=Ey[n.key]||n.key;if(i!=="Unidentified")return i}return n.type==="keypress"?(n=_r(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?xy[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pl,charCode:function(n){return n.type==="keypress"?_r(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?_r(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Ny=fn(_y),Ay=v({},wr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ad=fn(Ay),wy=v({},go,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pl}),Iy=fn(wy),Ry=v({},ji,{propertyName:0,elapsedTime:0,pseudoElement:0}),My=fn(Ry),Ly=v({},wr,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),ky=fn(Ly),$y=v({},ji,{newState:0,oldState:0}),Py=fn($y),Dy=[9,13,27,32],gl=ni&&"CompositionEvent"in window,yo=null;ni&&"documentMode"in document&&(yo=document.documentMode);var Uy=ni&&"TextEvent"in window&&!yo,od=ni&&(!gl||yo&&8<yo&&11>=yo),rd=" ",sd=!1;function ld(n,i){switch(n){case"keyup":return Dy.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ud(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var _a=!1;function Oy(n,i){switch(n){case"compositionend":return ud(i);case"keypress":return i.which!==32?null:(sd=!0,rd);case"textInput":return n=i.data,n===rd&&sd?null:n;default:return null}}function Gy(n,i){if(_a)return n==="compositionend"||!gl&&ld(n,i)?(n=ed(),br=cl=vi=null,_a=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return od&&i.locale!=="ko"?null:i.data;default:return null}}var Hy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cd(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i==="input"?!!Hy[n.type]:i==="textarea"}function dd(n,i,r,l){Sa?ba?ba.push(l):ba=[l]:Sa=l,i=ps(i,"onChange"),0<i.length&&(r=new Ar("onChange","change",null,r,l),n.push({event:r,listeners:i}))}var vo=null,To=null;function Vy(n){zm(n,0)}function Ir(n){var i=$t(n);if(zc(i))return n}function fd(n,i){if(n==="change")return i}var md=!1;if(ni){var hl;if(ni){var yl="oninput"in document;if(!yl){var pd=document.createElement("div");pd.setAttribute("oninput","return;"),yl=typeof pd.oninput=="function"}hl=yl}else hl=!1;md=hl&&(!document.documentMode||9<document.documentMode)}function gd(){vo&&(vo.detachEvent("onpropertychange",hd),To=vo=null)}function hd(n){if(n.propertyName==="value"&&Ir(To)){var i=[];dd(i,To,n,sl(n)),Wc(Vy,i)}}function qy(n,i,r){n==="focusin"?(gd(),vo=i,To=r,vo.attachEvent("onpropertychange",hd)):n==="focusout"&&gd()}function Fy(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Ir(To)}function Yy(n,i){if(n==="click")return Ir(i)}function By(n,i){if(n==="input"||n==="change")return Ir(i)}function zy(n,i){return n===i&&(n!==0||1/n===1/i)||n!==n&&i!==i}var En=typeof Object.is=="function"?Object.is:zy;function Co(n,i){if(En(n,i))return!0;if(typeof n!="object"||n===null||typeof i!="object"||i===null)return!1;var r=Object.keys(n),l=Object.keys(i);if(r.length!==l.length)return!1;for(l=0;l<r.length;l++){var m=r[l];if(!we.call(i,m)||!En(n[m],i[m]))return!1}return!0}function yd(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function vd(n,i){var r=yd(n);n=0;for(var l;r;){if(r.nodeType===3){if(l=n+r.textContent.length,n<=i&&l>=i)return{node:r,offset:i-n};n=l}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=yd(r)}}function Td(n,i){return n&&i?n===i?!0:n&&n.nodeType===3?!1:i&&i.nodeType===3?Td(n,i.parentNode):"contains"in n?n.contains(i):n.compareDocumentPosition?!!(n.compareDocumentPosition(i)&16):!1:!1}function Cd(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var i=xr(n.document);i instanceof n.HTMLIFrameElement;){try{var r=typeof i.contentWindow.location.href=="string"}catch{r=!1}if(r)n=i.contentWindow;else break;i=xr(n.document)}return i}function vl(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i&&(i==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||i==="textarea"||n.contentEditable==="true")}var Jy=ni&&"documentMode"in document&&11>=document.documentMode,Na=null,Tl=null,Eo=null,Cl=!1;function Ed(n,i,r){var l=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Cl||Na==null||Na!==xr(l)||(l=Na,"selectionStart"in l&&vl(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),Eo&&Co(Eo,l)||(Eo=l,l=ps(Tl,"onSelect"),0<l.length&&(i=new Ar("onSelect","select",null,i,r),n.push({event:i,listeners:l}),i.target=Na)))}function Qi(n,i){var r={};return r[n.toLowerCase()]=i.toLowerCase(),r["Webkit"+n]="webkit"+i,r["Moz"+n]="moz"+i,r}var Aa={animationend:Qi("Animation","AnimationEnd"),animationiteration:Qi("Animation","AnimationIteration"),animationstart:Qi("Animation","AnimationStart"),transitionrun:Qi("Transition","TransitionRun"),transitionstart:Qi("Transition","TransitionStart"),transitioncancel:Qi("Transition","TransitionCancel"),transitionend:Qi("Transition","TransitionEnd")},El={},xd={};ni&&(xd=document.createElement("div").style,"AnimationEvent"in window||(delete Aa.animationend.animation,delete Aa.animationiteration.animation,delete Aa.animationstart.animation),"TransitionEvent"in window||delete Aa.transitionend.transition);function Wi(n){if(El[n])return El[n];if(!Aa[n])return n;var i=Aa[n],r;for(r in i)if(i.hasOwnProperty(r)&&r in xd)return El[n]=i[r];return n}var Sd=Wi("animationend"),bd=Wi("animationiteration"),_d=Wi("animationstart"),Ky=Wi("transitionrun"),Zy=Wi("transitionstart"),Xy=Wi("transitioncancel"),Nd=Wi("transitionend"),Ad=new Map,xl="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");xl.push("scrollEnd");function Hn(n,i){Ad.set(n,i),dt(i,[n])}var wd=new WeakMap;function Mn(n,i){if(typeof n=="object"&&n!==null){var r=wd.get(n);return r!==void 0?r:(i={value:n,source:i,stack:Yc(i)},wd.set(n,i),i)}return{value:n,source:i,stack:Yc(i)}}var Ln=[],wa=0,Sl=0;function Rr(){for(var n=wa,i=Sl=wa=0;i<n;){var r=Ln[i];Ln[i++]=null;var l=Ln[i];Ln[i++]=null;var m=Ln[i];Ln[i++]=null;var y=Ln[i];if(Ln[i++]=null,l!==null&&m!==null){var x=l.pending;x===null?m.next=m:(m.next=x.next,x.next=m),l.pending=m}y!==0&&Id(r,m,y)}}function Mr(n,i,r,l){Ln[wa++]=n,Ln[wa++]=i,Ln[wa++]=r,Ln[wa++]=l,Sl|=l,n.lanes|=l,n=n.alternate,n!==null&&(n.lanes|=l)}function bl(n,i,r,l){return Mr(n,i,r,l),Lr(n)}function Ia(n,i){return Mr(n,null,null,i),Lr(n)}function Id(n,i,r){n.lanes|=r;var l=n.alternate;l!==null&&(l.lanes|=r);for(var m=!1,y=n.return;y!==null;)y.childLanes|=r,l=y.alternate,l!==null&&(l.childLanes|=r),y.tag===22&&(n=y.stateNode,n===null||n._visibility&1||(m=!0)),n=y,y=y.return;return n.tag===3?(y=n.stateNode,m&&i!==null&&(m=31-on(r),n=y.hiddenUpdates,l=n[m],l===null?n[m]=[i]:l.push(i),i.lane=r|536870912),y):null}function Lr(n){if(50<zo)throw zo=0,Ru=null,Error(o(185));for(var i=n.return;i!==null;)n=i,i=n.return;return n.tag===3?n.stateNode:null}var Ra={};function jy(n,i,r,l){this.tag=n,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xn(n,i,r,l){return new jy(n,i,r,l)}function _l(n){return n=n.prototype,!(!n||!n.isReactComponent)}function ii(n,i){var r=n.alternate;return r===null?(r=xn(n.tag,i,n.key,n.mode),r.elementType=n.elementType,r.type=n.type,r.stateNode=n.stateNode,r.alternate=n,n.alternate=r):(r.pendingProps=i,r.type=n.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=n.flags&65011712,r.childLanes=n.childLanes,r.lanes=n.lanes,r.child=n.child,r.memoizedProps=n.memoizedProps,r.memoizedState=n.memoizedState,r.updateQueue=n.updateQueue,i=n.dependencies,r.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},r.sibling=n.sibling,r.index=n.index,r.ref=n.ref,r.refCleanup=n.refCleanup,r}function Rd(n,i){n.flags&=65011714;var r=n.alternate;return r===null?(n.childLanes=0,n.lanes=i,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=r.childLanes,n.lanes=r.lanes,n.child=r.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=r.memoizedProps,n.memoizedState=r.memoizedState,n.updateQueue=r.updateQueue,n.type=r.type,i=r.dependencies,n.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),n}function kr(n,i,r,l,m,y){var x=0;if(l=n,typeof n=="function")_l(n)&&(x=1);else if(typeof n=="string")x=Wv(n,r,fe.current)?26:n==="html"||n==="head"||n==="body"?27:5;else e:switch(n){case F:return n=xn(31,r,i,m),n.elementType=F,n.lanes=y,n;case w:return ea(r.children,m,y,i);case I:x=8,m|=24;break;case b:return n=xn(12,r,i,m|2),n.elementType=b,n.lanes=y,n;case $:return n=xn(13,r,i,m),n.elementType=$,n.lanes=y,n;case V:return n=xn(19,r,i,m),n.elementType=V,n.lanes=y,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case A:case L:x=10;break e;case M:x=9;break e;case R:x=11;break e;case Q:x=14;break e;case te:x=16,l=null;break e}x=29,r=Error(o(130,n===null?"null":typeof n,"")),l=null}return i=xn(x,r,i,m),i.elementType=n,i.type=l,i.lanes=y,i}function ea(n,i,r,l){return n=xn(7,n,l,i),n.lanes=r,n}function Nl(n,i,r){return n=xn(6,n,null,i),n.lanes=r,n}function Al(n,i,r){return i=xn(4,n.children!==null?n.children:[],n.key,i),i.lanes=r,i.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},i}var Ma=[],La=0,$r=null,Pr=0,kn=[],$n=0,ta=null,ai=1,oi="";function na(n,i){Ma[La++]=Pr,Ma[La++]=$r,$r=n,Pr=i}function Md(n,i,r){kn[$n++]=ai,kn[$n++]=oi,kn[$n++]=ta,ta=n;var l=ai;n=oi;var m=32-on(l)-1;l&=~(1<<m),r+=1;var y=32-on(i)+m;if(30<y){var x=m-m%5;y=(l&(1<<x)-1).toString(32),l>>=x,m-=x,ai=1<<32-on(i)+m|r<<m|l,oi=y+n}else ai=1<<y|r<<m|l,oi=n}function wl(n){n.return!==null&&(na(n,1),Md(n,1,0))}function Il(n){for(;n===$r;)$r=Ma[--La],Ma[La]=null,Pr=Ma[--La],Ma[La]=null;for(;n===ta;)ta=kn[--$n],kn[$n]=null,oi=kn[--$n],kn[$n]=null,ai=kn[--$n],kn[$n]=null}var cn=null,Pt=null,st=!1,ia=null,Bn=!1,Rl=Error(o(519));function aa(n){var i=Error(o(418,""));throw bo(Mn(i,n)),Rl}function Ld(n){var i=n.stateNode,r=n.type,l=n.memoizedProps;switch(i[rt]=n,i[ct]=l,r){case"dialog":je("cancel",i),je("close",i);break;case"iframe":case"object":case"embed":je("load",i);break;case"video":case"audio":for(r=0;r<Ko.length;r++)je(Ko[r],i);break;case"source":je("error",i);break;case"img":case"image":case"link":je("error",i),je("load",i);break;case"details":je("toggle",i);break;case"input":je("invalid",i),Jc(i,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0),Er(i);break;case"select":je("invalid",i);break;case"textarea":je("invalid",i),Zc(i,l.value,l.defaultValue,l.children),Er(i)}r=l.children,typeof r!="string"&&typeof r!="number"&&typeof r!="bigint"||i.textContent===""+r||l.suppressHydrationWarning===!0||Xm(i.textContent,r)?(l.popover!=null&&(je("beforetoggle",i),je("toggle",i)),l.onScroll!=null&&je("scroll",i),l.onScrollEnd!=null&&je("scrollend",i),l.onClick!=null&&(i.onclick=gs),i=!0):i=!1,i||aa(n)}function kd(n){for(cn=n.return;cn;)switch(cn.tag){case 5:case 13:Bn=!1;return;case 27:case 3:Bn=!0;return;default:cn=cn.return}}function xo(n){if(n!==cn)return!1;if(!st)return kd(n),st=!0,!1;var i=n.tag,r;if((r=i!==3&&i!==27)&&((r=i===5)&&(r=n.type,r=!(r!=="form"&&r!=="button")||zu(n.type,n.memoizedProps)),r=!r),r&&Pt&&aa(n),kd(n),i===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(o(317));e:{for(n=n.nextSibling,i=0;n;){if(n.nodeType===8)if(r=n.data,r==="/$"){if(i===0){Pt=qn(n.nextSibling);break e}i--}else r!=="$"&&r!=="$!"&&r!=="$?"||i++;n=n.nextSibling}Pt=null}}else i===27?(i=Pt,$i(n.type)?(n=Xu,Xu=null,Pt=n):Pt=i):Pt=cn?qn(n.stateNode.nextSibling):null;return!0}function So(){Pt=cn=null,st=!1}function $d(){var n=ia;return n!==null&&(gn===null?gn=n:gn.push.apply(gn,n),ia=null),n}function bo(n){ia===null?ia=[n]:ia.push(n)}var Ml=j(null),oa=null,ri=null;function Ti(n,i,r){ie(Ml,i._currentValue),i._currentValue=r}function si(n){n._currentValue=Ml.current,Z(Ml)}function Ll(n,i,r){for(;n!==null;){var l=n.alternate;if((n.childLanes&i)!==i?(n.childLanes|=i,l!==null&&(l.childLanes|=i)):l!==null&&(l.childLanes&i)!==i&&(l.childLanes|=i),n===r)break;n=n.return}}function kl(n,i,r,l){var m=n.child;for(m!==null&&(m.return=n);m!==null;){var y=m.dependencies;if(y!==null){var x=m.child;y=y.firstContext;e:for(;y!==null;){var N=y;y=m;for(var k=0;k<i.length;k++)if(N.context===i[k]){y.lanes|=r,N=y.alternate,N!==null&&(N.lanes|=r),Ll(y.return,r,n),l||(x=null);break e}y=N.next}}else if(m.tag===18){if(x=m.return,x===null)throw Error(o(341));x.lanes|=r,y=x.alternate,y!==null&&(y.lanes|=r),Ll(x,r,n),x=null}else x=m.child;if(x!==null)x.return=m;else for(x=m;x!==null;){if(x===n){x=null;break}if(m=x.sibling,m!==null){m.return=x.return,x=m;break}x=x.return}m=x}}function _o(n,i,r,l){n=null;for(var m=i,y=!1;m!==null;){if(!y){if((m.flags&524288)!==0)y=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var x=m.alternate;if(x===null)throw Error(o(387));if(x=x.memoizedProps,x!==null){var N=m.type;En(m.pendingProps.value,x.value)||(n!==null?n.push(N):n=[N])}}else if(m===le.current){if(x=m.alternate,x===null)throw Error(o(387));x.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(n!==null?n.push(er):n=[er])}m=m.return}n!==null&&kl(i,n,r,l),i.flags|=262144}function Dr(n){for(n=n.firstContext;n!==null;){if(!En(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function ra(n){oa=n,ri=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function rn(n){return Pd(oa,n)}function Ur(n,i){return oa===null&&ra(n),Pd(n,i)}function Pd(n,i){var r=i._currentValue;if(i={context:i,memoizedValue:r,next:null},ri===null){if(n===null)throw Error(o(308));ri=i,n.dependencies={lanes:0,firstContext:i},n.flags|=524288}else ri=ri.next=i;return r}var Qy=typeof AbortController<"u"?AbortController:function(){var n=[],i=this.signal={aborted:!1,addEventListener:function(r,l){n.push(l)}};this.abort=function(){i.aborted=!0,n.forEach(function(r){return r()})}},Wy=a.unstable_scheduleCallback,ev=a.unstable_NormalPriority,Yt={$$typeof:L,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function $l(){return{controller:new Qy,data:new Map,refCount:0}}function No(n){n.refCount--,n.refCount===0&&Wy(ev,function(){n.controller.abort()})}var Ao=null,Pl=0,ka=0,$a=null;function tv(n,i){if(Ao===null){var r=Ao=[];Pl=0,ka=Uu(),$a={status:"pending",value:void 0,then:function(l){r.push(l)}}}return Pl++,i.then(Dd,Dd),i}function Dd(){if(--Pl===0&&Ao!==null){$a!==null&&($a.status="fulfilled");var n=Ao;Ao=null,ka=0,$a=null;for(var i=0;i<n.length;i++)(0,n[i])()}}function nv(n,i){var r=[],l={status:"pending",value:null,reason:null,then:function(m){r.push(m)}};return n.then(function(){l.status="fulfilled",l.value=i;for(var m=0;m<r.length;m++)(0,r[m])(i)},function(m){for(l.status="rejected",l.reason=m,m=0;m<r.length;m++)(0,r[m])(void 0)}),l}var Ud=U.S;U.S=function(n,i){typeof i=="object"&&i!==null&&typeof i.then=="function"&&tv(n,i),Ud!==null&&Ud(n,i)};var sa=j(null);function Dl(){var n=sa.current;return n!==null?n:At.pooledCache}function Or(n,i){i===null?ie(sa,sa.current):ie(sa,i.pool)}function Od(){var n=Dl();return n===null?null:{parent:Yt._currentValue,pool:n}}var wo=Error(o(460)),Gd=Error(o(474)),Gr=Error(o(542)),Ul={then:function(){}};function Hd(n){return n=n.status,n==="fulfilled"||n==="rejected"}function Hr(){}function Vd(n,i,r){switch(r=n[r],r===void 0?n.push(i):r!==i&&(i.then(Hr,Hr),i=r),i.status){case"fulfilled":return i.value;case"rejected":throw n=i.reason,Fd(n),n;default:if(typeof i.status=="string")i.then(Hr,Hr);else{if(n=At,n!==null&&100<n.shellSuspendCounter)throw Error(o(482));n=i,n.status="pending",n.then(function(l){if(i.status==="pending"){var m=i;m.status="fulfilled",m.value=l}},function(l){if(i.status==="pending"){var m=i;m.status="rejected",m.reason=l}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw n=i.reason,Fd(n),n}throw Io=i,wo}}var Io=null;function qd(){if(Io===null)throw Error(o(459));var n=Io;return Io=null,n}function Fd(n){if(n===wo||n===Gr)throw Error(o(483))}var Ci=!1;function Ol(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Gl(n,i){n=n.updateQueue,i.updateQueue===n&&(i.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function Ei(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function xi(n,i,r){var l=n.updateQueue;if(l===null)return null;if(l=l.shared,(mt&2)!==0){var m=l.pending;return m===null?i.next=i:(i.next=m.next,m.next=i),l.pending=i,i=Lr(n),Id(n,null,r),i}return Mr(n,l,i,r),Lr(n)}function Ro(n,i,r){if(i=i.updateQueue,i!==null&&(i=i.shared,(r&4194048)!==0)){var l=i.lanes;l&=n.pendingLanes,r|=l,i.lanes=r,lt(n,r)}}function Hl(n,i){var r=n.updateQueue,l=n.alternate;if(l!==null&&(l=l.updateQueue,r===l)){var m=null,y=null;if(r=r.firstBaseUpdate,r!==null){do{var x={lane:r.lane,tag:r.tag,payload:r.payload,callback:null,next:null};y===null?m=y=x:y=y.next=x,r=r.next}while(r!==null);y===null?m=y=i:y=y.next=i}else m=y=i;r={baseState:l.baseState,firstBaseUpdate:m,lastBaseUpdate:y,shared:l.shared,callbacks:l.callbacks},n.updateQueue=r;return}n=r.lastBaseUpdate,n===null?r.firstBaseUpdate=i:n.next=i,r.lastBaseUpdate=i}var Vl=!1;function Mo(){if(Vl){var n=$a;if(n!==null)throw n}}function Lo(n,i,r,l){Vl=!1;var m=n.updateQueue;Ci=!1;var y=m.firstBaseUpdate,x=m.lastBaseUpdate,N=m.shared.pending;if(N!==null){m.shared.pending=null;var k=N,H=k.next;k.next=null,x===null?y=H:x.next=H,x=k;var ee=n.alternate;ee!==null&&(ee=ee.updateQueue,N=ee.lastBaseUpdate,N!==x&&(N===null?ee.firstBaseUpdate=H:N.next=H,ee.lastBaseUpdate=k))}if(y!==null){var oe=m.baseState;x=0,ee=H=k=null,N=y;do{var q=N.lane&-536870913,B=q!==N.lane;if(B?(nt&q)===q:(l&q)===q){q!==0&&q===ka&&(Vl=!0),ee!==null&&(ee=ee.next={lane:0,tag:N.tag,payload:N.payload,callback:null,next:null});e:{var $e=n,Re=N;q=i;var Et=r;switch(Re.tag){case 1:if($e=Re.payload,typeof $e=="function"){oe=$e.call(Et,oe,q);break e}oe=$e;break e;case 3:$e.flags=$e.flags&-65537|128;case 0:if($e=Re.payload,q=typeof $e=="function"?$e.call(Et,oe,q):$e,q==null)break e;oe=v({},oe,q);break e;case 2:Ci=!0}}q=N.callback,q!==null&&(n.flags|=64,B&&(n.flags|=8192),B=m.callbacks,B===null?m.callbacks=[q]:B.push(q))}else B={lane:q,tag:N.tag,payload:N.payload,callback:N.callback,next:null},ee===null?(H=ee=B,k=oe):ee=ee.next=B,x|=q;if(N=N.next,N===null){if(N=m.shared.pending,N===null)break;B=N,N=B.next,B.next=null,m.lastBaseUpdate=B,m.shared.pending=null}}while(!0);ee===null&&(k=oe),m.baseState=k,m.firstBaseUpdate=H,m.lastBaseUpdate=ee,y===null&&(m.shared.lanes=0),Ri|=x,n.lanes=x,n.memoizedState=oe}}function Yd(n,i){if(typeof n!="function")throw Error(o(191,n));n.call(i)}function Bd(n,i){var r=n.callbacks;if(r!==null)for(n.callbacks=null,n=0;n<r.length;n++)Yd(r[n],i)}var Pa=j(null),Vr=j(0);function zd(n,i){n=pi,ie(Vr,n),ie(Pa,i),pi=n|i.baseLanes}function ql(){ie(Vr,pi),ie(Pa,Pa.current)}function Fl(){pi=Vr.current,Z(Pa),Z(Vr)}var Si=0,ze=null,Tt=null,Vt=null,qr=!1,Da=!1,la=!1,Fr=0,ko=0,Ua=null,iv=0;function Ot(){throw Error(o(321))}function Yl(n,i){if(i===null)return!1;for(var r=0;r<i.length&&r<n.length;r++)if(!En(n[r],i[r]))return!1;return!0}function Bl(n,i,r,l,m,y){return Si=y,ze=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,U.H=n===null||n.memoizedState===null?Rf:Mf,la=!1,y=r(l,m),la=!1,Da&&(y=Kd(i,r,l,m)),Jd(n),y}function Jd(n){U.H=Zr;var i=Tt!==null&&Tt.next!==null;if(Si=0,Vt=Tt=ze=null,qr=!1,ko=0,Ua=null,i)throw Error(o(300));n===null||Xt||(n=n.dependencies,n!==null&&Dr(n)&&(Xt=!0))}function Kd(n,i,r,l){ze=n;var m=0;do{if(Da&&(Ua=null),ko=0,Da=!1,25<=m)throw Error(o(301));if(m+=1,Vt=Tt=null,n.updateQueue!=null){var y=n.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}U.H=cv,y=i(r,l)}while(Da);return y}function av(){var n=U.H,i=n.useState()[0];return i=typeof i.then=="function"?$o(i):i,n=n.useState()[0],(Tt!==null?Tt.memoizedState:null)!==n&&(ze.flags|=1024),i}function zl(){var n=Fr!==0;return Fr=0,n}function Jl(n,i,r){i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~r}function Kl(n){if(qr){for(n=n.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}qr=!1}Si=0,Vt=Tt=ze=null,Da=!1,ko=Fr=0,Ua=null}function mn(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vt===null?ze.memoizedState=Vt=n:Vt=Vt.next=n,Vt}function qt(){if(Tt===null){var n=ze.alternate;n=n!==null?n.memoizedState:null}else n=Tt.next;var i=Vt===null?ze.memoizedState:Vt.next;if(i!==null)Vt=i,Tt=n;else{if(n===null)throw ze.alternate===null?Error(o(467)):Error(o(310));Tt=n,n={memoizedState:Tt.memoizedState,baseState:Tt.baseState,baseQueue:Tt.baseQueue,queue:Tt.queue,next:null},Vt===null?ze.memoizedState=Vt=n:Vt=Vt.next=n}return Vt}function Zl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function $o(n){var i=ko;return ko+=1,Ua===null&&(Ua=[]),n=Vd(Ua,n,i),i=ze,(Vt===null?i.memoizedState:Vt.next)===null&&(i=i.alternate,U.H=i===null||i.memoizedState===null?Rf:Mf),n}function Yr(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return $o(n);if(n.$$typeof===L)return rn(n)}throw Error(o(438,String(n)))}function Xl(n){var i=null,r=ze.updateQueue;if(r!==null&&(i=r.memoCache),i==null){var l=ze.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(i={data:l.data.map(function(m){return m.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),r===null&&(r=Zl(),ze.updateQueue=r),r.memoCache=i,r=i.data[i.index],r===void 0)for(r=i.data[i.index]=Array(n),l=0;l<n;l++)r[l]=ae;return i.index++,r}function li(n,i){return typeof i=="function"?i(n):i}function Br(n){var i=qt();return jl(i,Tt,n)}function jl(n,i,r){var l=n.queue;if(l===null)throw Error(o(311));l.lastRenderedReducer=r;var m=n.baseQueue,y=l.pending;if(y!==null){if(m!==null){var x=m.next;m.next=y.next,y.next=x}i.baseQueue=m=y,l.pending=null}if(y=n.baseState,m===null)n.memoizedState=y;else{i=m.next;var N=x=null,k=null,H=i,ee=!1;do{var oe=H.lane&-536870913;if(oe!==H.lane?(nt&oe)===oe:(Si&oe)===oe){var q=H.revertLane;if(q===0)k!==null&&(k=k.next={lane:0,revertLane:0,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null}),oe===ka&&(ee=!0);else if((Si&q)===q){H=H.next,q===ka&&(ee=!0);continue}else oe={lane:0,revertLane:H.revertLane,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null},k===null?(N=k=oe,x=y):k=k.next=oe,ze.lanes|=q,Ri|=q;oe=H.action,la&&r(y,oe),y=H.hasEagerState?H.eagerState:r(y,oe)}else q={lane:oe,revertLane:H.revertLane,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null},k===null?(N=k=q,x=y):k=k.next=q,ze.lanes|=oe,Ri|=oe;H=H.next}while(H!==null&&H!==i);if(k===null?x=y:k.next=N,!En(y,n.memoizedState)&&(Xt=!0,ee&&(r=$a,r!==null)))throw r;n.memoizedState=y,n.baseState=x,n.baseQueue=k,l.lastRenderedState=y}return m===null&&(l.lanes=0),[n.memoizedState,l.dispatch]}function Ql(n){var i=qt(),r=i.queue;if(r===null)throw Error(o(311));r.lastRenderedReducer=n;var l=r.dispatch,m=r.pending,y=i.memoizedState;if(m!==null){r.pending=null;var x=m=m.next;do y=n(y,x.action),x=x.next;while(x!==m);En(y,i.memoizedState)||(Xt=!0),i.memoizedState=y,i.baseQueue===null&&(i.baseState=y),r.lastRenderedState=y}return[y,l]}function Zd(n,i,r){var l=ze,m=qt(),y=st;if(y){if(r===void 0)throw Error(o(407));r=r()}else r=i();var x=!En((Tt||m).memoizedState,r);x&&(m.memoizedState=r,Xt=!0),m=m.queue;var N=Qd.bind(null,l,m,n);if(Po(2048,8,N,[n]),m.getSnapshot!==i||x||Vt!==null&&Vt.memoizedState.tag&1){if(l.flags|=2048,Oa(9,zr(),jd.bind(null,l,m,r,i),null),At===null)throw Error(o(349));y||(Si&124)!==0||Xd(l,i,r)}return r}function Xd(n,i,r){n.flags|=16384,n={getSnapshot:i,value:r},i=ze.updateQueue,i===null?(i=Zl(),ze.updateQueue=i,i.stores=[n]):(r=i.stores,r===null?i.stores=[n]:r.push(n))}function jd(n,i,r,l){i.value=r,i.getSnapshot=l,Wd(i)&&ef(n)}function Qd(n,i,r){return r(function(){Wd(i)&&ef(n)})}function Wd(n){var i=n.getSnapshot;n=n.value;try{var r=i();return!En(n,r)}catch{return!0}}function ef(n){var i=Ia(n,2);i!==null&&An(i,n,2)}function Wl(n){var i=mn();if(typeof n=="function"){var r=n;if(n=r(),la){yn(!0);try{r()}finally{yn(!1)}}}return i.memoizedState=i.baseState=n,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:li,lastRenderedState:n},i}function tf(n,i,r,l){return n.baseState=r,jl(n,Tt,typeof l=="function"?l:li)}function ov(n,i,r,l,m){if(Kr(n))throw Error(o(485));if(n=i.action,n!==null){var y={payload:m,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(x){y.listeners.push(x)}};U.T!==null?r(!0):y.isTransition=!1,l(y),r=i.pending,r===null?(y.next=i.pending=y,nf(i,y)):(y.next=r.next,i.pending=r.next=y)}}function nf(n,i){var r=i.action,l=i.payload,m=n.state;if(i.isTransition){var y=U.T,x={};U.T=x;try{var N=r(m,l),k=U.S;k!==null&&k(x,N),af(n,i,N)}catch(H){eu(n,i,H)}finally{U.T=y}}else try{y=r(m,l),af(n,i,y)}catch(H){eu(n,i,H)}}function af(n,i,r){r!==null&&typeof r=="object"&&typeof r.then=="function"?r.then(function(l){of(n,i,l)},function(l){return eu(n,i,l)}):of(n,i,r)}function of(n,i,r){i.status="fulfilled",i.value=r,rf(i),n.state=r,i=n.pending,i!==null&&(r=i.next,r===i?n.pending=null:(r=r.next,i.next=r,nf(n,r)))}function eu(n,i,r){var l=n.pending;if(n.pending=null,l!==null){l=l.next;do i.status="rejected",i.reason=r,rf(i),i=i.next;while(i!==l)}n.action=null}function rf(n){n=n.listeners;for(var i=0;i<n.length;i++)(0,n[i])()}function sf(n,i){return i}function lf(n,i){if(st){var r=At.formState;if(r!==null){e:{var l=ze;if(st){if(Pt){t:{for(var m=Pt,y=Bn;m.nodeType!==8;){if(!y){m=null;break t}if(m=qn(m.nextSibling),m===null){m=null;break t}}y=m.data,m=y==="F!"||y==="F"?m:null}if(m){Pt=qn(m.nextSibling),l=m.data==="F!";break e}}aa(l)}l=!1}l&&(i=r[0])}}return r=mn(),r.memoizedState=r.baseState=i,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:sf,lastRenderedState:i},r.queue=l,r=Af.bind(null,ze,l),l.dispatch=r,l=Wl(!1),y=ou.bind(null,ze,!1,l.queue),l=mn(),m={state:i,dispatch:null,action:n,pending:null},l.queue=m,r=ov.bind(null,ze,m,y,r),m.dispatch=r,l.memoizedState=n,[i,r,!1]}function uf(n){var i=qt();return cf(i,Tt,n)}function cf(n,i,r){if(i=jl(n,i,sf)[0],n=Br(li)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var l=$o(i)}catch(x){throw x===wo?Gr:x}else l=i;i=qt();var m=i.queue,y=m.dispatch;return r!==i.memoizedState&&(ze.flags|=2048,Oa(9,zr(),rv.bind(null,m,r),null)),[l,y,n]}function rv(n,i){n.action=i}function df(n){var i=qt(),r=Tt;if(r!==null)return cf(i,r,n);qt(),i=i.memoizedState,r=qt();var l=r.queue.dispatch;return r.memoizedState=n,[i,l,!1]}function Oa(n,i,r,l){return n={tag:n,create:r,deps:l,inst:i,next:null},i=ze.updateQueue,i===null&&(i=Zl(),ze.updateQueue=i),r=i.lastEffect,r===null?i.lastEffect=n.next=n:(l=r.next,r.next=n,n.next=l,i.lastEffect=n),n}function zr(){return{destroy:void 0,resource:void 0}}function ff(){return qt().memoizedState}function Jr(n,i,r,l){var m=mn();l=l===void 0?null:l,ze.flags|=n,m.memoizedState=Oa(1|i,zr(),r,l)}function Po(n,i,r,l){var m=qt();l=l===void 0?null:l;var y=m.memoizedState.inst;Tt!==null&&l!==null&&Yl(l,Tt.memoizedState.deps)?m.memoizedState=Oa(i,y,r,l):(ze.flags|=n,m.memoizedState=Oa(1|i,y,r,l))}function mf(n,i){Jr(8390656,8,n,i)}function pf(n,i){Po(2048,8,n,i)}function gf(n,i){return Po(4,2,n,i)}function hf(n,i){return Po(4,4,n,i)}function yf(n,i){if(typeof i=="function"){n=n();var r=i(n);return function(){typeof r=="function"?r():i(null)}}if(i!=null)return n=n(),i.current=n,function(){i.current=null}}function vf(n,i,r){r=r!=null?r.concat([n]):null,Po(4,4,yf.bind(null,i,n),r)}function tu(){}function Tf(n,i){var r=qt();i=i===void 0?null:i;var l=r.memoizedState;return i!==null&&Yl(i,l[1])?l[0]:(r.memoizedState=[n,i],n)}function Cf(n,i){var r=qt();i=i===void 0?null:i;var l=r.memoizedState;if(i!==null&&Yl(i,l[1]))return l[0];if(l=n(),la){yn(!0);try{n()}finally{yn(!1)}}return r.memoizedState=[l,i],l}function nu(n,i,r){return r===void 0||(Si&1073741824)!==0?n.memoizedState=i:(n.memoizedState=r,n=Sm(),ze.lanes|=n,Ri|=n,r)}function Ef(n,i,r,l){return En(r,i)?r:Pa.current!==null?(n=nu(n,r,l),En(n,i)||(Xt=!0),n):(Si&42)===0?(Xt=!0,n.memoizedState=r):(n=Sm(),ze.lanes|=n,Ri|=n,i)}function xf(n,i,r,l,m){var y=X.p;X.p=y!==0&&8>y?y:8;var x=U.T,N={};U.T=N,ou(n,!1,i,r);try{var k=m(),H=U.S;if(H!==null&&H(N,k),k!==null&&typeof k=="object"&&typeof k.then=="function"){var ee=nv(k,l);Do(n,i,ee,Nn(n))}else Do(n,i,l,Nn(n))}catch(oe){Do(n,i,{then:function(){},status:"rejected",reason:oe},Nn())}finally{X.p=y,U.T=x}}function sv(){}function iu(n,i,r,l){if(n.tag!==5)throw Error(o(476));var m=Sf(n).queue;xf(n,m,i,J,r===null?sv:function(){return bf(n),r(l)})}function Sf(n){var i=n.memoizedState;if(i!==null)return i;i={memoizedState:J,baseState:J,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:li,lastRenderedState:J},next:null};var r={};return i.next={memoizedState:r,baseState:r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:li,lastRenderedState:r},next:null},n.memoizedState=i,n=n.alternate,n!==null&&(n.memoizedState=i),i}function bf(n){var i=Sf(n).next.queue;Do(n,i,{},Nn())}function au(){return rn(er)}function _f(){return qt().memoizedState}function Nf(){return qt().memoizedState}function lv(n){for(var i=n.return;i!==null;){switch(i.tag){case 24:case 3:var r=Nn();n=Ei(r);var l=xi(i,n,r);l!==null&&(An(l,i,r),Ro(l,i,r)),i={cache:$l()},n.payload=i;return}i=i.return}}function uv(n,i,r){var l=Nn();r={lane:l,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null},Kr(n)?wf(i,r):(r=bl(n,i,r,l),r!==null&&(An(r,n,l),If(r,i,l)))}function Af(n,i,r){var l=Nn();Do(n,i,r,l)}function Do(n,i,r,l){var m={lane:l,revertLane:0,action:r,hasEagerState:!1,eagerState:null,next:null};if(Kr(n))wf(i,m);else{var y=n.alternate;if(n.lanes===0&&(y===null||y.lanes===0)&&(y=i.lastRenderedReducer,y!==null))try{var x=i.lastRenderedState,N=y(x,r);if(m.hasEagerState=!0,m.eagerState=N,En(N,x))return Mr(n,i,m,0),At===null&&Rr(),!1}catch{}finally{}if(r=bl(n,i,m,l),r!==null)return An(r,n,l),If(r,i,l),!0}return!1}function ou(n,i,r,l){if(l={lane:2,revertLane:Uu(),action:l,hasEagerState:!1,eagerState:null,next:null},Kr(n)){if(i)throw Error(o(479))}else i=bl(n,r,l,2),i!==null&&An(i,n,2)}function Kr(n){var i=n.alternate;return n===ze||i!==null&&i===ze}function wf(n,i){Da=qr=!0;var r=n.pending;r===null?i.next=i:(i.next=r.next,r.next=i),n.pending=i}function If(n,i,r){if((r&4194048)!==0){var l=i.lanes;l&=n.pendingLanes,r|=l,i.lanes=r,lt(n,r)}}var Zr={readContext:rn,use:Yr,useCallback:Ot,useContext:Ot,useEffect:Ot,useImperativeHandle:Ot,useLayoutEffect:Ot,useInsertionEffect:Ot,useMemo:Ot,useReducer:Ot,useRef:Ot,useState:Ot,useDebugValue:Ot,useDeferredValue:Ot,useTransition:Ot,useSyncExternalStore:Ot,useId:Ot,useHostTransitionStatus:Ot,useFormState:Ot,useActionState:Ot,useOptimistic:Ot,useMemoCache:Ot,useCacheRefresh:Ot},Rf={readContext:rn,use:Yr,useCallback:function(n,i){return mn().memoizedState=[n,i===void 0?null:i],n},useContext:rn,useEffect:mf,useImperativeHandle:function(n,i,r){r=r!=null?r.concat([n]):null,Jr(4194308,4,yf.bind(null,i,n),r)},useLayoutEffect:function(n,i){return Jr(4194308,4,n,i)},useInsertionEffect:function(n,i){Jr(4,2,n,i)},useMemo:function(n,i){var r=mn();i=i===void 0?null:i;var l=n();if(la){yn(!0);try{n()}finally{yn(!1)}}return r.memoizedState=[l,i],l},useReducer:function(n,i,r){var l=mn();if(r!==void 0){var m=r(i);if(la){yn(!0);try{r(i)}finally{yn(!1)}}}else m=i;return l.memoizedState=l.baseState=m,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:m},l.queue=n,n=n.dispatch=uv.bind(null,ze,n),[l.memoizedState,n]},useRef:function(n){var i=mn();return n={current:n},i.memoizedState=n},useState:function(n){n=Wl(n);var i=n.queue,r=Af.bind(null,ze,i);return i.dispatch=r,[n.memoizedState,r]},useDebugValue:tu,useDeferredValue:function(n,i){var r=mn();return nu(r,n,i)},useTransition:function(){var n=Wl(!1);return n=xf.bind(null,ze,n.queue,!0,!1),mn().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,i,r){var l=ze,m=mn();if(st){if(r===void 0)throw Error(o(407));r=r()}else{if(r=i(),At===null)throw Error(o(349));(nt&124)!==0||Xd(l,i,r)}m.memoizedState=r;var y={value:r,getSnapshot:i};return m.queue=y,mf(Qd.bind(null,l,y,n),[n]),l.flags|=2048,Oa(9,zr(),jd.bind(null,l,y,r,i),null),r},useId:function(){var n=mn(),i=At.identifierPrefix;if(st){var r=oi,l=ai;r=(l&~(1<<32-on(l)-1)).toString(32)+r,i=""+i+"R"+r,r=Fr++,0<r&&(i+="H"+r.toString(32)),i+=""}else r=iv++,i=""+i+"r"+r.toString(32)+"";return n.memoizedState=i},useHostTransitionStatus:au,useFormState:lf,useActionState:lf,useOptimistic:function(n){var i=mn();i.memoizedState=i.baseState=n;var r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=r,i=ou.bind(null,ze,!0,r),r.dispatch=i,[n,i]},useMemoCache:Xl,useCacheRefresh:function(){return mn().memoizedState=lv.bind(null,ze)}},Mf={readContext:rn,use:Yr,useCallback:Tf,useContext:rn,useEffect:pf,useImperativeHandle:vf,useInsertionEffect:gf,useLayoutEffect:hf,useMemo:Cf,useReducer:Br,useRef:ff,useState:function(){return Br(li)},useDebugValue:tu,useDeferredValue:function(n,i){var r=qt();return Ef(r,Tt.memoizedState,n,i)},useTransition:function(){var n=Br(li)[0],i=qt().memoizedState;return[typeof n=="boolean"?n:$o(n),i]},useSyncExternalStore:Zd,useId:_f,useHostTransitionStatus:au,useFormState:uf,useActionState:uf,useOptimistic:function(n,i){var r=qt();return tf(r,Tt,n,i)},useMemoCache:Xl,useCacheRefresh:Nf},cv={readContext:rn,use:Yr,useCallback:Tf,useContext:rn,useEffect:pf,useImperativeHandle:vf,useInsertionEffect:gf,useLayoutEffect:hf,useMemo:Cf,useReducer:Ql,useRef:ff,useState:function(){return Ql(li)},useDebugValue:tu,useDeferredValue:function(n,i){var r=qt();return Tt===null?nu(r,n,i):Ef(r,Tt.memoizedState,n,i)},useTransition:function(){var n=Ql(li)[0],i=qt().memoizedState;return[typeof n=="boolean"?n:$o(n),i]},useSyncExternalStore:Zd,useId:_f,useHostTransitionStatus:au,useFormState:df,useActionState:df,useOptimistic:function(n,i){var r=qt();return Tt!==null?tf(r,Tt,n,i):(r.baseState=n,[n,r.queue.dispatch])},useMemoCache:Xl,useCacheRefresh:Nf},Ga=null,Uo=0;function Xr(n){var i=Uo;return Uo+=1,Ga===null&&(Ga=[]),Vd(Ga,n,i)}function Oo(n,i){i=i.props.ref,n.ref=i!==void 0?i:null}function jr(n,i){throw i.$$typeof===T?Error(o(525)):(n=Object.prototype.toString.call(i),Error(o(31,n==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":n)))}function Lf(n){var i=n._init;return i(n._payload)}function kf(n){function i(O,D){if(n){var G=O.deletions;G===null?(O.deletions=[D],O.flags|=16):G.push(D)}}function r(O,D){if(!n)return null;for(;D!==null;)i(O,D),D=D.sibling;return null}function l(O){for(var D=new Map;O!==null;)O.key!==null?D.set(O.key,O):D.set(O.index,O),O=O.sibling;return D}function m(O,D){return O=ii(O,D),O.index=0,O.sibling=null,O}function y(O,D,G){return O.index=G,n?(G=O.alternate,G!==null?(G=G.index,G<D?(O.flags|=67108866,D):G):(O.flags|=67108866,D)):(O.flags|=1048576,D)}function x(O){return n&&O.alternate===null&&(O.flags|=67108866),O}function N(O,D,G,ne){return D===null||D.tag!==6?(D=Nl(G,O.mode,ne),D.return=O,D):(D=m(D,G),D.return=O,D)}function k(O,D,G,ne){var Ce=G.type;return Ce===w?ee(O,D,G.props.children,ne,G.key):D!==null&&(D.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===te&&Lf(Ce)===D.type)?(D=m(D,G.props),Oo(D,G),D.return=O,D):(D=kr(G.type,G.key,G.props,null,O.mode,ne),Oo(D,G),D.return=O,D)}function H(O,D,G,ne){return D===null||D.tag!==4||D.stateNode.containerInfo!==G.containerInfo||D.stateNode.implementation!==G.implementation?(D=Al(G,O.mode,ne),D.return=O,D):(D=m(D,G.children||[]),D.return=O,D)}function ee(O,D,G,ne,Ce){return D===null||D.tag!==7?(D=ea(G,O.mode,ne,Ce),D.return=O,D):(D=m(D,G),D.return=O,D)}function oe(O,D,G){if(typeof D=="string"&&D!==""||typeof D=="number"||typeof D=="bigint")return D=Nl(""+D,O.mode,G),D.return=O,D;if(typeof D=="object"&&D!==null){switch(D.$$typeof){case C:return G=kr(D.type,D.key,D.props,null,O.mode,G),Oo(G,D),G.return=O,G;case S:return D=Al(D,O.mode,G),D.return=O,D;case te:var ne=D._init;return D=ne(D._payload),oe(O,D,G)}if(se(D)||z(D))return D=ea(D,O.mode,G,null),D.return=O,D;if(typeof D.then=="function")return oe(O,Xr(D),G);if(D.$$typeof===L)return oe(O,Ur(O,D),G);jr(O,D)}return null}function q(O,D,G,ne){var Ce=D!==null?D.key:null;if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return Ce!==null?null:N(O,D,""+G,ne);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case C:return G.key===Ce?k(O,D,G,ne):null;case S:return G.key===Ce?H(O,D,G,ne):null;case te:return Ce=G._init,G=Ce(G._payload),q(O,D,G,ne)}if(se(G)||z(G))return Ce!==null?null:ee(O,D,G,ne,null);if(typeof G.then=="function")return q(O,D,Xr(G),ne);if(G.$$typeof===L)return q(O,D,Ur(O,G),ne);jr(O,G)}return null}function B(O,D,G,ne,Ce){if(typeof ne=="string"&&ne!==""||typeof ne=="number"||typeof ne=="bigint")return O=O.get(G)||null,N(D,O,""+ne,Ce);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case C:return O=O.get(ne.key===null?G:ne.key)||null,k(D,O,ne,Ce);case S:return O=O.get(ne.key===null?G:ne.key)||null,H(D,O,ne,Ce);case te:var Je=ne._init;return ne=Je(ne._payload),B(O,D,G,ne,Ce)}if(se(ne)||z(ne))return O=O.get(G)||null,ee(D,O,ne,Ce,null);if(typeof ne.then=="function")return B(O,D,G,Xr(ne),Ce);if(ne.$$typeof===L)return B(O,D,G,Ur(D,ne),Ce);jr(D,ne)}return null}function $e(O,D,G,ne){for(var Ce=null,Je=null,_e=D,ke=D=0,Qt=null;_e!==null&&ke<G.length;ke++){_e.index>ke?(Qt=_e,_e=null):Qt=_e.sibling;var at=q(O,_e,G[ke],ne);if(at===null){_e===null&&(_e=Qt);break}n&&_e&&at.alternate===null&&i(O,_e),D=y(at,D,ke),Je===null?Ce=at:Je.sibling=at,Je=at,_e=Qt}if(ke===G.length)return r(O,_e),st&&na(O,ke),Ce;if(_e===null){for(;ke<G.length;ke++)_e=oe(O,G[ke],ne),_e!==null&&(D=y(_e,D,ke),Je===null?Ce=_e:Je.sibling=_e,Je=_e);return st&&na(O,ke),Ce}for(_e=l(_e);ke<G.length;ke++)Qt=B(_e,O,ke,G[ke],ne),Qt!==null&&(n&&Qt.alternate!==null&&_e.delete(Qt.key===null?ke:Qt.key),D=y(Qt,D,ke),Je===null?Ce=Qt:Je.sibling=Qt,Je=Qt);return n&&_e.forEach(function(Gi){return i(O,Gi)}),st&&na(O,ke),Ce}function Re(O,D,G,ne){if(G==null)throw Error(o(151));for(var Ce=null,Je=null,_e=D,ke=D=0,Qt=null,at=G.next();_e!==null&&!at.done;ke++,at=G.next()){_e.index>ke?(Qt=_e,_e=null):Qt=_e.sibling;var Gi=q(O,_e,at.value,ne);if(Gi===null){_e===null&&(_e=Qt);break}n&&_e&&Gi.alternate===null&&i(O,_e),D=y(Gi,D,ke),Je===null?Ce=Gi:Je.sibling=Gi,Je=Gi,_e=Qt}if(at.done)return r(O,_e),st&&na(O,ke),Ce;if(_e===null){for(;!at.done;ke++,at=G.next())at=oe(O,at.value,ne),at!==null&&(D=y(at,D,ke),Je===null?Ce=at:Je.sibling=at,Je=at);return st&&na(O,ke),Ce}for(_e=l(_e);!at.done;ke++,at=G.next())at=B(_e,O,ke,at.value,ne),at!==null&&(n&&at.alternate!==null&&_e.delete(at.key===null?ke:at.key),D=y(at,D,ke),Je===null?Ce=at:Je.sibling=at,Je=at);return n&&_e.forEach(function(dT){return i(O,dT)}),st&&na(O,ke),Ce}function Et(O,D,G,ne){if(typeof G=="object"&&G!==null&&G.type===w&&G.key===null&&(G=G.props.children),typeof G=="object"&&G!==null){switch(G.$$typeof){case C:e:{for(var Ce=G.key;D!==null;){if(D.key===Ce){if(Ce=G.type,Ce===w){if(D.tag===7){r(O,D.sibling),ne=m(D,G.props.children),ne.return=O,O=ne;break e}}else if(D.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===te&&Lf(Ce)===D.type){r(O,D.sibling),ne=m(D,G.props),Oo(ne,G),ne.return=O,O=ne;break e}r(O,D);break}else i(O,D);D=D.sibling}G.type===w?(ne=ea(G.props.children,O.mode,ne,G.key),ne.return=O,O=ne):(ne=kr(G.type,G.key,G.props,null,O.mode,ne),Oo(ne,G),ne.return=O,O=ne)}return x(O);case S:e:{for(Ce=G.key;D!==null;){if(D.key===Ce)if(D.tag===4&&D.stateNode.containerInfo===G.containerInfo&&D.stateNode.implementation===G.implementation){r(O,D.sibling),ne=m(D,G.children||[]),ne.return=O,O=ne;break e}else{r(O,D);break}else i(O,D);D=D.sibling}ne=Al(G,O.mode,ne),ne.return=O,O=ne}return x(O);case te:return Ce=G._init,G=Ce(G._payload),Et(O,D,G,ne)}if(se(G))return $e(O,D,G,ne);if(z(G)){if(Ce=z(G),typeof Ce!="function")throw Error(o(150));return G=Ce.call(G),Re(O,D,G,ne)}if(typeof G.then=="function")return Et(O,D,Xr(G),ne);if(G.$$typeof===L)return Et(O,D,Ur(O,G),ne);jr(O,G)}return typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint"?(G=""+G,D!==null&&D.tag===6?(r(O,D.sibling),ne=m(D,G),ne.return=O,O=ne):(r(O,D),ne=Nl(G,O.mode,ne),ne.return=O,O=ne),x(O)):r(O,D)}return function(O,D,G,ne){try{Uo=0;var Ce=Et(O,D,G,ne);return Ga=null,Ce}catch(_e){if(_e===wo||_e===Gr)throw _e;var Je=xn(29,_e,null,O.mode);return Je.lanes=ne,Je.return=O,Je}finally{}}}var Ha=kf(!0),$f=kf(!1),Pn=j(null),zn=null;function bi(n){var i=n.alternate;ie(Bt,Bt.current&1),ie(Pn,n),zn===null&&(i===null||Pa.current!==null||i.memoizedState!==null)&&(zn=n)}function Pf(n){if(n.tag===22){if(ie(Bt,Bt.current),ie(Pn,n),zn===null){var i=n.alternate;i!==null&&i.memoizedState!==null&&(zn=n)}}else _i()}function _i(){ie(Bt,Bt.current),ie(Pn,Pn.current)}function ui(n){Z(Pn),zn===n&&(zn=null),Z(Bt)}var Bt=j(0);function Qr(n){for(var i=n;i!==null;){if(i.tag===13){var r=i.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||Zu(r)))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}function ru(n,i,r,l){i=n.memoizedState,r=r(l,i),r=r==null?i:v({},i,r),n.memoizedState=r,n.lanes===0&&(n.updateQueue.baseState=r)}var su={enqueueSetState:function(n,i,r){n=n._reactInternals;var l=Nn(),m=Ei(l);m.payload=i,r!=null&&(m.callback=r),i=xi(n,m,l),i!==null&&(An(i,n,l),Ro(i,n,l))},enqueueReplaceState:function(n,i,r){n=n._reactInternals;var l=Nn(),m=Ei(l);m.tag=1,m.payload=i,r!=null&&(m.callback=r),i=xi(n,m,l),i!==null&&(An(i,n,l),Ro(i,n,l))},enqueueForceUpdate:function(n,i){n=n._reactInternals;var r=Nn(),l=Ei(r);l.tag=2,i!=null&&(l.callback=i),i=xi(n,l,r),i!==null&&(An(i,n,r),Ro(i,n,r))}};function Df(n,i,r,l,m,y,x){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(l,y,x):i.prototype&&i.prototype.isPureReactComponent?!Co(r,l)||!Co(m,y):!0}function Uf(n,i,r,l){n=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(r,l),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(r,l),i.state!==n&&su.enqueueReplaceState(i,i.state,null)}function ua(n,i){var r=i;if("ref"in i){r={};for(var l in i)l!=="ref"&&(r[l]=i[l])}if(n=n.defaultProps){r===i&&(r=v({},r));for(var m in n)r[m]===void 0&&(r[m]=n[m])}return r}var Wr=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)};function Of(n){Wr(n)}function Gf(n){console.error(n)}function Hf(n){Wr(n)}function es(n,i){try{var r=n.onUncaughtError;r(i.value,{componentStack:i.stack})}catch(l){setTimeout(function(){throw l})}}function Vf(n,i,r){try{var l=n.onCaughtError;l(r.value,{componentStack:r.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function lu(n,i,r){return r=Ei(r),r.tag=3,r.payload={element:null},r.callback=function(){es(n,i)},r}function qf(n){return n=Ei(n),n.tag=3,n}function Ff(n,i,r,l){var m=r.type.getDerivedStateFromError;if(typeof m=="function"){var y=l.value;n.payload=function(){return m(y)},n.callback=function(){Vf(i,r,l)}}var x=r.stateNode;x!==null&&typeof x.componentDidCatch=="function"&&(n.callback=function(){Vf(i,r,l),typeof m!="function"&&(Mi===null?Mi=new Set([this]):Mi.add(this));var N=l.stack;this.componentDidCatch(l.value,{componentStack:N!==null?N:""})})}function dv(n,i,r,l,m){if(r.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(i=r.alternate,i!==null&&_o(i,r,m,!0),r=Pn.current,r!==null){switch(r.tag){case 13:return zn===null?Lu():r.alternate===null&&Dt===0&&(Dt=3),r.flags&=-257,r.flags|=65536,r.lanes=m,l===Ul?r.flags|=16384:(i=r.updateQueue,i===null?r.updateQueue=new Set([l]):i.add(l),$u(n,l,m)),!1;case 22:return r.flags|=65536,l===Ul?r.flags|=16384:(i=r.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([l])},r.updateQueue=i):(r=i.retryQueue,r===null?i.retryQueue=new Set([l]):r.add(l)),$u(n,l,m)),!1}throw Error(o(435,r.tag))}return $u(n,l,m),Lu(),!1}if(st)return i=Pn.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=m,l!==Rl&&(n=Error(o(422),{cause:l}),bo(Mn(n,r)))):(l!==Rl&&(i=Error(o(423),{cause:l}),bo(Mn(i,r))),n=n.current.alternate,n.flags|=65536,m&=-m,n.lanes|=m,l=Mn(l,r),m=lu(n.stateNode,l,m),Hl(n,m),Dt!==4&&(Dt=2)),!1;var y=Error(o(520),{cause:l});if(y=Mn(y,r),Bo===null?Bo=[y]:Bo.push(y),Dt!==4&&(Dt=2),i===null)return!0;l=Mn(l,r),r=i;do{switch(r.tag){case 3:return r.flags|=65536,n=m&-m,r.lanes|=n,n=lu(r.stateNode,l,n),Hl(r,n),!1;case 1:if(i=r.type,y=r.stateNode,(r.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Mi===null||!Mi.has(y))))return r.flags|=65536,m&=-m,r.lanes|=m,m=qf(m),Ff(m,n,r,l),Hl(r,m),!1}r=r.return}while(r!==null);return!1}var Yf=Error(o(461)),Xt=!1;function tn(n,i,r,l){i.child=n===null?$f(i,null,r,l):Ha(i,n.child,r,l)}function Bf(n,i,r,l,m){r=r.render;var y=i.ref;if("ref"in l){var x={};for(var N in l)N!=="ref"&&(x[N]=l[N])}else x=l;return ra(i),l=Bl(n,i,r,x,y,m),N=zl(),n!==null&&!Xt?(Jl(n,i,m),ci(n,i,m)):(st&&N&&wl(i),i.flags|=1,tn(n,i,l,m),i.child)}function zf(n,i,r,l,m){if(n===null){var y=r.type;return typeof y=="function"&&!_l(y)&&y.defaultProps===void 0&&r.compare===null?(i.tag=15,i.type=y,Jf(n,i,y,l,m)):(n=kr(r.type,null,l,i,i.mode,m),n.ref=i.ref,n.return=i,i.child=n)}if(y=n.child,!hu(n,m)){var x=y.memoizedProps;if(r=r.compare,r=r!==null?r:Co,r(x,l)&&n.ref===i.ref)return ci(n,i,m)}return i.flags|=1,n=ii(y,l),n.ref=i.ref,n.return=i,i.child=n}function Jf(n,i,r,l,m){if(n!==null){var y=n.memoizedProps;if(Co(y,l)&&n.ref===i.ref)if(Xt=!1,i.pendingProps=l=y,hu(n,m))(n.flags&131072)!==0&&(Xt=!0);else return i.lanes=n.lanes,ci(n,i,m)}return uu(n,i,r,l,m)}function Kf(n,i,r){var l=i.pendingProps,m=l.children,y=n!==null?n.memoizedState:null;if(l.mode==="hidden"){if((i.flags&128)!==0){if(l=y!==null?y.baseLanes|r:r,n!==null){for(m=i.child=n.child,y=0;m!==null;)y=y|m.lanes|m.childLanes,m=m.sibling;i.childLanes=y&~l}else i.childLanes=0,i.child=null;return Zf(n,i,l,r)}if((r&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},n!==null&&Or(i,y!==null?y.cachePool:null),y!==null?zd(i,y):ql(),Pf(i);else return i.lanes=i.childLanes=536870912,Zf(n,i,y!==null?y.baseLanes|r:r,r)}else y!==null?(Or(i,y.cachePool),zd(i,y),_i(),i.memoizedState=null):(n!==null&&Or(i,null),ql(),_i());return tn(n,i,m,r),i.child}function Zf(n,i,r,l){var m=Dl();return m=m===null?null:{parent:Yt._currentValue,pool:m},i.memoizedState={baseLanes:r,cachePool:m},n!==null&&Or(i,null),ql(),Pf(i),n!==null&&_o(n,i,l,!0),null}function ts(n,i){var r=i.ref;if(r===null)n!==null&&n.ref!==null&&(i.flags|=4194816);else{if(typeof r!="function"&&typeof r!="object")throw Error(o(284));(n===null||n.ref!==r)&&(i.flags|=4194816)}}function uu(n,i,r,l,m){return ra(i),r=Bl(n,i,r,l,void 0,m),l=zl(),n!==null&&!Xt?(Jl(n,i,m),ci(n,i,m)):(st&&l&&wl(i),i.flags|=1,tn(n,i,r,m),i.child)}function Xf(n,i,r,l,m,y){return ra(i),i.updateQueue=null,r=Kd(i,l,r,m),Jd(n),l=zl(),n!==null&&!Xt?(Jl(n,i,y),ci(n,i,y)):(st&&l&&wl(i),i.flags|=1,tn(n,i,r,y),i.child)}function jf(n,i,r,l,m){if(ra(i),i.stateNode===null){var y=Ra,x=r.contextType;typeof x=="object"&&x!==null&&(y=rn(x)),y=new r(l,y),i.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=su,i.stateNode=y,y._reactInternals=i,y=i.stateNode,y.props=l,y.state=i.memoizedState,y.refs={},Ol(i),x=r.contextType,y.context=typeof x=="object"&&x!==null?rn(x):Ra,y.state=i.memoizedState,x=r.getDerivedStateFromProps,typeof x=="function"&&(ru(i,r,x,l),y.state=i.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(x=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),x!==y.state&&su.enqueueReplaceState(y,y.state,null),Lo(i,l,y,m),Mo(),y.state=i.memoizedState),typeof y.componentDidMount=="function"&&(i.flags|=4194308),l=!0}else if(n===null){y=i.stateNode;var N=i.memoizedProps,k=ua(r,N);y.props=k;var H=y.context,ee=r.contextType;x=Ra,typeof ee=="object"&&ee!==null&&(x=rn(ee));var oe=r.getDerivedStateFromProps;ee=typeof oe=="function"||typeof y.getSnapshotBeforeUpdate=="function",N=i.pendingProps!==N,ee||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(N||H!==x)&&Uf(i,y,l,x),Ci=!1;var q=i.memoizedState;y.state=q,Lo(i,l,y,m),Mo(),H=i.memoizedState,N||q!==H||Ci?(typeof oe=="function"&&(ru(i,r,oe,l),H=i.memoizedState),(k=Ci||Df(i,r,k,l,q,H,x))?(ee||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(i.flags|=4194308)):(typeof y.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=l,i.memoizedState=H),y.props=l,y.state=H,y.context=x,l=k):(typeof y.componentDidMount=="function"&&(i.flags|=4194308),l=!1)}else{y=i.stateNode,Gl(n,i),x=i.memoizedProps,ee=ua(r,x),y.props=ee,oe=i.pendingProps,q=y.context,H=r.contextType,k=Ra,typeof H=="object"&&H!==null&&(k=rn(H)),N=r.getDerivedStateFromProps,(H=typeof N=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(x!==oe||q!==k)&&Uf(i,y,l,k),Ci=!1,q=i.memoizedState,y.state=q,Lo(i,l,y,m),Mo();var B=i.memoizedState;x!==oe||q!==B||Ci||n!==null&&n.dependencies!==null&&Dr(n.dependencies)?(typeof N=="function"&&(ru(i,r,N,l),B=i.memoizedState),(ee=Ci||Df(i,r,ee,l,q,B,k)||n!==null&&n.dependencies!==null&&Dr(n.dependencies))?(H||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(l,B,k),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(l,B,k)),typeof y.componentDidUpdate=="function"&&(i.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof y.componentDidUpdate!="function"||x===n.memoizedProps&&q===n.memoizedState||(i.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||x===n.memoizedProps&&q===n.memoizedState||(i.flags|=1024),i.memoizedProps=l,i.memoizedState=B),y.props=l,y.state=B,y.context=k,l=ee):(typeof y.componentDidUpdate!="function"||x===n.memoizedProps&&q===n.memoizedState||(i.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||x===n.memoizedProps&&q===n.memoizedState||(i.flags|=1024),l=!1)}return y=l,ts(n,i),l=(i.flags&128)!==0,y||l?(y=i.stateNode,r=l&&typeof r.getDerivedStateFromError!="function"?null:y.render(),i.flags|=1,n!==null&&l?(i.child=Ha(i,n.child,null,m),i.child=Ha(i,null,r,m)):tn(n,i,r,m),i.memoizedState=y.state,n=i.child):n=ci(n,i,m),n}function Qf(n,i,r,l){return So(),i.flags|=256,tn(n,i,r,l),i.child}var cu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function du(n){return{baseLanes:n,cachePool:Od()}}function fu(n,i,r){return n=n!==null?n.childLanes&~r:0,i&&(n|=Dn),n}function Wf(n,i,r){var l=i.pendingProps,m=!1,y=(i.flags&128)!==0,x;if((x=y)||(x=n!==null&&n.memoizedState===null?!1:(Bt.current&2)!==0),x&&(m=!0,i.flags&=-129),x=(i.flags&32)!==0,i.flags&=-33,n===null){if(st){if(m?bi(i):_i(),st){var N=Pt,k;if(k=N){e:{for(k=N,N=Bn;k.nodeType!==8;){if(!N){N=null;break e}if(k=qn(k.nextSibling),k===null){N=null;break e}}N=k}N!==null?(i.memoizedState={dehydrated:N,treeContext:ta!==null?{id:ai,overflow:oi}:null,retryLane:536870912,hydrationErrors:null},k=xn(18,null,null,0),k.stateNode=N,k.return=i,i.child=k,cn=i,Pt=null,k=!0):k=!1}k||aa(i)}if(N=i.memoizedState,N!==null&&(N=N.dehydrated,N!==null))return Zu(N)?i.lanes=32:i.lanes=536870912,null;ui(i)}return N=l.children,l=l.fallback,m?(_i(),m=i.mode,N=ns({mode:"hidden",children:N},m),l=ea(l,m,r,null),N.return=i,l.return=i,N.sibling=l,i.child=N,m=i.child,m.memoizedState=du(r),m.childLanes=fu(n,x,r),i.memoizedState=cu,l):(bi(i),mu(i,N))}if(k=n.memoizedState,k!==null&&(N=k.dehydrated,N!==null)){if(y)i.flags&256?(bi(i),i.flags&=-257,i=pu(n,i,r)):i.memoizedState!==null?(_i(),i.child=n.child,i.flags|=128,i=null):(_i(),m=l.fallback,N=i.mode,l=ns({mode:"visible",children:l.children},N),m=ea(m,N,r,null),m.flags|=2,l.return=i,m.return=i,l.sibling=m,i.child=l,Ha(i,n.child,null,r),l=i.child,l.memoizedState=du(r),l.childLanes=fu(n,x,r),i.memoizedState=cu,i=m);else if(bi(i),Zu(N)){if(x=N.nextSibling&&N.nextSibling.dataset,x)var H=x.dgst;x=H,l=Error(o(419)),l.stack="",l.digest=x,bo({value:l,source:null,stack:null}),i=pu(n,i,r)}else if(Xt||_o(n,i,r,!1),x=(r&n.childLanes)!==0,Xt||x){if(x=At,x!==null&&(l=r&-r,l=(l&42)!==0?1:tt(l),l=(l&(x.suspendedLanes|r))!==0?0:l,l!==0&&l!==k.retryLane))throw k.retryLane=l,Ia(n,l),An(x,n,l),Yf;N.data==="$?"||Lu(),i=pu(n,i,r)}else N.data==="$?"?(i.flags|=192,i.child=n.child,i=null):(n=k.treeContext,Pt=qn(N.nextSibling),cn=i,st=!0,ia=null,Bn=!1,n!==null&&(kn[$n++]=ai,kn[$n++]=oi,kn[$n++]=ta,ai=n.id,oi=n.overflow,ta=i),i=mu(i,l.children),i.flags|=4096);return i}return m?(_i(),m=l.fallback,N=i.mode,k=n.child,H=k.sibling,l=ii(k,{mode:"hidden",children:l.children}),l.subtreeFlags=k.subtreeFlags&65011712,H!==null?m=ii(H,m):(m=ea(m,N,r,null),m.flags|=2),m.return=i,l.return=i,l.sibling=m,i.child=l,l=m,m=i.child,N=n.child.memoizedState,N===null?N=du(r):(k=N.cachePool,k!==null?(H=Yt._currentValue,k=k.parent!==H?{parent:H,pool:H}:k):k=Od(),N={baseLanes:N.baseLanes|r,cachePool:k}),m.memoizedState=N,m.childLanes=fu(n,x,r),i.memoizedState=cu,l):(bi(i),r=n.child,n=r.sibling,r=ii(r,{mode:"visible",children:l.children}),r.return=i,r.sibling=null,n!==null&&(x=i.deletions,x===null?(i.deletions=[n],i.flags|=16):x.push(n)),i.child=r,i.memoizedState=null,r)}function mu(n,i){return i=ns({mode:"visible",children:i},n.mode),i.return=n,n.child=i}function ns(n,i){return n=xn(22,n,null,i),n.lanes=0,n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},n}function pu(n,i,r){return Ha(i,n.child,null,r),n=mu(i,i.pendingProps.children),n.flags|=2,i.memoizedState=null,n}function em(n,i,r){n.lanes|=i;var l=n.alternate;l!==null&&(l.lanes|=i),Ll(n.return,i,r)}function gu(n,i,r,l,m){var y=n.memoizedState;y===null?n.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:l,tail:r,tailMode:m}:(y.isBackwards=i,y.rendering=null,y.renderingStartTime=0,y.last=l,y.tail=r,y.tailMode=m)}function tm(n,i,r){var l=i.pendingProps,m=l.revealOrder,y=l.tail;if(tn(n,i,l.children,r),l=Bt.current,(l&2)!==0)l=l&1|2,i.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=i.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&em(n,r,i);else if(n.tag===19)em(n,r,i);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break e;for(;n.sibling===null;){if(n.return===null||n.return===i)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}l&=1}switch(ie(Bt,l),m){case"forwards":for(r=i.child,m=null;r!==null;)n=r.alternate,n!==null&&Qr(n)===null&&(m=r),r=r.sibling;r=m,r===null?(m=i.child,i.child=null):(m=r.sibling,r.sibling=null),gu(i,!1,m,r,y);break;case"backwards":for(r=null,m=i.child,i.child=null;m!==null;){if(n=m.alternate,n!==null&&Qr(n)===null){i.child=m;break}n=m.sibling,m.sibling=r,r=m,m=n}gu(i,!0,r,null,y);break;case"together":gu(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function ci(n,i,r){if(n!==null&&(i.dependencies=n.dependencies),Ri|=i.lanes,(r&i.childLanes)===0)if(n!==null){if(_o(n,i,r,!1),(r&i.childLanes)===0)return null}else return null;if(n!==null&&i.child!==n.child)throw Error(o(153));if(i.child!==null){for(n=i.child,r=ii(n,n.pendingProps),i.child=r,r.return=i;n.sibling!==null;)n=n.sibling,r=r.sibling=ii(n,n.pendingProps),r.return=i;r.sibling=null}return i.child}function hu(n,i){return(n.lanes&i)!==0?!0:(n=n.dependencies,!!(n!==null&&Dr(n)))}function fv(n,i,r){switch(i.tag){case 3:me(i,i.stateNode.containerInfo),Ti(i,Yt,n.memoizedState.cache),So();break;case 27:case 5:Ve(i);break;case 4:me(i,i.stateNode.containerInfo);break;case 10:Ti(i,i.type,i.memoizedProps.value);break;case 13:var l=i.memoizedState;if(l!==null)return l.dehydrated!==null?(bi(i),i.flags|=128,null):(r&i.child.childLanes)!==0?Wf(n,i,r):(bi(i),n=ci(n,i,r),n!==null?n.sibling:null);bi(i);break;case 19:var m=(n.flags&128)!==0;if(l=(r&i.childLanes)!==0,l||(_o(n,i,r,!1),l=(r&i.childLanes)!==0),m){if(l)return tm(n,i,r);i.flags|=128}if(m=i.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),ie(Bt,Bt.current),l)break;return null;case 22:case 23:return i.lanes=0,Kf(n,i,r);case 24:Ti(i,Yt,n.memoizedState.cache)}return ci(n,i,r)}function nm(n,i,r){if(n!==null)if(n.memoizedProps!==i.pendingProps)Xt=!0;else{if(!hu(n,r)&&(i.flags&128)===0)return Xt=!1,fv(n,i,r);Xt=(n.flags&131072)!==0}else Xt=!1,st&&(i.flags&1048576)!==0&&Md(i,Pr,i.index);switch(i.lanes=0,i.tag){case 16:e:{n=i.pendingProps;var l=i.elementType,m=l._init;if(l=m(l._payload),i.type=l,typeof l=="function")_l(l)?(n=ua(l,n),i.tag=1,i=jf(null,i,l,n,r)):(i.tag=0,i=uu(null,i,l,n,r));else{if(l!=null){if(m=l.$$typeof,m===R){i.tag=11,i=Bf(null,i,l,n,r);break e}else if(m===Q){i.tag=14,i=zf(null,i,l,n,r);break e}}throw i=re(l)||l,Error(o(306,i,""))}}return i;case 0:return uu(n,i,i.type,i.pendingProps,r);case 1:return l=i.type,m=ua(l,i.pendingProps),jf(n,i,l,m,r);case 3:e:{if(me(i,i.stateNode.containerInfo),n===null)throw Error(o(387));l=i.pendingProps;var y=i.memoizedState;m=y.element,Gl(n,i),Lo(i,l,null,r);var x=i.memoizedState;if(l=x.cache,Ti(i,Yt,l),l!==y.cache&&kl(i,[Yt],r,!0),Mo(),l=x.element,y.isDehydrated)if(y={element:l,isDehydrated:!1,cache:x.cache},i.updateQueue.baseState=y,i.memoizedState=y,i.flags&256){i=Qf(n,i,l,r);break e}else if(l!==m){m=Mn(Error(o(424)),i),bo(m),i=Qf(n,i,l,r);break e}else{switch(n=i.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(Pt=qn(n.firstChild),cn=i,st=!0,ia=null,Bn=!0,r=$f(i,null,l,r),i.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling}else{if(So(),l===m){i=ci(n,i,r);break e}tn(n,i,l,r)}i=i.child}return i;case 26:return ts(n,i),n===null?(r=rp(i.type,null,i.pendingProps,null))?i.memoizedState=r:st||(r=i.type,n=i.pendingProps,l=hs(de.current).createElement(r),l[rt]=i,l[ct]=n,an(l,r,n),Qe(l),i.stateNode=l):i.memoizedState=rp(i.type,n.memoizedProps,i.pendingProps,n.memoizedState),null;case 27:return Ve(i),n===null&&st&&(l=i.stateNode=ip(i.type,i.pendingProps,de.current),cn=i,Bn=!0,m=Pt,$i(i.type)?(Xu=m,Pt=qn(l.firstChild)):Pt=m),tn(n,i,i.pendingProps.children,r),ts(n,i),n===null&&(i.flags|=4194304),i.child;case 5:return n===null&&st&&((m=l=Pt)&&(l=Hv(l,i.type,i.pendingProps,Bn),l!==null?(i.stateNode=l,cn=i,Pt=qn(l.firstChild),Bn=!1,m=!0):m=!1),m||aa(i)),Ve(i),m=i.type,y=i.pendingProps,x=n!==null?n.memoizedProps:null,l=y.children,zu(m,y)?l=null:x!==null&&zu(m,x)&&(i.flags|=32),i.memoizedState!==null&&(m=Bl(n,i,av,null,null,r),er._currentValue=m),ts(n,i),tn(n,i,l,r),i.child;case 6:return n===null&&st&&((n=r=Pt)&&(r=Vv(r,i.pendingProps,Bn),r!==null?(i.stateNode=r,cn=i,Pt=null,n=!0):n=!1),n||aa(i)),null;case 13:return Wf(n,i,r);case 4:return me(i,i.stateNode.containerInfo),l=i.pendingProps,n===null?i.child=Ha(i,null,l,r):tn(n,i,l,r),i.child;case 11:return Bf(n,i,i.type,i.pendingProps,r);case 7:return tn(n,i,i.pendingProps,r),i.child;case 8:return tn(n,i,i.pendingProps.children,r),i.child;case 12:return tn(n,i,i.pendingProps.children,r),i.child;case 10:return l=i.pendingProps,Ti(i,i.type,l.value),tn(n,i,l.children,r),i.child;case 9:return m=i.type._context,l=i.pendingProps.children,ra(i),m=rn(m),l=l(m),i.flags|=1,tn(n,i,l,r),i.child;case 14:return zf(n,i,i.type,i.pendingProps,r);case 15:return Jf(n,i,i.type,i.pendingProps,r);case 19:return tm(n,i,r);case 31:return l=i.pendingProps,r=i.mode,l={mode:l.mode,children:l.children},n===null?(r=ns(l,r),r.ref=i.ref,i.child=r,r.return=i,i=r):(r=ii(n.child,l),r.ref=i.ref,i.child=r,r.return=i,i=r),i;case 22:return Kf(n,i,r);case 24:return ra(i),l=rn(Yt),n===null?(m=Dl(),m===null&&(m=At,y=$l(),m.pooledCache=y,y.refCount++,y!==null&&(m.pooledCacheLanes|=r),m=y),i.memoizedState={parent:l,cache:m},Ol(i),Ti(i,Yt,m)):((n.lanes&r)!==0&&(Gl(n,i),Lo(i,null,null,r),Mo()),m=n.memoizedState,y=i.memoizedState,m.parent!==l?(m={parent:l,cache:l},i.memoizedState=m,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=m),Ti(i,Yt,l)):(l=y.cache,Ti(i,Yt,l),l!==m.cache&&kl(i,[Yt],r,!0))),tn(n,i,i.pendingProps.children,r),i.child;case 29:throw i.pendingProps}throw Error(o(156,i.tag))}function di(n){n.flags|=4}function im(n,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!dp(i)){if(i=Pn.current,i!==null&&((nt&4194048)===nt?zn!==null:(nt&62914560)!==nt&&(nt&536870912)===0||i!==zn))throw Io=Ul,Gd;n.flags|=8192}}function is(n,i){i!==null&&(n.flags|=4),n.flags&16384&&(i=n.tag!==22?Ut():536870912,n.lanes|=i,Ya|=i)}function Go(n,i){if(!st)switch(n.tailMode){case"hidden":i=n.tail;for(var r=null;i!==null;)i.alternate!==null&&(r=i),i=i.sibling;r===null?n.tail=null:r.sibling=null;break;case"collapsed":r=n.tail;for(var l=null;r!==null;)r.alternate!==null&&(l=r),r=r.sibling;l===null?i||n.tail===null?n.tail=null:n.tail.sibling=null:l.sibling=null}}function Mt(n){var i=n.alternate!==null&&n.alternate.child===n.child,r=0,l=0;if(i)for(var m=n.child;m!==null;)r|=m.lanes|m.childLanes,l|=m.subtreeFlags&65011712,l|=m.flags&65011712,m.return=n,m=m.sibling;else for(m=n.child;m!==null;)r|=m.lanes|m.childLanes,l|=m.subtreeFlags,l|=m.flags,m.return=n,m=m.sibling;return n.subtreeFlags|=l,n.childLanes=r,i}function mv(n,i,r){var l=i.pendingProps;switch(Il(i),i.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mt(i),null;case 1:return Mt(i),null;case 3:return r=i.stateNode,l=null,n!==null&&(l=n.memoizedState.cache),i.memoizedState.cache!==l&&(i.flags|=2048),si(Yt),K(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(xo(i)?di(i):n===null||n.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,$d())),Mt(i),null;case 26:return r=i.memoizedState,n===null?(di(i),r!==null?(Mt(i),im(i,r)):(Mt(i),i.flags&=-16777217)):r?r!==n.memoizedState?(di(i),Mt(i),im(i,r)):(Mt(i),i.flags&=-16777217):(n.memoizedProps!==l&&di(i),Mt(i),i.flags&=-16777217),null;case 27:Te(i),r=de.current;var m=i.type;if(n!==null&&i.stateNode!=null)n.memoizedProps!==l&&di(i);else{if(!l){if(i.stateNode===null)throw Error(o(166));return Mt(i),null}n=fe.current,xo(i)?Ld(i):(n=ip(m,l,r),i.stateNode=n,di(i))}return Mt(i),null;case 5:if(Te(i),r=i.type,n!==null&&i.stateNode!=null)n.memoizedProps!==l&&di(i);else{if(!l){if(i.stateNode===null)throw Error(o(166));return Mt(i),null}if(n=fe.current,xo(i))Ld(i);else{switch(m=hs(de.current),n){case 1:n=m.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:n=m.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":n=m.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":n=m.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":n=m.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild);break;case"select":n=typeof l.is=="string"?m.createElement("select",{is:l.is}):m.createElement("select"),l.multiple?n.multiple=!0:l.size&&(n.size=l.size);break;default:n=typeof l.is=="string"?m.createElement(r,{is:l.is}):m.createElement(r)}}n[rt]=i,n[ct]=l;e:for(m=i.child;m!==null;){if(m.tag===5||m.tag===6)n.appendChild(m.stateNode);else if(m.tag!==4&&m.tag!==27&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===i)break e;for(;m.sibling===null;){if(m.return===null||m.return===i)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}i.stateNode=n;e:switch(an(n,r,l),r){case"button":case"input":case"select":case"textarea":n=!!l.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&di(i)}}return Mt(i),i.flags&=-16777217,null;case 6:if(n&&i.stateNode!=null)n.memoizedProps!==l&&di(i);else{if(typeof l!="string"&&i.stateNode===null)throw Error(o(166));if(n=de.current,xo(i)){if(n=i.stateNode,r=i.memoizedProps,l=null,m=cn,m!==null)switch(m.tag){case 27:case 5:l=m.memoizedProps}n[rt]=i,n=!!(n.nodeValue===r||l!==null&&l.suppressHydrationWarning===!0||Xm(n.nodeValue,r)),n||aa(i)}else n=hs(n).createTextNode(l),n[rt]=i,i.stateNode=n}return Mt(i),null;case 13:if(l=i.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(m=xo(i),l!==null&&l.dehydrated!==null){if(n===null){if(!m)throw Error(o(318));if(m=i.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(o(317));m[rt]=i}else So(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Mt(i),m=!1}else m=$d(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=m),m=!0;if(!m)return i.flags&256?(ui(i),i):(ui(i),null)}if(ui(i),(i.flags&128)!==0)return i.lanes=r,i;if(r=l!==null,n=n!==null&&n.memoizedState!==null,r){l=i.child,m=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(m=l.alternate.memoizedState.cachePool.pool);var y=null;l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(y=l.memoizedState.cachePool.pool),y!==m&&(l.flags|=2048)}return r!==n&&r&&(i.child.flags|=8192),is(i,i.updateQueue),Mt(i),null;case 4:return K(),n===null&&Vu(i.stateNode.containerInfo),Mt(i),null;case 10:return si(i.type),Mt(i),null;case 19:if(Z(Bt),m=i.memoizedState,m===null)return Mt(i),null;if(l=(i.flags&128)!==0,y=m.rendering,y===null)if(l)Go(m,!1);else{if(Dt!==0||n!==null&&(n.flags&128)!==0)for(n=i.child;n!==null;){if(y=Qr(n),y!==null){for(i.flags|=128,Go(m,!1),n=y.updateQueue,i.updateQueue=n,is(i,n),i.subtreeFlags=0,n=r,r=i.child;r!==null;)Rd(r,n),r=r.sibling;return ie(Bt,Bt.current&1|2),i.child}n=n.sibling}m.tail!==null&&Ze()>rs&&(i.flags|=128,l=!0,Go(m,!1),i.lanes=4194304)}else{if(!l)if(n=Qr(y),n!==null){if(i.flags|=128,l=!0,n=n.updateQueue,i.updateQueue=n,is(i,n),Go(m,!0),m.tail===null&&m.tailMode==="hidden"&&!y.alternate&&!st)return Mt(i),null}else 2*Ze()-m.renderingStartTime>rs&&r!==536870912&&(i.flags|=128,l=!0,Go(m,!1),i.lanes=4194304);m.isBackwards?(y.sibling=i.child,i.child=y):(n=m.last,n!==null?n.sibling=y:i.child=y,m.last=y)}return m.tail!==null?(i=m.tail,m.rendering=i,m.tail=i.sibling,m.renderingStartTime=Ze(),i.sibling=null,n=Bt.current,ie(Bt,l?n&1|2:n&1),i):(Mt(i),null);case 22:case 23:return ui(i),Fl(),l=i.memoizedState!==null,n!==null?n.memoizedState!==null!==l&&(i.flags|=8192):l&&(i.flags|=8192),l?(r&536870912)!==0&&(i.flags&128)===0&&(Mt(i),i.subtreeFlags&6&&(i.flags|=8192)):Mt(i),r=i.updateQueue,r!==null&&is(i,r.retryQueue),r=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(r=n.memoizedState.cachePool.pool),l=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),l!==r&&(i.flags|=2048),n!==null&&Z(sa),null;case 24:return r=null,n!==null&&(r=n.memoizedState.cache),i.memoizedState.cache!==r&&(i.flags|=2048),si(Yt),Mt(i),null;case 25:return null;case 30:return null}throw Error(o(156,i.tag))}function pv(n,i){switch(Il(i),i.tag){case 1:return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 3:return si(Yt),K(),n=i.flags,(n&65536)!==0&&(n&128)===0?(i.flags=n&-65537|128,i):null;case 26:case 27:case 5:return Te(i),null;case 13:if(ui(i),n=i.memoizedState,n!==null&&n.dehydrated!==null){if(i.alternate===null)throw Error(o(340));So()}return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 19:return Z(Bt),null;case 4:return K(),null;case 10:return si(i.type),null;case 22:case 23:return ui(i),Fl(),n!==null&&Z(sa),n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 24:return si(Yt),null;case 25:return null;default:return null}}function am(n,i){switch(Il(i),i.tag){case 3:si(Yt),K();break;case 26:case 27:case 5:Te(i);break;case 4:K();break;case 13:ui(i);break;case 19:Z(Bt);break;case 10:si(i.type);break;case 22:case 23:ui(i),Fl(),n!==null&&Z(sa);break;case 24:si(Yt)}}function Ho(n,i){try{var r=i.updateQueue,l=r!==null?r.lastEffect:null;if(l!==null){var m=l.next;r=m;do{if((r.tag&n)===n){l=void 0;var y=r.create,x=r.inst;l=y(),x.destroy=l}r=r.next}while(r!==m)}}catch(N){bt(i,i.return,N)}}function Ni(n,i,r){try{var l=i.updateQueue,m=l!==null?l.lastEffect:null;if(m!==null){var y=m.next;l=y;do{if((l.tag&n)===n){var x=l.inst,N=x.destroy;if(N!==void 0){x.destroy=void 0,m=i;var k=r,H=N;try{H()}catch(ee){bt(m,k,ee)}}}l=l.next}while(l!==y)}}catch(ee){bt(i,i.return,ee)}}function om(n){var i=n.updateQueue;if(i!==null){var r=n.stateNode;try{Bd(i,r)}catch(l){bt(n,n.return,l)}}}function rm(n,i,r){r.props=ua(n.type,n.memoizedProps),r.state=n.memoizedState;try{r.componentWillUnmount()}catch(l){bt(n,i,l)}}function Vo(n,i){try{var r=n.ref;if(r!==null){switch(n.tag){case 26:case 27:case 5:var l=n.stateNode;break;case 30:l=n.stateNode;break;default:l=n.stateNode}typeof r=="function"?n.refCleanup=r(l):r.current=l}}catch(m){bt(n,i,m)}}function Jn(n,i){var r=n.ref,l=n.refCleanup;if(r!==null)if(typeof l=="function")try{l()}catch(m){bt(n,i,m)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof r=="function")try{r(null)}catch(m){bt(n,i,m)}else r.current=null}function sm(n){var i=n.type,r=n.memoizedProps,l=n.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":r.autoFocus&&l.focus();break e;case"img":r.src?l.src=r.src:r.srcSet&&(l.srcset=r.srcSet)}}catch(m){bt(n,n.return,m)}}function yu(n,i,r){try{var l=n.stateNode;Pv(l,n.type,r,i),l[ct]=i}catch(m){bt(n,n.return,m)}}function lm(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&$i(n.type)||n.tag===4}function vu(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||lm(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&$i(n.type)||n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Tu(n,i,r){var l=n.tag;if(l===5||l===6)n=n.stateNode,i?(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r).insertBefore(n,i):(i=r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,i.appendChild(n),r=r._reactRootContainer,r!=null||i.onclick!==null||(i.onclick=gs));else if(l!==4&&(l===27&&$i(n.type)&&(r=n.stateNode,i=null),n=n.child,n!==null))for(Tu(n,i,r),n=n.sibling;n!==null;)Tu(n,i,r),n=n.sibling}function as(n,i,r){var l=n.tag;if(l===5||l===6)n=n.stateNode,i?r.insertBefore(n,i):r.appendChild(n);else if(l!==4&&(l===27&&$i(n.type)&&(r=n.stateNode),n=n.child,n!==null))for(as(n,i,r),n=n.sibling;n!==null;)as(n,i,r),n=n.sibling}function um(n){var i=n.stateNode,r=n.memoizedProps;try{for(var l=n.type,m=i.attributes;m.length;)i.removeAttributeNode(m[0]);an(i,l,r),i[rt]=n,i[ct]=r}catch(y){bt(n,n.return,y)}}var fi=!1,Gt=!1,Cu=!1,cm=typeof WeakSet=="function"?WeakSet:Set,jt=null;function gv(n,i){if(n=n.containerInfo,Yu=xs,n=Cd(n),vl(n)){if("selectionStart"in n)var r={start:n.selectionStart,end:n.selectionEnd};else e:{r=(r=n.ownerDocument)&&r.defaultView||window;var l=r.getSelection&&r.getSelection();if(l&&l.rangeCount!==0){r=l.anchorNode;var m=l.anchorOffset,y=l.focusNode;l=l.focusOffset;try{r.nodeType,y.nodeType}catch{r=null;break e}var x=0,N=-1,k=-1,H=0,ee=0,oe=n,q=null;t:for(;;){for(var B;oe!==r||m!==0&&oe.nodeType!==3||(N=x+m),oe!==y||l!==0&&oe.nodeType!==3||(k=x+l),oe.nodeType===3&&(x+=oe.nodeValue.length),(B=oe.firstChild)!==null;)q=oe,oe=B;for(;;){if(oe===n)break t;if(q===r&&++H===m&&(N=x),q===y&&++ee===l&&(k=x),(B=oe.nextSibling)!==null)break;oe=q,q=oe.parentNode}oe=B}r=N===-1||k===-1?null:{start:N,end:k}}else r=null}r=r||{start:0,end:0}}else r=null;for(Bu={focusedElem:n,selectionRange:r},xs=!1,jt=i;jt!==null;)if(i=jt,n=i.child,(i.subtreeFlags&1024)!==0&&n!==null)n.return=i,jt=n;else for(;jt!==null;){switch(i=jt,y=i.alternate,n=i.flags,i.tag){case 0:break;case 11:case 15:break;case 1:if((n&1024)!==0&&y!==null){n=void 0,r=i,m=y.memoizedProps,y=y.memoizedState,l=r.stateNode;try{var $e=ua(r.type,m,r.elementType===r.type);n=l.getSnapshotBeforeUpdate($e,y),l.__reactInternalSnapshotBeforeUpdate=n}catch(Re){bt(r,r.return,Re)}}break;case 3:if((n&1024)!==0){if(n=i.stateNode.containerInfo,r=n.nodeType,r===9)Ku(n);else if(r===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":Ku(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(o(163))}if(n=i.sibling,n!==null){n.return=i.return,jt=n;break}jt=i.return}}function dm(n,i,r){var l=r.flags;switch(r.tag){case 0:case 11:case 15:Ai(n,r),l&4&&Ho(5,r);break;case 1:if(Ai(n,r),l&4)if(n=r.stateNode,i===null)try{n.componentDidMount()}catch(x){bt(r,r.return,x)}else{var m=ua(r.type,i.memoizedProps);i=i.memoizedState;try{n.componentDidUpdate(m,i,n.__reactInternalSnapshotBeforeUpdate)}catch(x){bt(r,r.return,x)}}l&64&&om(r),l&512&&Vo(r,r.return);break;case 3:if(Ai(n,r),l&64&&(n=r.updateQueue,n!==null)){if(i=null,r.child!==null)switch(r.child.tag){case 27:case 5:i=r.child.stateNode;break;case 1:i=r.child.stateNode}try{Bd(n,i)}catch(x){bt(r,r.return,x)}}break;case 27:i===null&&l&4&&um(r);case 26:case 5:Ai(n,r),i===null&&l&4&&sm(r),l&512&&Vo(r,r.return);break;case 12:Ai(n,r);break;case 13:Ai(n,r),l&4&&pm(n,r),l&64&&(n=r.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(r=bv.bind(null,r),qv(n,r))));break;case 22:if(l=r.memoizedState!==null||fi,!l){i=i!==null&&i.memoizedState!==null||Gt,m=fi;var y=Gt;fi=l,(Gt=i)&&!y?wi(n,r,(r.subtreeFlags&8772)!==0):Ai(n,r),fi=m,Gt=y}break;case 30:break;default:Ai(n,r)}}function fm(n){var i=n.alternate;i!==null&&(n.alternate=null,fm(i)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(i=n.stateNode,i!==null&&it(i)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var It=null,pn=!1;function mi(n,i,r){for(r=r.child;r!==null;)mm(n,i,r),r=r.sibling}function mm(n,i,r){if(Jt&&typeof Jt.onCommitFiberUnmount=="function")try{Jt.onCommitFiberUnmount(Yn,r)}catch{}switch(r.tag){case 26:Gt||Jn(r,i),mi(n,i,r),r.memoizedState?r.memoizedState.count--:r.stateNode&&(r=r.stateNode,r.parentNode.removeChild(r));break;case 27:Gt||Jn(r,i);var l=It,m=pn;$i(r.type)&&(It=r.stateNode,pn=!1),mi(n,i,r),Xo(r.stateNode),It=l,pn=m;break;case 5:Gt||Jn(r,i);case 6:if(l=It,m=pn,It=null,mi(n,i,r),It=l,pn=m,It!==null)if(pn)try{(It.nodeType===9?It.body:It.nodeName==="HTML"?It.ownerDocument.body:It).removeChild(r.stateNode)}catch(y){bt(r,i,y)}else try{It.removeChild(r.stateNode)}catch(y){bt(r,i,y)}break;case 18:It!==null&&(pn?(n=It,tp(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,r.stateNode),ar(n)):tp(It,r.stateNode));break;case 4:l=It,m=pn,It=r.stateNode.containerInfo,pn=!0,mi(n,i,r),It=l,pn=m;break;case 0:case 11:case 14:case 15:Gt||Ni(2,r,i),Gt||Ni(4,r,i),mi(n,i,r);break;case 1:Gt||(Jn(r,i),l=r.stateNode,typeof l.componentWillUnmount=="function"&&rm(r,i,l)),mi(n,i,r);break;case 21:mi(n,i,r);break;case 22:Gt=(l=Gt)||r.memoizedState!==null,mi(n,i,r),Gt=l;break;default:mi(n,i,r)}}function pm(n,i){if(i.memoizedState===null&&(n=i.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{ar(n)}catch(r){bt(i,i.return,r)}}function hv(n){switch(n.tag){case 13:case 19:var i=n.stateNode;return i===null&&(i=n.stateNode=new cm),i;case 22:return n=n.stateNode,i=n._retryCache,i===null&&(i=n._retryCache=new cm),i;default:throw Error(o(435,n.tag))}}function Eu(n,i){var r=hv(n);i.forEach(function(l){var m=_v.bind(null,n,l);r.has(l)||(r.add(l),l.then(m,m))})}function Sn(n,i){var r=i.deletions;if(r!==null)for(var l=0;l<r.length;l++){var m=r[l],y=n,x=i,N=x;e:for(;N!==null;){switch(N.tag){case 27:if($i(N.type)){It=N.stateNode,pn=!1;break e}break;case 5:It=N.stateNode,pn=!1;break e;case 3:case 4:It=N.stateNode.containerInfo,pn=!0;break e}N=N.return}if(It===null)throw Error(o(160));mm(y,x,m),It=null,pn=!1,y=m.alternate,y!==null&&(y.return=null),m.return=null}if(i.subtreeFlags&13878)for(i=i.child;i!==null;)gm(i,n),i=i.sibling}var Vn=null;function gm(n,i){var r=n.alternate,l=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:Sn(i,n),bn(n),l&4&&(Ni(3,n,n.return),Ho(3,n),Ni(5,n,n.return));break;case 1:Sn(i,n),bn(n),l&512&&(Gt||r===null||Jn(r,r.return)),l&64&&fi&&(n=n.updateQueue,n!==null&&(l=n.callbacks,l!==null&&(r=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=r===null?l:r.concat(l))));break;case 26:var m=Vn;if(Sn(i,n),bn(n),l&512&&(Gt||r===null||Jn(r,r.return)),l&4){var y=r!==null?r.memoizedState:null;if(l=n.memoizedState,r===null)if(l===null)if(n.stateNode===null){e:{l=n.type,r=n.memoizedProps,m=m.ownerDocument||m;t:switch(l){case"title":y=m.getElementsByTagName("title")[0],(!y||y[Xi]||y[rt]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=m.createElement(l),m.head.insertBefore(y,m.querySelector("head > title"))),an(y,l,r),y[rt]=n,Qe(y),l=y;break e;case"link":var x=up("link","href",m).get(l+(r.href||""));if(x){for(var N=0;N<x.length;N++)if(y=x[N],y.getAttribute("href")===(r.href==null||r.href===""?null:r.href)&&y.getAttribute("rel")===(r.rel==null?null:r.rel)&&y.getAttribute("title")===(r.title==null?null:r.title)&&y.getAttribute("crossorigin")===(r.crossOrigin==null?null:r.crossOrigin)){x.splice(N,1);break t}}y=m.createElement(l),an(y,l,r),m.head.appendChild(y);break;case"meta":if(x=up("meta","content",m).get(l+(r.content||""))){for(N=0;N<x.length;N++)if(y=x[N],y.getAttribute("content")===(r.content==null?null:""+r.content)&&y.getAttribute("name")===(r.name==null?null:r.name)&&y.getAttribute("property")===(r.property==null?null:r.property)&&y.getAttribute("http-equiv")===(r.httpEquiv==null?null:r.httpEquiv)&&y.getAttribute("charset")===(r.charSet==null?null:r.charSet)){x.splice(N,1);break t}}y=m.createElement(l),an(y,l,r),m.head.appendChild(y);break;default:throw Error(o(468,l))}y[rt]=n,Qe(y),l=y}n.stateNode=l}else cp(m,n.type,n.stateNode);else n.stateNode=lp(m,l,n.memoizedProps);else y!==l?(y===null?r.stateNode!==null&&(r=r.stateNode,r.parentNode.removeChild(r)):y.count--,l===null?cp(m,n.type,n.stateNode):lp(m,l,n.memoizedProps)):l===null&&n.stateNode!==null&&yu(n,n.memoizedProps,r.memoizedProps)}break;case 27:Sn(i,n),bn(n),l&512&&(Gt||r===null||Jn(r,r.return)),r!==null&&l&4&&yu(n,n.memoizedProps,r.memoizedProps);break;case 5:if(Sn(i,n),bn(n),l&512&&(Gt||r===null||Jn(r,r.return)),n.flags&32){m=n.stateNode;try{xa(m,"")}catch(B){bt(n,n.return,B)}}l&4&&n.stateNode!=null&&(m=n.memoizedProps,yu(n,m,r!==null?r.memoizedProps:m)),l&1024&&(Cu=!0);break;case 6:if(Sn(i,n),bn(n),l&4){if(n.stateNode===null)throw Error(o(162));l=n.memoizedProps,r=n.stateNode;try{r.nodeValue=l}catch(B){bt(n,n.return,B)}}break;case 3:if(Ts=null,m=Vn,Vn=ys(i.containerInfo),Sn(i,n),Vn=m,bn(n),l&4&&r!==null&&r.memoizedState.isDehydrated)try{ar(i.containerInfo)}catch(B){bt(n,n.return,B)}Cu&&(Cu=!1,hm(n));break;case 4:l=Vn,Vn=ys(n.stateNode.containerInfo),Sn(i,n),bn(n),Vn=l;break;case 12:Sn(i,n),bn(n);break;case 13:Sn(i,n),bn(n),n.child.flags&8192&&n.memoizedState!==null!=(r!==null&&r.memoizedState!==null)&&(Au=Ze()),l&4&&(l=n.updateQueue,l!==null&&(n.updateQueue=null,Eu(n,l)));break;case 22:m=n.memoizedState!==null;var k=r!==null&&r.memoizedState!==null,H=fi,ee=Gt;if(fi=H||m,Gt=ee||k,Sn(i,n),Gt=ee,fi=H,bn(n),l&8192)e:for(i=n.stateNode,i._visibility=m?i._visibility&-2:i._visibility|1,m&&(r===null||k||fi||Gt||ca(n)),r=null,i=n;;){if(i.tag===5||i.tag===26){if(r===null){k=r=i;try{if(y=k.stateNode,m)x=y.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none";else{N=k.stateNode;var oe=k.memoizedProps.style,q=oe!=null&&oe.hasOwnProperty("display")?oe.display:null;N.style.display=q==null||typeof q=="boolean"?"":(""+q).trim()}}catch(B){bt(k,k.return,B)}}}else if(i.tag===6){if(r===null){k=i;try{k.stateNode.nodeValue=m?"":k.memoizedProps}catch(B){bt(k,k.return,B)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===n)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break e;for(;i.sibling===null;){if(i.return===null||i.return===n)break e;r===i&&(r=null),i=i.return}r===i&&(r=null),i.sibling.return=i.return,i=i.sibling}l&4&&(l=n.updateQueue,l!==null&&(r=l.retryQueue,r!==null&&(l.retryQueue=null,Eu(n,r))));break;case 19:Sn(i,n),bn(n),l&4&&(l=n.updateQueue,l!==null&&(n.updateQueue=null,Eu(n,l)));break;case 30:break;case 21:break;default:Sn(i,n),bn(n)}}function bn(n){var i=n.flags;if(i&2){try{for(var r,l=n.return;l!==null;){if(lm(l)){r=l;break}l=l.return}if(r==null)throw Error(o(160));switch(r.tag){case 27:var m=r.stateNode,y=vu(n);as(n,y,m);break;case 5:var x=r.stateNode;r.flags&32&&(xa(x,""),r.flags&=-33);var N=vu(n);as(n,N,x);break;case 3:case 4:var k=r.stateNode.containerInfo,H=vu(n);Tu(n,H,k);break;default:throw Error(o(161))}}catch(ee){bt(n,n.return,ee)}n.flags&=-3}i&4096&&(n.flags&=-4097)}function hm(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var i=n;hm(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),n=n.sibling}}function Ai(n,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)dm(n,i.alternate,i),i=i.sibling}function ca(n){for(n=n.child;n!==null;){var i=n;switch(i.tag){case 0:case 11:case 14:case 15:Ni(4,i,i.return),ca(i);break;case 1:Jn(i,i.return);var r=i.stateNode;typeof r.componentWillUnmount=="function"&&rm(i,i.return,r),ca(i);break;case 27:Xo(i.stateNode);case 26:case 5:Jn(i,i.return),ca(i);break;case 22:i.memoizedState===null&&ca(i);break;case 30:ca(i);break;default:ca(i)}n=n.sibling}}function wi(n,i,r){for(r=r&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var l=i.alternate,m=n,y=i,x=y.flags;switch(y.tag){case 0:case 11:case 15:wi(m,y,r),Ho(4,y);break;case 1:if(wi(m,y,r),l=y,m=l.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(H){bt(l,l.return,H)}if(l=y,m=l.updateQueue,m!==null){var N=l.stateNode;try{var k=m.shared.hiddenCallbacks;if(k!==null)for(m.shared.hiddenCallbacks=null,m=0;m<k.length;m++)Yd(k[m],N)}catch(H){bt(l,l.return,H)}}r&&x&64&&om(y),Vo(y,y.return);break;case 27:um(y);case 26:case 5:wi(m,y,r),r&&l===null&&x&4&&sm(y),Vo(y,y.return);break;case 12:wi(m,y,r);break;case 13:wi(m,y,r),r&&x&4&&pm(m,y);break;case 22:y.memoizedState===null&&wi(m,y,r),Vo(y,y.return);break;case 30:break;default:wi(m,y,r)}i=i.sibling}}function xu(n,i){var r=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(r=n.memoizedState.cachePool.pool),n=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(n=i.memoizedState.cachePool.pool),n!==r&&(n!=null&&n.refCount++,r!=null&&No(r))}function Su(n,i){n=null,i.alternate!==null&&(n=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==n&&(i.refCount++,n!=null&&No(n))}function Kn(n,i,r,l){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)ym(n,i,r,l),i=i.sibling}function ym(n,i,r,l){var m=i.flags;switch(i.tag){case 0:case 11:case 15:Kn(n,i,r,l),m&2048&&Ho(9,i);break;case 1:Kn(n,i,r,l);break;case 3:Kn(n,i,r,l),m&2048&&(n=null,i.alternate!==null&&(n=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==n&&(i.refCount++,n!=null&&No(n)));break;case 12:if(m&2048){Kn(n,i,r,l),n=i.stateNode;try{var y=i.memoizedProps,x=y.id,N=y.onPostCommit;typeof N=="function"&&N(x,i.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(k){bt(i,i.return,k)}}else Kn(n,i,r,l);break;case 13:Kn(n,i,r,l);break;case 23:break;case 22:y=i.stateNode,x=i.alternate,i.memoizedState!==null?y._visibility&2?Kn(n,i,r,l):qo(n,i):y._visibility&2?Kn(n,i,r,l):(y._visibility|=2,Va(n,i,r,l,(i.subtreeFlags&10256)!==0)),m&2048&&xu(x,i);break;case 24:Kn(n,i,r,l),m&2048&&Su(i.alternate,i);break;default:Kn(n,i,r,l)}}function Va(n,i,r,l,m){for(m=m&&(i.subtreeFlags&10256)!==0,i=i.child;i!==null;){var y=n,x=i,N=r,k=l,H=x.flags;switch(x.tag){case 0:case 11:case 15:Va(y,x,N,k,m),Ho(8,x);break;case 23:break;case 22:var ee=x.stateNode;x.memoizedState!==null?ee._visibility&2?Va(y,x,N,k,m):qo(y,x):(ee._visibility|=2,Va(y,x,N,k,m)),m&&H&2048&&xu(x.alternate,x);break;case 24:Va(y,x,N,k,m),m&&H&2048&&Su(x.alternate,x);break;default:Va(y,x,N,k,m)}i=i.sibling}}function qo(n,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var r=n,l=i,m=l.flags;switch(l.tag){case 22:qo(r,l),m&2048&&xu(l.alternate,l);break;case 24:qo(r,l),m&2048&&Su(l.alternate,l);break;default:qo(r,l)}i=i.sibling}}var Fo=8192;function qa(n){if(n.subtreeFlags&Fo)for(n=n.child;n!==null;)vm(n),n=n.sibling}function vm(n){switch(n.tag){case 26:qa(n),n.flags&Fo&&n.memoizedState!==null&&tT(Vn,n.memoizedState,n.memoizedProps);break;case 5:qa(n);break;case 3:case 4:var i=Vn;Vn=ys(n.stateNode.containerInfo),qa(n),Vn=i;break;case 22:n.memoizedState===null&&(i=n.alternate,i!==null&&i.memoizedState!==null?(i=Fo,Fo=16777216,qa(n),Fo=i):qa(n));break;default:qa(n)}}function Tm(n){var i=n.alternate;if(i!==null&&(n=i.child,n!==null)){i.child=null;do i=n.sibling,n.sibling=null,n=i;while(n!==null)}}function Yo(n){var i=n.deletions;if((n.flags&16)!==0){if(i!==null)for(var r=0;r<i.length;r++){var l=i[r];jt=l,Em(l,n)}Tm(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Cm(n),n=n.sibling}function Cm(n){switch(n.tag){case 0:case 11:case 15:Yo(n),n.flags&2048&&Ni(9,n,n.return);break;case 3:Yo(n);break;case 12:Yo(n);break;case 22:var i=n.stateNode;n.memoizedState!==null&&i._visibility&2&&(n.return===null||n.return.tag!==13)?(i._visibility&=-3,os(n)):Yo(n);break;default:Yo(n)}}function os(n){var i=n.deletions;if((n.flags&16)!==0){if(i!==null)for(var r=0;r<i.length;r++){var l=i[r];jt=l,Em(l,n)}Tm(n)}for(n=n.child;n!==null;){switch(i=n,i.tag){case 0:case 11:case 15:Ni(8,i,i.return),os(i);break;case 22:r=i.stateNode,r._visibility&2&&(r._visibility&=-3,os(i));break;default:os(i)}n=n.sibling}}function Em(n,i){for(;jt!==null;){var r=jt;switch(r.tag){case 0:case 11:case 15:Ni(8,r,i);break;case 23:case 22:if(r.memoizedState!==null&&r.memoizedState.cachePool!==null){var l=r.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:No(r.memoizedState.cache)}if(l=r.child,l!==null)l.return=r,jt=l;else e:for(r=n;jt!==null;){l=jt;var m=l.sibling,y=l.return;if(fm(l),l===r){jt=null;break e}if(m!==null){m.return=y,jt=m;break e}jt=y}}}var yv={getCacheForType:function(n){var i=rn(Yt),r=i.data.get(n);return r===void 0&&(r=n(),i.data.set(n,r)),r}},vv=typeof WeakMap=="function"?WeakMap:Map,mt=0,At=null,Xe=null,nt=0,pt=0,_n=null,Ii=!1,Fa=!1,bu=!1,pi=0,Dt=0,Ri=0,da=0,_u=0,Dn=0,Ya=0,Bo=null,gn=null,Nu=!1,Au=0,rs=1/0,ss=null,Mi=null,nn=0,Li=null,Ba=null,za=0,wu=0,Iu=null,xm=null,zo=0,Ru=null;function Nn(){if((mt&2)!==0&&nt!==0)return nt&-nt;if(U.T!==null){var n=ka;return n!==0?n:Uu()}return vn()}function Sm(){Dn===0&&(Dn=(nt&536870912)===0||st?Le():536870912);var n=Pn.current;return n!==null&&(n.flags|=32),Dn}function An(n,i,r){(n===At&&(pt===2||pt===9)||n.cancelPendingCommit!==null)&&(Ja(n,0),ki(n,nt,Dn,!1)),Ae(n,r),((mt&2)===0||n!==At)&&(n===At&&((mt&2)===0&&(da|=r),Dt===4&&ki(n,nt,Dn,!1)),Zn(n))}function bm(n,i,r){if((mt&6)!==0)throw Error(o(327));var l=!r&&(i&124)===0&&(i&n.expiredLanes)===0||ht(n,i),m=l?Ev(n,i):ku(n,i,!0),y=l;do{if(m===0){Fa&&!l&&ki(n,i,0,!1);break}else{if(r=n.current.alternate,y&&!Tv(r)){m=ku(n,i,!1),y=!1;continue}if(m===2){if(y=i,n.errorRecoveryDisabledLanes&y)var x=0;else x=n.pendingLanes&-536870913,x=x!==0?x:x&536870912?536870912:0;if(x!==0){i=x;e:{var N=n;m=Bo;var k=N.current.memoizedState.isDehydrated;if(k&&(Ja(N,x).flags|=256),x=ku(N,x,!1),x!==2){if(bu&&!k){N.errorRecoveryDisabledLanes|=y,da|=y,m=4;break e}y=gn,gn=m,y!==null&&(gn===null?gn=y:gn.push.apply(gn,y))}m=x}if(y=!1,m!==2)continue}}if(m===1){Ja(n,0),ki(n,i,0,!0);break}e:{switch(l=n,y=m,y){case 0:case 1:throw Error(o(345));case 4:if((i&4194048)!==i)break;case 6:ki(l,i,Dn,!Ii);break e;case 2:gn=null;break;case 3:case 5:break;default:throw Error(o(329))}if((i&62914560)===i&&(m=Au+300-Ze(),10<m)){if(ki(l,i,Dn,!Ii),Se(l,0,!0)!==0)break e;l.timeoutHandle=Wm(_m.bind(null,l,r,gn,ss,Nu,i,Dn,da,Ya,Ii,y,2,-0,0),m);break e}_m(l,r,gn,ss,Nu,i,Dn,da,Ya,Ii,y,0,-0,0)}}break}while(!0);Zn(n)}function _m(n,i,r,l,m,y,x,N,k,H,ee,oe,q,B){if(n.timeoutHandle=-1,oe=i.subtreeFlags,(oe&8192||(oe&16785408)===16785408)&&(Wo={stylesheets:null,count:0,unsuspend:eT},vm(i),oe=nT(),oe!==null)){n.cancelPendingCommit=oe(Lm.bind(null,n,i,y,r,l,m,x,N,k,ee,1,q,B)),ki(n,y,x,!H);return}Lm(n,i,y,r,l,m,x,N,k)}function Tv(n){for(var i=n;;){var r=i.tag;if((r===0||r===11||r===15)&&i.flags&16384&&(r=i.updateQueue,r!==null&&(r=r.stores,r!==null)))for(var l=0;l<r.length;l++){var m=r[l],y=m.getSnapshot;m=m.value;try{if(!En(y(),m))return!1}catch{return!1}}if(r=i.child,i.subtreeFlags&16384&&r!==null)r.return=i,i=r;else{if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function ki(n,i,r,l){i&=~_u,i&=~da,n.suspendedLanes|=i,n.pingedLanes&=~i,l&&(n.warmLanes|=i),l=n.expirationTimes;for(var m=i;0<m;){var y=31-on(m),x=1<<y;l[y]=-1,m&=~x}r!==0&&ve(n,r,i)}function ls(){return(mt&6)===0?(Jo(0),!1):!0}function Mu(){if(Xe!==null){if(pt===0)var n=Xe.return;else n=Xe,ri=oa=null,Kl(n),Ga=null,Uo=0,n=Xe;for(;n!==null;)am(n.alternate,n),n=n.return;Xe=null}}function Ja(n,i){var r=n.timeoutHandle;r!==-1&&(n.timeoutHandle=-1,Uv(r)),r=n.cancelPendingCommit,r!==null&&(n.cancelPendingCommit=null,r()),Mu(),At=n,Xe=r=ii(n.current,null),nt=i,pt=0,_n=null,Ii=!1,Fa=ht(n,i),bu=!1,Ya=Dn=_u=da=Ri=Dt=0,gn=Bo=null,Nu=!1,(i&8)!==0&&(i|=i&32);var l=n.entangledLanes;if(l!==0)for(n=n.entanglements,l&=i;0<l;){var m=31-on(l),y=1<<m;i|=n[m],l&=~y}return pi=i,Rr(),r}function Nm(n,i){ze=null,U.H=Zr,i===wo||i===Gr?(i=qd(),pt=3):i===Gd?(i=qd(),pt=4):pt=i===Yf?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,_n=i,Xe===null&&(Dt=1,es(n,Mn(i,n.current)))}function Am(){var n=U.H;return U.H=Zr,n===null?Zr:n}function wm(){var n=U.A;return U.A=yv,n}function Lu(){Dt=4,Ii||(nt&4194048)!==nt&&Pn.current!==null||(Fa=!0),(Ri&134217727)===0&&(da&134217727)===0||At===null||ki(At,nt,Dn,!1)}function ku(n,i,r){var l=mt;mt|=2;var m=Am(),y=wm();(At!==n||nt!==i)&&(ss=null,Ja(n,i)),i=!1;var x=Dt;e:do try{if(pt!==0&&Xe!==null){var N=Xe,k=_n;switch(pt){case 8:Mu(),x=6;break e;case 3:case 2:case 9:case 6:Pn.current===null&&(i=!0);var H=pt;if(pt=0,_n=null,Ka(n,N,k,H),r&&Fa){x=0;break e}break;default:H=pt,pt=0,_n=null,Ka(n,N,k,H)}}Cv(),x=Dt;break}catch(ee){Nm(n,ee)}while(!0);return i&&n.shellSuspendCounter++,ri=oa=null,mt=l,U.H=m,U.A=y,Xe===null&&(At=null,nt=0,Rr()),x}function Cv(){for(;Xe!==null;)Im(Xe)}function Ev(n,i){var r=mt;mt|=2;var l=Am(),m=wm();At!==n||nt!==i?(ss=null,rs=Ze()+500,Ja(n,i)):Fa=ht(n,i);e:do try{if(pt!==0&&Xe!==null){i=Xe;var y=_n;t:switch(pt){case 1:pt=0,_n=null,Ka(n,i,y,1);break;case 2:case 9:if(Hd(y)){pt=0,_n=null,Rm(i);break}i=function(){pt!==2&&pt!==9||At!==n||(pt=7),Zn(n)},y.then(i,i);break e;case 3:pt=7;break e;case 4:pt=5;break e;case 7:Hd(y)?(pt=0,_n=null,Rm(i)):(pt=0,_n=null,Ka(n,i,y,7));break;case 5:var x=null;switch(Xe.tag){case 26:x=Xe.memoizedState;case 5:case 27:var N=Xe;if(!x||dp(x)){pt=0,_n=null;var k=N.sibling;if(k!==null)Xe=k;else{var H=N.return;H!==null?(Xe=H,us(H)):Xe=null}break t}}pt=0,_n=null,Ka(n,i,y,5);break;case 6:pt=0,_n=null,Ka(n,i,y,6);break;case 8:Mu(),Dt=6;break e;default:throw Error(o(462))}}xv();break}catch(ee){Nm(n,ee)}while(!0);return ri=oa=null,U.H=l,U.A=m,mt=r,Xe!==null?0:(At=null,nt=0,Rr(),Dt)}function xv(){for(;Xe!==null&&!be();)Im(Xe)}function Im(n){var i=nm(n.alternate,n,pi);n.memoizedProps=n.pendingProps,i===null?us(n):Xe=i}function Rm(n){var i=n,r=i.alternate;switch(i.tag){case 15:case 0:i=Xf(r,i,i.pendingProps,i.type,void 0,nt);break;case 11:i=Xf(r,i,i.pendingProps,i.type.render,i.ref,nt);break;case 5:Kl(i);default:am(r,i),i=Xe=Rd(i,pi),i=nm(r,i,pi)}n.memoizedProps=n.pendingProps,i===null?us(n):Xe=i}function Ka(n,i,r,l){ri=oa=null,Kl(i),Ga=null,Uo=0;var m=i.return;try{if(dv(n,m,i,r,nt)){Dt=1,es(n,Mn(r,n.current)),Xe=null;return}}catch(y){if(m!==null)throw Xe=m,y;Dt=1,es(n,Mn(r,n.current)),Xe=null;return}i.flags&32768?(st||l===1?n=!0:Fa||(nt&536870912)!==0?n=!1:(Ii=n=!0,(l===2||l===9||l===3||l===6)&&(l=Pn.current,l!==null&&l.tag===13&&(l.flags|=16384))),Mm(i,n)):us(i)}function us(n){var i=n;do{if((i.flags&32768)!==0){Mm(i,Ii);return}n=i.return;var r=mv(i.alternate,i,pi);if(r!==null){Xe=r;return}if(i=i.sibling,i!==null){Xe=i;return}Xe=i=n}while(i!==null);Dt===0&&(Dt=5)}function Mm(n,i){do{var r=pv(n.alternate,n);if(r!==null){r.flags&=32767,Xe=r;return}if(r=n.return,r!==null&&(r.flags|=32768,r.subtreeFlags=0,r.deletions=null),!i&&(n=n.sibling,n!==null)){Xe=n;return}Xe=n=r}while(n!==null);Dt=6,Xe=null}function Lm(n,i,r,l,m,y,x,N,k){n.cancelPendingCommit=null;do cs();while(nn!==0);if((mt&6)!==0)throw Error(o(327));if(i!==null){if(i===n.current)throw Error(o(177));if(y=i.lanes|i.childLanes,y|=Sl,Kt(n,r,y,x,N,k),n===At&&(Xe=At=null,nt=0),Ba=i,Li=n,za=r,wu=y,Iu=m,xm=l,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,Nv(St,function(){return Um(),null})):(n.callbackNode=null,n.callbackPriority=0),l=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||l){l=U.T,U.T=null,m=X.p,X.p=2,x=mt,mt|=4;try{gv(n,i,r)}finally{mt=x,X.p=m,U.T=l}}nn=1,km(),$m(),Pm()}}function km(){if(nn===1){nn=0;var n=Li,i=Ba,r=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||r){r=U.T,U.T=null;var l=X.p;X.p=2;var m=mt;mt|=4;try{gm(i,n);var y=Bu,x=Cd(n.containerInfo),N=y.focusedElem,k=y.selectionRange;if(x!==N&&N&&N.ownerDocument&&Td(N.ownerDocument.documentElement,N)){if(k!==null&&vl(N)){var H=k.start,ee=k.end;if(ee===void 0&&(ee=H),"selectionStart"in N)N.selectionStart=H,N.selectionEnd=Math.min(ee,N.value.length);else{var oe=N.ownerDocument||document,q=oe&&oe.defaultView||window;if(q.getSelection){var B=q.getSelection(),$e=N.textContent.length,Re=Math.min(k.start,$e),Et=k.end===void 0?Re:Math.min(k.end,$e);!B.extend&&Re>Et&&(x=Et,Et=Re,Re=x);var O=vd(N,Re),D=vd(N,Et);if(O&&D&&(B.rangeCount!==1||B.anchorNode!==O.node||B.anchorOffset!==O.offset||B.focusNode!==D.node||B.focusOffset!==D.offset)){var G=oe.createRange();G.setStart(O.node,O.offset),B.removeAllRanges(),Re>Et?(B.addRange(G),B.extend(D.node,D.offset)):(G.setEnd(D.node,D.offset),B.addRange(G))}}}}for(oe=[],B=N;B=B.parentNode;)B.nodeType===1&&oe.push({element:B,left:B.scrollLeft,top:B.scrollTop});for(typeof N.focus=="function"&&N.focus(),N=0;N<oe.length;N++){var ne=oe[N];ne.element.scrollLeft=ne.left,ne.element.scrollTop=ne.top}}xs=!!Yu,Bu=Yu=null}finally{mt=m,X.p=l,U.T=r}}n.current=i,nn=2}}function $m(){if(nn===2){nn=0;var n=Li,i=Ba,r=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||r){r=U.T,U.T=null;var l=X.p;X.p=2;var m=mt;mt|=4;try{dm(n,i.alternate,i)}finally{mt=m,X.p=l,U.T=r}}nn=3}}function Pm(){if(nn===4||nn===3){nn=0,Ke();var n=Li,i=Ba,r=za,l=xm;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?nn=5:(nn=0,Ba=Li=null,Dm(n,n.pendingLanes));var m=n.pendingLanes;if(m===0&&(Mi=null),un(r),i=i.stateNode,Jt&&typeof Jt.onCommitFiberRoot=="function")try{Jt.onCommitFiberRoot(Yn,i,void 0,(i.current.flags&128)===128)}catch{}if(l!==null){i=U.T,m=X.p,X.p=2,U.T=null;try{for(var y=n.onRecoverableError,x=0;x<l.length;x++){var N=l[x];y(N.value,{componentStack:N.stack})}}finally{U.T=i,X.p=m}}(za&3)!==0&&cs(),Zn(n),m=n.pendingLanes,(r&4194090)!==0&&(m&42)!==0?n===Ru?zo++:(zo=0,Ru=n):zo=0,Jo(0)}}function Dm(n,i){(n.pooledCacheLanes&=i)===0&&(i=n.pooledCache,i!=null&&(n.pooledCache=null,No(i)))}function cs(n){return km(),$m(),Pm(),Um()}function Um(){if(nn!==5)return!1;var n=Li,i=wu;wu=0;var r=un(za),l=U.T,m=X.p;try{X.p=32>r?32:r,U.T=null,r=Iu,Iu=null;var y=Li,x=za;if(nn=0,Ba=Li=null,za=0,(mt&6)!==0)throw Error(o(331));var N=mt;if(mt|=4,Cm(y.current),ym(y,y.current,x,r),mt=N,Jo(0,!1),Jt&&typeof Jt.onPostCommitFiberRoot=="function")try{Jt.onPostCommitFiberRoot(Yn,y)}catch{}return!0}finally{X.p=m,U.T=l,Dm(n,i)}}function Om(n,i,r){i=Mn(r,i),i=lu(n.stateNode,i,2),n=xi(n,i,2),n!==null&&(Ae(n,2),Zn(n))}function bt(n,i,r){if(n.tag===3)Om(n,n,r);else for(;i!==null;){if(i.tag===3){Om(i,n,r);break}else if(i.tag===1){var l=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(Mi===null||!Mi.has(l))){n=Mn(r,n),r=qf(2),l=xi(i,r,2),l!==null&&(Ff(r,l,i,n),Ae(l,2),Zn(l));break}}i=i.return}}function $u(n,i,r){var l=n.pingCache;if(l===null){l=n.pingCache=new vv;var m=new Set;l.set(i,m)}else m=l.get(i),m===void 0&&(m=new Set,l.set(i,m));m.has(r)||(bu=!0,m.add(r),n=Sv.bind(null,n,i,r),i.then(n,n))}function Sv(n,i,r){var l=n.pingCache;l!==null&&l.delete(i),n.pingedLanes|=n.suspendedLanes&r,n.warmLanes&=~r,At===n&&(nt&r)===r&&(Dt===4||Dt===3&&(nt&62914560)===nt&&300>Ze()-Au?(mt&2)===0&&Ja(n,0):_u|=r,Ya===nt&&(Ya=0)),Zn(n)}function Gm(n,i){i===0&&(i=Ut()),n=Ia(n,i),n!==null&&(Ae(n,i),Zn(n))}function bv(n){var i=n.memoizedState,r=0;i!==null&&(r=i.retryLane),Gm(n,r)}function _v(n,i){var r=0;switch(n.tag){case 13:var l=n.stateNode,m=n.memoizedState;m!==null&&(r=m.retryLane);break;case 19:l=n.stateNode;break;case 22:l=n.stateNode._retryCache;break;default:throw Error(o(314))}l!==null&&l.delete(i),Gm(n,r)}function Nv(n,i){return Me(n,i)}var ds=null,Za=null,Pu=!1,fs=!1,Du=!1,fa=0;function Zn(n){n!==Za&&n.next===null&&(Za===null?ds=Za=n:Za=Za.next=n),fs=!0,Pu||(Pu=!0,wv())}function Jo(n,i){if(!Du&&fs){Du=!0;do for(var r=!1,l=ds;l!==null;){if(n!==0){var m=l.pendingLanes;if(m===0)var y=0;else{var x=l.suspendedLanes,N=l.pingedLanes;y=(1<<31-on(42|n)+1)-1,y&=m&~(x&~N),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(r=!0,Fm(l,y))}else y=nt,y=Se(l,l===At?y:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(y&3)===0||ht(l,y)||(r=!0,Fm(l,y));l=l.next}while(r);Du=!1}}function Av(){Hm()}function Hm(){fs=Pu=!1;var n=0;fa!==0&&(Dv()&&(n=fa),fa=0);for(var i=Ze(),r=null,l=ds;l!==null;){var m=l.next,y=Vm(l,i);y===0?(l.next=null,r===null?ds=m:r.next=m,m===null&&(Za=r)):(r=l,(n!==0||(y&3)!==0)&&(fs=!0)),l=m}Jo(n)}function Vm(n,i){for(var r=n.suspendedLanes,l=n.pingedLanes,m=n.expirationTimes,y=n.pendingLanes&-62914561;0<y;){var x=31-on(y),N=1<<x,k=m[x];k===-1?((N&r)===0||(N&l)!==0)&&(m[x]=et(N,i)):k<=i&&(n.expiredLanes|=N),y&=~N}if(i=At,r=nt,r=Se(n,n===i?r:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),l=n.callbackNode,r===0||n===i&&(pt===2||pt===9)||n.cancelPendingCommit!==null)return l!==null&&l!==null&&Ge(l),n.callbackNode=null,n.callbackPriority=0;if((r&3)===0||ht(n,r)){if(i=r&-r,i===n.callbackPriority)return i;switch(l!==null&&Ge(l),un(r)){case 2:case 8:r=xt;break;case 32:r=St;break;case 268435456:r=Wn;break;default:r=St}return l=qm.bind(null,n),r=Me(r,l),n.callbackPriority=i,n.callbackNode=r,i}return l!==null&&l!==null&&Ge(l),n.callbackPriority=2,n.callbackNode=null,2}function qm(n,i){if(nn!==0&&nn!==5)return n.callbackNode=null,n.callbackPriority=0,null;var r=n.callbackNode;if(cs()&&n.callbackNode!==r)return null;var l=nt;return l=Se(n,n===At?l:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),l===0?null:(bm(n,l,i),Vm(n,Ze()),n.callbackNode!=null&&n.callbackNode===r?qm.bind(null,n):null)}function Fm(n,i){if(cs())return null;bm(n,i,!0)}function wv(){Ov(function(){(mt&6)!==0?Me(kt,Av):Hm()})}function Uu(){return fa===0&&(fa=Le()),fa}function Ym(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Sr(""+n)}function Bm(n,i){var r=i.ownerDocument.createElement("input");return r.name=i.name,r.value=i.value,n.id&&r.setAttribute("form",n.id),i.parentNode.insertBefore(r,i),n=new FormData(n),r.parentNode.removeChild(r),n}function Iv(n,i,r,l,m){if(i==="submit"&&r&&r.stateNode===m){var y=Ym((m[ct]||null).action),x=l.submitter;x&&(i=(i=x[ct]||null)?Ym(i.formAction):x.getAttribute("formAction"),i!==null&&(y=i,x=null));var N=new Ar("action","action",null,l,m);n.push({event:N,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(fa!==0){var k=x?Bm(m,x):new FormData(m);iu(r,{pending:!0,data:k,method:m.method,action:y},null,k)}}else typeof y=="function"&&(N.preventDefault(),k=x?Bm(m,x):new FormData(m),iu(r,{pending:!0,data:k,method:m.method,action:y},y,k))},currentTarget:m}]})}}for(var Ou=0;Ou<xl.length;Ou++){var Gu=xl[Ou],Rv=Gu.toLowerCase(),Mv=Gu[0].toUpperCase()+Gu.slice(1);Hn(Rv,"on"+Mv)}Hn(Sd,"onAnimationEnd"),Hn(bd,"onAnimationIteration"),Hn(_d,"onAnimationStart"),Hn("dblclick","onDoubleClick"),Hn("focusin","onFocus"),Hn("focusout","onBlur"),Hn(Ky,"onTransitionRun"),Hn(Zy,"onTransitionStart"),Hn(Xy,"onTransitionCancel"),Hn(Nd,"onTransitionEnd"),Cn("onMouseEnter",["mouseout","mouseover"]),Cn("onMouseLeave",["mouseout","mouseover"]),Cn("onPointerEnter",["pointerout","pointerover"]),Cn("onPointerLeave",["pointerout","pointerover"]),dt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),dt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),dt("onBeforeInput",["compositionend","keypress","textInput","paste"]),dt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),dt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),dt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ko="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lv=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ko));function zm(n,i){i=(i&4)!==0;for(var r=0;r<n.length;r++){var l=n[r],m=l.event;l=l.listeners;e:{var y=void 0;if(i)for(var x=l.length-1;0<=x;x--){var N=l[x],k=N.instance,H=N.currentTarget;if(N=N.listener,k!==y&&m.isPropagationStopped())break e;y=N,m.currentTarget=H;try{y(m)}catch(ee){Wr(ee)}m.currentTarget=null,y=k}else for(x=0;x<l.length;x++){if(N=l[x],k=N.instance,H=N.currentTarget,N=N.listener,k!==y&&m.isPropagationStopped())break e;y=N,m.currentTarget=H;try{y(m)}catch(ee){Wr(ee)}m.currentTarget=null,y=k}}}}function je(n,i){var r=i[fo];r===void 0&&(r=i[fo]=new Set);var l=n+"__bubble";r.has(l)||(Jm(i,n,2,!1),r.add(l))}function Hu(n,i,r){var l=0;i&&(l|=4),Jm(r,n,l,i)}var ms="_reactListening"+Math.random().toString(36).slice(2);function Vu(n){if(!n[ms]){n[ms]=!0,He.forEach(function(r){r!=="selectionchange"&&(Lv.has(r)||Hu(r,!1,n),Hu(r,!0,n))});var i=n.nodeType===9?n:n.ownerDocument;i===null||i[ms]||(i[ms]=!0,Hu("selectionchange",!1,i))}}function Jm(n,i,r,l){switch(yp(i)){case 2:var m=oT;break;case 8:m=rT;break;default:m=tc}r=m.bind(null,i,r,n),m=void 0,!ul||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(m=!0),l?m!==void 0?n.addEventListener(i,r,{capture:!0,passive:m}):n.addEventListener(i,r,!0):m!==void 0?n.addEventListener(i,r,{passive:m}):n.addEventListener(i,r,!1)}function qu(n,i,r,l,m){var y=l;if((i&1)===0&&(i&2)===0&&l!==null)e:for(;;){if(l===null)return;var x=l.tag;if(x===3||x===4){var N=l.stateNode.containerInfo;if(N===m)break;if(x===4)for(x=l.return;x!==null;){var k=x.tag;if((k===3||k===4)&&x.stateNode.containerInfo===m)return;x=x.return}for(;N!==null;){if(x=Zt(N),x===null)return;if(k=x.tag,k===5||k===6||k===26||k===27){l=y=x;continue e}N=N.parentNode}}l=l.return}Wc(function(){var H=y,ee=sl(r),oe=[];e:{var q=Ad.get(n);if(q!==void 0){var B=Ar,$e=n;switch(n){case"keypress":if(_r(r)===0)break e;case"keydown":case"keyup":B=Ny;break;case"focusin":$e="focus",B=ml;break;case"focusout":$e="blur",B=ml;break;case"beforeblur":case"afterblur":B=ml;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":B=nd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":B=py;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":B=Iy;break;case Sd:case bd:case _d:B=yy;break;case Nd:B=My;break;case"scroll":case"scrollend":B=fy;break;case"wheel":B=ky;break;case"copy":case"cut":case"paste":B=Ty;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":B=ad;break;case"toggle":case"beforetoggle":B=Py}var Re=(i&4)!==0,Et=!Re&&(n==="scroll"||n==="scrollend"),O=Re?q!==null?q+"Capture":null:q;Re=[];for(var D=H,G;D!==null;){var ne=D;if(G=ne.stateNode,ne=ne.tag,ne!==5&&ne!==26&&ne!==27||G===null||O===null||(ne=mo(D,O),ne!=null&&Re.push(Zo(D,ne,G))),Et)break;D=D.return}0<Re.length&&(q=new B(q,$e,null,r,ee),oe.push({event:q,listeners:Re}))}}if((i&7)===0){e:{if(q=n==="mouseover"||n==="pointerover",B=n==="mouseout"||n==="pointerout",q&&r!==rl&&($e=r.relatedTarget||r.fromElement)&&(Zt($e)||$e[Tn]))break e;if((B||q)&&(q=ee.window===ee?ee:(q=ee.ownerDocument)?q.defaultView||q.parentWindow:window,B?($e=r.relatedTarget||r.toElement,B=H,$e=$e?Zt($e):null,$e!==null&&(Et=u($e),Re=$e.tag,$e!==Et||Re!==5&&Re!==27&&Re!==6)&&($e=null)):(B=null,$e=H),B!==$e)){if(Re=nd,ne="onMouseLeave",O="onMouseEnter",D="mouse",(n==="pointerout"||n==="pointerover")&&(Re=ad,ne="onPointerLeave",O="onPointerEnter",D="pointer"),Et=B==null?q:$t(B),G=$e==null?q:$t($e),q=new Re(ne,D+"leave",B,r,ee),q.target=Et,q.relatedTarget=G,ne=null,Zt(ee)===H&&(Re=new Re(O,D+"enter",$e,r,ee),Re.target=G,Re.relatedTarget=Et,ne=Re),Et=ne,B&&$e)t:{for(Re=B,O=$e,D=0,G=Re;G;G=Xa(G))D++;for(G=0,ne=O;ne;ne=Xa(ne))G++;for(;0<D-G;)Re=Xa(Re),D--;for(;0<G-D;)O=Xa(O),G--;for(;D--;){if(Re===O||O!==null&&Re===O.alternate)break t;Re=Xa(Re),O=Xa(O)}Re=null}else Re=null;B!==null&&Km(oe,q,B,Re,!1),$e!==null&&Et!==null&&Km(oe,Et,$e,Re,!0)}}e:{if(q=H?$t(H):window,B=q.nodeName&&q.nodeName.toLowerCase(),B==="select"||B==="input"&&q.type==="file")var Ce=fd;else if(cd(q))if(md)Ce=By;else{Ce=Fy;var Je=qy}else B=q.nodeName,!B||B.toLowerCase()!=="input"||q.type!=="checkbox"&&q.type!=="radio"?H&&ol(H.elementType)&&(Ce=fd):Ce=Yy;if(Ce&&(Ce=Ce(n,H))){dd(oe,Ce,r,ee);break e}Je&&Je(n,q,H),n==="focusout"&&H&&q.type==="number"&&H.memoizedProps.value!=null&&al(q,"number",q.value)}switch(Je=H?$t(H):window,n){case"focusin":(cd(Je)||Je.contentEditable==="true")&&(Na=Je,Tl=H,Eo=null);break;case"focusout":Eo=Tl=Na=null;break;case"mousedown":Cl=!0;break;case"contextmenu":case"mouseup":case"dragend":Cl=!1,Ed(oe,r,ee);break;case"selectionchange":if(Jy)break;case"keydown":case"keyup":Ed(oe,r,ee)}var _e;if(gl)e:{switch(n){case"compositionstart":var ke="onCompositionStart";break e;case"compositionend":ke="onCompositionEnd";break e;case"compositionupdate":ke="onCompositionUpdate";break e}ke=void 0}else _a?ld(n,r)&&(ke="onCompositionEnd"):n==="keydown"&&r.keyCode===229&&(ke="onCompositionStart");ke&&(od&&r.locale!=="ko"&&(_a||ke!=="onCompositionStart"?ke==="onCompositionEnd"&&_a&&(_e=ed()):(vi=ee,cl="value"in vi?vi.value:vi.textContent,_a=!0)),Je=ps(H,ke),0<Je.length&&(ke=new id(ke,n,null,r,ee),oe.push({event:ke,listeners:Je}),_e?ke.data=_e:(_e=ud(r),_e!==null&&(ke.data=_e)))),(_e=Uy?Oy(n,r):Gy(n,r))&&(ke=ps(H,"onBeforeInput"),0<ke.length&&(Je=new id("onBeforeInput","beforeinput",null,r,ee),oe.push({event:Je,listeners:ke}),Je.data=_e)),Iv(oe,n,H,r,ee)}zm(oe,i)})}function Zo(n,i,r){return{instance:n,listener:i,currentTarget:r}}function ps(n,i){for(var r=i+"Capture",l=[];n!==null;){var m=n,y=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||y===null||(m=mo(n,r),m!=null&&l.unshift(Zo(n,m,y)),m=mo(n,i),m!=null&&l.push(Zo(n,m,y))),n.tag===3)return l;n=n.return}return[]}function Xa(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function Km(n,i,r,l,m){for(var y=i._reactName,x=[];r!==null&&r!==l;){var N=r,k=N.alternate,H=N.stateNode;if(N=N.tag,k!==null&&k===l)break;N!==5&&N!==26&&N!==27||H===null||(k=H,m?(H=mo(r,y),H!=null&&x.unshift(Zo(r,H,k))):m||(H=mo(r,y),H!=null&&x.push(Zo(r,H,k)))),r=r.return}x.length!==0&&n.push({event:i,listeners:x})}var kv=/\r\n?/g,$v=/\u0000|\uFFFD/g;function Zm(n){return(typeof n=="string"?n:""+n).replace(kv,`
`).replace($v,"")}function Xm(n,i){return i=Zm(i),Zm(n)===i}function gs(){}function Ct(n,i,r,l,m,y){switch(r){case"children":typeof l=="string"?i==="body"||i==="textarea"&&l===""||xa(n,l):(typeof l=="number"||typeof l=="bigint")&&i!=="body"&&xa(n,""+l);break;case"className":Cr(n,"class",l);break;case"tabIndex":Cr(n,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":Cr(n,r,l);break;case"style":jc(n,l,y);break;case"data":if(i!=="object"){Cr(n,"data",l);break}case"src":case"href":if(l===""&&(i!=="a"||r!=="href")){n.removeAttribute(r);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){n.removeAttribute(r);break}l=Sr(""+l),n.setAttribute(r,l);break;case"action":case"formAction":if(typeof l=="function"){n.setAttribute(r,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(r==="formAction"?(i!=="input"&&Ct(n,i,"name",m.name,m,null),Ct(n,i,"formEncType",m.formEncType,m,null),Ct(n,i,"formMethod",m.formMethod,m,null),Ct(n,i,"formTarget",m.formTarget,m,null)):(Ct(n,i,"encType",m.encType,m,null),Ct(n,i,"method",m.method,m,null),Ct(n,i,"target",m.target,m,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){n.removeAttribute(r);break}l=Sr(""+l),n.setAttribute(r,l);break;case"onClick":l!=null&&(n.onclick=gs);break;case"onScroll":l!=null&&je("scroll",n);break;case"onScrollEnd":l!=null&&je("scrollend",n);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(o(61));if(r=l.__html,r!=null){if(m.children!=null)throw Error(o(60));n.innerHTML=r}}break;case"multiple":n.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":n.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){n.removeAttribute("xlink:href");break}r=Sr(""+l),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?n.setAttribute(r,""+l):n.removeAttribute(r);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?n.setAttribute(r,""):n.removeAttribute(r);break;case"capture":case"download":l===!0?n.setAttribute(r,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?n.setAttribute(r,l):n.removeAttribute(r);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?n.setAttribute(r,l):n.removeAttribute(r);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?n.removeAttribute(r):n.setAttribute(r,l);break;case"popover":je("beforetoggle",n),je("toggle",n),Tr(n,"popover",l);break;case"xlinkActuate":ti(n,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":ti(n,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":ti(n,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":ti(n,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":ti(n,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":ti(n,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":ti(n,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":ti(n,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":ti(n,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":Tr(n,"is",l);break;case"innerText":case"textContent":break;default:(!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(r=cy.get(r)||r,Tr(n,r,l))}}function Fu(n,i,r,l,m,y){switch(r){case"style":jc(n,l,y);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(o(61));if(r=l.__html,r!=null){if(m.children!=null)throw Error(o(60));n.innerHTML=r}}break;case"children":typeof l=="string"?xa(n,l):(typeof l=="number"||typeof l=="bigint")&&xa(n,""+l);break;case"onScroll":l!=null&&je("scroll",n);break;case"onScrollEnd":l!=null&&je("scrollend",n);break;case"onClick":l!=null&&(n.onclick=gs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Nt.hasOwnProperty(r))e:{if(r[0]==="o"&&r[1]==="n"&&(m=r.endsWith("Capture"),i=r.slice(2,m?r.length-7:void 0),y=n[ct]||null,y=y!=null?y[r]:null,typeof y=="function"&&n.removeEventListener(i,y,m),typeof l=="function")){typeof y!="function"&&y!==null&&(r in n?n[r]=null:n.hasAttribute(r)&&n.removeAttribute(r)),n.addEventListener(i,l,m);break e}r in n?n[r]=l:l===!0?n.setAttribute(r,""):Tr(n,r,l)}}}function an(n,i,r){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":je("error",n),je("load",n);var l=!1,m=!1,y;for(y in r)if(r.hasOwnProperty(y)){var x=r[y];if(x!=null)switch(y){case"src":l=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,i));default:Ct(n,i,y,x,r,null)}}m&&Ct(n,i,"srcSet",r.srcSet,r,null),l&&Ct(n,i,"src",r.src,r,null);return;case"input":je("invalid",n);var N=y=x=m=null,k=null,H=null;for(l in r)if(r.hasOwnProperty(l)){var ee=r[l];if(ee!=null)switch(l){case"name":m=ee;break;case"type":x=ee;break;case"checked":k=ee;break;case"defaultChecked":H=ee;break;case"value":y=ee;break;case"defaultValue":N=ee;break;case"children":case"dangerouslySetInnerHTML":if(ee!=null)throw Error(o(137,i));break;default:Ct(n,i,l,ee,r,null)}}Jc(n,y,N,k,H,x,m,!1),Er(n);return;case"select":je("invalid",n),l=x=y=null;for(m in r)if(r.hasOwnProperty(m)&&(N=r[m],N!=null))switch(m){case"value":y=N;break;case"defaultValue":x=N;break;case"multiple":l=N;default:Ct(n,i,m,N,r,null)}i=y,r=x,n.multiple=!!l,i!=null?Ea(n,!!l,i,!1):r!=null&&Ea(n,!!l,r,!0);return;case"textarea":je("invalid",n),y=m=l=null;for(x in r)if(r.hasOwnProperty(x)&&(N=r[x],N!=null))switch(x){case"value":l=N;break;case"defaultValue":m=N;break;case"children":y=N;break;case"dangerouslySetInnerHTML":if(N!=null)throw Error(o(91));break;default:Ct(n,i,x,N,r,null)}Zc(n,l,m,y),Er(n);return;case"option":for(k in r)if(r.hasOwnProperty(k)&&(l=r[k],l!=null))switch(k){case"selected":n.selected=l&&typeof l!="function"&&typeof l!="symbol";break;default:Ct(n,i,k,l,r,null)}return;case"dialog":je("beforetoggle",n),je("toggle",n),je("cancel",n),je("close",n);break;case"iframe":case"object":je("load",n);break;case"video":case"audio":for(l=0;l<Ko.length;l++)je(Ko[l],n);break;case"image":je("error",n),je("load",n);break;case"details":je("toggle",n);break;case"embed":case"source":case"link":je("error",n),je("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(H in r)if(r.hasOwnProperty(H)&&(l=r[H],l!=null))switch(H){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,i));default:Ct(n,i,H,l,r,null)}return;default:if(ol(i)){for(ee in r)r.hasOwnProperty(ee)&&(l=r[ee],l!==void 0&&Fu(n,i,ee,l,r,void 0));return}}for(N in r)r.hasOwnProperty(N)&&(l=r[N],l!=null&&Ct(n,i,N,l,r,null))}function Pv(n,i,r,l){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,y=null,x=null,N=null,k=null,H=null,ee=null;for(B in r){var oe=r[B];if(r.hasOwnProperty(B)&&oe!=null)switch(B){case"checked":break;case"value":break;case"defaultValue":k=oe;default:l.hasOwnProperty(B)||Ct(n,i,B,null,l,oe)}}for(var q in l){var B=l[q];if(oe=r[q],l.hasOwnProperty(q)&&(B!=null||oe!=null))switch(q){case"type":y=B;break;case"name":m=B;break;case"checked":H=B;break;case"defaultChecked":ee=B;break;case"value":x=B;break;case"defaultValue":N=B;break;case"children":case"dangerouslySetInnerHTML":if(B!=null)throw Error(o(137,i));break;default:B!==oe&&Ct(n,i,q,B,l,oe)}}il(n,x,N,k,H,ee,y,m);return;case"select":B=x=N=q=null;for(y in r)if(k=r[y],r.hasOwnProperty(y)&&k!=null)switch(y){case"value":break;case"multiple":B=k;default:l.hasOwnProperty(y)||Ct(n,i,y,null,l,k)}for(m in l)if(y=l[m],k=r[m],l.hasOwnProperty(m)&&(y!=null||k!=null))switch(m){case"value":q=y;break;case"defaultValue":N=y;break;case"multiple":x=y;default:y!==k&&Ct(n,i,m,y,l,k)}i=N,r=x,l=B,q!=null?Ea(n,!!r,q,!1):!!l!=!!r&&(i!=null?Ea(n,!!r,i,!0):Ea(n,!!r,r?[]:"",!1));return;case"textarea":B=q=null;for(N in r)if(m=r[N],r.hasOwnProperty(N)&&m!=null&&!l.hasOwnProperty(N))switch(N){case"value":break;case"children":break;default:Ct(n,i,N,null,l,m)}for(x in l)if(m=l[x],y=r[x],l.hasOwnProperty(x)&&(m!=null||y!=null))switch(x){case"value":q=m;break;case"defaultValue":B=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(o(91));break;default:m!==y&&Ct(n,i,x,m,l,y)}Kc(n,q,B);return;case"option":for(var $e in r)if(q=r[$e],r.hasOwnProperty($e)&&q!=null&&!l.hasOwnProperty($e))switch($e){case"selected":n.selected=!1;break;default:Ct(n,i,$e,null,l,q)}for(k in l)if(q=l[k],B=r[k],l.hasOwnProperty(k)&&q!==B&&(q!=null||B!=null))switch(k){case"selected":n.selected=q&&typeof q!="function"&&typeof q!="symbol";break;default:Ct(n,i,k,q,l,B)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Re in r)q=r[Re],r.hasOwnProperty(Re)&&q!=null&&!l.hasOwnProperty(Re)&&Ct(n,i,Re,null,l,q);for(H in l)if(q=l[H],B=r[H],l.hasOwnProperty(H)&&q!==B&&(q!=null||B!=null))switch(H){case"children":case"dangerouslySetInnerHTML":if(q!=null)throw Error(o(137,i));break;default:Ct(n,i,H,q,l,B)}return;default:if(ol(i)){for(var Et in r)q=r[Et],r.hasOwnProperty(Et)&&q!==void 0&&!l.hasOwnProperty(Et)&&Fu(n,i,Et,void 0,l,q);for(ee in l)q=l[ee],B=r[ee],!l.hasOwnProperty(ee)||q===B||q===void 0&&B===void 0||Fu(n,i,ee,q,l,B);return}}for(var O in r)q=r[O],r.hasOwnProperty(O)&&q!=null&&!l.hasOwnProperty(O)&&Ct(n,i,O,null,l,q);for(oe in l)q=l[oe],B=r[oe],!l.hasOwnProperty(oe)||q===B||q==null&&B==null||Ct(n,i,oe,q,l,B)}var Yu=null,Bu=null;function hs(n){return n.nodeType===9?n:n.ownerDocument}function jm(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Qm(n,i){if(n===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&i==="foreignObject"?0:n}function zu(n,i){return n==="textarea"||n==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Ju=null;function Dv(){var n=window.event;return n&&n.type==="popstate"?n===Ju?!1:(Ju=n,!0):(Ju=null,!1)}var Wm=typeof setTimeout=="function"?setTimeout:void 0,Uv=typeof clearTimeout=="function"?clearTimeout:void 0,ep=typeof Promise=="function"?Promise:void 0,Ov=typeof queueMicrotask=="function"?queueMicrotask:typeof ep<"u"?function(n){return ep.resolve(null).then(n).catch(Gv)}:Wm;function Gv(n){setTimeout(function(){throw n})}function $i(n){return n==="head"}function tp(n,i){var r=i,l=0,m=0;do{var y=r.nextSibling;if(n.removeChild(r),y&&y.nodeType===8)if(r=y.data,r==="/$"){if(0<l&&8>l){r=l;var x=n.ownerDocument;if(r&1&&Xo(x.documentElement),r&2&&Xo(x.body),r&4)for(r=x.head,Xo(r),x=r.firstChild;x;){var N=x.nextSibling,k=x.nodeName;x[Xi]||k==="SCRIPT"||k==="STYLE"||k==="LINK"&&x.rel.toLowerCase()==="stylesheet"||r.removeChild(x),x=N}}if(m===0){n.removeChild(y),ar(i);return}m--}else r==="$"||r==="$?"||r==="$!"?m++:l=r.charCodeAt(0)-48;else l=0;r=y}while(r);ar(i)}function Ku(n){var i=n.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var r=i;switch(i=i.nextSibling,r.nodeName){case"HTML":case"HEAD":case"BODY":Ku(r),it(r);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(r.rel.toLowerCase()==="stylesheet")continue}n.removeChild(r)}}function Hv(n,i,r,l){for(;n.nodeType===1;){var m=r;if(n.nodeName.toLowerCase()!==i.toLowerCase()){if(!l&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(l){if(!n[Xi])switch(i){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(y=n.getAttribute("rel"),y==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(y!==m.rel||n.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||n.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||n.getAttribute("title")!==(m.title==null?null:m.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(y=n.getAttribute("src"),(y!==(m.src==null?null:m.src)||n.getAttribute("type")!==(m.type==null?null:m.type)||n.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&y&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(i==="input"&&n.type==="hidden"){var y=m.name==null?null:""+m.name;if(m.type==="hidden"&&n.getAttribute("name")===y)return n}else return n;if(n=qn(n.nextSibling),n===null)break}return null}function Vv(n,i,r){if(i==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!r||(n=qn(n.nextSibling),n===null))return null;return n}function Zu(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState==="complete"}function qv(n,i){var r=n.ownerDocument;if(n.data!=="$?"||r.readyState==="complete")i();else{var l=function(){i(),r.removeEventListener("DOMContentLoaded",l)};r.addEventListener("DOMContentLoaded",l),n._reactRetry=l}}function qn(n){for(;n!=null;n=n.nextSibling){var i=n.nodeType;if(i===1||i===3)break;if(i===8){if(i=n.data,i==="$"||i==="$!"||i==="$?"||i==="F!"||i==="F")break;if(i==="/$")return null}}return n}var Xu=null;function np(n){n=n.previousSibling;for(var i=0;n;){if(n.nodeType===8){var r=n.data;if(r==="$"||r==="$!"||r==="$?"){if(i===0)return n;i--}else r==="/$"&&i++}n=n.previousSibling}return null}function ip(n,i,r){switch(i=hs(r),n){case"html":if(n=i.documentElement,!n)throw Error(o(452));return n;case"head":if(n=i.head,!n)throw Error(o(453));return n;case"body":if(n=i.body,!n)throw Error(o(454));return n;default:throw Error(o(451))}}function Xo(n){for(var i=n.attributes;i.length;)n.removeAttributeNode(i[0]);it(n)}var Un=new Map,ap=new Set;function ys(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var gi=X.d;X.d={f:Fv,r:Yv,D:Bv,C:zv,L:Jv,m:Kv,X:Xv,S:Zv,M:jv};function Fv(){var n=gi.f(),i=ls();return n||i}function Yv(n){var i=_t(n);i!==null&&i.tag===5&&i.type==="form"?bf(i):gi.r(n)}var ja=typeof document>"u"?null:document;function op(n,i,r){var l=ja;if(l&&typeof i=="string"&&i){var m=Rn(i);m='link[rel="'+n+'"][href="'+m+'"]',typeof r=="string"&&(m+='[crossorigin="'+r+'"]'),ap.has(m)||(ap.add(m),n={rel:n,crossOrigin:r,href:i},l.querySelector(m)===null&&(i=l.createElement("link"),an(i,"link",n),Qe(i),l.head.appendChild(i)))}}function Bv(n){gi.D(n),op("dns-prefetch",n,null)}function zv(n,i){gi.C(n,i),op("preconnect",n,i)}function Jv(n,i,r){gi.L(n,i,r);var l=ja;if(l&&n&&i){var m='link[rel="preload"][as="'+Rn(i)+'"]';i==="image"&&r&&r.imageSrcSet?(m+='[imagesrcset="'+Rn(r.imageSrcSet)+'"]',typeof r.imageSizes=="string"&&(m+='[imagesizes="'+Rn(r.imageSizes)+'"]')):m+='[href="'+Rn(n)+'"]';var y=m;switch(i){case"style":y=Qa(n);break;case"script":y=Wa(n)}Un.has(y)||(n=v({rel:"preload",href:i==="image"&&r&&r.imageSrcSet?void 0:n,as:i},r),Un.set(y,n),l.querySelector(m)!==null||i==="style"&&l.querySelector(jo(y))||i==="script"&&l.querySelector(Qo(y))||(i=l.createElement("link"),an(i,"link",n),Qe(i),l.head.appendChild(i)))}}function Kv(n,i){gi.m(n,i);var r=ja;if(r&&n){var l=i&&typeof i.as=="string"?i.as:"script",m='link[rel="modulepreload"][as="'+Rn(l)+'"][href="'+Rn(n)+'"]',y=m;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=Wa(n)}if(!Un.has(y)&&(n=v({rel:"modulepreload",href:n},i),Un.set(y,n),r.querySelector(m)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(r.querySelector(Qo(y)))return}l=r.createElement("link"),an(l,"link",n),Qe(l),r.head.appendChild(l)}}}function Zv(n,i,r){gi.S(n,i,r);var l=ja;if(l&&n){var m=vt(l).hoistableStyles,y=Qa(n);i=i||"default";var x=m.get(y);if(!x){var N={loading:0,preload:null};if(x=l.querySelector(jo(y)))N.loading=5;else{n=v({rel:"stylesheet",href:n,"data-precedence":i},r),(r=Un.get(y))&&ju(n,r);var k=x=l.createElement("link");Qe(k),an(k,"link",n),k._p=new Promise(function(H,ee){k.onload=H,k.onerror=ee}),k.addEventListener("load",function(){N.loading|=1}),k.addEventListener("error",function(){N.loading|=2}),N.loading|=4,vs(x,i,l)}x={type:"stylesheet",instance:x,count:1,state:N},m.set(y,x)}}}function Xv(n,i){gi.X(n,i);var r=ja;if(r&&n){var l=vt(r).hoistableScripts,m=Wa(n),y=l.get(m);y||(y=r.querySelector(Qo(m)),y||(n=v({src:n,async:!0},i),(i=Un.get(m))&&Qu(n,i),y=r.createElement("script"),Qe(y),an(y,"link",n),r.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},l.set(m,y))}}function jv(n,i){gi.M(n,i);var r=ja;if(r&&n){var l=vt(r).hoistableScripts,m=Wa(n),y=l.get(m);y||(y=r.querySelector(Qo(m)),y||(n=v({src:n,async:!0,type:"module"},i),(i=Un.get(m))&&Qu(n,i),y=r.createElement("script"),Qe(y),an(y,"link",n),r.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},l.set(m,y))}}function rp(n,i,r,l){var m=(m=de.current)?ys(m):null;if(!m)throw Error(o(446));switch(n){case"meta":case"title":return null;case"style":return typeof r.precedence=="string"&&typeof r.href=="string"?(i=Qa(r.href),r=vt(m).hoistableStyles,l=r.get(i),l||(l={type:"style",instance:null,count:0,state:null},r.set(i,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(r.rel==="stylesheet"&&typeof r.href=="string"&&typeof r.precedence=="string"){n=Qa(r.href);var y=vt(m).hoistableStyles,x=y.get(n);if(x||(m=m.ownerDocument||m,x={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(n,x),(y=m.querySelector(jo(n)))&&!y._p&&(x.instance=y,x.state.loading=5),Un.has(n)||(r={rel:"preload",as:"style",href:r.href,crossOrigin:r.crossOrigin,integrity:r.integrity,media:r.media,hrefLang:r.hrefLang,referrerPolicy:r.referrerPolicy},Un.set(n,r),y||Qv(m,n,r,x.state))),i&&l===null)throw Error(o(528,""));return x}if(i&&l!==null)throw Error(o(529,""));return null;case"script":return i=r.async,r=r.src,typeof r=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=Wa(r),r=vt(m).hoistableScripts,l=r.get(i),l||(l={type:"script",instance:null,count:0,state:null},r.set(i,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,n))}}function Qa(n){return'href="'+Rn(n)+'"'}function jo(n){return'link[rel="stylesheet"]['+n+"]"}function sp(n){return v({},n,{"data-precedence":n.precedence,precedence:null})}function Qv(n,i,r,l){n.querySelector('link[rel="preload"][as="style"]['+i+"]")?l.loading=1:(i=n.createElement("link"),l.preload=i,i.addEventListener("load",function(){return l.loading|=1}),i.addEventListener("error",function(){return l.loading|=2}),an(i,"link",r),Qe(i),n.head.appendChild(i))}function Wa(n){return'[src="'+Rn(n)+'"]'}function Qo(n){return"script[async]"+n}function lp(n,i,r){if(i.count++,i.instance===null)switch(i.type){case"style":var l=n.querySelector('style[data-href~="'+Rn(r.href)+'"]');if(l)return i.instance=l,Qe(l),l;var m=v({},r,{"data-href":r.href,"data-precedence":r.precedence,href:null,precedence:null});return l=(n.ownerDocument||n).createElement("style"),Qe(l),an(l,"style",m),vs(l,r.precedence,n),i.instance=l;case"stylesheet":m=Qa(r.href);var y=n.querySelector(jo(m));if(y)return i.state.loading|=4,i.instance=y,Qe(y),y;l=sp(r),(m=Un.get(m))&&ju(l,m),y=(n.ownerDocument||n).createElement("link"),Qe(y);var x=y;return x._p=new Promise(function(N,k){x.onload=N,x.onerror=k}),an(y,"link",l),i.state.loading|=4,vs(y,r.precedence,n),i.instance=y;case"script":return y=Wa(r.src),(m=n.querySelector(Qo(y)))?(i.instance=m,Qe(m),m):(l=r,(m=Un.get(y))&&(l=v({},r),Qu(l,m)),n=n.ownerDocument||n,m=n.createElement("script"),Qe(m),an(m,"link",l),n.head.appendChild(m),i.instance=m);case"void":return null;default:throw Error(o(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(l=i.instance,i.state.loading|=4,vs(l,r.precedence,n));return i.instance}function vs(n,i,r){for(var l=r.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=l.length?l[l.length-1]:null,y=m,x=0;x<l.length;x++){var N=l[x];if(N.dataset.precedence===i)y=N;else if(y!==m)break}y?y.parentNode.insertBefore(n,y.nextSibling):(i=r.nodeType===9?r.head:r,i.insertBefore(n,i.firstChild))}function ju(n,i){n.crossOrigin==null&&(n.crossOrigin=i.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=i.referrerPolicy),n.title==null&&(n.title=i.title)}function Qu(n,i){n.crossOrigin==null&&(n.crossOrigin=i.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=i.referrerPolicy),n.integrity==null&&(n.integrity=i.integrity)}var Ts=null;function up(n,i,r){if(Ts===null){var l=new Map,m=Ts=new Map;m.set(r,l)}else m=Ts,l=m.get(r),l||(l=new Map,m.set(r,l));if(l.has(n))return l;for(l.set(n,null),r=r.getElementsByTagName(n),m=0;m<r.length;m++){var y=r[m];if(!(y[Xi]||y[rt]||n==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var x=y.getAttribute(i)||"";x=n+x;var N=l.get(x);N?N.push(y):l.set(x,[y])}}return l}function cp(n,i,r){n=n.ownerDocument||n,n.head.insertBefore(r,i==="title"?n.querySelector("head > title"):null)}function Wv(n,i,r){if(r===1||i.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;switch(i.rel){case"stylesheet":return n=i.disabled,typeof i.precedence=="string"&&n==null;default:return!0}case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function dp(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}var Wo=null;function eT(){}function tT(n,i,r){if(Wo===null)throw Error(o(475));var l=Wo;if(i.type==="stylesheet"&&(typeof r.media!="string"||matchMedia(r.media).matches!==!1)&&(i.state.loading&4)===0){if(i.instance===null){var m=Qa(r.href),y=n.querySelector(jo(m));if(y){n=y._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(l.count++,l=Cs.bind(l),n.then(l,l)),i.state.loading|=4,i.instance=y,Qe(y);return}y=n.ownerDocument||n,r=sp(r),(m=Un.get(m))&&ju(r,m),y=y.createElement("link"),Qe(y);var x=y;x._p=new Promise(function(N,k){x.onload=N,x.onerror=k}),an(y,"link",r),i.instance=y}l.stylesheets===null&&(l.stylesheets=new Map),l.stylesheets.set(i,n),(n=i.state.preload)&&(i.state.loading&3)===0&&(l.count++,i=Cs.bind(l),n.addEventListener("load",i),n.addEventListener("error",i))}}function nT(){if(Wo===null)throw Error(o(475));var n=Wo;return n.stylesheets&&n.count===0&&Wu(n,n.stylesheets),0<n.count?function(i){var r=setTimeout(function(){if(n.stylesheets&&Wu(n,n.stylesheets),n.unsuspend){var l=n.unsuspend;n.unsuspend=null,l()}},6e4);return n.unsuspend=i,function(){n.unsuspend=null,clearTimeout(r)}}:null}function Cs(){if(this.count--,this.count===0){if(this.stylesheets)Wu(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var Es=null;function Wu(n,i){n.stylesheets=null,n.unsuspend!==null&&(n.count++,Es=new Map,i.forEach(iT,n),Es=null,Cs.call(n))}function iT(n,i){if(!(i.state.loading&4)){var r=Es.get(n);if(r)var l=r.get(null);else{r=new Map,Es.set(n,r);for(var m=n.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<m.length;y++){var x=m[y];(x.nodeName==="LINK"||x.getAttribute("media")!=="not all")&&(r.set(x.dataset.precedence,x),l=x)}l&&r.set(null,l)}m=i.instance,x=m.getAttribute("data-precedence"),y=r.get(x)||l,y===l&&r.set(null,m),r.set(x,m),this.count++,l=Cs.bind(this),m.addEventListener("load",l),m.addEventListener("error",l),y?y.parentNode.insertBefore(m,y.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(m,n.firstChild)),i.state.loading|=4}}var er={$$typeof:L,Provider:null,Consumer:null,_currentValue:J,_currentValue2:J,_threadCount:0};function aT(n,i,r,l,m,y,x,N){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ft(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ft(0),this.hiddenUpdates=ft(null),this.identifierPrefix=l,this.onUncaughtError=m,this.onCaughtError=y,this.onRecoverableError=x,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=N,this.incompleteTransitions=new Map}function fp(n,i,r,l,m,y,x,N,k,H,ee,oe){return n=new aT(n,i,r,x,N,k,H,oe),i=1,y===!0&&(i|=24),y=xn(3,null,null,i),n.current=y,y.stateNode=n,i=$l(),i.refCount++,n.pooledCache=i,i.refCount++,y.memoizedState={element:l,isDehydrated:r,cache:i},Ol(y),n}function mp(n){return n?(n=Ra,n):Ra}function pp(n,i,r,l,m,y){m=mp(m),l.context===null?l.context=m:l.pendingContext=m,l=Ei(i),l.payload={element:r},y=y===void 0?null:y,y!==null&&(l.callback=y),r=xi(n,l,i),r!==null&&(An(r,n,i),Ro(r,n,i))}function gp(n,i){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var r=n.retryLane;n.retryLane=r!==0&&r<i?r:i}}function ec(n,i){gp(n,i),(n=n.alternate)&&gp(n,i)}function hp(n){if(n.tag===13){var i=Ia(n,67108864);i!==null&&An(i,n,67108864),ec(n,67108864)}}var xs=!0;function oT(n,i,r,l){var m=U.T;U.T=null;var y=X.p;try{X.p=2,tc(n,i,r,l)}finally{X.p=y,U.T=m}}function rT(n,i,r,l){var m=U.T;U.T=null;var y=X.p;try{X.p=8,tc(n,i,r,l)}finally{X.p=y,U.T=m}}function tc(n,i,r,l){if(xs){var m=nc(l);if(m===null)qu(n,i,l,Ss,r),vp(n,l);else if(lT(m,n,i,r,l))l.stopPropagation();else if(vp(n,l),i&4&&-1<sT.indexOf(n)){for(;m!==null;){var y=_t(m);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var x=Be(y.pendingLanes);if(x!==0){var N=y;for(N.pendingLanes|=2,N.entangledLanes|=2;x;){var k=1<<31-on(x);N.entanglements[1]|=k,x&=~k}Zn(y),(mt&6)===0&&(rs=Ze()+500,Jo(0))}}break;case 13:N=Ia(y,2),N!==null&&An(N,y,2),ls(),ec(y,2)}if(y=nc(l),y===null&&qu(n,i,l,Ss,r),y===m)break;m=y}m!==null&&l.stopPropagation()}else qu(n,i,l,null,r)}}function nc(n){return n=sl(n),ic(n)}var Ss=null;function ic(n){if(Ss=null,n=Zt(n),n!==null){var i=u(n);if(i===null)n=null;else{var r=i.tag;if(r===13){if(n=f(i),n!==null)return n;n=null}else if(r===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null)}}return Ss=n,null}function yp(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Wt()){case kt:return 2;case xt:return 8;case St:case en:return 32;case Wn:return 268435456;default:return 32}default:return 32}}var ac=!1,Pi=null,Di=null,Ui=null,tr=new Map,nr=new Map,Oi=[],sT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function vp(n,i){switch(n){case"focusin":case"focusout":Pi=null;break;case"dragenter":case"dragleave":Di=null;break;case"mouseover":case"mouseout":Ui=null;break;case"pointerover":case"pointerout":tr.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":nr.delete(i.pointerId)}}function ir(n,i,r,l,m,y){return n===null||n.nativeEvent!==y?(n={blockedOn:i,domEventName:r,eventSystemFlags:l,nativeEvent:y,targetContainers:[m]},i!==null&&(i=_t(i),i!==null&&hp(i)),n):(n.eventSystemFlags|=l,i=n.targetContainers,m!==null&&i.indexOf(m)===-1&&i.push(m),n)}function lT(n,i,r,l,m){switch(i){case"focusin":return Pi=ir(Pi,n,i,r,l,m),!0;case"dragenter":return Di=ir(Di,n,i,r,l,m),!0;case"mouseover":return Ui=ir(Ui,n,i,r,l,m),!0;case"pointerover":var y=m.pointerId;return tr.set(y,ir(tr.get(y)||null,n,i,r,l,m)),!0;case"gotpointercapture":return y=m.pointerId,nr.set(y,ir(nr.get(y)||null,n,i,r,l,m)),!0}return!1}function Tp(n){var i=Zt(n.target);if(i!==null){var r=u(i);if(r!==null){if(i=r.tag,i===13){if(i=f(r),i!==null){n.blockedOn=i,ut(n.priority,function(){if(r.tag===13){var l=Nn();l=tt(l);var m=Ia(r,l);m!==null&&An(m,r,l),ec(r,l)}});return}}else if(i===3&&r.stateNode.current.memoizedState.isDehydrated){n.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}n.blockedOn=null}function bs(n){if(n.blockedOn!==null)return!1;for(var i=n.targetContainers;0<i.length;){var r=nc(n.nativeEvent);if(r===null){r=n.nativeEvent;var l=new r.constructor(r.type,r);rl=l,r.target.dispatchEvent(l),rl=null}else return i=_t(r),i!==null&&hp(i),n.blockedOn=r,!1;i.shift()}return!0}function Cp(n,i,r){bs(n)&&r.delete(i)}function uT(){ac=!1,Pi!==null&&bs(Pi)&&(Pi=null),Di!==null&&bs(Di)&&(Di=null),Ui!==null&&bs(Ui)&&(Ui=null),tr.forEach(Cp),nr.forEach(Cp)}function _s(n,i){n.blockedOn===i&&(n.blockedOn=null,ac||(ac=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,uT)))}var Ns=null;function Ep(n){Ns!==n&&(Ns=n,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){Ns===n&&(Ns=null);for(var i=0;i<n.length;i+=3){var r=n[i],l=n[i+1],m=n[i+2];if(typeof l!="function"){if(ic(l||r)===null)continue;break}var y=_t(r);y!==null&&(n.splice(i,3),i-=3,iu(y,{pending:!0,data:m,method:r.method,action:l},l,m))}}))}function ar(n){function i(k){return _s(k,n)}Pi!==null&&_s(Pi,n),Di!==null&&_s(Di,n),Ui!==null&&_s(Ui,n),tr.forEach(i),nr.forEach(i);for(var r=0;r<Oi.length;r++){var l=Oi[r];l.blockedOn===n&&(l.blockedOn=null)}for(;0<Oi.length&&(r=Oi[0],r.blockedOn===null);)Tp(r),r.blockedOn===null&&Oi.shift();if(r=(n.ownerDocument||n).$$reactFormReplay,r!=null)for(l=0;l<r.length;l+=3){var m=r[l],y=r[l+1],x=m[ct]||null;if(typeof y=="function")x||Ep(r);else if(x){var N=null;if(y&&y.hasAttribute("formAction")){if(m=y,x=y[ct]||null)N=x.formAction;else if(ic(m)!==null)continue}else N=x.action;typeof N=="function"?r[l+1]=N:(r.splice(l,3),l-=3),Ep(r)}}}function oc(n){this._internalRoot=n}As.prototype.render=oc.prototype.render=function(n){var i=this._internalRoot;if(i===null)throw Error(o(409));var r=i.current,l=Nn();pp(r,l,n,i,null,null)},As.prototype.unmount=oc.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var i=n.containerInfo;pp(n.current,2,null,n,null,null),ls(),i[Tn]=null}};function As(n){this._internalRoot=n}As.prototype.unstable_scheduleHydration=function(n){if(n){var i=vn();n={blockedOn:null,target:n,priority:i};for(var r=0;r<Oi.length&&i!==0&&i<Oi[r].priority;r++);Oi.splice(r,0,n),r===0&&Tp(n)}};var xp=e.version;if(xp!=="19.1.0")throw Error(o(527,xp,"19.1.0"));X.findDOMNode=function(n){var i=n._reactInternals;if(i===void 0)throw typeof n.render=="function"?Error(o(188)):(n=Object.keys(n).join(","),Error(o(268,n)));return n=h(i),n=n!==null?p(n):null,n=n===null?null:n.stateNode,n};var cT={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:U,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ws=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ws.isDisabled&&ws.supportsFiber)try{Yn=ws.inject(cT),Jt=ws}catch{}}return rr.createRoot=function(n,i){if(!s(n))throw Error(o(299));var r=!1,l="",m=Of,y=Gf,x=Hf,N=null;return i!=null&&(i.unstable_strictMode===!0&&(r=!0),i.identifierPrefix!==void 0&&(l=i.identifierPrefix),i.onUncaughtError!==void 0&&(m=i.onUncaughtError),i.onCaughtError!==void 0&&(y=i.onCaughtError),i.onRecoverableError!==void 0&&(x=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(N=i.unstable_transitionCallbacks)),i=fp(n,1,!1,null,null,r,l,m,y,x,N,null),n[Tn]=i.current,Vu(n),new oc(i)},rr.hydrateRoot=function(n,i,r){if(!s(n))throw Error(o(299));var l=!1,m="",y=Of,x=Gf,N=Hf,k=null,H=null;return r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(m=r.identifierPrefix),r.onUncaughtError!==void 0&&(y=r.onUncaughtError),r.onCaughtError!==void 0&&(x=r.onCaughtError),r.onRecoverableError!==void 0&&(N=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(k=r.unstable_transitionCallbacks),r.formState!==void 0&&(H=r.formState)),i=fp(n,1,!0,i,r??null,l,m,y,x,N,k,H),i.context=mp(null),r=i.current,l=Nn(),l=tt(l),m=Ei(l),m.callback=null,xi(r,m,l),r=l,i.current.lanes=r,Ae(i,r),Zn(i),n[Tn]=i.current,Vu(n),new As(i)},rr.version="19.1.0",rr}var Lp;function CT(){if(Lp)return lc.exports;Lp=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),lc.exports=TT(),lc.exports}var ET=CT();const xT=Ch(ET),ST=()=>{const[a,e]=Y.useState([]),t=Y.useCallback((o,s,u)=>{e(f=>[...f,{id:crypto.randomUUID(),type:o,text:s,processedText:u,timestamp:new Date}])},[]);return{gameLog:a,addLogEntry:t,setGameLog:e}};var ot;(function(a){a.assertEqual=s=>{};function e(s){}a.assertIs=e;function t(s){throw new Error}a.assertNever=t,a.arrayToEnum=s=>{const u={};for(const f of s)u[f]=f;return u},a.getValidEnumValues=s=>{const u=a.objectKeys(s).filter(g=>typeof s[s[g]]!="number"),f={};for(const g of u)f[g]=s[g];return a.objectValues(f)},a.objectValues=s=>a.objectKeys(s).map(function(u){return s[u]}),a.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const u=[];for(const f in s)Object.prototype.hasOwnProperty.call(s,f)&&u.push(f);return u},a.find=(s,u)=>{for(const f of s)if(u(f))return f},a.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function o(s,u=" | "){return s.map(f=>typeof f=="string"?`'${f}'`:f).join(u)}a.joinValues=o,a.jsonStringifyReplacer=(s,u)=>typeof u=="bigint"?u.toString():u})(ot||(ot={}));var kp;(function(a){a.mergeShapes=(e,t)=>({...e,...t})})(kp||(kp={}));const Ee=ot.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Vi=a=>{switch(typeof a){case"undefined":return Ee.undefined;case"string":return Ee.string;case"number":return Number.isNaN(a)?Ee.nan:Ee.number;case"boolean":return Ee.boolean;case"function":return Ee.function;case"bigint":return Ee.bigint;case"symbol":return Ee.symbol;case"object":return Array.isArray(a)?Ee.array:a===null?Ee.null:a.then&&typeof a.then=="function"&&a.catch&&typeof a.catch=="function"?Ee.promise:typeof Map<"u"&&a instanceof Map?Ee.map:typeof Set<"u"&&a instanceof Set?Ee.set:typeof Date<"u"&&a instanceof Date?Ee.date:Ee.object;default:return Ee.unknown}},ge=ot.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class yi extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=o=>{this.issues=[...this.issues,o]},this.addIssues=(o=[])=>{this.issues=[...this.issues,...o]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(u){return u.message},o={_errors:[]},s=u=>{for(const f of u.issues)if(f.code==="invalid_union")f.unionErrors.map(s);else if(f.code==="invalid_return_type")s(f.returnTypeError);else if(f.code==="invalid_arguments")s(f.argumentsError);else if(f.path.length===0)o._errors.push(t(f));else{let g=o,h=0;for(;h<f.path.length;){const p=f.path[h];h===f.path.length-1?(g[p]=g[p]||{_errors:[]},g[p]._errors.push(t(f))):g[p]=g[p]||{_errors:[]},g=g[p],h++}}};return s(this),o}static assert(e){if(!(e instanceof yi))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ot.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},o=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):o.push(e(s));return{formErrors:o,fieldErrors:t}}get formErrors(){return this.flatten()}}yi.create=a=>new yi(a);const pc=(a,e)=>{let t;switch(a.code){case ge.invalid_type:a.received===Ee.undefined?t="Required":t=`Expected ${a.expected}, received ${a.received}`;break;case ge.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(a.expected,ot.jsonStringifyReplacer)}`;break;case ge.unrecognized_keys:t=`Unrecognized key(s) in object: ${ot.joinValues(a.keys,", ")}`;break;case ge.invalid_union:t="Invalid input";break;case ge.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${ot.joinValues(a.options)}`;break;case ge.invalid_enum_value:t=`Invalid enum value. Expected ${ot.joinValues(a.options)}, received '${a.received}'`;break;case ge.invalid_arguments:t="Invalid function arguments";break;case ge.invalid_return_type:t="Invalid function return type";break;case ge.invalid_date:t="Invalid date";break;case ge.invalid_string:typeof a.validation=="object"?"includes"in a.validation?(t=`Invalid input: must include "${a.validation.includes}"`,typeof a.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${a.validation.position}`)):"startsWith"in a.validation?t=`Invalid input: must start with "${a.validation.startsWith}"`:"endsWith"in a.validation?t=`Invalid input: must end with "${a.validation.endsWith}"`:ot.assertNever(a.validation):a.validation!=="regex"?t=`Invalid ${a.validation}`:t="Invalid";break;case ge.too_small:a.type==="array"?t=`Array must contain ${a.exact?"exactly":a.inclusive?"at least":"more than"} ${a.minimum} element(s)`:a.type==="string"?t=`String must contain ${a.exact?"exactly":a.inclusive?"at least":"over"} ${a.minimum} character(s)`:a.type==="number"?t=`Number must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${a.minimum}`:a.type==="date"?t=`Date must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(a.minimum))}`:t="Invalid input";break;case ge.too_big:a.type==="array"?t=`Array must contain ${a.exact?"exactly":a.inclusive?"at most":"less than"} ${a.maximum} element(s)`:a.type==="string"?t=`String must contain ${a.exact?"exactly":a.inclusive?"at most":"under"} ${a.maximum} character(s)`:a.type==="number"?t=`Number must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:a.type==="bigint"?t=`BigInt must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:a.type==="date"?t=`Date must be ${a.exact?"exactly":a.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(a.maximum))}`:t="Invalid input";break;case ge.custom:t="Invalid input";break;case ge.invalid_intersection_types:t="Intersection results could not be merged";break;case ge.not_multiple_of:t=`Number must be a multiple of ${a.multipleOf}`;break;case ge.not_finite:t="Number must be finite";break;default:t=e.defaultError,ot.assertNever(a)}return{message:t}};let bT=pc;function _T(){return bT}const NT=a=>{const{data:e,path:t,errorMaps:o,issueData:s}=a,u=[...t,...s.path||[]],f={...s,path:u};if(s.message!==void 0)return{...s,path:u,message:s.message};let g="";const h=o.filter(p=>!!p).slice().reverse();for(const p of h)g=p(f,{data:e,defaultError:g}).message;return{...s,path:u,message:g}};function ye(a,e){const t=_T(),o=NT({issueData:e,data:a.data,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,t,t===pc?void 0:pc].filter(s=>!!s)});a.common.issues.push(o)}class dn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const o=[];for(const s of t){if(s.status==="aborted")return Oe;s.status==="dirty"&&e.dirty(),o.push(s.value)}return{status:e.value,value:o}}static async mergeObjectAsync(e,t){const o=[];for(const s of t){const u=await s.key,f=await s.value;o.push({key:u,value:f})}return dn.mergeObjectSync(e,o)}static mergeObjectSync(e,t){const o={};for(const s of t){const{key:u,value:f}=s;if(u.status==="aborted"||f.status==="aborted")return Oe;u.status==="dirty"&&e.dirty(),f.status==="dirty"&&e.dirty(),u.value!=="__proto__"&&(typeof f.value<"u"||s.alwaysSet)&&(o[u.value]=f.value)}return{status:e.value,value:o}}}const Oe=Object.freeze({status:"aborted"}),lr=a=>({status:"dirty",value:a}),On=a=>({status:"valid",value:a}),$p=a=>a.status==="aborted",Pp=a=>a.status==="dirty",io=a=>a.status==="valid",Os=a=>typeof Promise<"u"&&a instanceof Promise;var xe;(function(a){a.errToObj=e=>typeof e=="string"?{message:e}:e||{},a.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(xe||(xe={}));class Qn{constructor(e,t,o,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=o,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Dp=(a,e)=>{if(io(e))return{success:!0,data:e.value};if(!a.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new yi(a.common.issues);return this._error=t,this._error}}};function Ye(a){if(!a)return{};const{errorMap:e,invalid_type_error:t,required_error:o,description:s}=a;if(e&&(t||o))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(f,g)=>{const{message:h}=a;return f.code==="invalid_enum_value"?{message:h??g.defaultError}:typeof g.data>"u"?{message:h??o??g.defaultError}:f.code!=="invalid_type"?{message:g.defaultError}:{message:h??t??g.defaultError}},description:s}}class We{get description(){return this._def.description}_getType(e){return Vi(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Vi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new dn,ctx:{common:e.parent.common,data:e.data,parsedType:Vi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Os(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const o=this.safeParse(e,t);if(o.success)return o.data;throw o.error}safeParse(e,t){const o={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Vi(e)},s=this._parseSync({data:e,path:o.path,parent:o});return Dp(o,s)}"~validate"(e){var o,s;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Vi(e)};if(!this["~standard"].async)try{const u=this._parseSync({data:e,path:[],parent:t});return io(u)?{value:u.value}:{issues:t.common.issues}}catch(u){(s=(o=u==null?void 0:u.message)==null?void 0:o.toLowerCase())!=null&&s.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(u=>io(u)?{value:u.value}:{issues:t.common.issues})}async parseAsync(e,t){const o=await this.safeParseAsync(e,t);if(o.success)return o.data;throw o.error}async safeParseAsync(e,t){const o={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Vi(e)},s=this._parse({data:e,path:o.path,parent:o}),u=await(Os(s)?s:Promise.resolve(s));return Dp(o,u)}refine(e,t){const o=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,u)=>{const f=e(s),g=()=>u.addIssue({code:ge.custom,...o(s)});return typeof Promise<"u"&&f instanceof Promise?f.then(h=>h?!0:(g(),!1)):f?!0:(g(),!1)})}refinement(e,t){return this._refinement((o,s)=>e(o)?!0:(s.addIssue(typeof t=="function"?t(o,s):t),!1))}_refinement(e){return new ro({schema:this,typeName:Ue.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return qi.create(this,this._def)}nullable(){return so.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return jn.create(this)}promise(){return Fs.create(this,this._def)}or(e){return Hs.create([this,e],this._def)}and(e){return Vs.create(this,e,this._def)}transform(e){return new ro({...Ye(this._def),schema:this,typeName:Ue.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new vc({...Ye(this._def),innerType:this,defaultValue:t,typeName:Ue.ZodDefault})}brand(){return new ZT({typeName:Ue.ZodBranded,type:this,...Ye(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Tc({...Ye(this._def),innerType:this,catchValue:t,typeName:Ue.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return $c.create(this,e)}readonly(){return Cc.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const AT=/^c[^\s-]{8,}$/i,wT=/^[0-9a-z]+$/,IT=/^[0-9A-HJKMNP-TV-Z]{26}$/i,RT=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,MT=/^[a-z0-9_-]{21}$/i,LT=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,kT=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,$T=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,PT="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let fc;const DT=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,UT=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,OT=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,GT=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,HT=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,VT=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Eh="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",qT=new RegExp(`^${Eh}$`);function xh(a){let e="[0-5]\\d";a.precision?e=`${e}\\.\\d{${a.precision}}`:a.precision==null&&(e=`${e}(\\.\\d+)?`);const t=a.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function FT(a){return new RegExp(`^${xh(a)}$`)}function YT(a){let e=`${Eh}T${xh(a)}`;const t=[];return t.push(a.local?"Z?":"Z"),a.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function BT(a,e){return!!((e==="v4"||!e)&&DT.test(a)||(e==="v6"||!e)&&OT.test(a))}function zT(a,e){if(!LT.test(a))return!1;try{const[t]=a.split("."),o=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(o));return!(typeof s!="object"||s===null||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function JT(a,e){return!!((e==="v4"||!e)&&UT.test(a)||(e==="v6"||!e)&&GT.test(a))}class Xn extends We{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Ee.string){const u=this._getOrReturnCtx(e);return ye(u,{code:ge.invalid_type,expected:Ee.string,received:u.parsedType}),Oe}const o=new dn;let s;for(const u of this._def.checks)if(u.kind==="min")e.data.length<u.value&&(s=this._getOrReturnCtx(e,s),ye(s,{code:ge.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),o.dirty());else if(u.kind==="max")e.data.length>u.value&&(s=this._getOrReturnCtx(e,s),ye(s,{code:ge.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),o.dirty());else if(u.kind==="length"){const f=e.data.length>u.value,g=e.data.length<u.value;(f||g)&&(s=this._getOrReturnCtx(e,s),f?ye(s,{code:ge.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}):g&&ye(s,{code:ge.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}),o.dirty())}else if(u.kind==="email")$T.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"email",code:ge.invalid_string,message:u.message}),o.dirty());else if(u.kind==="emoji")fc||(fc=new RegExp(PT,"u")),fc.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"emoji",code:ge.invalid_string,message:u.message}),o.dirty());else if(u.kind==="uuid")RT.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"uuid",code:ge.invalid_string,message:u.message}),o.dirty());else if(u.kind==="nanoid")MT.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"nanoid",code:ge.invalid_string,message:u.message}),o.dirty());else if(u.kind==="cuid")AT.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"cuid",code:ge.invalid_string,message:u.message}),o.dirty());else if(u.kind==="cuid2")wT.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"cuid2",code:ge.invalid_string,message:u.message}),o.dirty());else if(u.kind==="ulid")IT.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"ulid",code:ge.invalid_string,message:u.message}),o.dirty());else if(u.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),ye(s,{validation:"url",code:ge.invalid_string,message:u.message}),o.dirty()}else u.kind==="regex"?(u.regex.lastIndex=0,u.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"regex",code:ge.invalid_string,message:u.message}),o.dirty())):u.kind==="trim"?e.data=e.data.trim():u.kind==="includes"?e.data.includes(u.value,u.position)||(s=this._getOrReturnCtx(e,s),ye(s,{code:ge.invalid_string,validation:{includes:u.value,position:u.position},message:u.message}),o.dirty()):u.kind==="toLowerCase"?e.data=e.data.toLowerCase():u.kind==="toUpperCase"?e.data=e.data.toUpperCase():u.kind==="startsWith"?e.data.startsWith(u.value)||(s=this._getOrReturnCtx(e,s),ye(s,{code:ge.invalid_string,validation:{startsWith:u.value},message:u.message}),o.dirty()):u.kind==="endsWith"?e.data.endsWith(u.value)||(s=this._getOrReturnCtx(e,s),ye(s,{code:ge.invalid_string,validation:{endsWith:u.value},message:u.message}),o.dirty()):u.kind==="datetime"?YT(u).test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{code:ge.invalid_string,validation:"datetime",message:u.message}),o.dirty()):u.kind==="date"?qT.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{code:ge.invalid_string,validation:"date",message:u.message}),o.dirty()):u.kind==="time"?FT(u).test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{code:ge.invalid_string,validation:"time",message:u.message}),o.dirty()):u.kind==="duration"?kT.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"duration",code:ge.invalid_string,message:u.message}),o.dirty()):u.kind==="ip"?BT(e.data,u.version)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"ip",code:ge.invalid_string,message:u.message}),o.dirty()):u.kind==="jwt"?zT(e.data,u.alg)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"jwt",code:ge.invalid_string,message:u.message}),o.dirty()):u.kind==="cidr"?JT(e.data,u.version)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"cidr",code:ge.invalid_string,message:u.message}),o.dirty()):u.kind==="base64"?HT.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"base64",code:ge.invalid_string,message:u.message}),o.dirty()):u.kind==="base64url"?VT.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"base64url",code:ge.invalid_string,message:u.message}),o.dirty()):ot.assertNever(u);return{status:o.value,value:e.data}}_regex(e,t,o){return this.refinement(s=>e.test(s),{validation:t,code:ge.invalid_string,...xe.errToObj(o)})}_addCheck(e){return new Xn({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...xe.errToObj(e)})}url(e){return this._addCheck({kind:"url",...xe.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...xe.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...xe.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...xe.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...xe.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...xe.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...xe.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...xe.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...xe.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...xe.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...xe.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...xe.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...xe.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...xe.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...xe.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...xe.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...xe.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...xe.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...xe.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...xe.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...xe.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...xe.errToObj(t)})}nonempty(e){return this.min(1,xe.errToObj(e))}trim(){return new Xn({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Xn({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Xn({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Xn.create=a=>new Xn({checks:[],typeName:Ue.ZodString,coerce:(a==null?void 0:a.coerce)??!1,...Ye(a)});function KT(a,e){const t=(a.toString().split(".")[1]||"").length,o=(e.toString().split(".")[1]||"").length,s=t>o?t:o,u=Number.parseInt(a.toFixed(s).replace(".","")),f=Number.parseInt(e.toFixed(s).replace(".",""));return u%f/10**s}class pa extends We{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Ee.number){const u=this._getOrReturnCtx(e);return ye(u,{code:ge.invalid_type,expected:Ee.number,received:u.parsedType}),Oe}let o;const s=new dn;for(const u of this._def.checks)u.kind==="int"?ot.isInteger(e.data)||(o=this._getOrReturnCtx(e,o),ye(o,{code:ge.invalid_type,expected:"integer",received:"float",message:u.message}),s.dirty()):u.kind==="min"?(u.inclusive?e.data<u.value:e.data<=u.value)&&(o=this._getOrReturnCtx(e,o),ye(o,{code:ge.too_small,minimum:u.value,type:"number",inclusive:u.inclusive,exact:!1,message:u.message}),s.dirty()):u.kind==="max"?(u.inclusive?e.data>u.value:e.data>=u.value)&&(o=this._getOrReturnCtx(e,o),ye(o,{code:ge.too_big,maximum:u.value,type:"number",inclusive:u.inclusive,exact:!1,message:u.message}),s.dirty()):u.kind==="multipleOf"?KT(e.data,u.value)!==0&&(o=this._getOrReturnCtx(e,o),ye(o,{code:ge.not_multiple_of,multipleOf:u.value,message:u.message}),s.dirty()):u.kind==="finite"?Number.isFinite(e.data)||(o=this._getOrReturnCtx(e,o),ye(o,{code:ge.not_finite,message:u.message}),s.dirty()):ot.assertNever(u);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,xe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,xe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,xe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,xe.toString(t))}setLimit(e,t,o,s){return new pa({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:o,message:xe.toString(s)}]})}_addCheck(e){return new pa({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:xe.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:xe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:xe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:xe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:xe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:xe.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:xe.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:xe.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:xe.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ot.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const o of this._def.checks){if(o.kind==="finite"||o.kind==="int"||o.kind==="multipleOf")return!0;o.kind==="min"?(t===null||o.value>t)&&(t=o.value):o.kind==="max"&&(e===null||o.value<e)&&(e=o.value)}return Number.isFinite(t)&&Number.isFinite(e)}}pa.create=a=>new pa({checks:[],typeName:Ue.ZodNumber,coerce:(a==null?void 0:a.coerce)||!1,...Ye(a)});class ga extends We{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Ee.bigint)return this._getInvalidInput(e);let o;const s=new dn;for(const u of this._def.checks)u.kind==="min"?(u.inclusive?e.data<u.value:e.data<=u.value)&&(o=this._getOrReturnCtx(e,o),ye(o,{code:ge.too_small,type:"bigint",minimum:u.value,inclusive:u.inclusive,message:u.message}),s.dirty()):u.kind==="max"?(u.inclusive?e.data>u.value:e.data>=u.value)&&(o=this._getOrReturnCtx(e,o),ye(o,{code:ge.too_big,type:"bigint",maximum:u.value,inclusive:u.inclusive,message:u.message}),s.dirty()):u.kind==="multipleOf"?e.data%u.value!==BigInt(0)&&(o=this._getOrReturnCtx(e,o),ye(o,{code:ge.not_multiple_of,multipleOf:u.value,message:u.message}),s.dirty()):ot.assertNever(u);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return ye(t,{code:ge.invalid_type,expected:Ee.bigint,received:t.parsedType}),Oe}gte(e,t){return this.setLimit("min",e,!0,xe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,xe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,xe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,xe.toString(t))}setLimit(e,t,o,s){return new ga({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:o,message:xe.toString(s)}]})}_addCheck(e){return new ga({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:xe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:xe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:xe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:xe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:xe.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ga.create=a=>new ga({checks:[],typeName:Ue.ZodBigInt,coerce:(a==null?void 0:a.coerce)??!1,...Ye(a)});class Gs extends We{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Ee.boolean){const o=this._getOrReturnCtx(e);return ye(o,{code:ge.invalid_type,expected:Ee.boolean,received:o.parsedType}),Oe}return On(e.data)}}Gs.create=a=>new Gs({typeName:Ue.ZodBoolean,coerce:(a==null?void 0:a.coerce)||!1,...Ye(a)});class ao extends We{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Ee.date){const u=this._getOrReturnCtx(e);return ye(u,{code:ge.invalid_type,expected:Ee.date,received:u.parsedType}),Oe}if(Number.isNaN(e.data.getTime())){const u=this._getOrReturnCtx(e);return ye(u,{code:ge.invalid_date}),Oe}const o=new dn;let s;for(const u of this._def.checks)u.kind==="min"?e.data.getTime()<u.value&&(s=this._getOrReturnCtx(e,s),ye(s,{code:ge.too_small,message:u.message,inclusive:!0,exact:!1,minimum:u.value,type:"date"}),o.dirty()):u.kind==="max"?e.data.getTime()>u.value&&(s=this._getOrReturnCtx(e,s),ye(s,{code:ge.too_big,message:u.message,inclusive:!0,exact:!1,maximum:u.value,type:"date"}),o.dirty()):ot.assertNever(u);return{status:o.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ao({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:xe.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:xe.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}ao.create=a=>new ao({checks:[],coerce:(a==null?void 0:a.coerce)||!1,typeName:Ue.ZodDate,...Ye(a)});class Up extends We{_parse(e){if(this._getType(e)!==Ee.symbol){const o=this._getOrReturnCtx(e);return ye(o,{code:ge.invalid_type,expected:Ee.symbol,received:o.parsedType}),Oe}return On(e.data)}}Up.create=a=>new Up({typeName:Ue.ZodSymbol,...Ye(a)});class Op extends We{_parse(e){if(this._getType(e)!==Ee.undefined){const o=this._getOrReturnCtx(e);return ye(o,{code:ge.invalid_type,expected:Ee.undefined,received:o.parsedType}),Oe}return On(e.data)}}Op.create=a=>new Op({typeName:Ue.ZodUndefined,...Ye(a)});class Gp extends We{_parse(e){if(this._getType(e)!==Ee.null){const o=this._getOrReturnCtx(e);return ye(o,{code:ge.invalid_type,expected:Ee.null,received:o.parsedType}),Oe}return On(e.data)}}Gp.create=a=>new Gp({typeName:Ue.ZodNull,...Ye(a)});class Hp extends We{constructor(){super(...arguments),this._any=!0}_parse(e){return On(e.data)}}Hp.create=a=>new Hp({typeName:Ue.ZodAny,...Ye(a)});class gc extends We{constructor(){super(...arguments),this._unknown=!0}_parse(e){return On(e.data)}}gc.create=a=>new gc({typeName:Ue.ZodUnknown,...Ye(a)});class Yi extends We{_parse(e){const t=this._getOrReturnCtx(e);return ye(t,{code:ge.invalid_type,expected:Ee.never,received:t.parsedType}),Oe}}Yi.create=a=>new Yi({typeName:Ue.ZodNever,...Ye(a)});class Vp extends We{_parse(e){if(this._getType(e)!==Ee.undefined){const o=this._getOrReturnCtx(e);return ye(o,{code:ge.invalid_type,expected:Ee.void,received:o.parsedType}),Oe}return On(e.data)}}Vp.create=a=>new Vp({typeName:Ue.ZodVoid,...Ye(a)});class jn extends We{_parse(e){const{ctx:t,status:o}=this._processInputParams(e),s=this._def;if(t.parsedType!==Ee.array)return ye(t,{code:ge.invalid_type,expected:Ee.array,received:t.parsedType}),Oe;if(s.exactLength!==null){const f=t.data.length>s.exactLength.value,g=t.data.length<s.exactLength.value;(f||g)&&(ye(t,{code:f?ge.too_big:ge.too_small,minimum:g?s.exactLength.value:void 0,maximum:f?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),o.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(ye(t,{code:ge.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),o.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(ye(t,{code:ge.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),o.dirty()),t.common.async)return Promise.all([...t.data].map((f,g)=>s.type._parseAsync(new Qn(t,f,t.path,g)))).then(f=>dn.mergeArray(o,f));const u=[...t.data].map((f,g)=>s.type._parseSync(new Qn(t,f,t.path,g)));return dn.mergeArray(o,u)}get element(){return this._def.type}min(e,t){return new jn({...this._def,minLength:{value:e,message:xe.toString(t)}})}max(e,t){return new jn({...this._def,maxLength:{value:e,message:xe.toString(t)}})}length(e,t){return new jn({...this._def,exactLength:{value:e,message:xe.toString(t)}})}nonempty(e){return this.min(1,e)}}jn.create=(a,e)=>new jn({type:a,minLength:null,maxLength:null,exactLength:null,typeName:Ue.ZodArray,...Ye(e)});function to(a){if(a instanceof Ft){const e={};for(const t in a.shape){const o=a.shape[t];e[t]=qi.create(to(o))}return new Ft({...a._def,shape:()=>e})}else return a instanceof jn?new jn({...a._def,type:to(a.element)}):a instanceof qi?qi.create(to(a.unwrap())):a instanceof so?so.create(to(a.unwrap())):a instanceof ha?ha.create(a.items.map(e=>to(e))):a}class Ft extends We{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=ot.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==Ee.object){const p=this._getOrReturnCtx(e);return ye(p,{code:ge.invalid_type,expected:Ee.object,received:p.parsedType}),Oe}const{status:o,ctx:s}=this._processInputParams(e),{shape:u,keys:f}=this._getCached(),g=[];if(!(this._def.catchall instanceof Yi&&this._def.unknownKeys==="strip"))for(const p in s.data)f.includes(p)||g.push(p);const h=[];for(const p of f){const v=u[p],T=s.data[p];h.push({key:{status:"valid",value:p},value:v._parse(new Qn(s,T,s.path,p)),alwaysSet:p in s.data})}if(this._def.catchall instanceof Yi){const p=this._def.unknownKeys;if(p==="passthrough")for(const v of g)h.push({key:{status:"valid",value:v},value:{status:"valid",value:s.data[v]}});else if(p==="strict")g.length>0&&(ye(s,{code:ge.unrecognized_keys,keys:g}),o.dirty());else if(p!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const p=this._def.catchall;for(const v of g){const T=s.data[v];h.push({key:{status:"valid",value:v},value:p._parse(new Qn(s,T,s.path,v)),alwaysSet:v in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const p=[];for(const v of h){const T=await v.key,C=await v.value;p.push({key:T,value:C,alwaysSet:v.alwaysSet})}return p}).then(p=>dn.mergeObjectSync(o,p)):dn.mergeObjectSync(o,h)}get shape(){return this._def.shape()}strict(e){return xe.errToObj,new Ft({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,o)=>{var u,f;const s=((f=(u=this._def).errorMap)==null?void 0:f.call(u,t,o).message)??o.defaultError;return t.code==="unrecognized_keys"?{message:xe.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new Ft({...this._def,unknownKeys:"strip"})}passthrough(){return new Ft({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ft({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ft({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Ue.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Ft({...this._def,catchall:e})}pick(e){const t={};for(const o of ot.objectKeys(e))e[o]&&this.shape[o]&&(t[o]=this.shape[o]);return new Ft({...this._def,shape:()=>t})}omit(e){const t={};for(const o of ot.objectKeys(this.shape))e[o]||(t[o]=this.shape[o]);return new Ft({...this._def,shape:()=>t})}deepPartial(){return to(this)}partial(e){const t={};for(const o of ot.objectKeys(this.shape)){const s=this.shape[o];e&&!e[o]?t[o]=s:t[o]=s.optional()}return new Ft({...this._def,shape:()=>t})}required(e){const t={};for(const o of ot.objectKeys(this.shape))if(e&&!e[o])t[o]=this.shape[o];else{let u=this.shape[o];for(;u instanceof qi;)u=u._def.innerType;t[o]=u}return new Ft({...this._def,shape:()=>t})}keyof(){return Sh(ot.objectKeys(this.shape))}}Ft.create=(a,e)=>new Ft({shape:()=>a,unknownKeys:"strip",catchall:Yi.create(),typeName:Ue.ZodObject,...Ye(e)});Ft.strictCreate=(a,e)=>new Ft({shape:()=>a,unknownKeys:"strict",catchall:Yi.create(),typeName:Ue.ZodObject,...Ye(e)});Ft.lazycreate=(a,e)=>new Ft({shape:a,unknownKeys:"strip",catchall:Yi.create(),typeName:Ue.ZodObject,...Ye(e)});class Hs extends We{_parse(e){const{ctx:t}=this._processInputParams(e),o=this._def.options;function s(u){for(const g of u)if(g.result.status==="valid")return g.result;for(const g of u)if(g.result.status==="dirty")return t.common.issues.push(...g.ctx.common.issues),g.result;const f=u.map(g=>new yi(g.ctx.common.issues));return ye(t,{code:ge.invalid_union,unionErrors:f}),Oe}if(t.common.async)return Promise.all(o.map(async u=>{const f={...t,common:{...t.common,issues:[]},parent:null};return{result:await u._parseAsync({data:t.data,path:t.path,parent:f}),ctx:f}})).then(s);{let u;const f=[];for(const h of o){const p={...t,common:{...t.common,issues:[]},parent:null},v=h._parseSync({data:t.data,path:t.path,parent:p});if(v.status==="valid")return v;v.status==="dirty"&&!u&&(u={result:v,ctx:p}),p.common.issues.length&&f.push(p.common.issues)}if(u)return t.common.issues.push(...u.ctx.common.issues),u.result;const g=f.map(h=>new yi(h));return ye(t,{code:ge.invalid_union,unionErrors:g}),Oe}}get options(){return this._def.options}}Hs.create=(a,e)=>new Hs({options:a,typeName:Ue.ZodUnion,...Ye(e)});function hc(a,e){const t=Vi(a),o=Vi(e);if(a===e)return{valid:!0,data:a};if(t===Ee.object&&o===Ee.object){const s=ot.objectKeys(e),u=ot.objectKeys(a).filter(g=>s.indexOf(g)!==-1),f={...a,...e};for(const g of u){const h=hc(a[g],e[g]);if(!h.valid)return{valid:!1};f[g]=h.data}return{valid:!0,data:f}}else if(t===Ee.array&&o===Ee.array){if(a.length!==e.length)return{valid:!1};const s=[];for(let u=0;u<a.length;u++){const f=a[u],g=e[u],h=hc(f,g);if(!h.valid)return{valid:!1};s.push(h.data)}return{valid:!0,data:s}}else return t===Ee.date&&o===Ee.date&&+a==+e?{valid:!0,data:a}:{valid:!1}}class Vs extends We{_parse(e){const{status:t,ctx:o}=this._processInputParams(e),s=(u,f)=>{if($p(u)||$p(f))return Oe;const g=hc(u.value,f.value);return g.valid?((Pp(u)||Pp(f))&&t.dirty(),{status:t.value,value:g.data}):(ye(o,{code:ge.invalid_intersection_types}),Oe)};return o.common.async?Promise.all([this._def.left._parseAsync({data:o.data,path:o.path,parent:o}),this._def.right._parseAsync({data:o.data,path:o.path,parent:o})]).then(([u,f])=>s(u,f)):s(this._def.left._parseSync({data:o.data,path:o.path,parent:o}),this._def.right._parseSync({data:o.data,path:o.path,parent:o}))}}Vs.create=(a,e,t)=>new Vs({left:a,right:e,typeName:Ue.ZodIntersection,...Ye(t)});class ha extends We{_parse(e){const{status:t,ctx:o}=this._processInputParams(e);if(o.parsedType!==Ee.array)return ye(o,{code:ge.invalid_type,expected:Ee.array,received:o.parsedType}),Oe;if(o.data.length<this._def.items.length)return ye(o,{code:ge.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Oe;!this._def.rest&&o.data.length>this._def.items.length&&(ye(o,{code:ge.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const u=[...o.data].map((f,g)=>{const h=this._def.items[g]||this._def.rest;return h?h._parse(new Qn(o,f,o.path,g)):null}).filter(f=>!!f);return o.common.async?Promise.all(u).then(f=>dn.mergeArray(t,f)):dn.mergeArray(t,u)}get items(){return this._def.items}rest(e){return new ha({...this._def,rest:e})}}ha.create=(a,e)=>{if(!Array.isArray(a))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ha({items:a,typeName:Ue.ZodTuple,rest:null,...Ye(e)})};class qs extends We{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:o}=this._processInputParams(e);if(o.parsedType!==Ee.object)return ye(o,{code:ge.invalid_type,expected:Ee.object,received:o.parsedType}),Oe;const s=[],u=this._def.keyType,f=this._def.valueType;for(const g in o.data)s.push({key:u._parse(new Qn(o,g,o.path,g)),value:f._parse(new Qn(o,o.data[g],o.path,g)),alwaysSet:g in o.data});return o.common.async?dn.mergeObjectAsync(t,s):dn.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,o){return t instanceof We?new qs({keyType:e,valueType:t,typeName:Ue.ZodRecord,...Ye(o)}):new qs({keyType:Xn.create(),valueType:e,typeName:Ue.ZodRecord,...Ye(t)})}}class qp extends We{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:o}=this._processInputParams(e);if(o.parsedType!==Ee.map)return ye(o,{code:ge.invalid_type,expected:Ee.map,received:o.parsedType}),Oe;const s=this._def.keyType,u=this._def.valueType,f=[...o.data.entries()].map(([g,h],p)=>({key:s._parse(new Qn(o,g,o.path,[p,"key"])),value:u._parse(new Qn(o,h,o.path,[p,"value"]))}));if(o.common.async){const g=new Map;return Promise.resolve().then(async()=>{for(const h of f){const p=await h.key,v=await h.value;if(p.status==="aborted"||v.status==="aborted")return Oe;(p.status==="dirty"||v.status==="dirty")&&t.dirty(),g.set(p.value,v.value)}return{status:t.value,value:g}})}else{const g=new Map;for(const h of f){const p=h.key,v=h.value;if(p.status==="aborted"||v.status==="aborted")return Oe;(p.status==="dirty"||v.status==="dirty")&&t.dirty(),g.set(p.value,v.value)}return{status:t.value,value:g}}}}qp.create=(a,e,t)=>new qp({valueType:e,keyType:a,typeName:Ue.ZodMap,...Ye(t)});class mr extends We{_parse(e){const{status:t,ctx:o}=this._processInputParams(e);if(o.parsedType!==Ee.set)return ye(o,{code:ge.invalid_type,expected:Ee.set,received:o.parsedType}),Oe;const s=this._def;s.minSize!==null&&o.data.size<s.minSize.value&&(ye(o,{code:ge.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&o.data.size>s.maxSize.value&&(ye(o,{code:ge.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const u=this._def.valueType;function f(h){const p=new Set;for(const v of h){if(v.status==="aborted")return Oe;v.status==="dirty"&&t.dirty(),p.add(v.value)}return{status:t.value,value:p}}const g=[...o.data.values()].map((h,p)=>u._parse(new Qn(o,h,o.path,p)));return o.common.async?Promise.all(g).then(h=>f(h)):f(g)}min(e,t){return new mr({...this._def,minSize:{value:e,message:xe.toString(t)}})}max(e,t){return new mr({...this._def,maxSize:{value:e,message:xe.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}mr.create=(a,e)=>new mr({valueType:a,minSize:null,maxSize:null,typeName:Ue.ZodSet,...Ye(e)});class yc extends We{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}yc.create=(a,e)=>new yc({getter:a,typeName:Ue.ZodLazy,...Ye(e)});class Fp extends We{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return ye(t,{received:t.data,code:ge.invalid_literal,expected:this._def.value}),Oe}return{status:"valid",value:e.data}}get value(){return this._def.value}}Fp.create=(a,e)=>new Fp({value:a,typeName:Ue.ZodLiteral,...Ye(e)});function Sh(a,e){return new oo({values:a,typeName:Ue.ZodEnum,...Ye(e)})}class oo extends We{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),o=this._def.values;return ye(t,{expected:ot.joinValues(o),received:t.parsedType,code:ge.invalid_type}),Oe}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),o=this._def.values;return ye(t,{received:t.data,code:ge.invalid_enum_value,options:o}),Oe}return On(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return oo.create(e,{...this._def,...t})}exclude(e,t=this._def){return oo.create(this.options.filter(o=>!e.includes(o)),{...this._def,...t})}}oo.create=Sh;class Yp extends We{_parse(e){const t=ot.getValidEnumValues(this._def.values),o=this._getOrReturnCtx(e);if(o.parsedType!==Ee.string&&o.parsedType!==Ee.number){const s=ot.objectValues(t);return ye(o,{expected:ot.joinValues(s),received:o.parsedType,code:ge.invalid_type}),Oe}if(this._cache||(this._cache=new Set(ot.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const s=ot.objectValues(t);return ye(o,{received:o.data,code:ge.invalid_enum_value,options:s}),Oe}return On(e.data)}get enum(){return this._def.values}}Yp.create=(a,e)=>new Yp({values:a,typeName:Ue.ZodNativeEnum,...Ye(e)});class Fs extends We{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ee.promise&&t.common.async===!1)return ye(t,{code:ge.invalid_type,expected:Ee.promise,received:t.parsedType}),Oe;const o=t.parsedType===Ee.promise?t.data:Promise.resolve(t.data);return On(o.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Fs.create=(a,e)=>new Fs({type:a,typeName:Ue.ZodPromise,...Ye(e)});class ro extends We{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Ue.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:o}=this._processInputParams(e),s=this._def.effect||null,u={addIssue:f=>{ye(o,f),f.fatal?t.abort():t.dirty()},get path(){return o.path}};if(u.addIssue=u.addIssue.bind(u),s.type==="preprocess"){const f=s.transform(o.data,u);if(o.common.async)return Promise.resolve(f).then(async g=>{if(t.value==="aborted")return Oe;const h=await this._def.schema._parseAsync({data:g,path:o.path,parent:o});return h.status==="aborted"?Oe:h.status==="dirty"||t.value==="dirty"?lr(h.value):h});{if(t.value==="aborted")return Oe;const g=this._def.schema._parseSync({data:f,path:o.path,parent:o});return g.status==="aborted"?Oe:g.status==="dirty"||t.value==="dirty"?lr(g.value):g}}if(s.type==="refinement"){const f=g=>{const h=s.refinement(g,u);if(o.common.async)return Promise.resolve(h);if(h instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return g};if(o.common.async===!1){const g=this._def.schema._parseSync({data:o.data,path:o.path,parent:o});return g.status==="aborted"?Oe:(g.status==="dirty"&&t.dirty(),f(g.value),{status:t.value,value:g.value})}else return this._def.schema._parseAsync({data:o.data,path:o.path,parent:o}).then(g=>g.status==="aborted"?Oe:(g.status==="dirty"&&t.dirty(),f(g.value).then(()=>({status:t.value,value:g.value}))))}if(s.type==="transform")if(o.common.async===!1){const f=this._def.schema._parseSync({data:o.data,path:o.path,parent:o});if(!io(f))return Oe;const g=s.transform(f.value,u);if(g instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:g}}else return this._def.schema._parseAsync({data:o.data,path:o.path,parent:o}).then(f=>io(f)?Promise.resolve(s.transform(f.value,u)).then(g=>({status:t.value,value:g})):Oe);ot.assertNever(s)}}ro.create=(a,e,t)=>new ro({schema:a,typeName:Ue.ZodEffects,effect:e,...Ye(t)});ro.createWithPreprocess=(a,e,t)=>new ro({schema:e,effect:{type:"preprocess",transform:a},typeName:Ue.ZodEffects,...Ye(t)});class qi extends We{_parse(e){return this._getType(e)===Ee.undefined?On(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}qi.create=(a,e)=>new qi({innerType:a,typeName:Ue.ZodOptional,...Ye(e)});class so extends We{_parse(e){return this._getType(e)===Ee.null?On(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}so.create=(a,e)=>new so({innerType:a,typeName:Ue.ZodNullable,...Ye(e)});class vc extends We{_parse(e){const{ctx:t}=this._processInputParams(e);let o=t.data;return t.parsedType===Ee.undefined&&(o=this._def.defaultValue()),this._def.innerType._parse({data:o,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}vc.create=(a,e)=>new vc({innerType:a,typeName:Ue.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Ye(e)});class Tc extends We{_parse(e){const{ctx:t}=this._processInputParams(e),o={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:o.data,path:o.path,parent:{...o}});return Os(s)?s.then(u=>({status:"valid",value:u.status==="valid"?u.value:this._def.catchValue({get error(){return new yi(o.common.issues)},input:o.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new yi(o.common.issues)},input:o.data})}}removeCatch(){return this._def.innerType}}Tc.create=(a,e)=>new Tc({innerType:a,typeName:Ue.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Ye(e)});class Bp extends We{_parse(e){if(this._getType(e)!==Ee.nan){const o=this._getOrReturnCtx(e);return ye(o,{code:ge.invalid_type,expected:Ee.nan,received:o.parsedType}),Oe}return{status:"valid",value:e.data}}}Bp.create=a=>new Bp({typeName:Ue.ZodNaN,...Ye(a)});class ZT extends We{_parse(e){const{ctx:t}=this._processInputParams(e),o=t.data;return this._def.type._parse({data:o,path:t.path,parent:t})}unwrap(){return this._def.type}}class $c extends We{_parse(e){const{status:t,ctx:o}=this._processInputParams(e);if(o.common.async)return(async()=>{const u=await this._def.in._parseAsync({data:o.data,path:o.path,parent:o});return u.status==="aborted"?Oe:u.status==="dirty"?(t.dirty(),lr(u.value)):this._def.out._parseAsync({data:u.value,path:o.path,parent:o})})();{const s=this._def.in._parseSync({data:o.data,path:o.path,parent:o});return s.status==="aborted"?Oe:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:o.path,parent:o})}}static create(e,t){return new $c({in:e,out:t,typeName:Ue.ZodPipeline})}}class Cc extends We{_parse(e){const t=this._def.innerType._parse(e),o=s=>(io(s)&&(s.value=Object.freeze(s.value)),s);return Os(t)?t.then(s=>o(s)):o(t)}unwrap(){return this._def.innerType}}Cc.create=(a,e)=>new Cc({innerType:a,typeName:Ue.ZodReadonly,...Ye(e)});var Ue;(function(a){a.ZodString="ZodString",a.ZodNumber="ZodNumber",a.ZodNaN="ZodNaN",a.ZodBigInt="ZodBigInt",a.ZodBoolean="ZodBoolean",a.ZodDate="ZodDate",a.ZodSymbol="ZodSymbol",a.ZodUndefined="ZodUndefined",a.ZodNull="ZodNull",a.ZodAny="ZodAny",a.ZodUnknown="ZodUnknown",a.ZodNever="ZodNever",a.ZodVoid="ZodVoid",a.ZodArray="ZodArray",a.ZodObject="ZodObject",a.ZodUnion="ZodUnion",a.ZodDiscriminatedUnion="ZodDiscriminatedUnion",a.ZodIntersection="ZodIntersection",a.ZodTuple="ZodTuple",a.ZodRecord="ZodRecord",a.ZodMap="ZodMap",a.ZodSet="ZodSet",a.ZodFunction="ZodFunction",a.ZodLazy="ZodLazy",a.ZodLiteral="ZodLiteral",a.ZodEnum="ZodEnum",a.ZodEffects="ZodEffects",a.ZodNativeEnum="ZodNativeEnum",a.ZodOptional="ZodOptional",a.ZodNullable="ZodNullable",a.ZodDefault="ZodDefault",a.ZodCatch="ZodCatch",a.ZodPromise="ZodPromise",a.ZodBranded="ZodBranded",a.ZodPipeline="ZodPipeline",a.ZodReadonly="ZodReadonly"})(Ue||(Ue={}));const ma=Xn.create,zp=pa.create;ga.create;const XT=Gs.create;ao.create;const Jp=gc.create;Yi.create;const ur=jn.create,jT=Ft.create,QT=Hs.create;Vs.create;ha.create;const WT=qs.create,eC=yc.create,tC=oo.create;Fs.create;qi.create;so.create;const eo={string:a=>Xn.create({...a,coerce:!0}),number:a=>pa.create({...a,coerce:!0}),boolean:a=>Gs.create({...a,coerce:!0}),bigint:a=>ga.create({...a,coerce:!0}),date:a=>ao.create({...a,coerce:!0})};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let nC,iC;function aC(){return{geminiUrl:nC,vertexUrl:iC}}function oC(a,e,t){var o,s,u;if(!(!((o=a.httpOptions)===null||o===void 0)&&o.baseUrl)){const f=aC();return a.vertexai?(s=f.vertexUrl)!==null&&s!==void 0?s:e:(u=f.geminiUrl)!==null&&u!==void 0?u:t}return a.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class hr{}function De(a,e){const t=/\{([^}]+)\}/g;return a.replace(t,(o,s)=>{if(Object.prototype.hasOwnProperty.call(e,s)){const u=e[s];return u!=null?String(u):""}else throw new Error(`Key '${s}' not found in valueMap.`)})}function d(a,e,t){for(let u=0;u<e.length-1;u++){const f=e[u];if(f.endsWith("[]")){const g=f.slice(0,-2);if(!(g in a))if(Array.isArray(t))a[g]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${f}`);if(Array.isArray(a[g])){const h=a[g];if(Array.isArray(t))for(let p=0;p<h.length;p++){const v=h[p];d(v,e.slice(u+1),t[p])}else for(const p of h)d(p,e.slice(u+1),t)}return}else if(f.endsWith("[0]")){const g=f.slice(0,-3);g in a||(a[g]=[{}]);const h=a[g];d(h[0],e.slice(u+1),t);return}(!a[f]||typeof a[f]!="object")&&(a[f]={}),a=a[f]}const o=e[e.length-1],s=a[o];if(s!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===s)return;if(typeof s=="object"&&typeof t=="object"&&s!==null&&t!==null)Object.assign(s,t);else throw new Error(`Cannot set value for an existing key. Key: ${o}`)}else a[o]=t}function c(a,e){try{if(e.length===1&&e[0]==="_self")return a;for(let t=0;t<e.length;t++){if(typeof a!="object"||a===null)return;const o=e[t];if(o.endsWith("[]")){const s=o.slice(0,-2);if(s in a){const u=a[s];return Array.isArray(u)?u.map(f=>c(f,e.slice(t+1))):void 0}else return}else a=a[o]}return a}catch(t){if(t instanceof TypeError)return;throw t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Kp;(function(a){a.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",a.OUTCOME_OK="OUTCOME_OK",a.OUTCOME_FAILED="OUTCOME_FAILED",a.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Kp||(Kp={}));var Zp;(function(a){a.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",a.PYTHON="PYTHON"})(Zp||(Zp={}));var _;(function(a){a.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",a.STRING="STRING",a.NUMBER="NUMBER",a.INTEGER="INTEGER",a.BOOLEAN="BOOLEAN",a.ARRAY="ARRAY",a.OBJECT="OBJECT",a.NULL="NULL"})(_||(_={}));var Xp;(function(a){a.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",a.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",a.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",a.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",a.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",a.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Xp||(Xp={}));var jp;(function(a){a.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",a.SEVERITY="SEVERITY",a.PROBABILITY="PROBABILITY"})(jp||(jp={}));var Qp;(function(a){a.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",a.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",a.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",a.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",a.BLOCK_NONE="BLOCK_NONE",a.OFF="OFF"})(Qp||(Qp={}));var Wp;(function(a){a.MODE_UNSPECIFIED="MODE_UNSPECIFIED",a.MODE_DYNAMIC="MODE_DYNAMIC"})(Wp||(Wp={}));var eg;(function(a){a.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",a.NO_AUTH="NO_AUTH",a.API_KEY_AUTH="API_KEY_AUTH",a.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",a.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",a.OAUTH="OAUTH",a.OIDC_AUTH="OIDC_AUTH"})(eg||(eg={}));var tg;(function(a){a.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",a.STOP="STOP",a.MAX_TOKENS="MAX_TOKENS",a.SAFETY="SAFETY",a.RECITATION="RECITATION",a.LANGUAGE="LANGUAGE",a.OTHER="OTHER",a.BLOCKLIST="BLOCKLIST",a.PROHIBITED_CONTENT="PROHIBITED_CONTENT",a.SPII="SPII",a.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",a.IMAGE_SAFETY="IMAGE_SAFETY"})(tg||(tg={}));var ng;(function(a){a.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",a.NEGLIGIBLE="NEGLIGIBLE",a.LOW="LOW",a.MEDIUM="MEDIUM",a.HIGH="HIGH"})(ng||(ng={}));var ig;(function(a){a.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",a.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",a.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",a.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",a.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(ig||(ig={}));var ag;(function(a){a.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",a.SAFETY="SAFETY",a.OTHER="OTHER",a.BLOCKLIST="BLOCKLIST",a.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(ag||(ag={}));var og;(function(a){a.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",a.ON_DEMAND="ON_DEMAND",a.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(og||(og={}));var Ys;(function(a){a.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",a.TEXT="TEXT",a.IMAGE="IMAGE",a.AUDIO="AUDIO"})(Ys||(Ys={}));var rg;(function(a){a.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",a.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",a.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",a.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(rg||(rg={}));var Ec;(function(a){a.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",a.JOB_STATE_QUEUED="JOB_STATE_QUEUED",a.JOB_STATE_PENDING="JOB_STATE_PENDING",a.JOB_STATE_RUNNING="JOB_STATE_RUNNING",a.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",a.JOB_STATE_FAILED="JOB_STATE_FAILED",a.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",a.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",a.JOB_STATE_PAUSED="JOB_STATE_PAUSED",a.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",a.JOB_STATE_UPDATING="JOB_STATE_UPDATING",a.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Ec||(Ec={}));var sg;(function(a){a.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",a.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",a.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",a.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",a.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",a.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",a.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(sg||(sg={}));var lg;(function(a){a.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",a.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",a.BALANCED="BALANCED",a.PRIORITIZE_COST="PRIORITIZE_COST"})(lg||(lg={}));var ug;(function(a){a.UNSPECIFIED="UNSPECIFIED",a.BLOCKING="BLOCKING",a.NON_BLOCKING="NON_BLOCKING"})(ug||(ug={}));var cg;(function(a){a.MODE_UNSPECIFIED="MODE_UNSPECIFIED",a.MODE_DYNAMIC="MODE_DYNAMIC"})(cg||(cg={}));var dg;(function(a){a.MODE_UNSPECIFIED="MODE_UNSPECIFIED",a.AUTO="AUTO",a.ANY="ANY",a.NONE="NONE"})(dg||(dg={}));var fg;(function(a){a.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",a.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",a.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR"})(fg||(fg={}));var mg;(function(a){a.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",a.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",a.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",a.BLOCK_NONE="BLOCK_NONE"})(mg||(mg={}));var pg;(function(a){a.DONT_ALLOW="DONT_ALLOW",a.ALLOW_ADULT="ALLOW_ADULT",a.ALLOW_ALL="ALLOW_ALL"})(pg||(pg={}));var gg;(function(a){a.auto="auto",a.en="en",a.ja="ja",a.ko="ko",a.hi="hi"})(gg||(gg={}));var hg;(function(a){a.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",a.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",a.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",a.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",a.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(hg||(hg={}));var yg;(function(a){a.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",a.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",a.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",a.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(yg||(yg={}));var vg;(function(a){a.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",a.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",a.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",a.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(vg||(vg={}));var Tg;(function(a){a.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",a.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",a.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",a.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",a.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",a.EDIT_MODE_STYLE="EDIT_MODE_STYLE",a.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",a.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Tg||(Tg={}));var Cg;(function(a){a.STATE_UNSPECIFIED="STATE_UNSPECIFIED",a.PROCESSING="PROCESSING",a.ACTIVE="ACTIVE",a.FAILED="FAILED"})(Cg||(Cg={}));var Eg;(function(a){a.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",a.UPLOADED="UPLOADED",a.GENERATED="GENERATED"})(Eg||(Eg={}));var xg;(function(a){a.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",a.TEXT="TEXT",a.IMAGE="IMAGE",a.VIDEO="VIDEO",a.AUDIO="AUDIO",a.DOCUMENT="DOCUMENT"})(xg||(xg={}));var Sg;(function(a){a.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",a.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",a.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Sg||(Sg={}));var bg;(function(a){a.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",a.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",a.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(bg||(bg={}));var _g;(function(a){a.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",a.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",a.NO_INTERRUPTION="NO_INTERRUPTION"})(_g||(_g={}));var Ng;(function(a){a.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",a.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",a.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Ng||(Ng={}));var Ag;(function(a){a.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",a.SILENT="SILENT",a.WHEN_IDLE="WHEN_IDLE",a.INTERRUPT="INTERRUPT"})(Ag||(Ag={}));var wg;(function(a){a.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",a.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",a.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",a.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",a.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",a.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",a.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",a.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",a.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",a.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",a.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",a.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",a.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(wg||(wg={}));var no;(function(a){a.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",a.PLAY="PLAY",a.PAUSE="PAUSE",a.STOP="STOP",a.RESET_CONTEXT="RESET_CONTEXT"})(no||(no={}));class sr{get text(){var e,t,o,s,u,f,g,h;if(((s=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let p="",v=!1;const T=[];for(const C of(h=(g=(f=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||f===void 0?void 0:f.content)===null||g===void 0?void 0:g.parts)!==null&&h!==void 0?h:[]){for(const[S,w]of Object.entries(C))S!=="text"&&S!=="thought"&&(w!==null||w!==void 0)&&T.push(S);if(typeof C.text=="string"){if(typeof C.thought=="boolean"&&C.thought)continue;v=!0,p+=C.text}}return T.length>0&&console.warn(`there are non-text parts ${T} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),v?p:void 0}get data(){var e,t,o,s,u,f,g,h;if(((s=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let p="";const v=[];for(const T of(h=(g=(f=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||f===void 0?void 0:f.content)===null||g===void 0?void 0:g.parts)!==null&&h!==void 0?h:[]){for(const[C,S]of Object.entries(T))C!=="inlineData"&&(S!==null||S!==void 0)&&v.push(C);T.inlineData&&typeof T.inlineData.data=="string"&&(p+=atob(T.inlineData.data))}return v.length>0&&console.warn(`there are non-data parts ${v} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),p.length>0?btoa(p):void 0}get functionCalls(){var e,t,o,s,u,f,g,h;if(((s=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const p=(h=(g=(f=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||f===void 0?void 0:f.content)===null||g===void 0?void 0:g.parts)===null||h===void 0?void 0:h.filter(v=>v.functionCall).map(v=>v.functionCall).filter(v=>v!==void 0);if((p==null?void 0:p.length)!==0)return p}get executableCode(){var e,t,o,s,u,f,g,h,p;if(((s=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const v=(h=(g=(f=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||f===void 0?void 0:f.content)===null||g===void 0?void 0:g.parts)===null||h===void 0?void 0:h.filter(T=>T.executableCode).map(T=>T.executableCode).filter(T=>T!==void 0);if((v==null?void 0:v.length)!==0)return(p=v==null?void 0:v[0])===null||p===void 0?void 0:p.code}get codeExecutionResult(){var e,t,o,s,u,f,g,h,p;if(((s=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const v=(h=(g=(f=(u=this.candidates)===null||u===void 0?void 0:u[0])===null||f===void 0?void 0:f.content)===null||g===void 0?void 0:g.parts)===null||h===void 0?void 0:h.filter(T=>T.codeExecutionResult).map(T=>T.codeExecutionResult).filter(T=>T!==void 0);if((v==null?void 0:v.length)!==0)return(p=v==null?void 0:v[0])===null||p===void 0?void 0:p.output}}class Ig{}class Rg{}class rC{}class sC{}class Mg{}class Lg{}class kg{}class lC{}class $g{}class Pg{}class Dg{}class uC{}class xc{constructor(e){const t={};for(const o of e.headers.entries())t[o[0]]=o[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class cC{}class dC{}class fC{get text(){var e,t,o;let s="",u=!1;const f=[];for(const g of(o=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&o!==void 0?o:[]){for(const[h,p]of Object.entries(g))h!=="text"&&h!=="thought"&&p!==null&&f.push(h);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;u=!0,s+=g.text}}return f.length>0&&console.warn(`there are non-text parts ${f} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?s:void 0}get data(){var e,t,o;let s="";const u=[];for(const f of(o=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&o!==void 0?o:[]){for(const[g,h]of Object.entries(f))g!=="inlineData"&&h!==null&&u.push(g);f.inlineData&&typeof f.inlineData.data=="string"&&(s+=atob(f.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}}class mC{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wt(a,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(a.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function bh(a,e){const t=wt(a,e);return t?t.startsWith("publishers/")&&a.isVertexAI()?`projects/${a.getProject()}/locations/${a.getLocation()}/${t}`:t.startsWith("models/")&&a.isVertexAI()?`projects/${a.getProject()}/locations/${a.getLocation()}/publishers/google/${t}`:t:""}function _h(a,e){return Array.isArray(e)?e.map(t=>Bs(a,t)):[Bs(a,e)]}function Bs(a,e){if(typeof e=="object"&&e!==null)return e;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function pC(a,e){const t=Bs(a,e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function gC(a,e){const t=Bs(a,e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function Ug(a,e){if(e==null)throw new Error("PartUnion is required");if(typeof e=="object")return e;if(typeof e=="string")return{text:e};throw new Error(`Unsupported part type: ${typeof e}`)}function Nh(a,e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(t=>Ug(a,t)):[Ug(a,e)]}function Sc(a){return a!=null&&typeof a=="object"&&"parts"in a&&Array.isArray(a.parts)}function Og(a){return a!=null&&typeof a=="object"&&"functionCall"in a}function Gg(a){return a!=null&&typeof a=="object"&&"functionResponse"in a}function hn(a,e){if(e==null)throw new Error("ContentUnion is required");return Sc(e)?e:{role:"user",parts:Nh(a,e)}}function Ah(a,e){if(!e)return[];if(a.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const o=hn(a,t);return o.parts&&o.parts.length>0&&o.parts[0].text!==void 0?[o.parts[0].text]:[]});if(a.isVertexAI()){const t=hn(a,e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>hn(a,t)):[hn(a,e)]}function Fn(a,e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("contents are required");if(!Array.isArray(e)){if(Og(e)||Gg(e))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[hn(a,e)]}const t=[],o=[],s=Sc(e[0]);for(const u of e){const f=Sc(u);if(f!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(f)t.push(u);else{if(Og(u)||Gg(u))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");o.push(u)}}return s||t.push({role:"user",parts:Nh(a,o)}),t}const Hg=tC(["string","number","integer","object","array","boolean","null"]),hC=QT([Hg,ur(Hg)]);function yC(a=!0){const e=eC(()=>{const t=jT({type:hC.optional(),format:ma().optional(),title:ma().optional(),description:ma().optional(),default:Jp().optional(),items:e.optional(),minItems:eo.string().optional(),maxItems:eo.string().optional(),enum:ur(Jp()).optional(),properties:WT(ma(),e).optional(),required:ur(ma()).optional(),minProperties:eo.string().optional(),maxProperties:eo.string().optional(),propertyOrdering:ur(ma()).optional(),minimum:zp().optional(),maximum:zp().optional(),minLength:eo.string().optional(),maxLength:eo.string().optional(),pattern:ma().optional(),anyOf:ur(e).optional(),additionalProperties:XT().optional()});return a?t.strict():t});return e}function vC(a,e){a.includes("null")&&(e.nullable=!0);const t=a.filter(o=>o!=="null");if(t.length===1)e.type=Object.keys(_).includes(t[0].toUpperCase())?_[t[0].toUpperCase()]:_.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const o of t)e.anyOf.push({type:Object.keys(_).includes(o.toUpperCase())?_[o.toUpperCase()]:_.TYPE_UNSPECIFIED})}}function dr(a){const e={},t=["items"],o=["anyOf"],s=["properties"];if(a.type&&a.anyOf)throw new Error("type and anyOf cannot be both populated.");const u=a.anyOf;u!=null&&u.length==2&&(u[0].type==="null"?(e.nullable=!0,a=u[1]):u[1].type==="null"&&(e.nullable=!0,a=u[0])),a.type instanceof Array&&vC(a.type,e);for(const[f,g]of Object.entries(a))if(g!=null)if(f=="type"){if(g==="null")throw new Error("type: null can not be the only possible type for the field.");if(g instanceof Array)continue;e.type=Object.keys(_).includes(g.toUpperCase())?g.toUpperCase():_.TYPE_UNSPECIFIED}else if(t.includes(f))e[f]=dr(g);else if(o.includes(f)){const h=[];for(const p of g){if(p.type=="null"){e.nullable=!0;continue}h.push(dr(p))}e[f]=h}else if(s.includes(f)){const h={};for(const[p,v]of Object.entries(g))h[p]=dr(v);e[f]=h}else{if(f==="additionalProperties")continue;e[f]=g}return e}function zs(a,e){if(Object.keys(e).includes("$schema")){delete e.$schema;const t=yC().parse(e);return dr(t)}else return dr(e)}function wh(a,e){if(typeof e=="object")return e;if(typeof e=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error(`Unsupported speechConfig type: ${typeof e}`)}function Ih(a,e){if("multiSpeakerVoiceConfig"in e)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function Ks(a,e){if(e.functionDeclarations)for(const t of e.functionDeclarations)t.parameters&&(t.parameters=zs(a,t.parameters)),t.response&&(t.response=zs(a,t.response));return e}function Zs(a,e){if(e==null)throw new Error("tools is required");if(!Array.isArray(e))throw new Error("tools is required and must be an array of Tools");const t=[];for(const o of e)t.push(o);return t}function TC(a,e,t,o=1){const s=!e.startsWith(`${t}/`)&&e.split("/").length===o;return a.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${a.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${a.getProject()}/locations/${a.getLocation()}/${e}`:s?`projects/${a.getProject()}/locations/${a.getLocation()}/${t}/${e}`:e:s?`${t}/${e}`:e}function zi(a,e){if(typeof e!="string")throw new Error("name must be a string");return TC(a,e,"cachedContents")}function Rh(a,e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function Ji(a,e){if(typeof e!="string")throw new Error("fromImageBytes must be a string");return e}function CC(a){return a!=null&&typeof a=="object"&&"name"in a}function EC(a){return a!=null&&typeof a=="object"&&"video"in a}function xC(a){return a!=null&&typeof a=="object"&&"uri"in a}function Mh(a,e){var t;let o;if(CC(e)&&(o=e.name),!(xC(e)&&(o=e.uri,o===void 0))&&!(EC(e)&&(o=(t=e.video)===null||t===void 0?void 0:t.uri,o===void 0))){if(typeof e=="string"&&(o=e),o===void 0)throw new Error("Could not extract file name from the provided input.");if(o.startsWith("https://")){const u=o.split("files/")[1].match(/[a-z0-9]+/);if(u===null)throw new Error(`Could not extract file name from URI ${o}`);o=u[0]}else o.startsWith("files/")&&(o=o.split("files/")[1]);return o}}function Lh(a,e){let t;return a.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function kh(a,e){for(const t of["models","tunedModels","publisherModels"])if(SC(e,t))return e[t];return[]}function SC(a,e){return a!==null&&typeof a=="object"&&e in a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function bC(a,e){const t={},o=c(e,["fps"]);o!=null&&d(t,["fps"],o);const s=c(e,["endOffset"]);s!=null&&d(t,["endOffset"],s);const u=c(e,["startOffset"]);return u!=null&&d(t,["startOffset"],u),t}function _C(a,e){const t={};if(c(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=c(e,["data"]);o!=null&&d(t,["data"],o);const s=c(e,["mimeType"]);return s!=null&&d(t,["mimeType"],s),t}function NC(a,e){const t={};if(c(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=c(e,["fileUri"]);o!=null&&d(t,["fileUri"],o);const s=c(e,["mimeType"]);return s!=null&&d(t,["mimeType"],s),t}function AC(a,e){const t={},o=c(e,["videoMetadata"]);o!=null&&d(t,["videoMetadata"],bC(a,o));const s=c(e,["thought"]);s!=null&&d(t,["thought"],s);const u=c(e,["inlineData"]);u!=null&&d(t,["inlineData"],_C(a,u));const f=c(e,["fileData"]);f!=null&&d(t,["fileData"],NC(a,f));const g=c(e,["codeExecutionResult"]);g!=null&&d(t,["codeExecutionResult"],g);const h=c(e,["executableCode"]);h!=null&&d(t,["executableCode"],h);const p=c(e,["functionCall"]);p!=null&&d(t,["functionCall"],p);const v=c(e,["functionResponse"]);v!=null&&d(t,["functionResponse"],v);const T=c(e,["text"]);return T!=null&&d(t,["text"],T),t}function Vg(a,e){const t={},o=c(e,["parts"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>AC(a,f))),d(t,["parts"],u)}const s=c(e,["role"]);return s!=null&&d(t,["role"],s),t}function wC(a,e){const t={},o=c(e,["behavior"]);o!=null&&d(t,["behavior"],o);const s=c(e,["description"]);s!=null&&d(t,["description"],s);const u=c(e,["name"]);u!=null&&d(t,["name"],u);const f=c(e,["parameters"]);f!=null&&d(t,["parameters"],f);const g=c(e,["response"]);return g!=null&&d(t,["response"],g),t}function IC(a,e){const t={},o=c(e,["startTime"]);o!=null&&d(t,["startTime"],o);const s=c(e,["endTime"]);return s!=null&&d(t,["endTime"],s),t}function RC(a,e){const t={},o=c(e,["timeRangeFilter"]);return o!=null&&d(t,["timeRangeFilter"],IC(a,o)),t}function MC(a,e){const t={},o=c(e,["mode"]);o!=null&&d(t,["mode"],o);const s=c(e,["dynamicThreshold"]);return s!=null&&d(t,["dynamicThreshold"],s),t}function LC(a,e){const t={},o=c(e,["dynamicRetrievalConfig"]);return o!=null&&d(t,["dynamicRetrievalConfig"],MC(a,o)),t}function kC(){return{}}function $C(a,e){const t={},o=c(e,["functionDeclarations"]);if(o!=null){let h=o;Array.isArray(h)&&(h=h.map(p=>wC(a,p))),d(t,["functionDeclarations"],h)}if(c(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=c(e,["googleSearch"]);s!=null&&d(t,["googleSearch"],RC(a,s));const u=c(e,["googleSearchRetrieval"]);if(u!=null&&d(t,["googleSearchRetrieval"],LC(a,u)),c(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(c(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");c(e,["urlContext"])!=null&&d(t,["urlContext"],kC());const g=c(e,["codeExecution"]);return g!=null&&d(t,["codeExecution"],g),t}function PC(a,e){const t={},o=c(e,["mode"]);o!=null&&d(t,["mode"],o);const s=c(e,["allowedFunctionNames"]);return s!=null&&d(t,["allowedFunctionNames"],s),t}function DC(a,e){const t={},o=c(e,["latitude"]);o!=null&&d(t,["latitude"],o);const s=c(e,["longitude"]);return s!=null&&d(t,["longitude"],s),t}function UC(a,e){const t={},o=c(e,["latLng"]);o!=null&&d(t,["latLng"],DC(a,o));const s=c(e,["languageCode"]);return s!=null&&d(t,["languageCode"],s),t}function OC(a,e){const t={},o=c(e,["functionCallingConfig"]);o!=null&&d(t,["functionCallingConfig"],PC(a,o));const s=c(e,["retrievalConfig"]);return s!=null&&d(t,["retrievalConfig"],UC(a,s)),t}function GC(a,e,t){const o={},s=c(e,["ttl"]);t!==void 0&&s!=null&&d(t,["ttl"],s);const u=c(e,["expireTime"]);t!==void 0&&u!=null&&d(t,["expireTime"],u);const f=c(e,["displayName"]);t!==void 0&&f!=null&&d(t,["displayName"],f);const g=c(e,["contents"]);if(t!==void 0&&g!=null){let T=Fn(a,g);Array.isArray(T)&&(T=T.map(C=>Vg(a,C))),d(t,["contents"],T)}const h=c(e,["systemInstruction"]);t!==void 0&&h!=null&&d(t,["systemInstruction"],Vg(a,hn(a,h)));const p=c(e,["tools"]);if(t!==void 0&&p!=null){let T=p;Array.isArray(T)&&(T=T.map(C=>$C(a,C))),d(t,["tools"],T)}const v=c(e,["toolConfig"]);if(t!==void 0&&v!=null&&d(t,["toolConfig"],OC(a,v)),c(e,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return o}function HC(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["model"],bh(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],GC(a,s,t)),t}function VC(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["_url","name"],zi(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function qC(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["_url","name"],zi(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function FC(a,e,t){const o={},s=c(e,["ttl"]);t!==void 0&&s!=null&&d(t,["ttl"],s);const u=c(e,["expireTime"]);return t!==void 0&&u!=null&&d(t,["expireTime"],u),o}function YC(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["_url","name"],zi(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],FC(a,s,t)),t}function BC(a,e,t){const o={},s=c(e,["pageSize"]);t!==void 0&&s!=null&&d(t,["_query","pageSize"],s);const u=c(e,["pageToken"]);return t!==void 0&&u!=null&&d(t,["_query","pageToken"],u),o}function zC(a,e){const t={},o=c(e,["config"]);return o!=null&&d(t,["config"],BC(a,o,t)),t}function JC(a,e){const t={},o=c(e,["fps"]);o!=null&&d(t,["fps"],o);const s=c(e,["endOffset"]);s!=null&&d(t,["endOffset"],s);const u=c(e,["startOffset"]);return u!=null&&d(t,["startOffset"],u),t}function KC(a,e){const t={},o=c(e,["displayName"]);o!=null&&d(t,["displayName"],o);const s=c(e,["data"]);s!=null&&d(t,["data"],s);const u=c(e,["mimeType"]);return u!=null&&d(t,["mimeType"],u),t}function ZC(a,e){const t={},o=c(e,["displayName"]);o!=null&&d(t,["displayName"],o);const s=c(e,["fileUri"]);s!=null&&d(t,["fileUri"],s);const u=c(e,["mimeType"]);return u!=null&&d(t,["mimeType"],u),t}function XC(a,e){const t={},o=c(e,["videoMetadata"]);o!=null&&d(t,["videoMetadata"],JC(a,o));const s=c(e,["thought"]);s!=null&&d(t,["thought"],s);const u=c(e,["inlineData"]);u!=null&&d(t,["inlineData"],KC(a,u));const f=c(e,["fileData"]);f!=null&&d(t,["fileData"],ZC(a,f));const g=c(e,["codeExecutionResult"]);g!=null&&d(t,["codeExecutionResult"],g);const h=c(e,["executableCode"]);h!=null&&d(t,["executableCode"],h);const p=c(e,["functionCall"]);p!=null&&d(t,["functionCall"],p);const v=c(e,["functionResponse"]);v!=null&&d(t,["functionResponse"],v);const T=c(e,["text"]);return T!=null&&d(t,["text"],T),t}function qg(a,e){const t={},o=c(e,["parts"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>XC(a,f))),d(t,["parts"],u)}const s=c(e,["role"]);return s!=null&&d(t,["role"],s),t}function jC(a,e){const t={};if(c(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const o=c(e,["description"]);o!=null&&d(t,["description"],o);const s=c(e,["name"]);s!=null&&d(t,["name"],s);const u=c(e,["parameters"]);u!=null&&d(t,["parameters"],u);const f=c(e,["response"]);return f!=null&&d(t,["response"],f),t}function QC(a,e){const t={},o=c(e,["startTime"]);o!=null&&d(t,["startTime"],o);const s=c(e,["endTime"]);return s!=null&&d(t,["endTime"],s),t}function WC(a,e){const t={},o=c(e,["timeRangeFilter"]);return o!=null&&d(t,["timeRangeFilter"],QC(a,o)),t}function e0(a,e){const t={},o=c(e,["mode"]);o!=null&&d(t,["mode"],o);const s=c(e,["dynamicThreshold"]);return s!=null&&d(t,["dynamicThreshold"],s),t}function t0(a,e){const t={},o=c(e,["dynamicRetrievalConfig"]);return o!=null&&d(t,["dynamicRetrievalConfig"],e0(a,o)),t}function n0(){return{}}function i0(a,e){const t={},o=c(e,["apiKeyString"]);return o!=null&&d(t,["apiKeyString"],o),t}function a0(a,e){const t={},o=c(e,["apiKeyConfig"]);o!=null&&d(t,["apiKeyConfig"],i0(a,o));const s=c(e,["authType"]);s!=null&&d(t,["authType"],s);const u=c(e,["googleServiceAccountConfig"]);u!=null&&d(t,["googleServiceAccountConfig"],u);const f=c(e,["httpBasicAuthConfig"]);f!=null&&d(t,["httpBasicAuthConfig"],f);const g=c(e,["oauthConfig"]);g!=null&&d(t,["oauthConfig"],g);const h=c(e,["oidcConfig"]);return h!=null&&d(t,["oidcConfig"],h),t}function o0(a,e){const t={},o=c(e,["authConfig"]);return o!=null&&d(t,["authConfig"],a0(a,o)),t}function r0(a,e){const t={},o=c(e,["functionDeclarations"]);if(o!=null){let v=o;Array.isArray(v)&&(v=v.map(T=>jC(a,T))),d(t,["functionDeclarations"],v)}const s=c(e,["retrieval"]);s!=null&&d(t,["retrieval"],s);const u=c(e,["googleSearch"]);u!=null&&d(t,["googleSearch"],WC(a,u));const f=c(e,["googleSearchRetrieval"]);f!=null&&d(t,["googleSearchRetrieval"],t0(a,f)),c(e,["enterpriseWebSearch"])!=null&&d(t,["enterpriseWebSearch"],n0());const h=c(e,["googleMaps"]);if(h!=null&&d(t,["googleMaps"],o0(a,h)),c(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const p=c(e,["codeExecution"]);return p!=null&&d(t,["codeExecution"],p),t}function s0(a,e){const t={},o=c(e,["mode"]);o!=null&&d(t,["mode"],o);const s=c(e,["allowedFunctionNames"]);return s!=null&&d(t,["allowedFunctionNames"],s),t}function l0(a,e){const t={},o=c(e,["latitude"]);o!=null&&d(t,["latitude"],o);const s=c(e,["longitude"]);return s!=null&&d(t,["longitude"],s),t}function u0(a,e){const t={},o=c(e,["latLng"]);o!=null&&d(t,["latLng"],l0(a,o));const s=c(e,["languageCode"]);return s!=null&&d(t,["languageCode"],s),t}function c0(a,e){const t={},o=c(e,["functionCallingConfig"]);o!=null&&d(t,["functionCallingConfig"],s0(a,o));const s=c(e,["retrievalConfig"]);return s!=null&&d(t,["retrievalConfig"],u0(a,s)),t}function d0(a,e,t){const o={},s=c(e,["ttl"]);t!==void 0&&s!=null&&d(t,["ttl"],s);const u=c(e,["expireTime"]);t!==void 0&&u!=null&&d(t,["expireTime"],u);const f=c(e,["displayName"]);t!==void 0&&f!=null&&d(t,["displayName"],f);const g=c(e,["contents"]);if(t!==void 0&&g!=null){let C=Fn(a,g);Array.isArray(C)&&(C=C.map(S=>qg(a,S))),d(t,["contents"],C)}const h=c(e,["systemInstruction"]);t!==void 0&&h!=null&&d(t,["systemInstruction"],qg(a,hn(a,h)));const p=c(e,["tools"]);if(t!==void 0&&p!=null){let C=p;Array.isArray(C)&&(C=C.map(S=>r0(a,S))),d(t,["tools"],C)}const v=c(e,["toolConfig"]);t!==void 0&&v!=null&&d(t,["toolConfig"],c0(a,v));const T=c(e,["kmsKeyName"]);return t!==void 0&&T!=null&&d(t,["encryption_spec","kmsKeyName"],T),o}function f0(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["model"],bh(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],d0(a,s,t)),t}function m0(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["_url","name"],zi(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function p0(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["_url","name"],zi(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function g0(a,e,t){const o={},s=c(e,["ttl"]);t!==void 0&&s!=null&&d(t,["ttl"],s);const u=c(e,["expireTime"]);return t!==void 0&&u!=null&&d(t,["expireTime"],u),o}function h0(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["_url","name"],zi(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],g0(a,s,t)),t}function y0(a,e,t){const o={},s=c(e,["pageSize"]);t!==void 0&&s!=null&&d(t,["_query","pageSize"],s);const u=c(e,["pageToken"]);return t!==void 0&&u!=null&&d(t,["_query","pageToken"],u),o}function v0(a,e){const t={},o=c(e,["config"]);return o!=null&&d(t,["config"],y0(a,o,t)),t}function $s(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["name"],o);const s=c(e,["displayName"]);s!=null&&d(t,["displayName"],s);const u=c(e,["model"]);u!=null&&d(t,["model"],u);const f=c(e,["createTime"]);f!=null&&d(t,["createTime"],f);const g=c(e,["updateTime"]);g!=null&&d(t,["updateTime"],g);const h=c(e,["expireTime"]);h!=null&&d(t,["expireTime"],h);const p=c(e,["usageMetadata"]);return p!=null&&d(t,["usageMetadata"],p),t}function T0(){return{}}function C0(a,e){const t={},o=c(e,["nextPageToken"]);o!=null&&d(t,["nextPageToken"],o);const s=c(e,["cachedContents"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(f=>$s(a,f))),d(t,["cachedContents"],u)}return t}function Ps(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["name"],o);const s=c(e,["displayName"]);s!=null&&d(t,["displayName"],s);const u=c(e,["model"]);u!=null&&d(t,["model"],u);const f=c(e,["createTime"]);f!=null&&d(t,["createTime"],f);const g=c(e,["updateTime"]);g!=null&&d(t,["updateTime"],g);const h=c(e,["expireTime"]);h!=null&&d(t,["expireTime"],h);const p=c(e,["usageMetadata"]);return p!=null&&d(t,["usageMetadata"],p),t}function E0(){return{}}function x0(a,e){const t={},o=c(e,["nextPageToken"]);o!=null&&d(t,["nextPageToken"],o);const s=c(e,["cachedContents"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(f=>Ps(a,f))),d(t,["cachedContents"],u)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var lo;(function(a){a.PAGED_ITEM_BATCH_JOBS="batchJobs",a.PAGED_ITEM_MODELS="models",a.PAGED_ITEM_TUNING_JOBS="tuningJobs",a.PAGED_ITEM_FILES="files",a.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(lo||(lo={}));class Xs{constructor(e,t,o,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,o,s)}init(e,t,o){var s,u;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.idxInternal=0;let f={config:{}};o?typeof o=="object"?f=Object.assign({},o):f=o:f={config:{}},f.config&&(f.config.pageToken=t.nextPageToken),this.paramsInternal=f,this.pageInternalSize=(u=(s=f.config)===null||s===void 0?void 0:s.pageSize)!==null&&u!==void 0?u:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class S0 extends hr{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Xs(lo.PAGED_ITEM_CACHED_CONTENTS,o=>this.listInternal(o),await this.listInternal(t),t)}async create(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=f0(this.apiClient,e);return g=De("cachedContents",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>Ps(this.apiClient,v))}else{const p=HC(this.apiClient,e);return g=De("cachedContents",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>$s(this.apiClient,v))}}async get(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=m0(this.apiClient,e);return g=De("{name}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>Ps(this.apiClient,v))}else{const p=VC(this.apiClient,e);return g=De("{name}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>$s(this.apiClient,v))}}async delete(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=p0(this.apiClient,e);return g=De("{name}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(()=>{const v=E0(),T=new Pg;return Object.assign(T,v),T})}else{const p=qC(this.apiClient,e);return g=De("{name}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(()=>{const v=T0(),T=new Pg;return Object.assign(T,v),T})}}async update(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=h0(this.apiClient,e);return g=De("{name}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>Ps(this.apiClient,v))}else{const p=YC(this.apiClient,e);return g=De("{name}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>$s(this.apiClient,v))}}async listInternal(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=v0(this.apiClient,e);return g=De("cachedContents",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>{const T=x0(this.apiClient,v),C=new Dg;return Object.assign(C,T),C})}else{const p=zC(this.apiClient,e);return g=De("cachedContents",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>{const T=C0(this.apiClient,v),C=new Dg;return Object.assign(C,T),C})}}}function Fg(a){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&a[e],o=0;if(t)return t.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&o>=a.length&&(a=void 0),{value:a&&a[o++],done:!a}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Lt(a){return this instanceof Lt?(this.v=a,this):new Lt(a)}function fr(a,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=t.apply(a,e||[]),s,u=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),g("next"),g("throw"),g("return",f),s[Symbol.asyncIterator]=function(){return this},s;function f(S){return function(w){return Promise.resolve(w).then(S,T)}}function g(S,w){o[S]&&(s[S]=function(I){return new Promise(function(b,A){u.push([S,I,b,A])>1||h(S,I)})},w&&(s[S]=w(s[S])))}function h(S,w){try{p(o[S](w))}catch(I){C(u[0][3],I)}}function p(S){S.value instanceof Lt?Promise.resolve(S.value.v).then(v,T):C(u[0][2],S)}function v(S){h("next",S)}function T(S){h("throw",S)}function C(S,w){S(w),u.shift(),u.length&&h(u[0][0],u[0][1])}}function Ds(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=a[Symbol.asyncIterator],t;return e?e.call(a):(a=typeof Fg=="function"?Fg(a):a[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(u){t[u]=a[u]&&function(f){return new Promise(function(g,h){f=a[u](f),s(g,h,f.done,f.value)})}}function s(u,f,g,h){Promise.resolve(h).then(function(p){u({value:p,done:g})},f)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function b0(a){var e;if(a.candidates==null||a.candidates.length===0)return!1;const t=(e=a.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:$h(t)}function $h(a){if(a.parts===void 0||a.parts.length===0)return!1;for(const e of a.parts)if(e===void 0||Object.keys(e).length===0||!e.thought&&e.text!==void 0&&e.text==="")return!1;return!0}function _0(a){if(a.length!==0){for(const e of a)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Yg(a){if(a===void 0||a.length===0)return[];const e=[],t=a.length;let o=0;for(;o<t;)if(a[o].role==="user")e.push(a[o]),o++;else{const s=[];let u=!0;for(;o<t&&a[o].role==="model";)s.push(a[o]),u&&!$h(a[o])&&(u=!1),o++;u?e.push(...s):e.pop()}return e}class N0{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new A0(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class A0{constructor(e,t,o,s={},u=[]){this.apiClient=e,this.modelsModule=t,this.model=o,this.config=s,this.history=u,this.sendPromise=Promise.resolve(),_0(u)}async sendMessage(e){var t;await this.sendPromise;const o=hn(this.apiClient,e.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(o),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var u,f,g;const h=await s,p=(f=(u=h.candidates)===null||u===void 0?void 0:u[0])===null||f===void 0?void 0:f.content,v=h.automaticFunctionCallingHistory,T=this.getHistory(!0).length;let C=[];v!=null&&(C=(g=v.slice(T))!==null&&g!==void 0?g:[]);const S=p?[p]:[];this.recordHistory(o,S,C)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),s}async sendMessageStream(e){var t;await this.sendPromise;const o=hn(this.apiClient,e.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(o),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});const u=await s;return this.processStreamResponse(u,o)}getHistory(e=!1){const t=e?Yg(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var o,s;return fr(this,arguments,function*(){var f,g,h,p;const v=[];try{for(var T=!0,C=Ds(e),S;S=yield Lt(C.next()),f=S.done,!f;T=!0){p=S.value,T=!1;const w=p;if(b0(w)){const I=(s=(o=w.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content;I!==void 0&&v.push(I)}yield yield Lt(w)}}catch(w){g={error:w}}finally{try{!T&&!f&&(h=C.return)&&(yield Lt(h.call(C)))}finally{if(g)throw g.error}}this.recordHistory(t,v)})}recordHistory(e,t,o){let s=[];t.length>0&&t.every(u=>u.role!==void 0)?s=t:s.push({role:"model",parts:[]}),o&&o.length>0?this.history.push(...Yg(o)):this.history.push(e),this.history.push(...s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function w0(a,e,t){const o={},s=c(e,["pageSize"]);t!==void 0&&s!=null&&d(t,["_query","pageSize"],s);const u=c(e,["pageToken"]);return t!==void 0&&u!=null&&d(t,["_query","pageToken"],u),o}function I0(a,e){const t={},o=c(e,["config"]);return o!=null&&d(t,["config"],w0(a,o,t)),t}function R0(a,e){const t={},o=c(e,["details"]);o!=null&&d(t,["details"],o);const s=c(e,["message"]);s!=null&&d(t,["message"],s);const u=c(e,["code"]);return u!=null&&d(t,["code"],u),t}function M0(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["name"],o);const s=c(e,["displayName"]);s!=null&&d(t,["displayName"],s);const u=c(e,["mimeType"]);u!=null&&d(t,["mimeType"],u);const f=c(e,["sizeBytes"]);f!=null&&d(t,["sizeBytes"],f);const g=c(e,["createTime"]);g!=null&&d(t,["createTime"],g);const h=c(e,["expirationTime"]);h!=null&&d(t,["expirationTime"],h);const p=c(e,["updateTime"]);p!=null&&d(t,["updateTime"],p);const v=c(e,["sha256Hash"]);v!=null&&d(t,["sha256Hash"],v);const T=c(e,["uri"]);T!=null&&d(t,["uri"],T);const C=c(e,["downloadUri"]);C!=null&&d(t,["downloadUri"],C);const S=c(e,["state"]);S!=null&&d(t,["state"],S);const w=c(e,["source"]);w!=null&&d(t,["source"],w);const I=c(e,["videoMetadata"]);I!=null&&d(t,["videoMetadata"],I);const b=c(e,["error"]);return b!=null&&d(t,["error"],R0(a,b)),t}function L0(a,e){const t={},o=c(e,["file"]);o!=null&&d(t,["file"],M0(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function k0(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["_url","file"],Mh(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function $0(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["_url","file"],Mh(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function P0(a,e){const t={},o=c(e,["details"]);o!=null&&d(t,["details"],o);const s=c(e,["message"]);s!=null&&d(t,["message"],s);const u=c(e,["code"]);return u!=null&&d(t,["code"],u),t}function bc(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["name"],o);const s=c(e,["displayName"]);s!=null&&d(t,["displayName"],s);const u=c(e,["mimeType"]);u!=null&&d(t,["mimeType"],u);const f=c(e,["sizeBytes"]);f!=null&&d(t,["sizeBytes"],f);const g=c(e,["createTime"]);g!=null&&d(t,["createTime"],g);const h=c(e,["expirationTime"]);h!=null&&d(t,["expirationTime"],h);const p=c(e,["updateTime"]);p!=null&&d(t,["updateTime"],p);const v=c(e,["sha256Hash"]);v!=null&&d(t,["sha256Hash"],v);const T=c(e,["uri"]);T!=null&&d(t,["uri"],T);const C=c(e,["downloadUri"]);C!=null&&d(t,["downloadUri"],C);const S=c(e,["state"]);S!=null&&d(t,["state"],S);const w=c(e,["source"]);w!=null&&d(t,["source"],w);const I=c(e,["videoMetadata"]);I!=null&&d(t,["videoMetadata"],I);const b=c(e,["error"]);return b!=null&&d(t,["error"],P0(a,b)),t}function D0(a,e){const t={},o=c(e,["nextPageToken"]);o!=null&&d(t,["nextPageToken"],o);const s=c(e,["files"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(f=>bc(a,f))),d(t,["files"],u)}return t}function U0(){return{}}function O0(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class G0 extends hr{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Xs(lo.PAGED_ITEM_FILES,o=>this.listInternal(o),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>bc(this.apiClient,t))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,o;let s,u="",f={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const g=I0(this.apiClient,e);return u=De("files",g._url),f=g._query,delete g.config,delete g._url,delete g._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{const p=D0(this.apiClient,h),v=new uC;return Object.assign(v,p),v})}}async createInternal(e){var t,o;let s,u="",f={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const g=L0(this.apiClient,e);return u=De("upload/v1beta/files",g._url),f=g._query,delete g.config,delete g._url,delete g._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(()=>{const h=U0(),p=new cC;return Object.assign(p,h),p})}}async get(e){var t,o;let s,u="",f={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const g=k0(this.apiClient,e);return u=De("files/{file}",g._url),f=g._query,delete g.config,delete g._url,delete g._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(g),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>bc(this.apiClient,h))}}async delete(e){var t,o;let s,u="",f={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const g=$0(this.apiClient,e);return u=De("files/{file}",g._url),f=g._query,delete g.config,delete g._url,delete g._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(()=>{const h=O0(),p=new dC;return Object.assign(p,h),p})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function H0(a,e){const t={},o=c(e,["voiceName"]);return o!=null&&d(t,["voiceName"],o),t}function V0(a,e){const t={},o=c(e,["voiceName"]);return o!=null&&d(t,["voiceName"],o),t}function Ph(a,e){const t={},o=c(e,["prebuiltVoiceConfig"]);return o!=null&&d(t,["prebuiltVoiceConfig"],H0(a,o)),t}function q0(a,e){const t={},o=c(e,["prebuiltVoiceConfig"]);return o!=null&&d(t,["prebuiltVoiceConfig"],V0(a,o)),t}function F0(a,e){const t={},o=c(e,["speaker"]);o!=null&&d(t,["speaker"],o);const s=c(e,["voiceConfig"]);return s!=null&&d(t,["voiceConfig"],Ph(a,s)),t}function Y0(a,e){const t={},o=c(e,["speakerVoiceConfigs"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>F0(a,u))),d(t,["speakerVoiceConfigs"],s)}return t}function B0(a,e){const t={},o=c(e,["voiceConfig"]);o!=null&&d(t,["voiceConfig"],Ph(a,o));const s=c(e,["multiSpeakerVoiceConfig"]);s!=null&&d(t,["multiSpeakerVoiceConfig"],Y0(a,s));const u=c(e,["languageCode"]);return u!=null&&d(t,["languageCode"],u),t}function z0(a,e){const t={},o=c(e,["voiceConfig"]);if(o!=null&&d(t,["voiceConfig"],q0(a,o)),c(e,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const s=c(e,["languageCode"]);return s!=null&&d(t,["languageCode"],s),t}function J0(a,e){const t={},o=c(e,["fps"]);o!=null&&d(t,["fps"],o);const s=c(e,["endOffset"]);s!=null&&d(t,["endOffset"],s);const u=c(e,["startOffset"]);return u!=null&&d(t,["startOffset"],u),t}function K0(a,e){const t={},o=c(e,["fps"]);o!=null&&d(t,["fps"],o);const s=c(e,["endOffset"]);s!=null&&d(t,["endOffset"],s);const u=c(e,["startOffset"]);return u!=null&&d(t,["startOffset"],u),t}function Z0(a,e){const t={};if(c(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=c(e,["data"]);o!=null&&d(t,["data"],o);const s=c(e,["mimeType"]);return s!=null&&d(t,["mimeType"],s),t}function X0(a,e){const t={},o=c(e,["displayName"]);o!=null&&d(t,["displayName"],o);const s=c(e,["data"]);s!=null&&d(t,["data"],s);const u=c(e,["mimeType"]);return u!=null&&d(t,["mimeType"],u),t}function j0(a,e){const t={};if(c(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=c(e,["fileUri"]);o!=null&&d(t,["fileUri"],o);const s=c(e,["mimeType"]);return s!=null&&d(t,["mimeType"],s),t}function Q0(a,e){const t={},o=c(e,["displayName"]);o!=null&&d(t,["displayName"],o);const s=c(e,["fileUri"]);s!=null&&d(t,["fileUri"],s);const u=c(e,["mimeType"]);return u!=null&&d(t,["mimeType"],u),t}function W0(a,e){const t={},o=c(e,["videoMetadata"]);o!=null&&d(t,["videoMetadata"],J0(a,o));const s=c(e,["thought"]);s!=null&&d(t,["thought"],s);const u=c(e,["inlineData"]);u!=null&&d(t,["inlineData"],Z0(a,u));const f=c(e,["fileData"]);f!=null&&d(t,["fileData"],j0(a,f));const g=c(e,["codeExecutionResult"]);g!=null&&d(t,["codeExecutionResult"],g);const h=c(e,["executableCode"]);h!=null&&d(t,["executableCode"],h);const p=c(e,["functionCall"]);p!=null&&d(t,["functionCall"],p);const v=c(e,["functionResponse"]);v!=null&&d(t,["functionResponse"],v);const T=c(e,["text"]);return T!=null&&d(t,["text"],T),t}function eE(a,e){const t={},o=c(e,["videoMetadata"]);o!=null&&d(t,["videoMetadata"],K0(a,o));const s=c(e,["thought"]);s!=null&&d(t,["thought"],s);const u=c(e,["inlineData"]);u!=null&&d(t,["inlineData"],X0(a,u));const f=c(e,["fileData"]);f!=null&&d(t,["fileData"],Q0(a,f));const g=c(e,["codeExecutionResult"]);g!=null&&d(t,["codeExecutionResult"],g);const h=c(e,["executableCode"]);h!=null&&d(t,["executableCode"],h);const p=c(e,["functionCall"]);p!=null&&d(t,["functionCall"],p);const v=c(e,["functionResponse"]);v!=null&&d(t,["functionResponse"],v);const T=c(e,["text"]);return T!=null&&d(t,["text"],T),t}function tE(a,e){const t={},o=c(e,["parts"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>W0(a,f))),d(t,["parts"],u)}const s=c(e,["role"]);return s!=null&&d(t,["role"],s),t}function nE(a,e){const t={},o=c(e,["parts"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>eE(a,f))),d(t,["parts"],u)}const s=c(e,["role"]);return s!=null&&d(t,["role"],s),t}function iE(a,e){const t={},o=c(e,["behavior"]);o!=null&&d(t,["behavior"],o);const s=c(e,["description"]);s!=null&&d(t,["description"],s);const u=c(e,["name"]);u!=null&&d(t,["name"],u);const f=c(e,["parameters"]);f!=null&&d(t,["parameters"],f);const g=c(e,["response"]);return g!=null&&d(t,["response"],g),t}function aE(a,e){const t={};if(c(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const o=c(e,["description"]);o!=null&&d(t,["description"],o);const s=c(e,["name"]);s!=null&&d(t,["name"],s);const u=c(e,["parameters"]);u!=null&&d(t,["parameters"],u);const f=c(e,["response"]);return f!=null&&d(t,["response"],f),t}function oE(a,e){const t={},o=c(e,["startTime"]);o!=null&&d(t,["startTime"],o);const s=c(e,["endTime"]);return s!=null&&d(t,["endTime"],s),t}function rE(a,e){const t={},o=c(e,["startTime"]);o!=null&&d(t,["startTime"],o);const s=c(e,["endTime"]);return s!=null&&d(t,["endTime"],s),t}function sE(a,e){const t={},o=c(e,["timeRangeFilter"]);return o!=null&&d(t,["timeRangeFilter"],oE(a,o)),t}function lE(a,e){const t={},o=c(e,["timeRangeFilter"]);return o!=null&&d(t,["timeRangeFilter"],rE(a,o)),t}function uE(a,e){const t={},o=c(e,["mode"]);o!=null&&d(t,["mode"],o);const s=c(e,["dynamicThreshold"]);return s!=null&&d(t,["dynamicThreshold"],s),t}function cE(a,e){const t={},o=c(e,["mode"]);o!=null&&d(t,["mode"],o);const s=c(e,["dynamicThreshold"]);return s!=null&&d(t,["dynamicThreshold"],s),t}function dE(a,e){const t={},o=c(e,["dynamicRetrievalConfig"]);return o!=null&&d(t,["dynamicRetrievalConfig"],uE(a,o)),t}function fE(a,e){const t={},o=c(e,["dynamicRetrievalConfig"]);return o!=null&&d(t,["dynamicRetrievalConfig"],cE(a,o)),t}function mE(){return{}}function pE(a,e){const t={},o=c(e,["apiKeyString"]);return o!=null&&d(t,["apiKeyString"],o),t}function gE(a,e){const t={},o=c(e,["apiKeyConfig"]);o!=null&&d(t,["apiKeyConfig"],pE(a,o));const s=c(e,["authType"]);s!=null&&d(t,["authType"],s);const u=c(e,["googleServiceAccountConfig"]);u!=null&&d(t,["googleServiceAccountConfig"],u);const f=c(e,["httpBasicAuthConfig"]);f!=null&&d(t,["httpBasicAuthConfig"],f);const g=c(e,["oauthConfig"]);g!=null&&d(t,["oauthConfig"],g);const h=c(e,["oidcConfig"]);return h!=null&&d(t,["oidcConfig"],h),t}function hE(a,e){const t={},o=c(e,["authConfig"]);return o!=null&&d(t,["authConfig"],gE(a,o)),t}function yE(){return{}}function vE(a,e){const t={},o=c(e,["functionDeclarations"]);if(o!=null){let h=o;Array.isArray(h)&&(h=h.map(p=>iE(a,p))),d(t,["functionDeclarations"],h)}if(c(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=c(e,["googleSearch"]);s!=null&&d(t,["googleSearch"],sE(a,s));const u=c(e,["googleSearchRetrieval"]);if(u!=null&&d(t,["googleSearchRetrieval"],dE(a,u)),c(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(c(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");c(e,["urlContext"])!=null&&d(t,["urlContext"],yE());const g=c(e,["codeExecution"]);return g!=null&&d(t,["codeExecution"],g),t}function TE(a,e){const t={},o=c(e,["functionDeclarations"]);if(o!=null){let v=o;Array.isArray(v)&&(v=v.map(T=>aE(a,T))),d(t,["functionDeclarations"],v)}const s=c(e,["retrieval"]);s!=null&&d(t,["retrieval"],s);const u=c(e,["googleSearch"]);u!=null&&d(t,["googleSearch"],lE(a,u));const f=c(e,["googleSearchRetrieval"]);f!=null&&d(t,["googleSearchRetrieval"],fE(a,f)),c(e,["enterpriseWebSearch"])!=null&&d(t,["enterpriseWebSearch"],mE());const h=c(e,["googleMaps"]);if(h!=null&&d(t,["googleMaps"],hE(a,h)),c(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const p=c(e,["codeExecution"]);return p!=null&&d(t,["codeExecution"],p),t}function CE(a,e){const t={},o=c(e,["handle"]);if(o!=null&&d(t,["handle"],o),c(e,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function EE(a,e){const t={},o=c(e,["handle"]);o!=null&&d(t,["handle"],o);const s=c(e,["transparent"]);return s!=null&&d(t,["transparent"],s),t}function Bg(){return{}}function zg(){return{}}function xE(a,e){const t={},o=c(e,["disabled"]);o!=null&&d(t,["disabled"],o);const s=c(e,["startOfSpeechSensitivity"]);s!=null&&d(t,["startOfSpeechSensitivity"],s);const u=c(e,["endOfSpeechSensitivity"]);u!=null&&d(t,["endOfSpeechSensitivity"],u);const f=c(e,["prefixPaddingMs"]);f!=null&&d(t,["prefixPaddingMs"],f);const g=c(e,["silenceDurationMs"]);return g!=null&&d(t,["silenceDurationMs"],g),t}function SE(a,e){const t={},o=c(e,["disabled"]);o!=null&&d(t,["disabled"],o);const s=c(e,["startOfSpeechSensitivity"]);s!=null&&d(t,["startOfSpeechSensitivity"],s);const u=c(e,["endOfSpeechSensitivity"]);u!=null&&d(t,["endOfSpeechSensitivity"],u);const f=c(e,["prefixPaddingMs"]);f!=null&&d(t,["prefixPaddingMs"],f);const g=c(e,["silenceDurationMs"]);return g!=null&&d(t,["silenceDurationMs"],g),t}function bE(a,e){const t={},o=c(e,["automaticActivityDetection"]);o!=null&&d(t,["automaticActivityDetection"],xE(a,o));const s=c(e,["activityHandling"]);s!=null&&d(t,["activityHandling"],s);const u=c(e,["turnCoverage"]);return u!=null&&d(t,["turnCoverage"],u),t}function _E(a,e){const t={},o=c(e,["automaticActivityDetection"]);o!=null&&d(t,["automaticActivityDetection"],SE(a,o));const s=c(e,["activityHandling"]);s!=null&&d(t,["activityHandling"],s);const u=c(e,["turnCoverage"]);return u!=null&&d(t,["turnCoverage"],u),t}function NE(a,e){const t={},o=c(e,["targetTokens"]);return o!=null&&d(t,["targetTokens"],o),t}function AE(a,e){const t={},o=c(e,["targetTokens"]);return o!=null&&d(t,["targetTokens"],o),t}function wE(a,e){const t={},o=c(e,["triggerTokens"]);o!=null&&d(t,["triggerTokens"],o);const s=c(e,["slidingWindow"]);return s!=null&&d(t,["slidingWindow"],NE(a,s)),t}function IE(a,e){const t={},o=c(e,["triggerTokens"]);o!=null&&d(t,["triggerTokens"],o);const s=c(e,["slidingWindow"]);return s!=null&&d(t,["slidingWindow"],AE(a,s)),t}function RE(a,e){const t={},o=c(e,["proactiveAudio"]);return o!=null&&d(t,["proactiveAudio"],o),t}function ME(a,e){const t={},o=c(e,["proactiveAudio"]);return o!=null&&d(t,["proactiveAudio"],o),t}function LE(a,e,t){const o={},s=c(e,["generationConfig"]);t!==void 0&&s!=null&&d(t,["setup","generationConfig"],s);const u=c(e,["responseModalities"]);t!==void 0&&u!=null&&d(t,["setup","generationConfig","responseModalities"],u);const f=c(e,["temperature"]);t!==void 0&&f!=null&&d(t,["setup","generationConfig","temperature"],f);const g=c(e,["topP"]);t!==void 0&&g!=null&&d(t,["setup","generationConfig","topP"],g);const h=c(e,["topK"]);t!==void 0&&h!=null&&d(t,["setup","generationConfig","topK"],h);const p=c(e,["maxOutputTokens"]);t!==void 0&&p!=null&&d(t,["setup","generationConfig","maxOutputTokens"],p);const v=c(e,["mediaResolution"]);t!==void 0&&v!=null&&d(t,["setup","generationConfig","mediaResolution"],v);const T=c(e,["seed"]);t!==void 0&&T!=null&&d(t,["setup","generationConfig","seed"],T);const C=c(e,["speechConfig"]);t!==void 0&&C!=null&&d(t,["setup","generationConfig","speechConfig"],B0(a,Ih(a,C)));const S=c(e,["enableAffectiveDialog"]);t!==void 0&&S!=null&&d(t,["setup","generationConfig","enableAffectiveDialog"],S);const w=c(e,["systemInstruction"]);t!==void 0&&w!=null&&d(t,["setup","systemInstruction"],tE(a,hn(a,w)));const I=c(e,["tools"]);if(t!==void 0&&I!=null){let V=Zs(a,I);Array.isArray(V)&&(V=V.map(Q=>vE(a,Ks(a,Q)))),d(t,["setup","tools"],V)}const b=c(e,["sessionResumption"]);t!==void 0&&b!=null&&d(t,["setup","sessionResumption"],CE(a,b));const A=c(e,["inputAudioTranscription"]);t!==void 0&&A!=null&&d(t,["setup","inputAudioTranscription"],Bg());const M=c(e,["outputAudioTranscription"]);t!==void 0&&M!=null&&d(t,["setup","outputAudioTranscription"],Bg());const L=c(e,["realtimeInputConfig"]);t!==void 0&&L!=null&&d(t,["setup","realtimeInputConfig"],bE(a,L));const R=c(e,["contextWindowCompression"]);t!==void 0&&R!=null&&d(t,["setup","contextWindowCompression"],wE(a,R));const $=c(e,["proactivity"]);return t!==void 0&&$!=null&&d(t,["setup","proactivity"],RE(a,$)),o}function kE(a,e,t){const o={},s=c(e,["generationConfig"]);t!==void 0&&s!=null&&d(t,["setup","generationConfig"],s);const u=c(e,["responseModalities"]);t!==void 0&&u!=null&&d(t,["setup","generationConfig","responseModalities"],u);const f=c(e,["temperature"]);t!==void 0&&f!=null&&d(t,["setup","generationConfig","temperature"],f);const g=c(e,["topP"]);t!==void 0&&g!=null&&d(t,["setup","generationConfig","topP"],g);const h=c(e,["topK"]);t!==void 0&&h!=null&&d(t,["setup","generationConfig","topK"],h);const p=c(e,["maxOutputTokens"]);t!==void 0&&p!=null&&d(t,["setup","generationConfig","maxOutputTokens"],p);const v=c(e,["mediaResolution"]);t!==void 0&&v!=null&&d(t,["setup","generationConfig","mediaResolution"],v);const T=c(e,["seed"]);t!==void 0&&T!=null&&d(t,["setup","generationConfig","seed"],T);const C=c(e,["speechConfig"]);t!==void 0&&C!=null&&d(t,["setup","generationConfig","speechConfig"],z0(a,Ih(a,C)));const S=c(e,["enableAffectiveDialog"]);t!==void 0&&S!=null&&d(t,["setup","generationConfig","enableAffectiveDialog"],S);const w=c(e,["systemInstruction"]);t!==void 0&&w!=null&&d(t,["setup","systemInstruction"],nE(a,hn(a,w)));const I=c(e,["tools"]);if(t!==void 0&&I!=null){let V=Zs(a,I);Array.isArray(V)&&(V=V.map(Q=>TE(a,Ks(a,Q)))),d(t,["setup","tools"],V)}const b=c(e,["sessionResumption"]);t!==void 0&&b!=null&&d(t,["setup","sessionResumption"],EE(a,b));const A=c(e,["inputAudioTranscription"]);t!==void 0&&A!=null&&d(t,["setup","inputAudioTranscription"],zg());const M=c(e,["outputAudioTranscription"]);t!==void 0&&M!=null&&d(t,["setup","outputAudioTranscription"],zg());const L=c(e,["realtimeInputConfig"]);t!==void 0&&L!=null&&d(t,["setup","realtimeInputConfig"],_E(a,L));const R=c(e,["contextWindowCompression"]);t!==void 0&&R!=null&&d(t,["setup","contextWindowCompression"],IE(a,R));const $=c(e,["proactivity"]);return t!==void 0&&$!=null&&d(t,["setup","proactivity"],ME(a,$)),o}function $E(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["setup","model"],wt(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],LE(a,s,t)),t}function PE(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["setup","model"],wt(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],kE(a,s,t)),t}function DE(){return{}}function UE(){return{}}function OE(){return{}}function GE(){return{}}function HE(a,e){const t={},o=c(e,["media"]);o!=null&&d(t,["mediaChunks"],_h(a,o));const s=c(e,["audio"]);s!=null&&d(t,["audio"],gC(a,s));const u=c(e,["audioStreamEnd"]);u!=null&&d(t,["audioStreamEnd"],u);const f=c(e,["video"]);f!=null&&d(t,["video"],pC(a,f));const g=c(e,["text"]);return g!=null&&d(t,["text"],g),c(e,["activityStart"])!=null&&d(t,["activityStart"],DE()),c(e,["activityEnd"])!=null&&d(t,["activityEnd"],OE()),t}function VE(a,e){const t={},o=c(e,["media"]);if(o!=null&&d(t,["mediaChunks"],_h(a,o)),c(e,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const s=c(e,["audioStreamEnd"]);if(s!=null&&d(t,["audioStreamEnd"],s),c(e,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(c(e,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return c(e,["activityStart"])!=null&&d(t,["activityStart"],UE()),c(e,["activityEnd"])!=null&&d(t,["activityEnd"],GE()),t}function Dh(a,e){const t={},o=c(e,["text"]);o!=null&&d(t,["text"],o);const s=c(e,["weight"]);return s!=null&&d(t,["weight"],s),t}function qE(a,e){const t={},o=c(e,["weightedPrompts"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>Dh(a,u))),d(t,["weightedPrompts"],s)}return t}function Uh(a,e){const t={},o=c(e,["temperature"]);o!=null&&d(t,["temperature"],o);const s=c(e,["topK"]);s!=null&&d(t,["topK"],s);const u=c(e,["seed"]);u!=null&&d(t,["seed"],u);const f=c(e,["guidance"]);f!=null&&d(t,["guidance"],f);const g=c(e,["bpm"]);g!=null&&d(t,["bpm"],g);const h=c(e,["density"]);h!=null&&d(t,["density"],h);const p=c(e,["brightness"]);p!=null&&d(t,["brightness"],p);const v=c(e,["scale"]);v!=null&&d(t,["scale"],v);const T=c(e,["muteBass"]);T!=null&&d(t,["muteBass"],T);const C=c(e,["muteDrums"]);C!=null&&d(t,["muteDrums"],C);const S=c(e,["onlyBassAndDrums"]);return S!=null&&d(t,["onlyBassAndDrums"],S),t}function FE(a,e){const t={},o=c(e,["musicGenerationConfig"]);return o!=null&&d(t,["musicGenerationConfig"],Uh(a,o)),t}function Oh(a,e){const t={},o=c(e,["model"]);return o!=null&&d(t,["model"],o),t}function Gh(a,e){const t={},o=c(e,["weightedPrompts"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>Dh(a,u))),d(t,["weightedPrompts"],s)}return t}function _c(a,e){const t={},o=c(e,["setup"]);o!=null&&d(t,["setup"],Oh(a,o));const s=c(e,["clientContent"]);s!=null&&d(t,["clientContent"],Gh(a,s));const u=c(e,["musicGenerationConfig"]);u!=null&&d(t,["musicGenerationConfig"],Uh(a,u));const f=c(e,["playbackControl"]);return f!=null&&d(t,["playbackControl"],f),t}function YE(){return{}}function BE(){return{}}function zE(a,e){const t={},o=c(e,["fps"]);o!=null&&d(t,["fps"],o);const s=c(e,["endOffset"]);s!=null&&d(t,["endOffset"],s);const u=c(e,["startOffset"]);return u!=null&&d(t,["startOffset"],u),t}function JE(a,e){const t={},o=c(e,["fps"]);o!=null&&d(t,["fps"],o);const s=c(e,["endOffset"]);s!=null&&d(t,["endOffset"],s);const u=c(e,["startOffset"]);return u!=null&&d(t,["startOffset"],u),t}function KE(a,e){const t={},o=c(e,["data"]);o!=null&&d(t,["data"],o);const s=c(e,["mimeType"]);return s!=null&&d(t,["mimeType"],s),t}function ZE(a,e){const t={},o=c(e,["displayName"]);o!=null&&d(t,["displayName"],o);const s=c(e,["data"]);s!=null&&d(t,["data"],s);const u=c(e,["mimeType"]);return u!=null&&d(t,["mimeType"],u),t}function XE(a,e){const t={},o=c(e,["fileUri"]);o!=null&&d(t,["fileUri"],o);const s=c(e,["mimeType"]);return s!=null&&d(t,["mimeType"],s),t}function jE(a,e){const t={},o=c(e,["displayName"]);o!=null&&d(t,["displayName"],o);const s=c(e,["fileUri"]);s!=null&&d(t,["fileUri"],s);const u=c(e,["mimeType"]);return u!=null&&d(t,["mimeType"],u),t}function QE(a,e){const t={},o=c(e,["videoMetadata"]);o!=null&&d(t,["videoMetadata"],zE(a,o));const s=c(e,["thought"]);s!=null&&d(t,["thought"],s);const u=c(e,["inlineData"]);u!=null&&d(t,["inlineData"],KE(a,u));const f=c(e,["fileData"]);f!=null&&d(t,["fileData"],XE(a,f));const g=c(e,["codeExecutionResult"]);g!=null&&d(t,["codeExecutionResult"],g);const h=c(e,["executableCode"]);h!=null&&d(t,["executableCode"],h);const p=c(e,["functionCall"]);p!=null&&d(t,["functionCall"],p);const v=c(e,["functionResponse"]);v!=null&&d(t,["functionResponse"],v);const T=c(e,["text"]);return T!=null&&d(t,["text"],T),t}function WE(a,e){const t={},o=c(e,["videoMetadata"]);o!=null&&d(t,["videoMetadata"],JE(a,o));const s=c(e,["thought"]);s!=null&&d(t,["thought"],s);const u=c(e,["inlineData"]);u!=null&&d(t,["inlineData"],ZE(a,u));const f=c(e,["fileData"]);f!=null&&d(t,["fileData"],jE(a,f));const g=c(e,["codeExecutionResult"]);g!=null&&d(t,["codeExecutionResult"],g);const h=c(e,["executableCode"]);h!=null&&d(t,["executableCode"],h);const p=c(e,["functionCall"]);p!=null&&d(t,["functionCall"],p);const v=c(e,["functionResponse"]);v!=null&&d(t,["functionResponse"],v);const T=c(e,["text"]);return T!=null&&d(t,["text"],T),t}function ex(a,e){const t={},o=c(e,["parts"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>QE(a,f))),d(t,["parts"],u)}const s=c(e,["role"]);return s!=null&&d(t,["role"],s),t}function tx(a,e){const t={},o=c(e,["parts"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>WE(a,f))),d(t,["parts"],u)}const s=c(e,["role"]);return s!=null&&d(t,["role"],s),t}function Jg(a,e){const t={},o=c(e,["text"]);o!=null&&d(t,["text"],o);const s=c(e,["finished"]);return s!=null&&d(t,["finished"],s),t}function Kg(a,e){const t={},o=c(e,["text"]);o!=null&&d(t,["text"],o);const s=c(e,["finished"]);return s!=null&&d(t,["finished"],s),t}function nx(a,e){const t={},o=c(e,["retrievedUrl"]);o!=null&&d(t,["retrievedUrl"],o);const s=c(e,["urlRetrievalStatus"]);return s!=null&&d(t,["urlRetrievalStatus"],s),t}function ix(a,e){const t={},o=c(e,["urlMetadata"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>nx(a,u))),d(t,["urlMetadata"],s)}return t}function ax(a,e){const t={},o=c(e,["modelTurn"]);o!=null&&d(t,["modelTurn"],ex(a,o));const s=c(e,["turnComplete"]);s!=null&&d(t,["turnComplete"],s);const u=c(e,["interrupted"]);u!=null&&d(t,["interrupted"],u);const f=c(e,["groundingMetadata"]);f!=null&&d(t,["groundingMetadata"],f);const g=c(e,["generationComplete"]);g!=null&&d(t,["generationComplete"],g);const h=c(e,["inputTranscription"]);h!=null&&d(t,["inputTranscription"],Jg(a,h));const p=c(e,["outputTranscription"]);p!=null&&d(t,["outputTranscription"],Jg(a,p));const v=c(e,["urlContextMetadata"]);return v!=null&&d(t,["urlContextMetadata"],ix(a,v)),t}function ox(a,e){const t={},o=c(e,["modelTurn"]);o!=null&&d(t,["modelTurn"],tx(a,o));const s=c(e,["turnComplete"]);s!=null&&d(t,["turnComplete"],s);const u=c(e,["interrupted"]);u!=null&&d(t,["interrupted"],u);const f=c(e,["groundingMetadata"]);f!=null&&d(t,["groundingMetadata"],f);const g=c(e,["generationComplete"]);g!=null&&d(t,["generationComplete"],g);const h=c(e,["inputTranscription"]);h!=null&&d(t,["inputTranscription"],Kg(a,h));const p=c(e,["outputTranscription"]);return p!=null&&d(t,["outputTranscription"],Kg(a,p)),t}function rx(a,e){const t={},o=c(e,["id"]);o!=null&&d(t,["id"],o);const s=c(e,["args"]);s!=null&&d(t,["args"],s);const u=c(e,["name"]);return u!=null&&d(t,["name"],u),t}function sx(a,e){const t={},o=c(e,["args"]);o!=null&&d(t,["args"],o);const s=c(e,["name"]);return s!=null&&d(t,["name"],s),t}function lx(a,e){const t={},o=c(e,["functionCalls"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>rx(a,u))),d(t,["functionCalls"],s)}return t}function ux(a,e){const t={},o=c(e,["functionCalls"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>sx(a,u))),d(t,["functionCalls"],s)}return t}function cx(a,e){const t={},o=c(e,["ids"]);return o!=null&&d(t,["ids"],o),t}function dx(a,e){const t={},o=c(e,["ids"]);return o!=null&&d(t,["ids"],o),t}function Is(a,e){const t={},o=c(e,["modality"]);o!=null&&d(t,["modality"],o);const s=c(e,["tokenCount"]);return s!=null&&d(t,["tokenCount"],s),t}function Rs(a,e){const t={},o=c(e,["modality"]);o!=null&&d(t,["modality"],o);const s=c(e,["tokenCount"]);return s!=null&&d(t,["tokenCount"],s),t}function fx(a,e){const t={},o=c(e,["promptTokenCount"]);o!=null&&d(t,["promptTokenCount"],o);const s=c(e,["cachedContentTokenCount"]);s!=null&&d(t,["cachedContentTokenCount"],s);const u=c(e,["responseTokenCount"]);u!=null&&d(t,["responseTokenCount"],u);const f=c(e,["toolUsePromptTokenCount"]);f!=null&&d(t,["toolUsePromptTokenCount"],f);const g=c(e,["thoughtsTokenCount"]);g!=null&&d(t,["thoughtsTokenCount"],g);const h=c(e,["totalTokenCount"]);h!=null&&d(t,["totalTokenCount"],h);const p=c(e,["promptTokensDetails"]);if(p!=null){let S=p;Array.isArray(S)&&(S=S.map(w=>Is(a,w))),d(t,["promptTokensDetails"],S)}const v=c(e,["cacheTokensDetails"]);if(v!=null){let S=v;Array.isArray(S)&&(S=S.map(w=>Is(a,w))),d(t,["cacheTokensDetails"],S)}const T=c(e,["responseTokensDetails"]);if(T!=null){let S=T;Array.isArray(S)&&(S=S.map(w=>Is(a,w))),d(t,["responseTokensDetails"],S)}const C=c(e,["toolUsePromptTokensDetails"]);if(C!=null){let S=C;Array.isArray(S)&&(S=S.map(w=>Is(a,w))),d(t,["toolUsePromptTokensDetails"],S)}return t}function mx(a,e){const t={},o=c(e,["promptTokenCount"]);o!=null&&d(t,["promptTokenCount"],o);const s=c(e,["cachedContentTokenCount"]);s!=null&&d(t,["cachedContentTokenCount"],s);const u=c(e,["candidatesTokenCount"]);u!=null&&d(t,["responseTokenCount"],u);const f=c(e,["toolUsePromptTokenCount"]);f!=null&&d(t,["toolUsePromptTokenCount"],f);const g=c(e,["thoughtsTokenCount"]);g!=null&&d(t,["thoughtsTokenCount"],g);const h=c(e,["totalTokenCount"]);h!=null&&d(t,["totalTokenCount"],h);const p=c(e,["promptTokensDetails"]);if(p!=null){let w=p;Array.isArray(w)&&(w=w.map(I=>Rs(a,I))),d(t,["promptTokensDetails"],w)}const v=c(e,["cacheTokensDetails"]);if(v!=null){let w=v;Array.isArray(w)&&(w=w.map(I=>Rs(a,I))),d(t,["cacheTokensDetails"],w)}const T=c(e,["candidatesTokensDetails"]);if(T!=null){let w=T;Array.isArray(w)&&(w=w.map(I=>Rs(a,I))),d(t,["responseTokensDetails"],w)}const C=c(e,["toolUsePromptTokensDetails"]);if(C!=null){let w=C;Array.isArray(w)&&(w=w.map(I=>Rs(a,I))),d(t,["toolUsePromptTokensDetails"],w)}const S=c(e,["trafficType"]);return S!=null&&d(t,["trafficType"],S),t}function px(a,e){const t={},o=c(e,["timeLeft"]);return o!=null&&d(t,["timeLeft"],o),t}function gx(a,e){const t={},o=c(e,["timeLeft"]);return o!=null&&d(t,["timeLeft"],o),t}function hx(a,e){const t={},o=c(e,["newHandle"]);o!=null&&d(t,["newHandle"],o);const s=c(e,["resumable"]);s!=null&&d(t,["resumable"],s);const u=c(e,["lastConsumedClientMessageIndex"]);return u!=null&&d(t,["lastConsumedClientMessageIndex"],u),t}function yx(a,e){const t={},o=c(e,["newHandle"]);o!=null&&d(t,["newHandle"],o);const s=c(e,["resumable"]);s!=null&&d(t,["resumable"],s);const u=c(e,["lastConsumedClientMessageIndex"]);return u!=null&&d(t,["lastConsumedClientMessageIndex"],u),t}function vx(a,e){const t={};c(e,["setupComplete"])!=null&&d(t,["setupComplete"],YE());const s=c(e,["serverContent"]);s!=null&&d(t,["serverContent"],ax(a,s));const u=c(e,["toolCall"]);u!=null&&d(t,["toolCall"],lx(a,u));const f=c(e,["toolCallCancellation"]);f!=null&&d(t,["toolCallCancellation"],cx(a,f));const g=c(e,["usageMetadata"]);g!=null&&d(t,["usageMetadata"],fx(a,g));const h=c(e,["goAway"]);h!=null&&d(t,["goAway"],px(a,h));const p=c(e,["sessionResumptionUpdate"]);return p!=null&&d(t,["sessionResumptionUpdate"],hx(a,p)),t}function Tx(a,e){const t={};c(e,["setupComplete"])!=null&&d(t,["setupComplete"],BE());const s=c(e,["serverContent"]);s!=null&&d(t,["serverContent"],ox(a,s));const u=c(e,["toolCall"]);u!=null&&d(t,["toolCall"],ux(a,u));const f=c(e,["toolCallCancellation"]);f!=null&&d(t,["toolCallCancellation"],dx(a,f));const g=c(e,["usageMetadata"]);g!=null&&d(t,["usageMetadata"],mx(a,g));const h=c(e,["goAway"]);h!=null&&d(t,["goAway"],gx(a,h));const p=c(e,["sessionResumptionUpdate"]);return p!=null&&d(t,["sessionResumptionUpdate"],yx(a,p)),t}function Cx(){return{}}function Ex(a,e){const t={},o=c(e,["text"]);o!=null&&d(t,["text"],o);const s=c(e,["weight"]);return s!=null&&d(t,["weight"],s),t}function xx(a,e){const t={},o=c(e,["weightedPrompts"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>Ex(a,u))),d(t,["weightedPrompts"],s)}return t}function Sx(a,e){const t={},o=c(e,["temperature"]);o!=null&&d(t,["temperature"],o);const s=c(e,["topK"]);s!=null&&d(t,["topK"],s);const u=c(e,["seed"]);u!=null&&d(t,["seed"],u);const f=c(e,["guidance"]);f!=null&&d(t,["guidance"],f);const g=c(e,["bpm"]);g!=null&&d(t,["bpm"],g);const h=c(e,["density"]);h!=null&&d(t,["density"],h);const p=c(e,["brightness"]);p!=null&&d(t,["brightness"],p);const v=c(e,["scale"]);v!=null&&d(t,["scale"],v);const T=c(e,["muteBass"]);T!=null&&d(t,["muteBass"],T);const C=c(e,["muteDrums"]);C!=null&&d(t,["muteDrums"],C);const S=c(e,["onlyBassAndDrums"]);return S!=null&&d(t,["onlyBassAndDrums"],S),t}function bx(a,e){const t={},o=c(e,["clientContent"]);o!=null&&d(t,["clientContent"],xx(a,o));const s=c(e,["musicGenerationConfig"]);return s!=null&&d(t,["musicGenerationConfig"],Sx(a,s)),t}function _x(a,e){const t={},o=c(e,["data"]);o!=null&&d(t,["data"],o);const s=c(e,["mimeType"]);s!=null&&d(t,["mimeType"],s);const u=c(e,["sourceMetadata"]);return u!=null&&d(t,["sourceMetadata"],bx(a,u)),t}function Nx(a,e){const t={},o=c(e,["audioChunks"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>_x(a,u))),d(t,["audioChunks"],s)}return t}function Ax(a,e){const t={},o=c(e,["text"]);o!=null&&d(t,["text"],o);const s=c(e,["filteredReason"]);return s!=null&&d(t,["filteredReason"],s),t}function wx(a,e){const t={};c(e,["setupComplete"])!=null&&d(t,["setupComplete"],Cx());const s=c(e,["serverContent"]);s!=null&&d(t,["serverContent"],Nx(a,s));const u=c(e,["filteredPrompt"]);return u!=null&&d(t,["filteredPrompt"],Ax(a,u)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ix(a,e){const t={},o=c(e,["fps"]);o!=null&&d(t,["fps"],o);const s=c(e,["endOffset"]);s!=null&&d(t,["endOffset"],s);const u=c(e,["startOffset"]);return u!=null&&d(t,["startOffset"],u),t}function Rx(a,e){const t={};if(c(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=c(e,["data"]);o!=null&&d(t,["data"],o);const s=c(e,["mimeType"]);return s!=null&&d(t,["mimeType"],s),t}function Mx(a,e){const t={};if(c(e,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=c(e,["fileUri"]);o!=null&&d(t,["fileUri"],o);const s=c(e,["mimeType"]);return s!=null&&d(t,["mimeType"],s),t}function Lx(a,e){const t={},o=c(e,["videoMetadata"]);o!=null&&d(t,["videoMetadata"],Ix(a,o));const s=c(e,["thought"]);s!=null&&d(t,["thought"],s);const u=c(e,["inlineData"]);u!=null&&d(t,["inlineData"],Rx(a,u));const f=c(e,["fileData"]);f!=null&&d(t,["fileData"],Mx(a,f));const g=c(e,["codeExecutionResult"]);g!=null&&d(t,["codeExecutionResult"],g);const h=c(e,["executableCode"]);h!=null&&d(t,["executableCode"],h);const p=c(e,["functionCall"]);p!=null&&d(t,["functionCall"],p);const v=c(e,["functionResponse"]);v!=null&&d(t,["functionResponse"],v);const T=c(e,["text"]);return T!=null&&d(t,["text"],T),t}function js(a,e){const t={},o=c(e,["parts"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>Lx(a,f))),d(t,["parts"],u)}const s=c(e,["role"]);return s!=null&&d(t,["role"],s),t}function kx(a,e){const t={},o=c(e,["anyOf"]);o!=null&&d(t,["anyOf"],o);const s=c(e,["default"]);s!=null&&d(t,["default"],s);const u=c(e,["description"]);u!=null&&d(t,["description"],u);const f=c(e,["enum"]);f!=null&&d(t,["enum"],f);const g=c(e,["example"]);g!=null&&d(t,["example"],g);const h=c(e,["format"]);h!=null&&d(t,["format"],h);const p=c(e,["items"]);p!=null&&d(t,["items"],p);const v=c(e,["maxItems"]);v!=null&&d(t,["maxItems"],v);const T=c(e,["maxLength"]);T!=null&&d(t,["maxLength"],T);const C=c(e,["maxProperties"]);C!=null&&d(t,["maxProperties"],C);const S=c(e,["maximum"]);S!=null&&d(t,["maximum"],S);const w=c(e,["minItems"]);w!=null&&d(t,["minItems"],w);const I=c(e,["minLength"]);I!=null&&d(t,["minLength"],I);const b=c(e,["minProperties"]);b!=null&&d(t,["minProperties"],b);const A=c(e,["minimum"]);A!=null&&d(t,["minimum"],A);const M=c(e,["nullable"]);M!=null&&d(t,["nullable"],M);const L=c(e,["pattern"]);L!=null&&d(t,["pattern"],L);const R=c(e,["properties"]);R!=null&&d(t,["properties"],R);const $=c(e,["propertyOrdering"]);$!=null&&d(t,["propertyOrdering"],$);const V=c(e,["required"]);V!=null&&d(t,["required"],V);const Q=c(e,["title"]);Q!=null&&d(t,["title"],Q);const te=c(e,["type"]);return te!=null&&d(t,["type"],te),t}function $x(a,e){const t={};if(c(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const o=c(e,["category"]);o!=null&&d(t,["category"],o);const s=c(e,["threshold"]);return s!=null&&d(t,["threshold"],s),t}function Px(a,e){const t={},o=c(e,["behavior"]);o!=null&&d(t,["behavior"],o);const s=c(e,["description"]);s!=null&&d(t,["description"],s);const u=c(e,["name"]);u!=null&&d(t,["name"],u);const f=c(e,["parameters"]);f!=null&&d(t,["parameters"],f);const g=c(e,["response"]);return g!=null&&d(t,["response"],g),t}function Dx(a,e){const t={},o=c(e,["startTime"]);o!=null&&d(t,["startTime"],o);const s=c(e,["endTime"]);return s!=null&&d(t,["endTime"],s),t}function Ux(a,e){const t={},o=c(e,["timeRangeFilter"]);return o!=null&&d(t,["timeRangeFilter"],Dx(a,o)),t}function Ox(a,e){const t={},o=c(e,["mode"]);o!=null&&d(t,["mode"],o);const s=c(e,["dynamicThreshold"]);return s!=null&&d(t,["dynamicThreshold"],s),t}function Gx(a,e){const t={},o=c(e,["dynamicRetrievalConfig"]);return o!=null&&d(t,["dynamicRetrievalConfig"],Ox(a,o)),t}function Hx(){return{}}function Vx(a,e){const t={},o=c(e,["functionDeclarations"]);if(o!=null){let h=o;Array.isArray(h)&&(h=h.map(p=>Px(a,p))),d(t,["functionDeclarations"],h)}if(c(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=c(e,["googleSearch"]);s!=null&&d(t,["googleSearch"],Ux(a,s));const u=c(e,["googleSearchRetrieval"]);if(u!=null&&d(t,["googleSearchRetrieval"],Gx(a,u)),c(e,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(c(e,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");c(e,["urlContext"])!=null&&d(t,["urlContext"],Hx());const g=c(e,["codeExecution"]);return g!=null&&d(t,["codeExecution"],g),t}function qx(a,e){const t={},o=c(e,["mode"]);o!=null&&d(t,["mode"],o);const s=c(e,["allowedFunctionNames"]);return s!=null&&d(t,["allowedFunctionNames"],s),t}function Fx(a,e){const t={},o=c(e,["latitude"]);o!=null&&d(t,["latitude"],o);const s=c(e,["longitude"]);return s!=null&&d(t,["longitude"],s),t}function Yx(a,e){const t={},o=c(e,["latLng"]);o!=null&&d(t,["latLng"],Fx(a,o));const s=c(e,["languageCode"]);return s!=null&&d(t,["languageCode"],s),t}function Bx(a,e){const t={},o=c(e,["functionCallingConfig"]);o!=null&&d(t,["functionCallingConfig"],qx(a,o));const s=c(e,["retrievalConfig"]);return s!=null&&d(t,["retrievalConfig"],Yx(a,s)),t}function zx(a,e){const t={},o=c(e,["voiceName"]);return o!=null&&d(t,["voiceName"],o),t}function Hh(a,e){const t={},o=c(e,["prebuiltVoiceConfig"]);return o!=null&&d(t,["prebuiltVoiceConfig"],zx(a,o)),t}function Jx(a,e){const t={},o=c(e,["speaker"]);o!=null&&d(t,["speaker"],o);const s=c(e,["voiceConfig"]);return s!=null&&d(t,["voiceConfig"],Hh(a,s)),t}function Kx(a,e){const t={},o=c(e,["speakerVoiceConfigs"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>Jx(a,u))),d(t,["speakerVoiceConfigs"],s)}return t}function Zx(a,e){const t={},o=c(e,["voiceConfig"]);o!=null&&d(t,["voiceConfig"],Hh(a,o));const s=c(e,["multiSpeakerVoiceConfig"]);s!=null&&d(t,["multiSpeakerVoiceConfig"],Kx(a,s));const u=c(e,["languageCode"]);return u!=null&&d(t,["languageCode"],u),t}function Xx(a,e){const t={},o=c(e,["includeThoughts"]);o!=null&&d(t,["includeThoughts"],o);const s=c(e,["thinkingBudget"]);return s!=null&&d(t,["thinkingBudget"],s),t}function jx(a,e,t){const o={},s=c(e,["systemInstruction"]);t!==void 0&&s!=null&&d(t,["systemInstruction"],js(a,hn(a,s)));const u=c(e,["temperature"]);u!=null&&d(o,["temperature"],u);const f=c(e,["topP"]);f!=null&&d(o,["topP"],f);const g=c(e,["topK"]);g!=null&&d(o,["topK"],g);const h=c(e,["candidateCount"]);h!=null&&d(o,["candidateCount"],h);const p=c(e,["maxOutputTokens"]);p!=null&&d(o,["maxOutputTokens"],p);const v=c(e,["stopSequences"]);v!=null&&d(o,["stopSequences"],v);const T=c(e,["responseLogprobs"]);T!=null&&d(o,["responseLogprobs"],T);const C=c(e,["logprobs"]);C!=null&&d(o,["logprobs"],C);const S=c(e,["presencePenalty"]);S!=null&&d(o,["presencePenalty"],S);const w=c(e,["frequencyPenalty"]);w!=null&&d(o,["frequencyPenalty"],w);const I=c(e,["seed"]);I!=null&&d(o,["seed"],I);const b=c(e,["responseMimeType"]);b!=null&&d(o,["responseMimeType"],b);const A=c(e,["responseSchema"]);if(A!=null&&d(o,["responseSchema"],kx(a,zs(a,A))),c(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(c(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const M=c(e,["safetySettings"]);if(t!==void 0&&M!=null){let ae=M;Array.isArray(ae)&&(ae=ae.map(W=>$x(a,W))),d(t,["safetySettings"],ae)}const L=c(e,["tools"]);if(t!==void 0&&L!=null){let ae=Zs(a,L);Array.isArray(ae)&&(ae=ae.map(W=>Vx(a,Ks(a,W)))),d(t,["tools"],ae)}const R=c(e,["toolConfig"]);if(t!==void 0&&R!=null&&d(t,["toolConfig"],Bx(a,R)),c(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const $=c(e,["cachedContent"]);t!==void 0&&$!=null&&d(t,["cachedContent"],zi(a,$));const V=c(e,["responseModalities"]);V!=null&&d(o,["responseModalities"],V);const Q=c(e,["mediaResolution"]);Q!=null&&d(o,["mediaResolution"],Q);const te=c(e,["speechConfig"]);if(te!=null&&d(o,["speechConfig"],Zx(a,wh(a,te))),c(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const F=c(e,["thinkingConfig"]);return F!=null&&d(o,["thinkingConfig"],Xx(a,F)),o}function Zg(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","model"],wt(a,o));const s=c(e,["contents"]);if(s!=null){let f=Fn(a,s);Array.isArray(f)&&(f=f.map(g=>js(a,g))),d(t,["contents"],f)}const u=c(e,["config"]);return u!=null&&d(t,["generationConfig"],jx(a,u,t)),t}function Qx(a,e,t){const o={},s=c(e,["taskType"]);t!==void 0&&s!=null&&d(t,["requests[]","taskType"],s);const u=c(e,["title"]);t!==void 0&&u!=null&&d(t,["requests[]","title"],u);const f=c(e,["outputDimensionality"]);if(t!==void 0&&f!=null&&d(t,["requests[]","outputDimensionality"],f),c(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(c(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return o}function Wx(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","model"],wt(a,o));const s=c(e,["contents"]);s!=null&&d(t,["requests[]","content"],Ah(a,s));const u=c(e,["config"]);u!=null&&d(t,["config"],Qx(a,u,t));const f=c(e,["model"]);return f!==void 0&&d(t,["requests[]","model"],wt(a,f)),t}function eS(a,e,t){const o={};if(c(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(c(e,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=c(e,["numberOfImages"]);t!==void 0&&s!=null&&d(t,["parameters","sampleCount"],s);const u=c(e,["aspectRatio"]);t!==void 0&&u!=null&&d(t,["parameters","aspectRatio"],u);const f=c(e,["guidanceScale"]);if(t!==void 0&&f!=null&&d(t,["parameters","guidanceScale"],f),c(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const g=c(e,["safetyFilterLevel"]);t!==void 0&&g!=null&&d(t,["parameters","safetySetting"],g);const h=c(e,["personGeneration"]);t!==void 0&&h!=null&&d(t,["parameters","personGeneration"],h);const p=c(e,["includeSafetyAttributes"]);t!==void 0&&p!=null&&d(t,["parameters","includeSafetyAttributes"],p);const v=c(e,["includeRaiReason"]);t!==void 0&&v!=null&&d(t,["parameters","includeRaiReason"],v);const T=c(e,["language"]);t!==void 0&&T!=null&&d(t,["parameters","language"],T);const C=c(e,["outputMimeType"]);t!==void 0&&C!=null&&d(t,["parameters","outputOptions","mimeType"],C);const S=c(e,["outputCompressionQuality"]);if(t!==void 0&&S!=null&&d(t,["parameters","outputOptions","compressionQuality"],S),c(e,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(c(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return o}function tS(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","model"],wt(a,o));const s=c(e,["prompt"]);s!=null&&d(t,["instances[0]","prompt"],s);const u=c(e,["config"]);return u!=null&&d(t,["config"],eS(a,u,t)),t}function nS(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","name"],wt(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function iS(a,e,t){const o={},s=c(e,["pageSize"]);t!==void 0&&s!=null&&d(t,["_query","pageSize"],s);const u=c(e,["pageToken"]);t!==void 0&&u!=null&&d(t,["_query","pageToken"],u);const f=c(e,["filter"]);t!==void 0&&f!=null&&d(t,["_query","filter"],f);const g=c(e,["queryBase"]);return t!==void 0&&g!=null&&d(t,["_url","models_url"],Lh(a,g)),o}function aS(a,e){const t={},o=c(e,["config"]);return o!=null&&d(t,["config"],iS(a,o,t)),t}function oS(a,e,t){const o={},s=c(e,["displayName"]);t!==void 0&&s!=null&&d(t,["displayName"],s);const u=c(e,["description"]);t!==void 0&&u!=null&&d(t,["description"],u);const f=c(e,["defaultCheckpointId"]);return t!==void 0&&f!=null&&d(t,["defaultCheckpointId"],f),o}function rS(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","name"],wt(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],oS(a,s,t)),t}function sS(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","name"],wt(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function lS(a,e){const t={};if(c(e,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(c(e,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(c(e,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function uS(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","model"],wt(a,o));const s=c(e,["contents"]);if(s!=null){let f=Fn(a,s);Array.isArray(f)&&(f=f.map(g=>js(a,g))),d(t,["contents"],f)}const u=c(e,["config"]);return u!=null&&d(t,["config"],lS(a,u)),t}function cS(a,e){const t={};if(c(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const o=c(e,["imageBytes"]);o!=null&&d(t,["bytesBase64Encoded"],Ji(a,o));const s=c(e,["mimeType"]);return s!=null&&d(t,["mimeType"],s),t}function dS(a,e,t){const o={},s=c(e,["numberOfVideos"]);if(t!==void 0&&s!=null&&d(t,["parameters","sampleCount"],s),c(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(c(e,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const u=c(e,["durationSeconds"]);if(t!==void 0&&u!=null&&d(t,["parameters","durationSeconds"],u),c(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const f=c(e,["aspectRatio"]);if(t!==void 0&&f!=null&&d(t,["parameters","aspectRatio"],f),c(e,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const g=c(e,["personGeneration"]);if(t!==void 0&&g!=null&&d(t,["parameters","personGeneration"],g),c(e,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const h=c(e,["negativePrompt"]);if(t!==void 0&&h!=null&&d(t,["parameters","negativePrompt"],h),c(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");if(c(e,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");return o}function fS(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","model"],wt(a,o));const s=c(e,["prompt"]);s!=null&&d(t,["instances[0]","prompt"],s);const u=c(e,["image"]);u!=null&&d(t,["instances[0]","image"],cS(a,u));const f=c(e,["config"]);return f!=null&&d(t,["config"],dS(a,f,t)),t}function mS(a,e){const t={},o=c(e,["fps"]);o!=null&&d(t,["fps"],o);const s=c(e,["endOffset"]);s!=null&&d(t,["endOffset"],s);const u=c(e,["startOffset"]);return u!=null&&d(t,["startOffset"],u),t}function pS(a,e){const t={},o=c(e,["displayName"]);o!=null&&d(t,["displayName"],o);const s=c(e,["data"]);s!=null&&d(t,["data"],s);const u=c(e,["mimeType"]);return u!=null&&d(t,["mimeType"],u),t}function gS(a,e){const t={},o=c(e,["displayName"]);o!=null&&d(t,["displayName"],o);const s=c(e,["fileUri"]);s!=null&&d(t,["fileUri"],s);const u=c(e,["mimeType"]);return u!=null&&d(t,["mimeType"],u),t}function hS(a,e){const t={},o=c(e,["videoMetadata"]);o!=null&&d(t,["videoMetadata"],mS(a,o));const s=c(e,["thought"]);s!=null&&d(t,["thought"],s);const u=c(e,["inlineData"]);u!=null&&d(t,["inlineData"],pS(a,u));const f=c(e,["fileData"]);f!=null&&d(t,["fileData"],gS(a,f));const g=c(e,["codeExecutionResult"]);g!=null&&d(t,["codeExecutionResult"],g);const h=c(e,["executableCode"]);h!=null&&d(t,["executableCode"],h);const p=c(e,["functionCall"]);p!=null&&d(t,["functionCall"],p);const v=c(e,["functionResponse"]);v!=null&&d(t,["functionResponse"],v);const T=c(e,["text"]);return T!=null&&d(t,["text"],T),t}function uo(a,e){const t={},o=c(e,["parts"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>hS(a,f))),d(t,["parts"],u)}const s=c(e,["role"]);return s!=null&&d(t,["role"],s),t}function yS(a,e){const t={},o=c(e,["anyOf"]);o!=null&&d(t,["anyOf"],o);const s=c(e,["default"]);s!=null&&d(t,["default"],s);const u=c(e,["description"]);u!=null&&d(t,["description"],u);const f=c(e,["enum"]);f!=null&&d(t,["enum"],f);const g=c(e,["example"]);g!=null&&d(t,["example"],g);const h=c(e,["format"]);h!=null&&d(t,["format"],h);const p=c(e,["items"]);p!=null&&d(t,["items"],p);const v=c(e,["maxItems"]);v!=null&&d(t,["maxItems"],v);const T=c(e,["maxLength"]);T!=null&&d(t,["maxLength"],T);const C=c(e,["maxProperties"]);C!=null&&d(t,["maxProperties"],C);const S=c(e,["maximum"]);S!=null&&d(t,["maximum"],S);const w=c(e,["minItems"]);w!=null&&d(t,["minItems"],w);const I=c(e,["minLength"]);I!=null&&d(t,["minLength"],I);const b=c(e,["minProperties"]);b!=null&&d(t,["minProperties"],b);const A=c(e,["minimum"]);A!=null&&d(t,["minimum"],A);const M=c(e,["nullable"]);M!=null&&d(t,["nullable"],M);const L=c(e,["pattern"]);L!=null&&d(t,["pattern"],L);const R=c(e,["properties"]);R!=null&&d(t,["properties"],R);const $=c(e,["propertyOrdering"]);$!=null&&d(t,["propertyOrdering"],$);const V=c(e,["required"]);V!=null&&d(t,["required"],V);const Q=c(e,["title"]);Q!=null&&d(t,["title"],Q);const te=c(e,["type"]);return te!=null&&d(t,["type"],te),t}function vS(a,e){const t={},o=c(e,["featureSelectionPreference"]);return o!=null&&d(t,["featureSelectionPreference"],o),t}function TS(a,e){const t={},o=c(e,["method"]);o!=null&&d(t,["method"],o);const s=c(e,["category"]);s!=null&&d(t,["category"],s);const u=c(e,["threshold"]);return u!=null&&d(t,["threshold"],u),t}function CS(a,e){const t={};if(c(e,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const o=c(e,["description"]);o!=null&&d(t,["description"],o);const s=c(e,["name"]);s!=null&&d(t,["name"],s);const u=c(e,["parameters"]);u!=null&&d(t,["parameters"],u);const f=c(e,["response"]);return f!=null&&d(t,["response"],f),t}function ES(a,e){const t={},o=c(e,["startTime"]);o!=null&&d(t,["startTime"],o);const s=c(e,["endTime"]);return s!=null&&d(t,["endTime"],s),t}function xS(a,e){const t={},o=c(e,["timeRangeFilter"]);return o!=null&&d(t,["timeRangeFilter"],ES(a,o)),t}function SS(a,e){const t={},o=c(e,["mode"]);o!=null&&d(t,["mode"],o);const s=c(e,["dynamicThreshold"]);return s!=null&&d(t,["dynamicThreshold"],s),t}function bS(a,e){const t={},o=c(e,["dynamicRetrievalConfig"]);return o!=null&&d(t,["dynamicRetrievalConfig"],SS(a,o)),t}function _S(){return{}}function NS(a,e){const t={},o=c(e,["apiKeyString"]);return o!=null&&d(t,["apiKeyString"],o),t}function AS(a,e){const t={},o=c(e,["apiKeyConfig"]);o!=null&&d(t,["apiKeyConfig"],NS(a,o));const s=c(e,["authType"]);s!=null&&d(t,["authType"],s);const u=c(e,["googleServiceAccountConfig"]);u!=null&&d(t,["googleServiceAccountConfig"],u);const f=c(e,["httpBasicAuthConfig"]);f!=null&&d(t,["httpBasicAuthConfig"],f);const g=c(e,["oauthConfig"]);g!=null&&d(t,["oauthConfig"],g);const h=c(e,["oidcConfig"]);return h!=null&&d(t,["oidcConfig"],h),t}function wS(a,e){const t={},o=c(e,["authConfig"]);return o!=null&&d(t,["authConfig"],AS(a,o)),t}function Vh(a,e){const t={},o=c(e,["functionDeclarations"]);if(o!=null){let v=o;Array.isArray(v)&&(v=v.map(T=>CS(a,T))),d(t,["functionDeclarations"],v)}const s=c(e,["retrieval"]);s!=null&&d(t,["retrieval"],s);const u=c(e,["googleSearch"]);u!=null&&d(t,["googleSearch"],xS(a,u));const f=c(e,["googleSearchRetrieval"]);f!=null&&d(t,["googleSearchRetrieval"],bS(a,f)),c(e,["enterpriseWebSearch"])!=null&&d(t,["enterpriseWebSearch"],_S());const h=c(e,["googleMaps"]);if(h!=null&&d(t,["googleMaps"],wS(a,h)),c(e,["urlContext"])!==void 0)throw new Error("urlContext parameter is not supported in Vertex AI.");const p=c(e,["codeExecution"]);return p!=null&&d(t,["codeExecution"],p),t}function IS(a,e){const t={},o=c(e,["mode"]);o!=null&&d(t,["mode"],o);const s=c(e,["allowedFunctionNames"]);return s!=null&&d(t,["allowedFunctionNames"],s),t}function RS(a,e){const t={},o=c(e,["latitude"]);o!=null&&d(t,["latitude"],o);const s=c(e,["longitude"]);return s!=null&&d(t,["longitude"],s),t}function MS(a,e){const t={},o=c(e,["latLng"]);o!=null&&d(t,["latLng"],RS(a,o));const s=c(e,["languageCode"]);return s!=null&&d(t,["languageCode"],s),t}function LS(a,e){const t={},o=c(e,["functionCallingConfig"]);o!=null&&d(t,["functionCallingConfig"],IS(a,o));const s=c(e,["retrievalConfig"]);return s!=null&&d(t,["retrievalConfig"],MS(a,s)),t}function kS(a,e){const t={},o=c(e,["voiceName"]);return o!=null&&d(t,["voiceName"],o),t}function $S(a,e){const t={},o=c(e,["prebuiltVoiceConfig"]);return o!=null&&d(t,["prebuiltVoiceConfig"],kS(a,o)),t}function PS(a,e){const t={},o=c(e,["voiceConfig"]);if(o!=null&&d(t,["voiceConfig"],$S(a,o)),c(e,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const s=c(e,["languageCode"]);return s!=null&&d(t,["languageCode"],s),t}function DS(a,e){const t={},o=c(e,["includeThoughts"]);o!=null&&d(t,["includeThoughts"],o);const s=c(e,["thinkingBudget"]);return s!=null&&d(t,["thinkingBudget"],s),t}function US(a,e,t){const o={},s=c(e,["systemInstruction"]);t!==void 0&&s!=null&&d(t,["systemInstruction"],uo(a,hn(a,s)));const u=c(e,["temperature"]);u!=null&&d(o,["temperature"],u);const f=c(e,["topP"]);f!=null&&d(o,["topP"],f);const g=c(e,["topK"]);g!=null&&d(o,["topK"],g);const h=c(e,["candidateCount"]);h!=null&&d(o,["candidateCount"],h);const p=c(e,["maxOutputTokens"]);p!=null&&d(o,["maxOutputTokens"],p);const v=c(e,["stopSequences"]);v!=null&&d(o,["stopSequences"],v);const T=c(e,["responseLogprobs"]);T!=null&&d(o,["responseLogprobs"],T);const C=c(e,["logprobs"]);C!=null&&d(o,["logprobs"],C);const S=c(e,["presencePenalty"]);S!=null&&d(o,["presencePenalty"],S);const w=c(e,["frequencyPenalty"]);w!=null&&d(o,["frequencyPenalty"],w);const I=c(e,["seed"]);I!=null&&d(o,["seed"],I);const b=c(e,["responseMimeType"]);b!=null&&d(o,["responseMimeType"],b);const A=c(e,["responseSchema"]);A!=null&&d(o,["responseSchema"],yS(a,zs(a,A)));const M=c(e,["routingConfig"]);M!=null&&d(o,["routingConfig"],M);const L=c(e,["modelSelectionConfig"]);L!=null&&d(o,["modelConfig"],vS(a,L));const R=c(e,["safetySettings"]);if(t!==void 0&&R!=null){let re=R;Array.isArray(re)&&(re=re.map(se=>TS(a,se))),d(t,["safetySettings"],re)}const $=c(e,["tools"]);if(t!==void 0&&$!=null){let re=Zs(a,$);Array.isArray(re)&&(re=re.map(se=>Vh(a,Ks(a,se)))),d(t,["tools"],re)}const V=c(e,["toolConfig"]);t!==void 0&&V!=null&&d(t,["toolConfig"],LS(a,V));const Q=c(e,["labels"]);t!==void 0&&Q!=null&&d(t,["labels"],Q);const te=c(e,["cachedContent"]);t!==void 0&&te!=null&&d(t,["cachedContent"],zi(a,te));const F=c(e,["responseModalities"]);F!=null&&d(o,["responseModalities"],F);const ae=c(e,["mediaResolution"]);ae!=null&&d(o,["mediaResolution"],ae);const W=c(e,["speechConfig"]);W!=null&&d(o,["speechConfig"],PS(a,wh(a,W)));const z=c(e,["audioTimestamp"]);z!=null&&d(o,["audioTimestamp"],z);const ue=c(e,["thinkingConfig"]);return ue!=null&&d(o,["thinkingConfig"],DS(a,ue)),o}function Xg(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","model"],wt(a,o));const s=c(e,["contents"]);if(s!=null){let f=Fn(a,s);Array.isArray(f)&&(f=f.map(g=>uo(a,g))),d(t,["contents"],f)}const u=c(e,["config"]);return u!=null&&d(t,["generationConfig"],US(a,u,t)),t}function OS(a,e,t){const o={},s=c(e,["taskType"]);t!==void 0&&s!=null&&d(t,["instances[]","task_type"],s);const u=c(e,["title"]);t!==void 0&&u!=null&&d(t,["instances[]","title"],u);const f=c(e,["outputDimensionality"]);t!==void 0&&f!=null&&d(t,["parameters","outputDimensionality"],f);const g=c(e,["mimeType"]);t!==void 0&&g!=null&&d(t,["instances[]","mimeType"],g);const h=c(e,["autoTruncate"]);return t!==void 0&&h!=null&&d(t,["parameters","autoTruncate"],h),o}function GS(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","model"],wt(a,o));const s=c(e,["contents"]);s!=null&&d(t,["instances[]","content"],Ah(a,s));const u=c(e,["config"]);return u!=null&&d(t,["config"],OS(a,u,t)),t}function HS(a,e,t){const o={},s=c(e,["outputGcsUri"]);t!==void 0&&s!=null&&d(t,["parameters","storageUri"],s);const u=c(e,["negativePrompt"]);t!==void 0&&u!=null&&d(t,["parameters","negativePrompt"],u);const f=c(e,["numberOfImages"]);t!==void 0&&f!=null&&d(t,["parameters","sampleCount"],f);const g=c(e,["aspectRatio"]);t!==void 0&&g!=null&&d(t,["parameters","aspectRatio"],g);const h=c(e,["guidanceScale"]);t!==void 0&&h!=null&&d(t,["parameters","guidanceScale"],h);const p=c(e,["seed"]);t!==void 0&&p!=null&&d(t,["parameters","seed"],p);const v=c(e,["safetyFilterLevel"]);t!==void 0&&v!=null&&d(t,["parameters","safetySetting"],v);const T=c(e,["personGeneration"]);t!==void 0&&T!=null&&d(t,["parameters","personGeneration"],T);const C=c(e,["includeSafetyAttributes"]);t!==void 0&&C!=null&&d(t,["parameters","includeSafetyAttributes"],C);const S=c(e,["includeRaiReason"]);t!==void 0&&S!=null&&d(t,["parameters","includeRaiReason"],S);const w=c(e,["language"]);t!==void 0&&w!=null&&d(t,["parameters","language"],w);const I=c(e,["outputMimeType"]);t!==void 0&&I!=null&&d(t,["parameters","outputOptions","mimeType"],I);const b=c(e,["outputCompressionQuality"]);t!==void 0&&b!=null&&d(t,["parameters","outputOptions","compressionQuality"],b);const A=c(e,["addWatermark"]);t!==void 0&&A!=null&&d(t,["parameters","addWatermark"],A);const M=c(e,["enhancePrompt"]);return t!==void 0&&M!=null&&d(t,["parameters","enhancePrompt"],M),o}function VS(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","model"],wt(a,o));const s=c(e,["prompt"]);s!=null&&d(t,["instances[0]","prompt"],s);const u=c(e,["config"]);return u!=null&&d(t,["config"],HS(a,u,t)),t}function Pc(a,e){const t={},o=c(e,["gcsUri"]);o!=null&&d(t,["gcsUri"],o);const s=c(e,["imageBytes"]);s!=null&&d(t,["bytesBase64Encoded"],Ji(a,s));const u=c(e,["mimeType"]);return u!=null&&d(t,["mimeType"],u),t}function qS(a,e){const t={},o=c(e,["maskMode"]);o!=null&&d(t,["maskMode"],o);const s=c(e,["segmentationClasses"]);s!=null&&d(t,["maskClasses"],s);const u=c(e,["maskDilation"]);return u!=null&&d(t,["dilation"],u),t}function FS(a,e){const t={},o=c(e,["controlType"]);o!=null&&d(t,["controlType"],o);const s=c(e,["enableControlImageComputation"]);return s!=null&&d(t,["computeControl"],s),t}function YS(a,e){const t={},o=c(e,["styleDescription"]);return o!=null&&d(t,["styleDescription"],o),t}function BS(a,e){const t={},o=c(e,["subjectType"]);o!=null&&d(t,["subjectType"],o);const s=c(e,["subjectDescription"]);return s!=null&&d(t,["subjectDescription"],s),t}function zS(a,e){const t={},o=c(e,["referenceImage"]);o!=null&&d(t,["referenceImage"],Pc(a,o));const s=c(e,["referenceId"]);s!=null&&d(t,["referenceId"],s);const u=c(e,["referenceType"]);u!=null&&d(t,["referenceType"],u);const f=c(e,["maskImageConfig"]);f!=null&&d(t,["maskImageConfig"],qS(a,f));const g=c(e,["controlImageConfig"]);g!=null&&d(t,["controlImageConfig"],FS(a,g));const h=c(e,["styleImageConfig"]);h!=null&&d(t,["styleImageConfig"],YS(a,h));const p=c(e,["subjectImageConfig"]);return p!=null&&d(t,["subjectImageConfig"],BS(a,p)),t}function JS(a,e,t){const o={},s=c(e,["outputGcsUri"]);t!==void 0&&s!=null&&d(t,["parameters","storageUri"],s);const u=c(e,["negativePrompt"]);t!==void 0&&u!=null&&d(t,["parameters","negativePrompt"],u);const f=c(e,["numberOfImages"]);t!==void 0&&f!=null&&d(t,["parameters","sampleCount"],f);const g=c(e,["aspectRatio"]);t!==void 0&&g!=null&&d(t,["parameters","aspectRatio"],g);const h=c(e,["guidanceScale"]);t!==void 0&&h!=null&&d(t,["parameters","guidanceScale"],h);const p=c(e,["seed"]);t!==void 0&&p!=null&&d(t,["parameters","seed"],p);const v=c(e,["safetyFilterLevel"]);t!==void 0&&v!=null&&d(t,["parameters","safetySetting"],v);const T=c(e,["personGeneration"]);t!==void 0&&T!=null&&d(t,["parameters","personGeneration"],T);const C=c(e,["includeSafetyAttributes"]);t!==void 0&&C!=null&&d(t,["parameters","includeSafetyAttributes"],C);const S=c(e,["includeRaiReason"]);t!==void 0&&S!=null&&d(t,["parameters","includeRaiReason"],S);const w=c(e,["language"]);t!==void 0&&w!=null&&d(t,["parameters","language"],w);const I=c(e,["outputMimeType"]);t!==void 0&&I!=null&&d(t,["parameters","outputOptions","mimeType"],I);const b=c(e,["outputCompressionQuality"]);t!==void 0&&b!=null&&d(t,["parameters","outputOptions","compressionQuality"],b);const A=c(e,["editMode"]);t!==void 0&&A!=null&&d(t,["parameters","editMode"],A);const M=c(e,["baseSteps"]);return t!==void 0&&M!=null&&d(t,["parameters","editConfig","baseSteps"],M),o}function KS(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","model"],wt(a,o));const s=c(e,["prompt"]);s!=null&&d(t,["instances[0]","prompt"],s);const u=c(e,["referenceImages"]);if(u!=null){let g=u;Array.isArray(g)&&(g=g.map(h=>zS(a,h))),d(t,["instances[0]","referenceImages"],g)}const f=c(e,["config"]);return f!=null&&d(t,["config"],JS(a,f,t)),t}function ZS(a,e,t){const o={},s=c(e,["includeRaiReason"]);t!==void 0&&s!=null&&d(t,["parameters","includeRaiReason"],s);const u=c(e,["outputMimeType"]);t!==void 0&&u!=null&&d(t,["parameters","outputOptions","mimeType"],u);const f=c(e,["outputCompressionQuality"]);t!==void 0&&f!=null&&d(t,["parameters","outputOptions","compressionQuality"],f);const g=c(e,["numberOfImages"]);t!==void 0&&g!=null&&d(t,["parameters","sampleCount"],g);const h=c(e,["mode"]);return t!==void 0&&h!=null&&d(t,["parameters","mode"],h),o}function XS(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","model"],wt(a,o));const s=c(e,["image"]);s!=null&&d(t,["instances[0]","image"],Pc(a,s));const u=c(e,["upscaleFactor"]);u!=null&&d(t,["parameters","upscaleConfig","upscaleFactor"],u);const f=c(e,["config"]);return f!=null&&d(t,["config"],ZS(a,f,t)),t}function jS(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","name"],wt(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function QS(a,e,t){const o={},s=c(e,["pageSize"]);t!==void 0&&s!=null&&d(t,["_query","pageSize"],s);const u=c(e,["pageToken"]);t!==void 0&&u!=null&&d(t,["_query","pageToken"],u);const f=c(e,["filter"]);t!==void 0&&f!=null&&d(t,["_query","filter"],f);const g=c(e,["queryBase"]);return t!==void 0&&g!=null&&d(t,["_url","models_url"],Lh(a,g)),o}function WS(a,e){const t={},o=c(e,["config"]);return o!=null&&d(t,["config"],QS(a,o,t)),t}function eb(a,e,t){const o={},s=c(e,["displayName"]);t!==void 0&&s!=null&&d(t,["displayName"],s);const u=c(e,["description"]);t!==void 0&&u!=null&&d(t,["description"],u);const f=c(e,["defaultCheckpointId"]);return t!==void 0&&f!=null&&d(t,["defaultCheckpointId"],f),o}function tb(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","model"],wt(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],eb(a,s,t)),t}function nb(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","name"],wt(a,o));const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function ib(a,e,t){const o={},s=c(e,["systemInstruction"]);t!==void 0&&s!=null&&d(t,["systemInstruction"],uo(a,hn(a,s)));const u=c(e,["tools"]);if(t!==void 0&&u!=null){let g=u;Array.isArray(g)&&(g=g.map(h=>Vh(a,h))),d(t,["tools"],g)}const f=c(e,["generationConfig"]);return t!==void 0&&f!=null&&d(t,["generationConfig"],f),o}function ab(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","model"],wt(a,o));const s=c(e,["contents"]);if(s!=null){let f=Fn(a,s);Array.isArray(f)&&(f=f.map(g=>uo(a,g))),d(t,["contents"],f)}const u=c(e,["config"]);return u!=null&&d(t,["config"],ib(a,u,t)),t}function ob(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","model"],wt(a,o));const s=c(e,["contents"]);if(s!=null){let f=Fn(a,s);Array.isArray(f)&&(f=f.map(g=>uo(a,g))),d(t,["contents"],f)}const u=c(e,["config"]);return u!=null&&d(t,["config"],u),t}function rb(a,e,t){const o={},s=c(e,["numberOfVideos"]);t!==void 0&&s!=null&&d(t,["parameters","sampleCount"],s);const u=c(e,["outputGcsUri"]);t!==void 0&&u!=null&&d(t,["parameters","storageUri"],u);const f=c(e,["fps"]);t!==void 0&&f!=null&&d(t,["parameters","fps"],f);const g=c(e,["durationSeconds"]);t!==void 0&&g!=null&&d(t,["parameters","durationSeconds"],g);const h=c(e,["seed"]);t!==void 0&&h!=null&&d(t,["parameters","seed"],h);const p=c(e,["aspectRatio"]);t!==void 0&&p!=null&&d(t,["parameters","aspectRatio"],p);const v=c(e,["resolution"]);t!==void 0&&v!=null&&d(t,["parameters","resolution"],v);const T=c(e,["personGeneration"]);t!==void 0&&T!=null&&d(t,["parameters","personGeneration"],T);const C=c(e,["pubsubTopic"]);t!==void 0&&C!=null&&d(t,["parameters","pubsubTopic"],C);const S=c(e,["negativePrompt"]);t!==void 0&&S!=null&&d(t,["parameters","negativePrompt"],S);const w=c(e,["enhancePrompt"]);t!==void 0&&w!=null&&d(t,["parameters","enhancePrompt"],w);const I=c(e,["generateAudio"]);return t!==void 0&&I!=null&&d(t,["parameters","generateAudio"],I),o}function sb(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["_url","model"],wt(a,o));const s=c(e,["prompt"]);s!=null&&d(t,["instances[0]","prompt"],s);const u=c(e,["image"]);u!=null&&d(t,["instances[0]","image"],Pc(a,u));const f=c(e,["config"]);return f!=null&&d(t,["config"],rb(a,f,t)),t}function lb(a,e){const t={},o=c(e,["fps"]);o!=null&&d(t,["fps"],o);const s=c(e,["endOffset"]);s!=null&&d(t,["endOffset"],s);const u=c(e,["startOffset"]);return u!=null&&d(t,["startOffset"],u),t}function ub(a,e){const t={},o=c(e,["data"]);o!=null&&d(t,["data"],o);const s=c(e,["mimeType"]);return s!=null&&d(t,["mimeType"],s),t}function cb(a,e){const t={},o=c(e,["fileUri"]);o!=null&&d(t,["fileUri"],o);const s=c(e,["mimeType"]);return s!=null&&d(t,["mimeType"],s),t}function db(a,e){const t={},o=c(e,["videoMetadata"]);o!=null&&d(t,["videoMetadata"],lb(a,o));const s=c(e,["thought"]);s!=null&&d(t,["thought"],s);const u=c(e,["inlineData"]);u!=null&&d(t,["inlineData"],ub(a,u));const f=c(e,["fileData"]);f!=null&&d(t,["fileData"],cb(a,f));const g=c(e,["codeExecutionResult"]);g!=null&&d(t,["codeExecutionResult"],g);const h=c(e,["executableCode"]);h!=null&&d(t,["executableCode"],h);const p=c(e,["functionCall"]);p!=null&&d(t,["functionCall"],p);const v=c(e,["functionResponse"]);v!=null&&d(t,["functionResponse"],v);const T=c(e,["text"]);return T!=null&&d(t,["text"],T),t}function fb(a,e){const t={},o=c(e,["parts"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>db(a,f))),d(t,["parts"],u)}const s=c(e,["role"]);return s!=null&&d(t,["role"],s),t}function mb(a,e){const t={},o=c(e,["citationSources"]);return o!=null&&d(t,["citations"],o),t}function pb(a,e){const t={},o=c(e,["retrievedUrl"]);o!=null&&d(t,["retrievedUrl"],o);const s=c(e,["urlRetrievalStatus"]);return s!=null&&d(t,["urlRetrievalStatus"],s),t}function gb(a,e){const t={},o=c(e,["urlMetadata"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>pb(a,u))),d(t,["urlMetadata"],s)}return t}function hb(a,e){const t={},o=c(e,["content"]);o!=null&&d(t,["content"],fb(a,o));const s=c(e,["citationMetadata"]);s!=null&&d(t,["citationMetadata"],mb(a,s));const u=c(e,["tokenCount"]);u!=null&&d(t,["tokenCount"],u);const f=c(e,["finishReason"]);f!=null&&d(t,["finishReason"],f);const g=c(e,["urlContextMetadata"]);g!=null&&d(t,["urlContextMetadata"],gb(a,g));const h=c(e,["avgLogprobs"]);h!=null&&d(t,["avgLogprobs"],h);const p=c(e,["groundingMetadata"]);p!=null&&d(t,["groundingMetadata"],p);const v=c(e,["index"]);v!=null&&d(t,["index"],v);const T=c(e,["logprobsResult"]);T!=null&&d(t,["logprobsResult"],T);const C=c(e,["safetyRatings"]);return C!=null&&d(t,["safetyRatings"],C),t}function jg(a,e){const t={},o=c(e,["candidates"]);if(o!=null){let g=o;Array.isArray(g)&&(g=g.map(h=>hb(a,h))),d(t,["candidates"],g)}const s=c(e,["modelVersion"]);s!=null&&d(t,["modelVersion"],s);const u=c(e,["promptFeedback"]);u!=null&&d(t,["promptFeedback"],u);const f=c(e,["usageMetadata"]);return f!=null&&d(t,["usageMetadata"],f),t}function yb(a,e){const t={},o=c(e,["values"]);return o!=null&&d(t,["values"],o),t}function vb(){return{}}function Tb(a,e){const t={},o=c(e,["embeddings"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>yb(a,f))),d(t,["embeddings"],u)}return c(e,["metadata"])!=null&&d(t,["metadata"],vb()),t}function Cb(a,e){const t={},o=c(e,["bytesBase64Encoded"]);o!=null&&d(t,["imageBytes"],Ji(a,o));const s=c(e,["mimeType"]);return s!=null&&d(t,["mimeType"],s),t}function qh(a,e){const t={},o=c(e,["safetyAttributes","categories"]);o!=null&&d(t,["categories"],o);const s=c(e,["safetyAttributes","scores"]);s!=null&&d(t,["scores"],s);const u=c(e,["contentType"]);return u!=null&&d(t,["contentType"],u),t}function Eb(a,e){const t={},o=c(e,["_self"]);o!=null&&d(t,["image"],Cb(a,o));const s=c(e,["raiFilteredReason"]);s!=null&&d(t,["raiFilteredReason"],s);const u=c(e,["_self"]);return u!=null&&d(t,["safetyAttributes"],qh(a,u)),t}function xb(a,e){const t={},o=c(e,["predictions"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>Eb(a,f))),d(t,["generatedImages"],u)}const s=c(e,["positivePromptSafetyAttributes"]);return s!=null&&d(t,["positivePromptSafetyAttributes"],qh(a,s)),t}function Sb(a,e){const t={},o=c(e,["baseModel"]);o!=null&&d(t,["baseModel"],o);const s=c(e,["createTime"]);s!=null&&d(t,["createTime"],s);const u=c(e,["updateTime"]);return u!=null&&d(t,["updateTime"],u),t}function Nc(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["name"],o);const s=c(e,["displayName"]);s!=null&&d(t,["displayName"],s);const u=c(e,["description"]);u!=null&&d(t,["description"],u);const f=c(e,["version"]);f!=null&&d(t,["version"],f);const g=c(e,["_self"]);g!=null&&d(t,["tunedModelInfo"],Sb(a,g));const h=c(e,["inputTokenLimit"]);h!=null&&d(t,["inputTokenLimit"],h);const p=c(e,["outputTokenLimit"]);p!=null&&d(t,["outputTokenLimit"],p);const v=c(e,["supportedGenerationMethods"]);return v!=null&&d(t,["supportedActions"],v),t}function bb(a,e){const t={},o=c(e,["nextPageToken"]);o!=null&&d(t,["nextPageToken"],o);const s=c(e,["_self"]);if(s!=null){let u=kh(a,s);Array.isArray(u)&&(u=u.map(f=>Nc(a,f))),d(t,["models"],u)}return t}function _b(){return{}}function Nb(a,e){const t={},o=c(e,["totalTokens"]);o!=null&&d(t,["totalTokens"],o);const s=c(e,["cachedContentTokenCount"]);return s!=null&&d(t,["cachedContentTokenCount"],s),t}function Ab(a,e){const t={},o=c(e,["video","uri"]);o!=null&&d(t,["uri"],o);const s=c(e,["video","encodedVideo"]);s!=null&&d(t,["videoBytes"],Ji(a,s));const u=c(e,["encoding"]);return u!=null&&d(t,["mimeType"],u),t}function wb(a,e){const t={},o=c(e,["_self"]);return o!=null&&d(t,["video"],Ab(a,o)),t}function Ib(a,e){const t={},o=c(e,["generatedSamples"]);if(o!=null){let f=o;Array.isArray(f)&&(f=f.map(g=>wb(a,g))),d(t,["generatedVideos"],f)}const s=c(e,["raiMediaFilteredCount"]);s!=null&&d(t,["raiMediaFilteredCount"],s);const u=c(e,["raiMediaFilteredReasons"]);return u!=null&&d(t,["raiMediaFilteredReasons"],u),t}function Rb(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["name"],o);const s=c(e,["metadata"]);s!=null&&d(t,["metadata"],s);const u=c(e,["done"]);u!=null&&d(t,["done"],u);const f=c(e,["error"]);f!=null&&d(t,["error"],f);const g=c(e,["response","generateVideoResponse"]);return g!=null&&d(t,["response"],Ib(a,g)),t}function Mb(a,e){const t={},o=c(e,["fps"]);o!=null&&d(t,["fps"],o);const s=c(e,["endOffset"]);s!=null&&d(t,["endOffset"],s);const u=c(e,["startOffset"]);return u!=null&&d(t,["startOffset"],u),t}function Lb(a,e){const t={},o=c(e,["displayName"]);o!=null&&d(t,["displayName"],o);const s=c(e,["data"]);s!=null&&d(t,["data"],s);const u=c(e,["mimeType"]);return u!=null&&d(t,["mimeType"],u),t}function kb(a,e){const t={},o=c(e,["displayName"]);o!=null&&d(t,["displayName"],o);const s=c(e,["fileUri"]);s!=null&&d(t,["fileUri"],s);const u=c(e,["mimeType"]);return u!=null&&d(t,["mimeType"],u),t}function $b(a,e){const t={},o=c(e,["videoMetadata"]);o!=null&&d(t,["videoMetadata"],Mb(a,o));const s=c(e,["thought"]);s!=null&&d(t,["thought"],s);const u=c(e,["inlineData"]);u!=null&&d(t,["inlineData"],Lb(a,u));const f=c(e,["fileData"]);f!=null&&d(t,["fileData"],kb(a,f));const g=c(e,["codeExecutionResult"]);g!=null&&d(t,["codeExecutionResult"],g);const h=c(e,["executableCode"]);h!=null&&d(t,["executableCode"],h);const p=c(e,["functionCall"]);p!=null&&d(t,["functionCall"],p);const v=c(e,["functionResponse"]);v!=null&&d(t,["functionResponse"],v);const T=c(e,["text"]);return T!=null&&d(t,["text"],T),t}function Pb(a,e){const t={},o=c(e,["parts"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>$b(a,f))),d(t,["parts"],u)}const s=c(e,["role"]);return s!=null&&d(t,["role"],s),t}function Db(a,e){const t={},o=c(e,["citations"]);return o!=null&&d(t,["citations"],o),t}function Ub(a,e){const t={},o=c(e,["content"]);o!=null&&d(t,["content"],Pb(a,o));const s=c(e,["citationMetadata"]);s!=null&&d(t,["citationMetadata"],Db(a,s));const u=c(e,["finishMessage"]);u!=null&&d(t,["finishMessage"],u);const f=c(e,["finishReason"]);f!=null&&d(t,["finishReason"],f);const g=c(e,["avgLogprobs"]);g!=null&&d(t,["avgLogprobs"],g);const h=c(e,["groundingMetadata"]);h!=null&&d(t,["groundingMetadata"],h);const p=c(e,["index"]);p!=null&&d(t,["index"],p);const v=c(e,["logprobsResult"]);v!=null&&d(t,["logprobsResult"],v);const T=c(e,["safetyRatings"]);return T!=null&&d(t,["safetyRatings"],T),t}function Qg(a,e){const t={},o=c(e,["candidates"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(v=>Ub(a,v))),d(t,["candidates"],p)}const s=c(e,["createTime"]);s!=null&&d(t,["createTime"],s);const u=c(e,["responseId"]);u!=null&&d(t,["responseId"],u);const f=c(e,["modelVersion"]);f!=null&&d(t,["modelVersion"],f);const g=c(e,["promptFeedback"]);g!=null&&d(t,["promptFeedback"],g);const h=c(e,["usageMetadata"]);return h!=null&&d(t,["usageMetadata"],h),t}function Ob(a,e){const t={},o=c(e,["truncated"]);o!=null&&d(t,["truncated"],o);const s=c(e,["token_count"]);return s!=null&&d(t,["tokenCount"],s),t}function Gb(a,e){const t={},o=c(e,["values"]);o!=null&&d(t,["values"],o);const s=c(e,["statistics"]);return s!=null&&d(t,["statistics"],Ob(a,s)),t}function Hb(a,e){const t={},o=c(e,["billableCharacterCount"]);return o!=null&&d(t,["billableCharacterCount"],o),t}function Vb(a,e){const t={},o=c(e,["predictions[]","embeddings"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>Gb(a,f))),d(t,["embeddings"],u)}const s=c(e,["metadata"]);return s!=null&&d(t,["metadata"],Hb(a,s)),t}function qb(a,e){const t={},o=c(e,["gcsUri"]);o!=null&&d(t,["gcsUri"],o);const s=c(e,["bytesBase64Encoded"]);s!=null&&d(t,["imageBytes"],Ji(a,s));const u=c(e,["mimeType"]);return u!=null&&d(t,["mimeType"],u),t}function Fh(a,e){const t={},o=c(e,["safetyAttributes","categories"]);o!=null&&d(t,["categories"],o);const s=c(e,["safetyAttributes","scores"]);s!=null&&d(t,["scores"],s);const u=c(e,["contentType"]);return u!=null&&d(t,["contentType"],u),t}function Dc(a,e){const t={},o=c(e,["_self"]);o!=null&&d(t,["image"],qb(a,o));const s=c(e,["raiFilteredReason"]);s!=null&&d(t,["raiFilteredReason"],s);const u=c(e,["_self"]);u!=null&&d(t,["safetyAttributes"],Fh(a,u));const f=c(e,["prompt"]);return f!=null&&d(t,["enhancedPrompt"],f),t}function Fb(a,e){const t={},o=c(e,["predictions"]);if(o!=null){let u=o;Array.isArray(u)&&(u=u.map(f=>Dc(a,f))),d(t,["generatedImages"],u)}const s=c(e,["positivePromptSafetyAttributes"]);return s!=null&&d(t,["positivePromptSafetyAttributes"],Fh(a,s)),t}function Yb(a,e){const t={},o=c(e,["predictions"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>Dc(a,u))),d(t,["generatedImages"],s)}return t}function Bb(a,e){const t={},o=c(e,["predictions"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>Dc(a,u))),d(t,["generatedImages"],s)}return t}function zb(a,e){const t={},o=c(e,["endpoint"]);o!=null&&d(t,["name"],o);const s=c(e,["deployedModelId"]);return s!=null&&d(t,["deployedModelId"],s),t}function Jb(a,e){const t={},o=c(e,["labels","google-vertex-llm-tuning-base-model-id"]);o!=null&&d(t,["baseModel"],o);const s=c(e,["createTime"]);s!=null&&d(t,["createTime"],s);const u=c(e,["updateTime"]);return u!=null&&d(t,["updateTime"],u),t}function Kb(a,e){const t={},o=c(e,["checkpointId"]);o!=null&&d(t,["checkpointId"],o);const s=c(e,["epoch"]);s!=null&&d(t,["epoch"],s);const u=c(e,["step"]);return u!=null&&d(t,["step"],u),t}function Ac(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["name"],o);const s=c(e,["displayName"]);s!=null&&d(t,["displayName"],s);const u=c(e,["description"]);u!=null&&d(t,["description"],u);const f=c(e,["versionId"]);f!=null&&d(t,["version"],f);const g=c(e,["deployedModels"]);if(g!=null){let C=g;Array.isArray(C)&&(C=C.map(S=>zb(a,S))),d(t,["endpoints"],C)}const h=c(e,["labels"]);h!=null&&d(t,["labels"],h);const p=c(e,["_self"]);p!=null&&d(t,["tunedModelInfo"],Jb(a,p));const v=c(e,["defaultCheckpointId"]);v!=null&&d(t,["defaultCheckpointId"],v);const T=c(e,["checkpoints"]);if(T!=null){let C=T;Array.isArray(C)&&(C=C.map(S=>Kb(a,S))),d(t,["checkpoints"],C)}return t}function Zb(a,e){const t={},o=c(e,["nextPageToken"]);o!=null&&d(t,["nextPageToken"],o);const s=c(e,["_self"]);if(s!=null){let u=kh(a,s);Array.isArray(u)&&(u=u.map(f=>Ac(a,f))),d(t,["models"],u)}return t}function Xb(){return{}}function jb(a,e){const t={},o=c(e,["totalTokens"]);return o!=null&&d(t,["totalTokens"],o),t}function Qb(a,e){const t={},o=c(e,["tokensInfo"]);return o!=null&&d(t,["tokensInfo"],o),t}function Wb(a,e){const t={},o=c(e,["gcsUri"]);o!=null&&d(t,["uri"],o);const s=c(e,["bytesBase64Encoded"]);s!=null&&d(t,["videoBytes"],Ji(a,s));const u=c(e,["mimeType"]);return u!=null&&d(t,["mimeType"],u),t}function e_(a,e){const t={},o=c(e,["_self"]);return o!=null&&d(t,["video"],Wb(a,o)),t}function t_(a,e){const t={},o=c(e,["videos"]);if(o!=null){let f=o;Array.isArray(f)&&(f=f.map(g=>e_(a,g))),d(t,["generatedVideos"],f)}const s=c(e,["raiMediaFilteredCount"]);s!=null&&d(t,["raiMediaFilteredCount"],s);const u=c(e,["raiMediaFilteredReasons"]);return u!=null&&d(t,["raiMediaFilteredReasons"],u),t}function n_(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["name"],o);const s=c(e,["metadata"]);s!=null&&d(t,["metadata"],s);const u=c(e,["done"]);u!=null&&d(t,["done"],u);const f=c(e,["error"]);f!=null&&d(t,["error"],f);const g=c(e,["response"]);return g!=null&&d(t,["response"],t_(a,g)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const i_="Content-Type",a_="X-Server-Timeout",o_="User-Agent",wc="x-goog-api-client",r_="1.2.0",s_=`google-genai-sdk/${r_}`,l_="v1beta1",u_="v1beta",Wg=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Yh extends Error{constructor(e,t){t?super(e,{cause:t}):super(e,{cause:new Error().stack}),this.message=e,this.name="ClientError"}}class Ic extends Error{constructor(e,t){t?super(e,{cause:t}):super(e,{cause:new Error().stack}),this.message=e,this.name="ServerError"}}class c_{constructor(e){var t,o;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const s={};this.clientOptions.vertexai?(s.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:l_,s.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(s.apiVersion=(o=this.clientOptions.apiVersion)!==null&&o!==void 0?o:u_,s.baseUrl="https://generativelanguage.googleapis.com/"),s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const o=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&o.push(e.apiVersion),o.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,o){const s=[this.getRequestUrlInternal(t)];return o&&s.push(this.getBaseResourcePath()),e!==""&&s.push(e),new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const o=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,o);if(e.queryParams)for(const[f,g]of Object.entries(e.queryParams))s.searchParams.append(f,String(g));let u={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else u.body=e.body;return u=await this.includeExtraHttpOptionsToRequestInit(u,t,e.abortSignal),this.unaryApiCall(s,u,e.httpMethod)}patchHttpOptions(e,t){const o=JSON.parse(JSON.stringify(e));for(const[s,u]of Object.entries(t))typeof u=="object"?o[s]=Object.assign(Object.assign({},o[s]),u):u!==void 0&&(o[s]=u);return o}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const o=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,o);(!s.searchParams.has("alt")||s.searchParams.get("alt")!=="sse")&&s.searchParams.set("alt","sse");let u={};return u.body=e.body,u=await this.includeExtraHttpOptionsToRequestInit(u,t,e.abortSignal),this.streamApiCall(s,u,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,o){if(t&&t.timeout||o){const s=new AbortController,u=s.signal;t.timeout&&(t==null?void 0:t.timeout)>0&&setTimeout(()=>s.abort(),t.timeout),o&&o.addEventListener("abort",()=>{s.abort()}),e.signal=u}return e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,o){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:o})).then(async s=>(await eh(s),new xc(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}async streamApiCall(e,t,o){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:o})).then(async s=>(await eh(s),this.processStreamResponse(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}processStreamResponse(e){var t;return fr(this,arguments,function*(){const s=(t=e==null?void 0:e.body)===null||t===void 0?void 0:t.getReader(),u=new TextDecoder("utf-8");if(!s)throw new Error("Response body is empty");try{let f="";for(;;){const{done:g,value:h}=yield Lt(s.read());if(g){if(f.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const p=u.decode(h);try{const T=JSON.parse(p);if("error"in T){const C=JSON.parse(JSON.stringify(T.error)),S=C.status,w=C.code,I=`got status: ${S}. ${JSON.stringify(T)}`;if(w>=400&&w<500)throw new Yh(I);if(w>=500&&w<600)throw new Ic(I)}}catch(T){const C=T;if(C.name==="ClientError"||C.name==="ServerError")throw T}f+=p;let v=f.match(Wg);for(;v;){const T=v[1];try{const C=new Response(T,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield Lt(new xc(C)),f=f.slice(v[0].length),v=f.match(Wg)}catch(C){throw new Error(`exception parsing stream chunk ${T}. ${C}`)}}}}finally{s.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(o=>{throw new Error(`exception ${o} sending request`)})}getDefaultHeaders(){const e={},t=s_+" "+this.clientOptions.userAgentExtra;return e[o_]=t,e[wc]=t,e[i_]="application/json",e}async getHeadersInternal(e){const t=new Headers;if(e&&e.headers){for(const[o,s]of Object.entries(e.headers))t.append(o,s);e.timeout&&e.timeout>0&&t.append(a_,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var o;const s={};t!=null&&(s.mimeType=t.mimeType,s.name=t.name,s.displayName=t.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);const u=this.clientOptions.uploader,f=await u.stat(e);s.sizeBytes=String(f.size);const g=(o=t==null?void 0:t.mimeType)!==null&&o!==void 0?o:f.type;if(g===void 0||g==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=g;const h=await this.fetchUploadUrl(s,t);return u.upload(e,h,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t){var o;let s={};t!=null&&t.httpOptions?s=t.httpOptions:s={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const u={file:e},f=await this.request({path:De("upload/v1beta/files",u._url),body:JSON.stringify(u),httpMethod:"POST",httpOptions:s});if(!f||!(f!=null&&f.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const g=(o=f==null?void 0:f.headers)===null||o===void 0?void 0:o["x-goog-upload-url"];if(g===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return g}}async function eh(a){var e;if(a===void 0)throw new Ic("response is undefined");if(!a.ok){const t=a.status,o=a.statusText;let s;!((e=a.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?s=await a.json():s={error:{message:await a.text(),code:a.status,status:a.statusText}};const u=`got status: ${t} ${o}. ${JSON.stringify(s)}`;throw t>=400&&t<500?new Yh(u):t>=500&&t<600?new Ic(u):new Error(u)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const d_="mcp_used/unknown";function Bh(a){for(const e of a)if(Uc(e)||typeof e=="object"&&"inputSchema"in e)return!0;return!1}function zh(a){var e;const t=(e=a[wc])!==null&&e!==void 0?e:"";a[wc]=(t+` ${d_}`).trimStart()}function f_(a){var e,t,o;return(o=(t=(e=a.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(s=>Uc(s)))!==null&&o!==void 0?o:!1}function m_(a){var e,t,o;return(o=(t=(e=a.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(s=>!Uc(s)))!==null&&o!==void 0?o:!1}function Uc(a){return a!==null&&typeof a=="object"&&"tool"in a&&"callTool"in a}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function p_(a,e,t){const o=new mC;let s;t.data instanceof Blob?s=JSON.parse(await t.data.text()):s=JSON.parse(t.data);const u=wx(a,s);Object.assign(o,u),e(o)}class g_{constructor(e,t,o){this.apiClient=e,this.auth=t,this.webSocketFactory=o}async connect(e){var t,o;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const s=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion(),f=v_(this.apiClient.getDefaultHeaders()),g=this.apiClient.getApiKey(),h=`${s}/ws/google.ai.generativelanguage.${u}.GenerativeService.BidiGenerateMusic?key=${g}`;let p=()=>{};const v=new Promise(L=>{p=L}),T=e.callbacks,C=function(){p({})},S=this.apiClient,w={onopen:C,onmessage:L=>{p_(S,T.onmessage,L)},onerror:(t=T==null?void 0:T.onerror)!==null&&t!==void 0?t:function(L){},onclose:(o=T==null?void 0:T.onclose)!==null&&o!==void 0?o:function(L){}},I=this.webSocketFactory.create(h,y_(f),w);I.connect(),await v;const b=wt(this.apiClient,e.model),A=Oh(this.apiClient,{model:b}),M=_c(this.apiClient,{setup:A});return I.send(JSON.stringify(M)),new h_(I,this.apiClient)}}class h_{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=qE(this.apiClient,e),o=Gh(this.apiClient,t);this.conn.send(JSON.stringify({clientContent:o}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=FE(this.apiClient,e),o=_c(this.apiClient,t);this.conn.send(JSON.stringify(o))}sendPlaybackControl(e){const t=_c(this.apiClient,{playbackControl:e});this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(no.PLAY)}pause(){this.sendPlaybackControl(no.PAUSE)}stop(){this.sendPlaybackControl(no.STOP)}resetContext(){this.sendPlaybackControl(no.RESET_CONTEXT)}close(){this.conn.close()}}function y_(a){const e={};return a.forEach((t,o)=>{e[o]=t}),e}function v_(a){const e=new Headers;for(const[t,o]of Object.entries(a))e.append(t,o);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const T_="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function C_(a,e,t){const o=new fC;let s;if(t.data instanceof Blob?s=JSON.parse(await t.data.text()):s=JSON.parse(t.data),a.isVertexAI()){const u=Tx(a,s);Object.assign(o,u)}else{const u=vx(a,s);Object.assign(o,u)}e(o)}class E_{constructor(e,t,o){this.apiClient=e,this.auth=t,this.webSocketFactory=o,this.music=new g_(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,o,s,u,f,g;const h=this.apiClient.getWebsocketBaseUrl(),p=this.apiClient.getApiVersion();let v;const T=this.apiClient.getDefaultHeaders();e.config&&e.config.tools&&Bh(e.config.tools)&&zh(T);const C=__(T);if(this.apiClient.isVertexAI())v=`${h}/ws/google.cloud.aiplatform.${p}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(C);else{const F=this.apiClient.getApiKey();v=`${h}/ws/google.ai.generativelanguage.${p}.GenerativeService.BidiGenerateContent?key=${F}`}let S=()=>{};const w=new Promise(F=>{S=F}),I=e.callbacks,b=function(){var F;(F=I==null?void 0:I.onopen)===null||F===void 0||F.call(I),S({})},A=this.apiClient,M={onopen:b,onmessage:F=>{C_(A,I.onmessage,F)},onerror:(t=I==null?void 0:I.onerror)!==null&&t!==void 0?t:function(F){},onclose:(o=I==null?void 0:I.onclose)!==null&&o!==void 0?o:function(F){}},L=this.webSocketFactory.create(v,b_(C),M);L.connect(),await w;let R=wt(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&R.startsWith("publishers/")){const F=this.apiClient.getProject(),ae=this.apiClient.getLocation();R=`projects/${F}/locations/${ae}/`+R}let $={};this.apiClient.isVertexAI()&&((s=e.config)===null||s===void 0?void 0:s.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Ys.AUDIO]}:e.config.responseModalities=[Ys.AUDIO]),!((u=e.config)===null||u===void 0)&&u.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const V=(g=(f=e.config)===null||f===void 0?void 0:f.tools)!==null&&g!==void 0?g:[],Q=[];for(const F of V)if(this.isCallableTool(F)){const ae=F;Q.push(await ae.tool())}else Q.push(F);Q.length>0&&(e.config.tools=Q);const te={model:R,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?$=PE(this.apiClient,te):$=$E(this.apiClient,te),delete $.config,L.send(JSON.stringify($)),new S_(L,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const x_={turnComplete:!0};class S_{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let o=[];try{o=Fn(e,t.turns),e.isVertexAI()?o=o.map(s=>uo(e,s)):o=o.map(s=>js(e,s))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:o,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let o=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?o=t.functionResponses:o=[t.functionResponses],o.length===0)throw new Error("functionResponses is required.");for(const u of o){if(typeof u!="object"||u===null||!("name"in u)||!("response"in u))throw new Error(`Could not parse function response, type '${typeof u}'.`);if(!e.isVertexAI()&&!("id"in u))throw new Error(T_)}return{toolResponse:{functionResponses:o}}}sendClientContent(e){e=Object.assign(Object.assign({},x_),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:VE(this.apiClient,e)}:t={realtimeInput:HE(this.apiClient,e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function b_(a){const e={};return a.forEach((t,o)=>{e[o]=t}),e}function __(a){const e=new Headers;for(const[t,o]of Object.entries(a))e.append(t,o);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const th=10;function nh(a){var e,t,o;if(!((e=a==null?void 0:a.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let s=!1;for(const f of(t=a==null?void 0:a.tools)!==null&&t!==void 0?t:[])if(Us(f)){s=!0;break}if(!s)return!0;const u=(o=a==null?void 0:a.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls;return u&&(u<0||!Number.isInteger(u))||u==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",u),!0):!1}function Us(a){return"callTool"in a&&typeof a.callTool=="function"}function ih(a){var e;return!(!((e=a==null?void 0:a.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class N_ extends hr{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var o,s,u,f,g;const h=await this.processParamsForMcpUsage(t);if(!f_(t)||nh(t.config))return await this.generateContentInternal(h);if(m_(t))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let p,v;const T=Fn(this.apiClient,h.contents),C=(u=(s=(o=h.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&u!==void 0?u:th;let S=0;for(;S<C&&(p=await this.generateContentInternal(h),!(!p.functionCalls||p.functionCalls.length===0));){const w=p.candidates[0].content,I=[];for(const b of(g=(f=t.config)===null||f===void 0?void 0:f.tools)!==null&&g!==void 0?g:[])if(Us(b)){const M=await b.callTool(p.functionCalls);I.push(...M)}S++,v={role:"user",parts:I},h.contents=Fn(this.apiClient,h.contents),h.contents.push(w),h.contents.push(v),ih(h.config)&&(T.push(w),T.push(v))}return ih(h.config)&&(p.automaticFunctionCallingHistory=T),p},this.generateContentStream=async t=>{if(nh(t.config)){const o=await this.processParamsForMcpUsage(t);return await this.generateContentStreamInternal(o)}else return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(o=>{var s;let u;const f=[];if(o!=null&&o.generatedImages)for(const h of o.generatedImages)h&&(h!=null&&h.safetyAttributes)&&((s=h==null?void 0:h.safetyAttributes)===null||s===void 0?void 0:s.contentType)==="Positive Prompt"?u=h==null?void 0:h.safetyAttributes:f.push(h);let g;return u?g={generatedImages:f,positivePromptSafetyAttributes:u}:g={generatedImages:f},g}),this.list=async t=>{var o;const f={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!f.config.queryBase){if(!((o=f.config)===null||o===void 0)&&o.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");f.config.filter="labels.tune-type:*"}return new Xs(lo.PAGED_ITEM_MODELS,g=>this.listInternal(g),await this.listInternal(f),f)},this.editImage=async t=>{const o={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(o.referenceImages=t.referenceImages.map(s=>s.toReferenceImageAPI())),await this.editImageInternal(o)},this.upscaleImage=async t=>{let o={numberOfImages:1,mode:"upscale"};t.config&&(o=Object.assign(Object.assign({},o),t.config));const s={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:o};return await this.upscaleImageInternal(s)}}async processParamsForMcpUsage(e){var t,o,s;const u=(t=e.config)===null||t===void 0?void 0:t.tools;if(!u)return e;const f=await Promise.all(u.map(async h=>Us(h)?await h.tool():h)),g={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:f})};if(g.config.tools=f,e.config&&e.config.tools&&Bh(e.config.tools)){const h=(s=(o=e.config.httpOptions)===null||o===void 0?void 0:o.headers)!==null&&s!==void 0?s:{};let p=Object.assign({},h);Object.keys(p).length===0&&(p=this.apiClient.getDefaultHeaders()),zh(p),g.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:p})}return g}async initAfcToolsMap(e){var t,o,s;const u=new Map;for(const f of(o=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&o!==void 0?o:[])if(Us(f)){const g=f,h=await g.tool();for(const p of(s=h.functionDeclarations)!==null&&s!==void 0?s:[]){if(!p.name)throw new Error("Function declaration name is required.");if(u.has(p.name))throw new Error(`Duplicate tool declaration name: ${p.name}`);u.set(p.name,g)}}return u}async processAfcStream(e){var t,o,s;const u=(s=(o=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&s!==void 0?s:th;let f=!1,g=0;const h=await this.initAfcToolsMap(e);return function(p,v,T){var C,S;return fr(this,arguments,function*(){for(var w,I,b,A;g<u;){f&&(g++,f=!1);const $=yield Lt(p.processParamsForMcpUsage(T)),V=yield Lt(p.generateContentStreamInternal($)),Q=[],te=[];try{for(var M=!0,L=(I=void 0,Ds(V)),R;R=yield Lt(L.next()),w=R.done,!w;M=!0){A=R.value,M=!1;const F=A;if(yield yield Lt(F),F.candidates&&(!((C=F.candidates[0])===null||C===void 0)&&C.content)){te.push(F.candidates[0].content);for(const ae of(S=F.candidates[0].content.parts)!==null&&S!==void 0?S:[])if(g<u&&ae.functionCall){if(!ae.functionCall.name)throw new Error("Function call name was not returned by the model.");if(v.has(ae.functionCall.name)){const W=yield Lt(v.get(ae.functionCall.name).callTool([ae.functionCall]));Q.push(...W)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${v.keys()}, mising tool: ${ae.functionCall.name}`)}}}}catch(F){I={error:F}}finally{try{!M&&!w&&(b=L.return)&&(yield Lt(b.call(L)))}finally{if(I)throw I.error}}if(Q.length>0){f=!0;const F=new sr;F.candidates=[{content:{role:"user",parts:Q}}],yield yield Lt(F);const ae=[];ae.push(...te),ae.push({role:"user",parts:Q});const W=Fn(p.apiClient,T.contents).concat(ae);T.contents=W}else break}})}(this,h,e)}async generateContentInternal(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=Xg(this.apiClient,e);return g=De("{model}:generateContent",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>{const T=Qg(this.apiClient,v),C=new sr;return Object.assign(C,T),C})}else{const p=Zg(this.apiClient,e);return g=De("{model}:generateContent",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>{const T=jg(this.apiClient,v),C=new sr;return Object.assign(C,T),C})}}async generateContentStreamInternal(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=Xg(this.apiClient,e);g=De("{model}:streamGenerateContent?alt=sse",p._url),h=p._query,delete p.config,delete p._url,delete p._query;const v=this.apiClient;return f=v.requestStream({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),f.then(function(T){return fr(this,arguments,function*(){var C,S,w,I;try{for(var b=!0,A=Ds(T),M;M=yield Lt(A.next()),C=M.done,!C;b=!0){I=M.value,b=!1;const R=Qg(v,yield Lt(I.json())),$=new sr;Object.assign($,R),yield yield Lt($)}}catch(L){S={error:L}}finally{try{!b&&!C&&(w=A.return)&&(yield Lt(w.call(A)))}finally{if(S)throw S.error}}})})}else{const p=Zg(this.apiClient,e);g=De("{model}:streamGenerateContent?alt=sse",p._url),h=p._query,delete p.config,delete p._url,delete p._query;const v=this.apiClient;return f=v.requestStream({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}),f.then(function(T){return fr(this,arguments,function*(){var C,S,w,I;try{for(var b=!0,A=Ds(T),M;M=yield Lt(A.next()),C=M.done,!C;b=!0){I=M.value,b=!1;const R=jg(v,yield Lt(I.json())),$=new sr;Object.assign($,R),yield yield Lt($)}}catch(L){S={error:L}}finally{try{!b&&!C&&(w=A.return)&&(yield Lt(w.call(A)))}finally{if(S)throw S.error}}})})}}async embedContent(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=GS(this.apiClient,e);return g=De("{model}:predict",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>{const T=Vb(this.apiClient,v),C=new Ig;return Object.assign(C,T),C})}else{const p=Wx(this.apiClient,e);return g=De("{model}:batchEmbedContents",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>{const T=Tb(this.apiClient,v),C=new Ig;return Object.assign(C,T),C})}}async generateImagesInternal(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=VS(this.apiClient,e);return g=De("{model}:predict",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>{const T=Fb(this.apiClient,v),C=new Rg;return Object.assign(C,T),C})}else{const p=tS(this.apiClient,e);return g=De("{model}:predict",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>{const T=xb(this.apiClient,v),C=new Rg;return Object.assign(C,T),C})}}async editImageInternal(e){var t,o;let s,u="",f={};if(this.apiClient.isVertexAI()){const g=KS(this.apiClient,e);return u=De("{model}:predict",g._url),f=g._query,delete g.config,delete g._url,delete g._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{const p=Yb(this.apiClient,h),v=new rC;return Object.assign(v,p),v})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,o;let s,u="",f={};if(this.apiClient.isVertexAI()){const g=XS(this.apiClient,e);return u=De("{model}:predict",g._url),f=g._query,delete g.config,delete g._url,delete g._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{const p=Bb(this.apiClient,h),v=new sC;return Object.assign(v,p),v})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=jS(this.apiClient,e);return g=De("{name}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>Ac(this.apiClient,v))}else{const p=nS(this.apiClient,e);return g=De("{name}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>Nc(this.apiClient,v))}}async listInternal(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=WS(this.apiClient,e);return g=De("{models_url}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>{const T=Zb(this.apiClient,v),C=new Mg;return Object.assign(C,T),C})}else{const p=aS(this.apiClient,e);return g=De("{models_url}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>{const T=bb(this.apiClient,v),C=new Mg;return Object.assign(C,T),C})}}async update(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=tb(this.apiClient,e);return g=De("{model}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>Ac(this.apiClient,v))}else{const p=rS(this.apiClient,e);return g=De("{name}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>Nc(this.apiClient,v))}}async delete(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=nb(this.apiClient,e);return g=De("{name}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(()=>{const v=Xb(),T=new Lg;return Object.assign(T,v),T})}else{const p=sS(this.apiClient,e);return g=De("{name}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(()=>{const v=_b(),T=new Lg;return Object.assign(T,v),T})}}async countTokens(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=ab(this.apiClient,e);return g=De("{model}:countTokens",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>{const T=jb(this.apiClient,v),C=new kg;return Object.assign(C,T),C})}else{const p=uS(this.apiClient,e);return g=De("{model}:countTokens",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>{const T=Nb(this.apiClient,v),C=new kg;return Object.assign(C,T),C})}}async computeTokens(e){var t,o;let s,u="",f={};if(this.apiClient.isVertexAI()){const g=ob(this.apiClient,e);return u=De("{model}:computeTokens",g._url),f=g._query,delete g.config,delete g._url,delete g._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>{const p=Qb(this.apiClient,h),v=new lC;return Object.assign(v,p),v})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=sb(this.apiClient,e);return g=De("{model}:predictLongRunning",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>n_(this.apiClient,v))}else{const p=fS(this.apiClient,e);return g=De("{model}:predictLongRunning",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>Rb(this.apiClient,v))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function A_(a,e){const t={},o=c(e,["operationName"]);o!=null&&d(t,["_url","operationName"],o);const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function w_(a,e){const t={},o=c(e,["operationName"]);o!=null&&d(t,["_url","operationName"],o);const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function I_(a,e){const t={},o=c(e,["operationName"]);o!=null&&d(t,["operationName"],o);const s=c(e,["resourceName"]);s!=null&&d(t,["_url","resourceName"],s);const u=c(e,["config"]);return u!=null&&d(t,["config"],u),t}function R_(a,e){const t={},o=c(e,["video","uri"]);o!=null&&d(t,["uri"],o);const s=c(e,["video","encodedVideo"]);s!=null&&d(t,["videoBytes"],Ji(a,s));const u=c(e,["encoding"]);return u!=null&&d(t,["mimeType"],u),t}function M_(a,e){const t={},o=c(e,["_self"]);return o!=null&&d(t,["video"],R_(a,o)),t}function L_(a,e){const t={},o=c(e,["generatedSamples"]);if(o!=null){let f=o;Array.isArray(f)&&(f=f.map(g=>M_(a,g))),d(t,["generatedVideos"],f)}const s=c(e,["raiMediaFilteredCount"]);s!=null&&d(t,["raiMediaFilteredCount"],s);const u=c(e,["raiMediaFilteredReasons"]);return u!=null&&d(t,["raiMediaFilteredReasons"],u),t}function k_(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["name"],o);const s=c(e,["metadata"]);s!=null&&d(t,["metadata"],s);const u=c(e,["done"]);u!=null&&d(t,["done"],u);const f=c(e,["error"]);f!=null&&d(t,["error"],f);const g=c(e,["response","generateVideoResponse"]);return g!=null&&d(t,["response"],L_(a,g)),t}function $_(a,e){const t={},o=c(e,["gcsUri"]);o!=null&&d(t,["uri"],o);const s=c(e,["bytesBase64Encoded"]);s!=null&&d(t,["videoBytes"],Ji(a,s));const u=c(e,["mimeType"]);return u!=null&&d(t,["mimeType"],u),t}function P_(a,e){const t={},o=c(e,["_self"]);return o!=null&&d(t,["video"],$_(a,o)),t}function D_(a,e){const t={},o=c(e,["videos"]);if(o!=null){let f=o;Array.isArray(f)&&(f=f.map(g=>P_(a,g))),d(t,["generatedVideos"],f)}const s=c(e,["raiMediaFilteredCount"]);s!=null&&d(t,["raiMediaFilteredCount"],s);const u=c(e,["raiMediaFilteredReasons"]);return u!=null&&d(t,["raiMediaFilteredReasons"],u),t}function ah(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["name"],o);const s=c(e,["metadata"]);s!=null&&d(t,["metadata"],s);const u=c(e,["done"]);u!=null&&d(t,["done"],u);const f=c(e,["error"]);f!=null&&d(t,["error"],f);const g=c(e,["response"]);return g!=null&&d(t,["response"],D_(a,g)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class U_ extends hr{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,o=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=t.name.split("/operations/")[0];let u;return o&&"httpOptions"in o&&(u=o.httpOptions),this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:u}})}else return this.getVideosOperationInternal({operationName:t.name,config:o})}async getVideosOperationInternal(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=w_(this.apiClient,e);return g=De("{operationName}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>ah(this.apiClient,v))}else{const p=A_(this.apiClient,e);return g=De("{operationName}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>k_(this.apiClient,v))}}async fetchPredictVideosOperationInternal(e){var t,o;let s,u="",f={};if(this.apiClient.isVertexAI()){const g=I_(this.apiClient,e);return u=De("{resourceName}:fetchPredictOperation",g._url),f=g._query,delete g.config,delete g._url,delete g._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>ah(this.apiClient,h))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function O_(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["_url","name"],o);const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function G_(a,e,t){const o={},s=c(e,["pageSize"]);t!==void 0&&s!=null&&d(t,["_query","pageSize"],s);const u=c(e,["pageToken"]);t!==void 0&&u!=null&&d(t,["_query","pageToken"],u);const f=c(e,["filter"]);return t!==void 0&&f!=null&&d(t,["_query","filter"],f),o}function H_(a,e){const t={},o=c(e,["config"]);return o!=null&&d(t,["config"],G_(a,o,t)),t}function V_(a,e){const t={},o=c(e,["textInput"]);o!=null&&d(t,["textInput"],o);const s=c(e,["output"]);return s!=null&&d(t,["output"],s),t}function q_(a,e){const t={};if(c(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const o=c(e,["examples"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(u=>V_(a,u))),d(t,["examples","examples"],s)}return t}function F_(a,e,t){const o={};if(c(e,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const s=c(e,["tunedModelDisplayName"]);if(t!==void 0&&s!=null&&d(t,["displayName"],s),c(e,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const u=c(e,["epochCount"]);t!==void 0&&u!=null&&d(t,["tuningTask","hyperparameters","epochCount"],u);const f=c(e,["learningRateMultiplier"]);if(f!=null&&d(o,["tuningTask","hyperparameters","learningRateMultiplier"],f),c(e,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(c(e,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const g=c(e,["batchSize"]);t!==void 0&&g!=null&&d(t,["tuningTask","hyperparameters","batchSize"],g);const h=c(e,["learningRate"]);return t!==void 0&&h!=null&&d(t,["tuningTask","hyperparameters","learningRate"],h),o}function Y_(a,e){const t={},o=c(e,["baseModel"]);o!=null&&d(t,["baseModel"],o);const s=c(e,["trainingDataset"]);s!=null&&d(t,["tuningTask","trainingData"],q_(a,s));const u=c(e,["config"]);return u!=null&&d(t,["config"],F_(a,u,t)),t}function B_(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["_url","name"],o);const s=c(e,["config"]);return s!=null&&d(t,["config"],s),t}function z_(a,e,t){const o={},s=c(e,["pageSize"]);t!==void 0&&s!=null&&d(t,["_query","pageSize"],s);const u=c(e,["pageToken"]);t!==void 0&&u!=null&&d(t,["_query","pageToken"],u);const f=c(e,["filter"]);return t!==void 0&&f!=null&&d(t,["_query","filter"],f),o}function J_(a,e){const t={},o=c(e,["config"]);return o!=null&&d(t,["config"],z_(a,o,t)),t}function K_(a,e,t){const o={},s=c(e,["gcsUri"]);if(t!==void 0&&s!=null&&d(t,["supervisedTuningSpec","trainingDatasetUri"],s),c(e,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return o}function Z_(a,e){const t={},o=c(e,["gcsUri"]);return o!=null&&d(t,["validationDatasetUri"],o),t}function X_(a,e,t){const o={},s=c(e,["validationDataset"]);t!==void 0&&s!=null&&d(t,["supervisedTuningSpec"],Z_(a,s));const u=c(e,["tunedModelDisplayName"]);t!==void 0&&u!=null&&d(t,["tunedModelDisplayName"],u);const f=c(e,["description"]);t!==void 0&&f!=null&&d(t,["description"],f);const g=c(e,["epochCount"]);t!==void 0&&g!=null&&d(t,["supervisedTuningSpec","hyperParameters","epochCount"],g);const h=c(e,["learningRateMultiplier"]);t!==void 0&&h!=null&&d(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],h);const p=c(e,["exportLastCheckpointOnly"]);t!==void 0&&p!=null&&d(t,["supervisedTuningSpec","exportLastCheckpointOnly"],p);const v=c(e,["adapterSize"]);if(t!==void 0&&v!=null&&d(t,["supervisedTuningSpec","hyperParameters","adapterSize"],v),c(e,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(c(e,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return o}function j_(a,e){const t={},o=c(e,["baseModel"]);o!=null&&d(t,["baseModel"],o);const s=c(e,["trainingDataset"]);s!=null&&d(t,["supervisedTuningSpec","trainingDatasetUri"],K_(a,s,t));const u=c(e,["config"]);return u!=null&&d(t,["config"],X_(a,u,t)),t}function Q_(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["model"],o);const s=c(e,["name"]);return s!=null&&d(t,["endpoint"],s),t}function Jh(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["name"],o);const s=c(e,["state"]);s!=null&&d(t,["state"],Rh(a,s));const u=c(e,["createTime"]);u!=null&&d(t,["createTime"],u);const f=c(e,["tuningTask","startTime"]);f!=null&&d(t,["startTime"],f);const g=c(e,["tuningTask","completeTime"]);g!=null&&d(t,["endTime"],g);const h=c(e,["updateTime"]);h!=null&&d(t,["updateTime"],h);const p=c(e,["description"]);p!=null&&d(t,["description"],p);const v=c(e,["baseModel"]);v!=null&&d(t,["baseModel"],v);const T=c(e,["_self"]);T!=null&&d(t,["tunedModel"],Q_(a,T));const C=c(e,["distillationSpec"]);C!=null&&d(t,["distillationSpec"],C);const S=c(e,["experiment"]);S!=null&&d(t,["experiment"],S);const w=c(e,["labels"]);w!=null&&d(t,["labels"],w);const I=c(e,["pipelineJob"]);I!=null&&d(t,["pipelineJob"],I);const b=c(e,["serviceAccount"]);b!=null&&d(t,["serviceAccount"],b);const A=c(e,["tunedModelDisplayName"]);return A!=null&&d(t,["tunedModelDisplayName"],A),t}function W_(a,e){const t={},o=c(e,["nextPageToken"]);o!=null&&d(t,["nextPageToken"],o);const s=c(e,["tunedModels"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(f=>Jh(a,f))),d(t,["tuningJobs"],u)}return t}function eN(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["name"],o);const s=c(e,["metadata"]);s!=null&&d(t,["metadata"],s);const u=c(e,["done"]);u!=null&&d(t,["done"],u);const f=c(e,["error"]);return f!=null&&d(t,["error"],f),t}function tN(a,e){const t={},o=c(e,["checkpointId"]);o!=null&&d(t,["checkpointId"],o);const s=c(e,["epoch"]);s!=null&&d(t,["epoch"],s);const u=c(e,["step"]);u!=null&&d(t,["step"],u);const f=c(e,["endpoint"]);return f!=null&&d(t,["endpoint"],f),t}function nN(a,e){const t={},o=c(e,["model"]);o!=null&&d(t,["model"],o);const s=c(e,["endpoint"]);s!=null&&d(t,["endpoint"],s);const u=c(e,["checkpoints"]);if(u!=null){let f=u;Array.isArray(f)&&(f=f.map(g=>tN(a,g))),d(t,["checkpoints"],f)}return t}function Rc(a,e){const t={},o=c(e,["name"]);o!=null&&d(t,["name"],o);const s=c(e,["state"]);s!=null&&d(t,["state"],Rh(a,s));const u=c(e,["createTime"]);u!=null&&d(t,["createTime"],u);const f=c(e,["startTime"]);f!=null&&d(t,["startTime"],f);const g=c(e,["endTime"]);g!=null&&d(t,["endTime"],g);const h=c(e,["updateTime"]);h!=null&&d(t,["updateTime"],h);const p=c(e,["error"]);p!=null&&d(t,["error"],p);const v=c(e,["description"]);v!=null&&d(t,["description"],v);const T=c(e,["baseModel"]);T!=null&&d(t,["baseModel"],T);const C=c(e,["tunedModel"]);C!=null&&d(t,["tunedModel"],nN(a,C));const S=c(e,["supervisedTuningSpec"]);S!=null&&d(t,["supervisedTuningSpec"],S);const w=c(e,["tuningDataStats"]);w!=null&&d(t,["tuningDataStats"],w);const I=c(e,["encryptionSpec"]);I!=null&&d(t,["encryptionSpec"],I);const b=c(e,["partnerModelTuningSpec"]);b!=null&&d(t,["partnerModelTuningSpec"],b);const A=c(e,["distillationSpec"]);A!=null&&d(t,["distillationSpec"],A);const M=c(e,["experiment"]);M!=null&&d(t,["experiment"],M);const L=c(e,["labels"]);L!=null&&d(t,["labels"],L);const R=c(e,["pipelineJob"]);R!=null&&d(t,["pipelineJob"],R);const $=c(e,["serviceAccount"]);$!=null&&d(t,["serviceAccount"],$);const V=c(e,["tunedModelDisplayName"]);return V!=null&&d(t,["tunedModelDisplayName"],V),t}function iN(a,e){const t={},o=c(e,["nextPageToken"]);o!=null&&d(t,["nextPageToken"],o);const s=c(e,["tuningJobs"]);if(s!=null){let u=s;Array.isArray(u)&&(u=u.map(f=>Rc(a,f))),d(t,["tuningJobs"],u)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class aN extends hr{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new Xs(lo.PAGED_ITEM_TUNING_JOBS,o=>this.listInternal(o),await this.listInternal(t),t),this.tune=async t=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(t);{const o=await this.tuneMldevInternal(t);let s="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?s=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(s=o.name.split("/operations/")[0]),{name:s,state:Ec.JOB_STATE_QUEUED}}}}async getInternal(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=B_(this.apiClient,e);return g=De("{name}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>Rc(this.apiClient,v))}else{const p=O_(this.apiClient,e);return g=De("{name}",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>Jh(this.apiClient,v))}}async listInternal(e){var t,o,s,u;let f,g="",h={};if(this.apiClient.isVertexAI()){const p=J_(this.apiClient,e);return g=De("tuningJobs",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(v=>v.json()),f.then(v=>{const T=iN(this.apiClient,v),C=new $g;return Object.assign(C,T),C})}else{const p=H_(this.apiClient,e);return g=De("tunedModels",p._url),h=p._query,delete p.config,delete p._url,delete p._query,f=this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(p),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(u=e.config)===null||u===void 0?void 0:u.abortSignal}).then(v=>v.json()),f.then(v=>{const T=W_(this.apiClient,v),C=new $g;return Object.assign(C,T),C})}}async tuneInternal(e){var t,o;let s,u="",f={};if(this.apiClient.isVertexAI()){const g=j_(this.apiClient,e);return u=De("tuningJobs",g._url),f=g._query,delete g.config,delete g._url,delete g._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>Rc(this.apiClient,h))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,o;let s,u="",f={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const g=Y_(this.apiClient,e);return u=De("tunedModels",g._url),f=g._query,delete g.config,delete g._url,delete g._query,s=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(g),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(h=>h.json()),s.then(h=>eN(this.apiClient,h))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class oN{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const rN=1024*1024*8,sN=3,lN=1e3,uN=2,mc="x-goog-upload-status";async function cN(a,e,t){var o,s,u;let f=0,g=0,h=new xc(new Response),p="upload";for(f=a.size;g<f;){const T=Math.min(rN,f-g),C=a.slice(g,g+T);g+T>=f&&(p+=", finalize");let S=0,w=lN;for(;S<sN&&(h=await t.request({path:"",body:C,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":p,"X-Goog-Upload-Offset":String(g),"Content-Length":String(T)}}}),!(!((o=h==null?void 0:h.headers)===null||o===void 0)&&o[mc]));)S++,await fN(w),w=w*uN;if(g+=T,((s=h==null?void 0:h.headers)===null||s===void 0?void 0:s[mc])!=="active")break;if(f<=g)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const v=await(h==null?void 0:h.json());if(((u=h==null?void 0:h.headers)===null||u===void 0?void 0:u[mc])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return v.file}async function dN(a){return{size:a.size,type:a.type}}function fN(a){return new Promise(e=>setTimeout(e,a))}class mN{async upload(e,t,o){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await cN(e,t,o)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await dN(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class pN{create(e,t,o){return new gN(e,t,o)}}class gN{constructor(e,t,o){this.url=e,this.headers=t,this.callbacks=o}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const oh="x-goog-api-key";class hN{constructor(e){this.apiKey=e}async addAuthHeaders(e){e.get(oh)===null&&e.append(oh,this.apiKey)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const yN="gl-node/";class vN{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const o=oC(e,void 0,void 0);o&&(e.httpOptions?e.httpOptions.baseUrl=o:e.httpOptions={baseUrl:o}),this.apiVersion=e.apiVersion;const s=new hN(this.apiKey);this.apiClient=new c_({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:yN+"web",uploader:new mN,downloader:new oN}),this.models=new N_(this.apiClient),this.live=new E_(this.apiClient,s,new pN),this.chats=new N0(this.models,this.apiClient),this.caches=new S0(this.apiClient),this.files=new G0(this.apiClient),this.operations=new U_(this.apiClient),this.tunings=new aN(this.apiClient)}}const TN="AIzaSyAky0rAzhYL61AZdL7jbXZYsf46TVC_6oM",Gn=new vN({apiKey:TN}),ya="gemini-2.5-flash-preview-04-17",yr="imagen-3.0-generate-002";async function Rt(a,e,t,o,s,u=1){var g,h,p,v;let f=0;for(;f<=u;)try{const C=(p=(h=(g=(await Gn.models.generateContent({model:ya,contents:[{role:"user",parts:[{text:a}]}],config:{tools:[e]}})).candidates)==null?void 0:g[0])==null?void 0:h.content)==null?void 0:p.parts;if(!C||C.length===0)throw new Error(`No parts received from API for ${s}.`);let S=null;const w=C.find(I=>!!I.functionCall);if((v=w==null?void 0:w.functionCall)!=null&&v.args)S=w.functionCall.args;else throw new Error(`LLM failed to use the provided tool for ${s}. Review LLM's understanding of the tool or prompt.`);if(S===null){let I=`No function call arguments received from API for ${s}.`;throw new Error(I)}if(!t(S))throw new Error(`${o} (${s})`);return S}catch(T){f++;const C=T.message||"Unknown API error";if(f>u)throw new Error(`Failed to get valid tool response for ${s} after ${f} attempts. Last error: ${C}.`);console.warn(`Attempt ${f}/${u+1} failed for ${s}. Error: ${C}. Retrying...`),await new Promise(S=>setTimeout(S,1e3*f))}throw new Error(`Exhausted retries for ${s}.`)}async function Kh(a,e,t,o,s=1){var f;let u=0;for(;u<=s;)try{let h=(f=(await Gn.models.generateContent({model:ya,contents:[{role:"user",parts:[{text:a}]}],config:{responseMimeType:"application/json"}})).text)==null?void 0:f.trim();if(!h)throw new Error("LLM returned empty text response.");const p=/^```(\w*)?\s*\n?(.*?)\n?\s*```$/s,v=h.match(p);v&&v[2]&&(h=v[2].trim());let T;try{T=JSON.parse(h)}catch(C){throw new Error(`Failed to parse JSON response: ${C.message}`)}if(!e(T))throw new Error(`${t} (${o})`);return T}catch(g){u++;const h=g.message||"Unknown API error";if(u>s)throw new Error(`Failed to get valid JSON response for ${o} after ${u} attempts. Last error: ${h}.`);console.warn(`Attempt ${u}/${s+1} failed for ${o}. Error: ${h}. Retrying...`),await new Promise(p=>setTimeout(p,1e3*u))}throw new Error(`Exhausted retries for ${o}.`)}const Ht=`
SKILL LEVEL INTERPRETATION:
When considering skill levels, use this guide:
- 0 (Untrained): High chance of failure, clumsy, basic understanding.
- 1-2 (Novice): Can perform basic tasks with effort, inconsistent results.
- 3-4 (Apprentice): Reliable at simple tasks, competent.
- 5-6 (Adept): Proficient, good quality, handles moderate complexity.
- 7-8 (Expert): Highly skilled, excellent results, can innovate.
- 9 (Virtuoso): Near peak, remarkable feats, master of nuance.
- 10 (Master): Legendary, defines the art, flawless.
Outcomes and narrations should reflect these skill levels where relevant.`,zt=a=>{if(!a||a.length===0)return"No specific skills noted.";const e=a.filter(t=>t.level>0);return e.length===0?"No skills above level 0.":e.map(t=>`${t.name} (Lvl ${t.level})`).join(", ")},Ki=a=>{if(!a||a.length===0)return"No limb data to determine equipped items.";const e=[];let t=!1;return a.forEach(o=>{if(o.equippedItems&&o.equippedItems.length>0){t=!0;const s=o.equippedItems.map(u=>`${u.name} (${u.rarity})`).join(", ");e.push(`${o.name}: [${s}]`)}}),t?`Equipped Items: ${e.join("; ")}.`:"Equipped: Nothing significant."},va=a=>!a||a.length===0?"No limb data.":a.map(e=>{var t;return`${e.name} (Status: ${e.status}, Health: ${e.health}HP, Equipped: ${((t=e.equippedItems)==null?void 0:t.map(o=>`${o.name} (${o.rarity})`).join(", "))||"None"})`}).join("; "),CN=a=>{if(!a||typeof a.textWithMarkup!="string"||!Array.isArray(a.entities))return!1;const e=["item","npc","location"],t=["Common","Uncommon","Rare","Epic","Legendary","Lore","Character_Self"];return a.entities.every(o=>o&&typeof o.name=="string"&&o.name.trim()!==""&&typeof o.type=="string"&&e.includes(o.type)&&typeof o.descriptionHint=="string"&&o.descriptionHint.trim()!==""&&(o.rarityHint===void 0||typeof o.rarityHint=="string"&&t.includes(o.rarityHint))&&typeof o.originalPhrase=="string"&&o.originalPhrase.trim()!=="")},EN={functionDeclarations:[{name:"identify_and_markup_lore_entities",description:"Identifies potential new lore entities (items, NPCs, locations) mentioned in text. Returns details and the original text with these entities marked up. Focuses on significant, named entities that sound like discoverable game elements, not generic terms. Avoids re-identifying entities already known from memory context if their name is an exact match.",parameters:{type:_.OBJECT,properties:{entities:{type:_.ARRAY,description:"Array of identified lore entities. Empty if none found.",items:{type:_.OBJECT,properties:{name:{type:_.STRING,description:"The proper name of the identified entity."},type:{type:_.STRING,enum:["item","npc","location"],description:"Type of entity."},descriptionHint:{type:_.STRING,description:"A very brief (3-7 word) hint or rumor about the entity, derived from the text. E.g., 'a powerful artifact', 'a hermit in the mountains', 'a lost city of gold'."},rarityHint:{type:_.STRING,enum:["Common","Uncommon","Rare","Epic","Legendary","Lore","Character_Self"],nullable:!0,description:"Implied rarity, if any. Default to 'Lore' or null if unclear."},originalPhrase:{type:_.STRING,description:"The exact phrase/text from the input that refers to this entity."}},required:["name","type","descriptionHint","originalPhrase"]}},textWithMarkup:{type:_.STRING,description:`The original input text, with identified lore entities enclosed in [lore entity_type="TYPE" entity_name="NAME"]ENTITY_PHRASE[/lore] tags. Example: 'He mentioned the [lore entity_type="item" entity_name="Sunstone Compass"]Sunstone Compass[/lore] found in the [lore entity_type="location" entity_name="Whispering Caves"]Whispering Caves[/lore].'`}},required:["entities","textWithMarkup"]}}]},Bi=async(a,e,t,o,s,u)=>{const f=`Player Character: ${o.characterName} (${o.characterConcept}). Skills: ${zt(o.skills)}. ${Ht}`;let g="";e==="dialogue"?g=`This text is dialogue from an NPC (ID: ${t}).`:e==="item_text"?g=`This text is from an item (ID: ${t}) being read/examined.`:e==="contextual_examination"?g=`This text is from a player examining a contextual detail (Source ID: ${t}) in their surroundings.`:e==="event_narration"&&(g=`This text is narrative description or dialogue related to an ongoing event (Event ID/Title: ${t}).`);const h=`You are an AI assistant for a text-based adventure game. Your task is to identify mentions of potentially new, significant, and discoverable game entities (items, NPCs, locations) within the provided text. These entities should sound like unique named things the player could later find or encounter.
Do not identify generic concepts (e.g., "a sword", "a cave", "a merchant") unless they are given a specific, proper name and context suggests uniqueness (e.g., "the Sword of Valoria", "the Crystal Caves of Eldoria", "Merchant Vorlag").
${f}
${g}
Current Game Memory Context (Entities already known or rumored. Avoid re-identifying exact name matches from this list unless the new mention adds significant new detail):
${u}

Text to Analyze:
---
${a}
---

Instructions:
1.  Carefully read the "Text to Analyze".
2.  Identify specific names of items, NPCs, or locations that are presented as potentially discoverable, legendary, hidden, or important for a quest/lore.
3.  For each identified entity, determine its type ('item', 'npc', 'location'), a very brief 'descriptionHint' (3-7 words, like a rumor), and its 'originalPhrase' (the exact text snippet from the input). Optionally, suggest a 'rarityHint'.
4.  Return the original text with identified entity phrases wrapped in special tags: \`[lore entity_type="TYPE" entity_name="PROPER_NAME_OF_ENTITY"]ORIGINAL_PHRASE_HERE[/lore]\`.
    - Ensure "PROPER_NAME_OF_ENTITY" is the canonical name you've identified for the entity.
    - Ensure "ORIGINAL_PHRASE_HERE" is the exact text snippet from the input.
5.  If no such significant entities are mentioned, the 'entities' array should be empty, and 'textWithMarkup' should be the original, unchanged text.

CRITICAL: You MUST use the 'identify_and_markup_lore_entities' tool. Adhere strictly to its schema.
Focus on QUALITY over quantity. Only identify truly distinct and potentially discoverable named entities. Player's Perception skill (see charCtx) can slightly influence the likelihood of noticing subtle hints.
`;try{const p=await Rt(h,EN,CN,"Invalid lore identification structure (check entities array, textWithMarkup, and individual entity fields).",`identifyPotentialDiscoveriesInText (Source: ${e} ${t})`),v=p.entities.map(T=>({name:T.name,type:T.type,descriptionHint:T.descriptionHint,rarityHint:T.rarityHint,sourceTextSnippet:T.originalPhrase,sourceType:e,sourceEntityId:t}));return{rawText:a,processedText:p.textWithMarkup,potentialDiscoveries:v}}catch(p){return console.error("Error identifying potential discoveries:",p),{rawText:a,processedText:a,potentialDiscoveries:[]}}},xN=a=>a&&(typeof a.fulfilledLeadId=="string"||a.fulfilledLeadId===null),SN={functionDeclarations:[{name:"link_entity_to_lead",description:"Compares a newly generated game entity (item, NPC, or location) against a list of unconfirmed leads of the same type. Determines if the new entity fulfills any of the leads based on name similarity, description, and contextual relevance. Returns the ID of the fulfilled lead or null.",parameters:{type:_.OBJECT,properties:{fulfilledLeadId:{type:_.STRING,nullable:!0,description:"The ID of the lead that is best fulfilled by the generated entity. Null if no lead is fulfilled or no leads provided."}},required:["fulfilledLeadId"]}}]},Fi=async(a,e,t,o,s)=>{var p;if(t.length===0)return null;const u=`
    Name: ${a.name}
    Type: ${e}
    Rarity: ${a.rarity||"N/A"}
    Description: ${a.description||a.visualPromptHint}
    ${e==="item"?`Item Type Guess: ${a.itemTypeGuess}`:""}
    ${e==="npc"?`Appearance: ${a.appearanceDetails}`:""}
    ${e==="location"?`Environment Tags: ${(p=a.environmentTags)==null?void 0:p.join(", ")}`:""}
  `,f=t.map(v=>`- Lead ID: ${v.id}, Lead Name: "${v.name}", Lead Description Hint: "${v.descriptionHint}", Lead Rarity Hint: ${v.rarityHint||"N/A"}, Source: ${v.sourceType} snippet "${v.sourceTextSnippet.substring(0,70)}..."`).join(`
`),h=`You are an AI assistant determining if a newly generated game entity fulfills an existing unconfirmed lead.
${`Game Setting: ${o.gameSettingType}. ${o.gameSettingType==="Historical"&&o.initialHistoricalContext?`Context: ${o.initialHistoricalContext}.`:o.gameSettingType==="Fictional"&&o.fictionalUniverseContext?`Universe: ${o.fictionalUniverseContext}.`:""}`}
Player Character: ${o.characterName} (${o.characterConcept}).
Current Game Memory Context:
${s}
A new entity of type '${e}' has just been generated:
${u}
Here are the currently unconfirmed leads of type '${e}':
${f.length>0?f:"No unconfirmed leads of this type exist."}
Task: Compare the "Generated ${e}" with each "Unconfirmed Lead".
Factors for matching:
1.  Semantic Similarity of Names (e.g., "Ancient Sword" vs. "The Sword of Ancients").
2.  Alignment of Descriptions/Hints.
3.  Contextual Plausibility given memory and setting.
4.  Rarity Consistency.
Goal: Identify the ONE lead MOST CLEARLY and PLAUSIBLY fulfilled. If multiple match, pick BEST. If no strong match, 'fulfilledLeadId' MUST be null. Do not confirm weak matches.
CRITICAL: You MUST invoke tool 'link_entity_to_lead' with 'fulfilledLeadId'.`;try{return(await Rt(h,SN,xN,"Invalid lead linking structure. Must return fulfilledLeadId (string or null).",`linkGeneratedEntityToLead (Entity: ${a.name}, Type: ${e})`)).fulfilledLeadId}catch(v){return console.error(`Error linking entity ${a.name} to lead:`,v),null}},bN=async(a,e,t)=>{const o=`New Lead: Name: "${a.name}", Type: ${a.type}, Hint: "${a.descriptionHint}", Rarity Hint: ${a.rarityHint||"N/A"}.`,s=e.length>0?`Existing Leads:
`+e.map(h=>`- Name: "${h.name}", Type: ${h.type}, Hint: "${h.descriptionHint}", Rarity Hint: ${h.rarityHint||"N/A"}, Status: ${h.status}.`).join(`
`):"No existing leads of this type.",u=`You are an AI assistant determining if a new potential discovery (lead) is semantically similar enough to an existing lead to be considered a duplicate.
${t||"No broader memory context provided."}
${o}
${s}

Task:
Compare the "New Lead" with each "Existing Lead". Consider:
1.  Semantic Name Similarity: Are names very close (e.g., "Amulet of Kings" vs. "The King's Amulet")?
2.  Description Hint Overlap: Do hints describe essentially the same thing?
3.  Type Consistency: Must be the same type.
Goal: Determine if the "New Lead" is essentially a REWORDING or SLIGHT VARIATION of an "Existing Lead" (regardless of status: 'mentioned' or 'discovered').
If a very strong semantic similarity exists with ANY existing lead, return true (similar lead exists).
If the new lead is distinct enough, return false (no similar lead exists).
Prioritize preventing redundant leads for the same underlying concept.

CRITICAL: You MUST invoke the tool 'check_if_similar_lead_exists_tool_response'. This is the only way to return your decision.
`,f={functionDeclarations:[{name:"check_if_similar_lead_exists_tool_response",description:"Responds whether a semantically similar lead already exists.",parameters:{type:_.OBJECT,properties:{similarLeadExists:{type:_.BOOLEAN,description:"True if a similar lead already exists, false otherwise."}},required:["similarLeadExists"]}}]},g=h=>h&&typeof h.similarLeadExists=="boolean";try{return(await Rt(u,f,g,"Invalid similar lead check structure. Must return similarLeadExists (boolean).",`checkIfSimilarLeadExists (New Lead: ${a.name})`)).similarLeadExists}catch(h){console.error(`Error checking for similar lead "${a.name}":`,h);const p=a.name.toLowerCase().trim();return e.some(v=>v.type===a.type&&v.name.toLowerCase().trim()===p)}},_N=a=>a&&(typeof a.matchedExistingEntityId=="string"||a.matchedExistingEntityId===null),NN={functionDeclarations:[{name:"link_lead_to_existing_entity",description:"Compares a potential new lead against a list of already known memorable entities. Determines if the lead refers to an entity the player already knows. Returns the ID of the matched memorable entity or null.",parameters:{type:_.OBJECT,properties:{matchedExistingEntityId:{type:_.STRING,nullable:!0,description:"The ID of the memorable entity that this lead likely refers to. Null if no strong match with an existing known entity."}},required:["matchedExistingEntityId"]}}]},AN=async(a,e,t,o)=>{const s=Array.from(e.values()).filter(p=>p.type===a.type);if(s.length===0)return null;const u=`Potential New Lead: Name: "${a.name}", Type: ${a.type}, Hint: "${a.descriptionHint}", Rarity Hint: ${a.rarityHint||"N/A"}.`,f=`Known Memorable Entities (of the same type):
`+s.map(p=>`- Entity ID: ${p.id}, Name: "${p.name}", Type: ${p.type}, Rarity: ${p.rarity}, Hint: "${p.descriptionHint}"`).join(`
`),h=`You are an AI assistant determining if a new potential discovery (a lead/rumor) actually refers to an entity ALREADY KNOWN to the player.
${`Game Setting: ${t.gameSettingType}. `}
Player Character: ${t.characterName} (${t.characterConcept}).
Full Game Memory Context (includes all known entities, plot points, and other leads):
${o}

${u}

${f.length>0?f:"No existing memorable entities of this type are known."}

Task:
Carefully compare the "Potential New Lead" with each "Known Memorable Entity" of the same type.
Consider these factors for matching:
1.  Strong Semantic Similarity of Names: Does the lead's name very closely match an existing entity's name (e.g., "The Sunken Library" vs. "Sunken Library of Eldoria")?
2.  Strong Alignment of Descriptions/Hints: Does the lead's hint strongly align with the known entity's description?
3.  Contextual Plausibility: Given the full game memory and setting, is it highly plausible that this lead refers to something already recorded as known?
4.  Rarity Consistency: Is the lead's rarity hint consistent with the known entity's rarity?

Your Goal:
Identify if the "Potential New Lead" is essentially a rediscovery or re-mentioning of a "Known Memorable Entity".
- If a very strong and clear match is found, provide the 'matchedExistingEntityId' of that known entity.
- If multiple known entities seem to match, pick only the BEST and MOST DIRECT fit.
- If no known entity is a strong or clear match, 'matchedExistingEntityId' MUST be null. The lead should be treated as new information.
- Do not link if the match is weak or coincidental. The link should be quite evident.

CRITICAL: You MUST invoke the tool 'link_lead_to_existing_entity' and provide the 'matchedExistingEntityId'. This is the only way to return your decision.
`;try{return(await Rt(h,NN,_N,"Invalid link lead to existing entity structure. Must return matchedExistingEntityId (string or null).",`linkPotentialDiscoveryToExistingEntity (Lead: ${a.name})`)).matchedExistingEntityId}catch(p){return console.error(`Error linking lead ${a.name} to existing entity:`,p),null}},wN=a=>{if(!a||!Array.isArray(a.leads))return!1;const e=["item","npc","location"],t=["Common","Uncommon","Rare","Epic","Legendary","Lore","Character_Self"];return a.leads.every(o=>o&&typeof o.name=="string"&&o.name.trim()!==""&&typeof o.type=="string"&&e.includes(o.type)&&typeof o.descriptionHint=="string"&&o.descriptionHint.trim()!==""&&(o.rarityHint===void 0||typeof o.rarityHint=="string"&&t.includes(o.rarityHint))&&typeof o.sourceTextSnippet=="string"&&o.sourceTextSnippet.trim()!=="")},IN={functionDeclarations:[{name:"generate_initial_game_leads",description:"Generates 1-2 initial leads/rumors for the start of the game, based on the character, starting location, game setting, and visual style. These leads hint at potential items, NPCs, or locations for the player to investigate and should be thematically consistent.",parameters:{type:_.OBJECT,properties:{leads:{type:_.ARRAY,description:"Array of 1-2 generated leads. Empty if no suitable leads found.",items:{type:_.OBJECT,properties:{name:{type:_.STRING,description:"The proper name of the hinted item, NPC, or location."},type:{type:_.STRING,enum:["item","npc","location"],description:"Type of entity hinted at."},descriptionHint:{type:_.STRING,description:"A brief (5-15 word) hint or rumor about the discovery. E.g., 'a hidden grove guarded by ancient spirits', 'a legendary sword lost in the ruins', 'a mysterious hermit dwelling in the eastern caves'."},rarityHint:{type:_.STRING,enum:["Common","Uncommon","Rare","Epic","Legendary","Lore"],nullable:!0,description:"Implied rarity of the hinted entity. Optional."},sourceTextSnippet:{type:_.STRING,description:"A short, thematic in-world phrase indicating how this lead is known or intuited by the character (e.g., 'A faded inscription in your journal mentions...', 'Local legends whisper of...', 'A recurring dream hints at...'). Should be 5-15 words."}},required:["name","type","descriptionHint","sourceTextSnippet"]}}},required:["leads"]}}]},RN=async(a,e,t,o,s,u)=>{const f=`Character: ${a.characterName} - ${a.characterConcept} (Rarity: ${a.characterRarity}, Skills: ${zt(a.skills)}, Visual Style: ${s}).`,g=`Starting Location: ${e.name} - ${e.description} (Rarity: ${e.rarity}, Tags: ${e.environmentTags.join(", ")}).`;let h=`Game Setting: ${t}.`;t==="Historical"&&o?h+=` Specific Historical Context: ${o}. Leads must be historically plausible for this era/culture.`:t==="Fictional"&&o?h+=` Specific Fictional Universe: ${o}. Leads must be consistent with this universe's lore.`:t==="Fictional"&&(h+=" This is a generic fictional world; be creative but thematic.");const p=`You are an AI game master crafting initial plot hooks for a new game.
${f}
${g}
${h}
Memory Context (existing entities, if any, to avoid immediate duplication for leads):
${u}

Task: Generate 1 or 2 thematic and actionable leads (rumors, hints, objectives) that fit the starting character, location, and game setting. These leads should provide initial direction or mystery for the player.
- Leads can hint at nearby interesting items, notable NPCs, or intriguing locations.
- They should feel like natural starting points or pieces of knowledge the character might possess or intuit.
- The 'sourceTextSnippet' should be a short, evocative in-world phrase explaining how the character knows this hint (e.g., "A tattered map fragment suggests...", "Whispers in the tavern spoke of...", "A recurring dream points to...").
- Rarity of leads should generally be Common to Rare, unless the character/location concept strongly implies something Epic/Legendary from the start.

CRITICAL: You MUST use the 'generate_initial_game_leads' tool. Adhere strictly to its schema.
Return 1-2 leads. If absolutely no thematic leads can be generated, an empty 'leads' array is acceptable.
`;try{return(await Rt(p,IN,wN,"Invalid initial leads structure (check leads array, and individual lead fields like name, type, descriptionHint, sourceTextSnippet).","generateInitialLeads")).leads.map(T=>({name:T.name,type:T.type,descriptionHint:T.descriptionHint,rarityHint:T.rarityHint,sourceTextSnippet:T.sourceTextSnippet,sourceType:"initial_setup",sourceEntityId:`GameStart-${a.characterName}`}))}catch(v){return console.error("Error generating initial game leads:",v),[]}},MN=()=>{const[a,e]=Y.useState(new Map),[t,o]=Y.useState([]),[s,u]=Y.useState([]),f=Y.useCallback((C,S,w,I,b,A)=>{let M=!1,L;return e(R=>{var V,Q;if(R.has(C)&&((V=R.get(C))==null?void 0:V.name)===S&&((Q=R.get(C))==null?void 0:Q.type)===w){const te=R.get(C);if(b.length>te.descriptionHint.length||A!==te.firstEncounteredContext){const F=new Map(R);return L={...te,descriptionHint:b.length>te.descriptionHint.length?b.substring(0,150):te.descriptionHint,firstEncounteredContext:A.substring(0,200)},F.set(C,L),M=!0,F}return R}const $=new Map(R);return L={id:C,name:S,type:w,rarity:I,descriptionHint:b.substring(0,150),firstEncounteredContext:A.substring(0,200)},$.set(C,L),M=!0,$}),{entityAddedOrUpdated:M,newEntity:L}},[]),g=Y.useCallback((C,S,w)=>{let I=!1,b;return o(A=>(b={id:crypto.randomUUID(),timestamp:Date.now(),summary:C.substring(0,250),involvedEntityIds:S,locationName:w},A.slice(-3).some(L=>{var R;return L.summary.toLowerCase()===C.toLowerCase()&&JSON.stringify((R=L.involvedEntityIds)==null?void 0:R.sort())===JSON.stringify(S==null?void 0:S.sort())})?(console.warn("Attempted to add duplicate major plot point:",C),I=!1,b=void 0,A):(I=!0,[...A,b].slice(-20)))),{plotPointAdded:I,newPlotPoint:b}},[]),h=Y.useCallback(async(C,S,w,I,b)=>{let A,M,L=!1,R;const $=`${S}-${C.name.replace(/\s+/g,"_").toLowerCase()}-${C.type}`,V=I();if(await bN(C,s,V))return console.log(`Similar lead for "${C.name}" already exists. Not adding.`),L=!0,{duplicatePrevented:L};const F=await AN(C,b,{characterName:"System",characterConcept:"Lore Keeper",gameSettingType:"Fictional"},V);if(F)return u(ae=>{if(ae.some(z=>z.id===$&&z.status==="discovered"&&z.fulfilledById===F))return ae;R={...C,id:$,status:"discovered",fulfilledById:F,firstMentionedTimestamp:Date.now(),firstMentionedLocationKey:w};const W=ae.findIndex(z=>z.id===$);if(W>-1){const z=[...ae];return z[W]=R,z}return[...ae,R]}),console.log(`Lead for "${C.name}" auto-confirmed as it matches existing entity ID: ${F}.`),{preConfirmedLead:R};if(u(ae=>ae.some(W=>W.id===$)?ae:(A={...C,id:$,status:"mentioned",firstMentionedTimestamp:Date.now(),firstMentionedLocationKey:w,fulfilledById:void 0},[...ae,A])),A){const{entityAddedOrUpdated:ae,newEntity:W}=f(A.id,A.name,"lore_hint",A.rarityHint||"Lore",A.descriptionHint,`Mentioned in ${A.sourceType} (ID: ${A.sourceEntityId}) at ${w}`);ae&&(M=W)}return{newDiscovery:A,newLoreHint:M,duplicatePrevented:L}},[f,s]),p=Y.useCallback((C,S)=>{let w=null;return u(I=>I.map(b=>b.id===C&&b.status==="mentioned"?(w={...b,status:"discovered",fulfilledById:S},w):b)),{updatedDiscovery:w}},[]),v=Y.useCallback(()=>{let C=`MEMORY CONTEXT:
`;const S=new Set(s.filter(b=>b.status==="discovered").map(b=>b.id)),w=Array.from(a.values()).filter(b=>b.type==="lore_hint"?!S.has(b.id):!0).slice(-10);w.length>0?(C+=`
Notable Entities (Name, Type, Rarity, Hint, First Encounter):
`,w.forEach(b=>{C+=`- ${b.name} (${b.type}, ${b.rarity}). Hint: ${b.descriptionHint}. Seen: ${b.firstEncounteredContext}
`})):C+=`No specific notable entities recorded yet.
`,t.length>0?(C+=`
Recent Major Plot Points (Chronicle - Summary, Involved, Location):
`,t.slice(-10).forEach(b=>{var A;C+=`- ${b.summary}. Involved: ${((A=b.involvedEntityIds)==null?void 0:A.join(", "))||"N/A"}. At: ${b.locationName||"Unknown Location"}
`})):C+=`No major plot points recorded yet.
`;const I=s.filter(b=>b.status==="mentioned");return I.length>0?(C+=`
Active Leads (Potential Discoveries - Name, Type, Hint, Rarity Hint):
`,I.slice(-10).forEach(b=>{C+=`- ${b.name} (${b.type}, Hint: ${b.descriptionHint}, Rarity Hint: ${b.rarityHint||"Unknown"}).
`})):C+=`No specific rumors or unconfirmed leads noted yet.
`,C},[a,t,s]),T=Y.useCallback(()=>{e(new Map),o([]),u([])},[]);return{memorableEntities:a,setMemorableEntities:e,majorPlotPoints:t,setMajorPlotPoints:o,potentialDiscoveries:s,setPotentialDiscoveries:u,addMemorableEntityLogic:f,addMajorPlotPointLogic:g,addPotentialDiscoveryLogic:h,markPotentialDiscoveryFoundLogic:p,getMemoryContextString:v,clearMemorySystemLogic:T}},LN=()=>{const[a,e]=Y.useState(null),t=Y.useCallback((s,u,f)=>{let g=!1;return e(h=>{if(!h)return null;if(h.isDefeated)return h;const p=Math.max(0,h.currentEnergy-s);let v={...h,currentEnergy:p};return p===0&&h.currentEnergy>0&&(v={...v,isDefeated:!0,overallHealth:0},g=!0),v}),{wasDefeated:g}},[]),o=Y.useCallback((s,u,f)=>{e(g=>{if(!g||u<=0)return g;let h=!1;const p=g.skills.map(v=>{if(v.name===s){h=!0;let T=v.experience+u,C=v.level,S=v.experienceToNextLevel;for(C===0&&T>=S&&(C=1,T-=v.experienceToNextLevel,S=C*100+100);C>0&&T>=S;)C++,T-=S,S=C*100+100;return{...v,level:C,experience:T,experienceToNextLevel:S}}return v});return h?{...g,skills:p}:g})},[]);return{characterData:a,setCharacterData:e,consumeEnergyLogic:t,gainSkillExperienceLogic:o}},kN=()=>{const[a,e]=Y.useState(!1),[t,o]=Y.useState(null),[s,u]=Y.useState([]),[f,g]=Y.useState({x:0,y:0}),[h,p]=Y.useState(new Map),[v,T]=Y.useState(!1),[C,S]=Y.useState(""),[w,I]=Y.useState(!1),[b,A]=Y.useState(null),[M,L]=Y.useState(null),[R,$]=Y.useState(null),[V,Q]=Y.useState(null),[te,F]=Y.useState(!1),[ae,W]=Y.useState(null),[z,ue]=Y.useState(null),[re,se]=Y.useState(new Set),U=Y.useCallback(J=>{se(he=>new Set(he).add(J))},[]),X=Y.useCallback(J=>{se(he=>{const P=new Set(he);return P.delete(J),P})},[]);return{gameStarted:a,setGameStarted:e,locationData:t,setLocationData:o,playerInventory:s,setPlayerInventory:u,currentCoordinates:f,setCurrentCoordinates:g,visitedLocations:h,setVisitedLocations:p,isLoading:v,setIsLoading:T,loadingMessage:C,setLoadingMessage:S,isConsoleBusy:w,setIsConsoleBusy:I,error:b,setError:A,locationItems:M,setLocationItems:L,locationNPCs:R,setLocationNPCs:$,talkingToNPC:V,setTalkingToNPC:Q,isGeneratingEvent:te,setIsGeneratingEvent:F,eventLoadingMessage:ae,setEventLoadingMessage:W,lastEventTimestamp:z,setLastEventTimestamp:ue,elaboratingEntityIds:re,addElaboratingEntityId:U,removeElaboratingEntityId:X}},$N=a=>!0,PN=a=>a?!(a.itemsAddedToInventory&&!Array.isArray(a.itemsAddedToInventory)||a.itemsRemovedFromInventoryByName&&!Array.isArray(a.itemsRemovedFromInventoryByName)||a.itemsAddedToLocation&&!Array.isArray(a.itemsAddedToLocation)||a.itemsRemovedFromLocationByName&&!Array.isArray(a.itemsRemovedFromLocationByName)):!0,DN=a=>!0,UN=a=>a?Array.isArray(a)?a.every(e=>typeof e.npcIdTargeted=="string"&&(e.isHiddenDuringEvent===void 0||typeof e.isHiddenDuringEvent=="boolean")):!1:!0,ON=a=>{if(!a)return!0;if(!Array.isArray(a))return!1;const e=["item","npc","location"],t=["event_narration"],o=["Common","Uncommon","Rare","Epic","Legendary","Lore","Character_Self",void 0];return a.every(s=>typeof s.name=="string"&&e.includes(s.type)&&typeof s.descriptionHint=="string"&&(s.rarityHint===void 0||o.includes(s.rarityHint))&&typeof s.sourceTextSnippet=="string"&&t.includes(s.sourceType)&&typeof s.sourceEntityId=="string")},Zh=a=>a&&typeof a.eventTitle=="string"&&a.eventTitle.trim()!==""&&typeof a.narration=="string"&&a.narration.trim()!==""&&(a.combatNarration===void 0||a.combatNarration===null||typeof a.combatNarration=="string")&&$N(a.characterEffects)&&PN(a.itemEffects)&&DN(a.locationEffects)&&UN(a.npcEffects)&&(a.worldEffects===void 0||a.worldEffects===null||typeof a.worldEffects=="object")&&(a.majorPlotPointSummary===void 0||a.majorPlotPointSummary===null||typeof a.majorPlotPointSummary=="string")&&(a.visualPromptHintForEventImage===void 0||a.visualPromptHintForEventImage===null||typeof a.visualPromptHintForEventImage=="string")&&(a.requiresPlayerActionToResolve===void 0||typeof a.requiresPlayerActionToResolve=="boolean")&&(a.resolutionCriteriaPrompt===void 0||a.resolutionCriteriaPrompt===null||typeof a.resolutionCriteriaPrompt=="string")&&(a.resolutionNpcDispositionChange===void 0||a.resolutionNpcDispositionChange===null||typeof a.resolutionNpcDispositionChange=="object"&&typeof a.resolutionNpcDispositionChange.npcId=="string")&&(a.resolutionItemsAwardedToPlayer===void 0||a.resolutionItemsAwardedToPlayer===null||Array.isArray(a.resolutionItemsAwardedToPlayer))&&ON(a.potentialDiscoveriesGenerated),GN={functionDeclarations:[{name:"generate_complex_event_with_effects",description:"Generates an unexpected event based on an optional concept and intensity. An event MUST be a single, uninterrupted interaction or sequence that concludes within the current context (time and place). It should NOT automatically transition to a new location or a significantly later time. Provides initial narrative details, optional effects, image hint, resolution needs, NPC visibility, and potential new discoveries (leads). Events aim to introduce leads. Considers game context, setting, thematic consistency. Prioritizes narrative value and player engagement. Visual prompt hints for event/items must be for the game's current visual style (e.g., 'Pixel Art', 'Anime', or 'black and white traditional Chinese ink painting style' if 'Ink Painting' is the game style).",parameters:{type:_.OBJECT,properties:{eventTitle:{type:_.STRING,description:"A short, catchy, and impactful title (typically 3-7 words) that captures the essence of the event. If no significant event occurs (based on low intensity input), use a mundane title like 'A Fleeting Sensation' or 'The Moment Passes'. MUST strongly align with the provided eventConcept if any."},narration:{type:_.STRING,description:"An atmospheric and cinematic description of the INITIAL STATE and progression of the event, concluding with its natural end for the current scene (2-4 sentences). This narration MUST describe what is *actively happening* TO THE PLAYER or how the environment/NPCs are *dynamically changing*. Focus on setting the scene with an emphasis on a developing PLOT, a concrete SITUATION, or an unfolding CHALLENGE. Convey tension or new circumstances. MUST strongly align with the provided eventConcept if any. Example: If eventConcept is 'discussing a war plan', narration describes the discussion and its conclusion (e.g., 'The generals agree on the pincer maneuver. The meeting adjourns, thoughts heavy with the coming battle.')."},visualPromptHintForEventImage:{type:_.STRING,description:"If the event's INITIAL STATE warrants a specific visual, provide a descriptive prompt for a DYNAMIC, FIRST-PERSON perspective [CURRENT_GAME_STYLE] image, blending location essence with event action/mood. Example for [CURRENT_GAME_STYLE]=Anime: 'First-person view of a war map, a general's finger decisively tracing a route through mountains.' Null if mundane/low intensity or visual not central. Suitable for the specified [CURRENT_GAME_STYLE]. (Optional, can be null)"},requiresPlayerActionToResolve:{type:_.BOOLEAN,description:"True if player must actively address/interact to resolve/progress the event WITHIN THE CURRENT SCENE. False if self-contained, effects immediate, or event stage naturally concludes (e.g., meeting ends). If false, event considered over from interactive standpoint in this scene. Defaults false for mundane events. (Optional)"},resolutionCriteriaPrompt:{type:_.STRING,description:"If 'requiresPlayerActionToResolve' is true, hint for player actions to progress event INITIALLY. If 'requiresPlayerActionToResolve' was true and is now false (event concluding), this can guide player on how to act on 'majorPlotPointSummary' and 'potentialDiscoveriesGenerated' (e.g., 'The war council has ended. Will you investigate the Northern Pass or gather more intelligence?'). Null if event simply narrates to a conclusion. MUST strongly align with eventConcept. Example: for 'football match', criteria 'Make a decisive play' or 'Score a goal'. (Optional, can be null)"},majorPlotPointSummary:{type:_.STRING,description:"ESSENTIAL for context. If event is plot-significant or reveals important lore, summarize the key OUTCOME, DECISION, or significant LORE revealed by THIS CONCLUDED EVENT (1-2 sentences) for the game's chronicle. This summary, combined with leads, provides context for future LLM decisions when player explores related areas or acts on leads. Example: 'War plan XYZ was decided, targeting the Northern Pass.' (Optional)"},potentialDiscoveriesGenerated:{type:_.ARRAY,description:"CRITICAL for story progression. If the event's outcome or revealed information logically suggests a next step, a related location, a key NPC, or a consequential item, generate 1-2 actionable leads. These leads, combined with chronicle entries, form the context for future, player-driven discoveries or subsequent emergent events. Each discovery details name, type (item, npc, location), descriptionHint, optional rarityHint, sourceTextSnippet (from narration), sourceEntityId (event title), and sourceType ('event_narration'). AIM FOR AT LEAST ONE. Especially important for dialogue-triggered lore reveals.",items:{type:_.OBJECT,properties:{name:{type:_.STRING,description:"Name of the potential discovery."},type:{type:_.STRING,description:"Type: 'item', 'npc', 'location'."},descriptionHint:{type:_.STRING,description:"Brief hint about this discovery."},rarityHint:{type:_.STRING,description:"Optional rarity: 'Common', 'Uncommon', 'Rare', 'Epic', 'Legendary', 'Lore', 'Character_Self'. (Optional, null)"},sourceTextSnippet:{type:_.STRING,description:"Exact phrase from event narration hinting at this."},sourceType:{type:_.STRING,description:"MUST be 'event_narration'."},sourceEntityId:{type:_.STRING,description:"The title of this event."}},required:["name","type","descriptionHint","sourceTextSnippet","sourceType","sourceEntityId"]}},resolutionNpcDispositionChange:{type:_.OBJECT,description:"Optional: Define an NPC's disposition change upon FINAL successful resolution of the event. New disposition. Must be one of: 'Neutral', 'Friendly', 'Hostile', 'Afraid'.",properties:{npcId:{type:_.STRING},newDisposition:{type:_.STRING,description:"New disposition: 'Neutral', 'Friendly', 'Hostile', 'Afraid'."}},required:["npcId","newDisposition"]},resolutionItemsAwardedToPlayer:{type:_.ARRAY,description:"Optional: List items awarded to player upon FINAL successful event resolution. Rarity: 'Common', 'Uncommon', 'Rare', 'Epic', 'Legendary'.",items:{type:_.OBJECT,properties:{name:{type:_.STRING},description:{type:_.STRING},itemTypeGuess:{type:_.STRING},rarity:{type:_.STRING,description:"Rarity: 'Common', 'Uncommon', 'Rare', 'Epic', 'Legendary'."},visualPromptHint:{type:_.STRING,description:"Visual prompt for item, suitable for game's style. (Optional, null)"}},required:["name","description","itemTypeGuess","rarity"]}},characterEffects:{type:_.OBJECT,description:"Initial effects on player from event's start. Contribute to story/challenge, or reflect skills being tested. (Optional)",properties:{healthChange:{type:_.NUMBER,description:"(Optional)"},energyChange:{type:_.NUMBER,description:"(Optional)"},limbEffects:{type:_.ARRAY,description:"(Optional)",items:{type:_.OBJECT,properties:{limbName:{type:_.STRING},healthChange:{type:_.NUMBER,description:"(Optional)"},newStatus:{type:_.STRING,description:"(Optional)"},newHealthAbsolute:{type:_.NUMBER,description:"(Optional)"}},required:["limbName"]}},skillXpGains:{type:_.ARRAY,description:"(Optional)",items:{type:_.OBJECT,properties:{skillName:{type:_.STRING},amount:{type:_.NUMBER}},required:["skillName","amount"]}},statusEffectAdded:{type:_.STRING,description:"(Optional)"},statusEffectRemoved:{type:_.STRING,description:"(Optional)"}}},itemEffects:{type:_.OBJECT,description:"Effects on items (player/location) that advance story or present challenge. (Optional)",properties:{itemsAddedToInventory:{type:_.ARRAY,description:"(Optional)",items:{type:_.OBJECT,properties:{name:{type:_.STRING},description:{type:_.STRING},itemTypeGuess:{type:_.STRING},rarity:{type:_.STRING,description:"Rarity: 'Common', 'Uncommon', 'Rare', 'Epic', 'Legendary'."},visualPromptHint:{type:_.STRING,description:"(Optional)"}},required:["name","description","itemTypeGuess","rarity"]}},itemsRemovedFromInventoryByName:{type:_.ARRAY,description:"(Optional)",items:{type:_.STRING}},itemsAddedToLocation:{type:_.ARRAY,description:"(Optional)",items:{type:_.OBJECT,properties:{name:{type:_.STRING},description:{type:_.STRING},itemTypeGuess:{type:_.STRING},rarity:{type:_.STRING,description:"Rarity: 'Common', 'Uncommon', 'Rare', 'Epic', 'Legendary'."},visualPromptHint:{type:_.STRING,description:"(Optional)"}},required:["name","description","itemTypeGuess","rarity"]}},itemsRemovedFromLocationByName:{type:_.ARRAY,description:"(Optional)",items:{type:_.STRING}}}},locationEffects:{type:_.OBJECT,description:"Effects on current location driving story/challenge, making environment dynamic. (Optional)",properties:{descriptionChange:{type:_.STRING,description:"(Optional)"},newTemporaryNpc:{type:_.OBJECT,description:"(Optional)",properties:{name:{type:_.STRING},description:{type:_.STRING},appearanceDetails:{type:_.STRING},dialogueGreeting:{type:_.STRING},rarity:{type:_.STRING,description:"Rarity: 'Common', 'Uncommon', 'Rare', 'Epic', 'Legendary'."},visualPromptHint:{type:_.STRING},initialInventoryInstructions:{type:_.STRING,description:"(Optional)"},skillSuggestions:{type:_.ARRAY,description:"(Optional)",items:{type:_.OBJECT,properties:{skillName:{type:_.STRING},level:{type:_.NUMBER}},required:["skillName","level"]}}},required:["name","description","appearanceDetails","dialogueGreeting","rarity","visualPromptHint"]},environmentTagAdded:{type:_.STRING,description:"(Optional)"},environmentTagRemoved:{type:_.STRING,description:"(Optional)"}}},npcEffects:{type:_.ARRAY,description:"Effects on existing NPCs in location that are part of story/challenge, making them react dynamically. (Optional)",items:{type:_.OBJECT,properties:{npcIdTargeted:{type:_.STRING,description:"ID of NPC affected."},healthChange:{type:_.NUMBER,description:"(Optional)"},isDefeated:{type:_.BOOLEAN,description:"(Optional)"},dispositionChange:{type:_.STRING,description:"New disposition: 'Neutral', 'Friendly', 'Hostile', 'Afraid'. (Optional)"},dialogueOverride:{type:_.STRING,description:"Specific line NPC says. (Optional)"},isHiddenDuringEvent:{type:_.BOOLEAN,description:"If true, NPC becomes temporarily hidden/non-interactive. (Optional)"}},required:["npcIdTargeted"]}},worldEffects:{type:_.OBJECT,description:"Broader world effects. (Optional)",properties:{timePasses:{type:_.STRING,description:"(Optional)"},weatherChanges:{type:_.STRING,description:"(Optional)"}}},involvedEntityIdsForPlotPoint:{type:_.ARRAY,description:"Relevant entity IDs for plot point. (Optional)",items:{type:_.STRING}}},required:["eventTitle","narration"]}}]},HN=async(a,e,t,o,s,u,f="")=>{const g=zt(a.skills),h=va(a.limbs),p=t.map(I=>`${I.name} (Rarity: ${I.rarity})`).join(", ")||"empty",v=o.slice(-3).map(I=>I.text).join(`
`),T=a.visualStyle;let C="Generate a spontaneous, unexpected event.";s&&u&&(C=`Generate an event based on the concept: "${s}" with an intensity of "${u}". The generated event (title, narration, resolution criteria, etc.) MUST be thematically consistent with this concept and intensity.`);let S="";a.gameSettingType==="Historical"&&a.initialHistoricalContext?S=`Game Setting: HISTORICAL - ${a.initialHistoricalContext}. Event MUST be plausible for this period/culture. NPC reactions, item appearances, etc., must be authentic. Visual prompts for event/items must be for a ${T==="Ink Painting"?"black and white traditional Chinese ink painting style":T} rendering.`:a.gameSettingType==="Fictional"&&(a.fictionalUniverseContext?S=`Game Setting: FICTIONAL universe: "${a.fictionalUniverseContext}". Event MUST be consistent with its lore, themes, and known character statuses. Visual prompts for event/items must be for a ${T==="Ink Painting"?"black and white traditional Chinese ink painting style":T} rendering.`:S=`Game Setting: General FICTIONAL. Event should fit character/location themes. Visual prompts for event/items must be for a ${T==="Ink Painting"?"black and white traditional Chinese ink painting style":T} rendering.`);const w=`You are an AI game master. ${C}
CONTEXT:
Player: ${a.characterConcept} (Health: ${a.overallHealth}, Energy: ${a.currentEnergy}, Skills: ${g}, Limbs: ${h}, Rarity: ${a.characterRarity}, Visual Style: ${T}).
Location: ${e.name} (Rarity: ${e.rarity}, Desc: ${e.description}, Tags: ${e.environmentTags.join(", ")}).
Inventory: ${p}.
Recent Log: "${v}".
${f}
${S}
${Ht}

TASK: Define event details using 'generate_complex_event_with_effects' tool.
EVENT SCOPE: An event MUST be a single, uninterrupted interaction or sequence that concludes within the current context (time and place). It should NOT automatically transition to a new location or a significantly later time. For example, if an event is a 'discussion about a war plan,' it concludes when the discussion ends. The actual attack is a *separate* potential future event, likely triggered by the player acting on leads generated from this discussion.
- Title: Catchy, 3-7 words. If truly mundane (for low intensity), title like "A Fleeting Sensation". MUST align with provided 'eventConcept'.
- Narration: An atmospheric and cinematic description of the INITIAL STATE and progression of the event, concluding with its natural end for the current scene (2-4 sentences). This narration MUST describe what is *actively happening* TO THE PLAYER or how the environment/NPCs are *dynamically changing*. Focus on setting the scene with an emphasis on a developing PLOT, a concrete SITUATION, or an unfolding CHALLENGE. Convey tension or new circumstances. MUST strongly align with the provided eventConcept if any. For example, if the eventConcept is 'Guan Yu outlines a bold maneuver', the narration should detail THE MANEUVER ITSELF or the IMMEDIATE NEXT STEP/IMPLICATION, not just him leaning over a map.
- Visual Prompt Hint: Optional, for event's FIRST-PERSON visual, merging location & event. MUST specify "a detailed ${T==="Ink Painting"?"black and white traditional Chinese ink painting style":T} style illustration of...". Null if mundane/low intensity.
- Resolution: 'requiresPlayerActionToResolve' (boolean), 'resolutionCriteriaPrompt' (string hint, optional). If event stage naturally concludes (e.g., meeting ends), 'requiresPlayerActionToResolve' should be 'false'. Criteria should guide meaningful interaction/challenges or, if event is concluding, guide player towards using generated leads/chronicle info. MUST align with 'eventConcept'.
- majorPlotPointSummary: ESSENTIAL for context. If event is plot-significant or reveals important lore, summarize the key OUTCOME, DECISION, or significant LORE revealed by THIS CONCLUDED EVENT (1-2 sentences) for the game's chronicle. This summary, combined with leads, provides context for future LLM decisions. If the event introduces significant lore from its inception (e.g. reading a prophecy), this field can capture that.
- potentialDiscoveriesGenerated: CRITICAL for story progression. If the event's outcome logically suggests a next step (related location, NPC, item), generate 1-2 actionable leads. These leads, combined with chronicle entries, form the context for future, player-driven discoveries or subsequent emergent events. AIM FOR AT LEAST ONE.
- Effects: Character, item, location, NPC effects should contribute to STORY or CHALLENGE. Reflect potential consequences (positive/negative/mixed) based on context and player skills.
- Consistency & Challenge: Ensure thematic coherence. Events should present meaningful gameplay, a twist, a problem to solve, or significant lore reveal. Avoid purely observational events unless 'low' intensity. Player skills and choices should matter for outcomes if event becomes interactive. The event's theme and challenges MUST strongly reflect the input 'eventConcept' and 'eventIntensity'.
NARRATIVE FOCUS FOR DIALOGUE-TRIGGERED EVENTS: If the 'eventConcept' clearly stems from a dialogue interaction (e.g., "NPC Enraged", "Secret Revealed", "Prophecy Uncovered", "Strategy Outlined"):
    - 'narration' should vividly describe THE SPECIFIC DETAILS of the situation developing FROM THE DIALOGUE (e.g., if a strategy is outlined, the narration should summarize the core elements of that strategy or the immediate next step it implies, and its conclusion).
    - 'majorPlotPointSummary' is HIGHLY ENCOURAGED if the event significantly alters the story, reveals critical lore, or changes character relationships/statuses. This summary MUST capture the key details for a chronicle entry, including relevant lore details.
    - 'potentialDiscoveriesGenerated' should be considered if the event uncovers new leads (items, locations, NPCs, or further lore hints related to the dialogue).
    - 'npcEffects' should reflect the NPC's reaction and any change in disposition or actions.
    - 'resolutionCriteriaPrompt' (if event was interactive and is now concluding) should be thematically linked to the dialogue trigger and its consequences, prompting specific follow-up related to the revealed information or situation.

CRITICAL: Invoke 'generate_complex_event_with_effects' tool. Adhere to schema. Tool call is ONLY valid output. If no significant event, make 'eventTitle' mundane, 'narration' brief, 'requiresPlayerActionToResolve' false, and omit most effects.
Replace '[CURRENT_GAME_STYLE]' in tool schema descriptions with '${T==="Ink Painting"?"black and white traditional Chinese ink painting style":T}'.`;return Rt(w,GN,Zh,"Invalid event effects structure (check title, narration, resolution, discoveries, effects, consistency with context/setting/universe/style/eventConcept, event scope)","generateDynamicEventDetails")},VN={functionDeclarations:[{name:"generate_attack_consequences",description:"Determines consequences of player attacking an NPC. Considers combat skills of both, NPC rarity/status, memory context, game setting/universe. Provides combat narration, effects on both, and resolution needs if combat continues. Visual prompts hints for items/event must be for game's current visual style (e.g., 'Pixel Art', 'Anime', or 'black and white traditional Chinese ink painting style' if 'Ink Painting' is the game style).",parameters:{type:_.OBJECT,properties:{eventTitle:{type:_.STRING,description:"E.g., 'Skirmish with [NPC Name]', 'Assault on [NPC Name]'."},narration:{type:_.STRING,description:"Initial cinematic narration of player's attack action and NPC's immediate reaction (2-3 sentences). Reflects skills. Focus on IMPACT and STORY, not just visual detail."},combatNarration:{type:_.STRING,nullable:!0,description:"Detailed blow-by-blow of this combat round. (Optional)"},visualPromptHintForEventImage:{type:_.STRING,nullable:!0,description:"Optional: Prompt for dynamic [CURRENT_GAME_STYLE] image of combat. E.g., 'First-person view: narrowly dodging a goblin's rusty scimitar swing in a dark cave.' Null if not visually distinct."},requiresPlayerActionToResolve:{type:_.BOOLEAN,description:"True if combat continues, false if NPC defeated or player defeated/flees."},resolutionCriteriaPrompt:{type:_.STRING,nullable:!0,description:"If combat continues, hint for next player action (e.g., 'Press the attack!', 'Defend yourself!', 'Look for an escape!'). (Optional)"},characterEffects:{type:_.OBJECT,nullable:!0,description:"Effects on player. (Optional)",properties:{healthChange:{type:_.NUMBER,nullable:!0,description:"Numeric change in health. (Optional)"},energyChange:{type:_.NUMBER,nullable:!0,description:"Numeric change in energy. (Optional)"},limbEffects:{type:_.ARRAY,nullable:!0,description:"Effects on specific limbs. (Optional)",items:{type:_.OBJECT,properties:{limbName:{type:_.STRING},healthChange:{type:_.NUMBER,nullable:!0,description:"Change in limb health. (Optional)"},newStatus:{type:_.STRING,nullable:!0,description:"New status for the limb. (Optional)"},newHealthAbsolute:{type:_.NUMBER,nullable:!0,description:"Absolute new health (0-100) for the limb. (Optional)"}},required:["limbName"]}},skillXpGains:{type:_.ARRAY,nullable:!0,description:"XP gains for skills. (Optional)",items:{type:_.OBJECT,properties:{skillName:{type:_.STRING},amount:{type:_.NUMBER}},required:["skillName","amount"]}},statusEffectAdded:{type:_.STRING,nullable:!0,description:"Descriptive status effect added. (Optional)"},statusEffectRemoved:{type:_.STRING,nullable:!0,description:"Descriptive status effect removed. (Optional)"}}},npcEffects:{type:_.ARRAY,nullable:!0,description:"Effects on NPCs (target NPC primarily). (Optional)",items:{type:_.OBJECT,properties:{npcIdTargeted:{type:_.STRING,description:"ID of the NPC affected."},healthChange:{type:_.NUMBER,nullable:!0,description:"(Optional)"},isDefeated:{type:_.BOOLEAN,nullable:!0,description:"(Optional)"},dispositionChange:{type:_.STRING,nullable:!0,description:"New disposition. Must be one of: 'Neutral', 'Friendly', 'Hostile', 'Afraid'. (Optional)"},dialogueOverride:{type:_.STRING,nullable:!0,description:"A specific line NPC says. (Optional)"},isHiddenDuringEvent:{type:_.BOOLEAN,nullable:!0,description:"If true, this NPC becomes temporarily hidden or non-interactive during the event. (Optional)"}},required:["npcIdTargeted"]}},itemEffects:{type:_.OBJECT,nullable:!0,description:"Items dropped by NPC, etc. (Optional)",properties:{itemsAddedToInventory:{type:_.ARRAY,nullable:!0,description:"Items added to player inventory. (Optional)",items:{type:_.OBJECT,properties:{name:{type:_.STRING},description:{type:_.STRING},itemTypeGuess:{type:_.STRING},rarity:{type:_.STRING,description:"Rarity. Must be one of: 'Common', 'Uncommon', 'Rare', 'Epic', 'Legendary'."},visualPromptHint:{type:_.STRING,nullable:!0,description:"(Optional)"}},required:["name","description","itemTypeGuess","rarity"]}},itemsRemovedFromInventoryByName:{type:_.ARRAY,nullable:!0,description:"Names of items removed from inventory. (Optional)",items:{type:_.STRING}},itemsAddedToLocation:{type:_.ARRAY,nullable:!0,description:"Items added to current location. (Optional)",items:{type:_.OBJECT,properties:{name:{type:_.STRING},description:{type:_.STRING},itemTypeGuess:{type:_.STRING},rarity:{type:_.STRING,description:"Rarity. Must be one of: 'Common', 'Uncommon', 'Rare', 'Epic', 'Legendary'."},visualPromptHint:{type:_.STRING,nullable:!0,description:"(Optional)"}},required:["name","description","itemTypeGuess","rarity"]}},itemsRemovedFromLocationByName:{type:_.ARRAY,nullable:!0,description:"Names of items removed from location. (Optional)",items:{type:_.STRING}}}},majorPlotPointSummary:{type:_.STRING,nullable:!0,description:"If attack is plot-significant (e.g., a key NPC defeated). This should capture chronicle-worthy details."},involvedEntityIdsForPlotPoint:{type:_.ARRAY,nullable:!0,description:"Player, NPC ID, etc. (Optional)",items:{type:_.STRING}},potentialDiscoveriesGenerated:{type:_.ARRAY,nullable:!0,description:"Leads revealed by combat. (Optional)",items:{type:_.OBJECT,properties:{name:{type:_.STRING,description:"Name of the potential discovery."},type:{type:_.STRING,description:"Type of the discovery. Must be one of: 'item', 'npc', 'location'."},descriptionHint:{type:_.STRING,description:"A brief hint about this discovery."},rarityHint:{type:_.STRING,nullable:!0,description:"Implied rarity. Must be one of: 'Common', 'Uncommon', 'Rare', 'Epic', 'Legendary', 'Lore', 'Character_Self'. (Optional)"},sourceTextSnippet:{type:_.STRING,description:"The exact phrase from event narration hinting at this."},sourceType:{type:_.STRING,description:"MUST be 'event_narration'."},sourceEntityId:{type:_.STRING,description:"The title of this event."}},required:["name","type","descriptionHint","sourceTextSnippet","sourceType","sourceEntityId"]}}},required:["eventTitle","narration","requiresPlayerActionToResolve"]}}]},qN=async(a,e,t,o="")=>{var T,C;zt(a.skills);const s=((T=a.skills.find(S=>S.name==="Combat"))==null?void 0:T.level)||0,u=va(a.limbs),f=zt(e.skills),g=((C=e.skills.find(S=>S.name==="Combat"))==null?void 0:C.level)||0,h=a.visualStyle;let p="";a.gameSettingType==="Historical"&&a.initialHistoricalContext?p=`Game Setting: HISTORICAL - ${a.initialHistoricalContext}. Combat outcomes, NPC reactions, items must be plausible for this era/culture. Visuals in ${h==="Ink Painting"?"black and white traditional Chinese ink painting style":h}.`:a.gameSettingType==="Fictional"&&(a.fictionalUniverseContext?p=`Game Setting: FICTIONAL universe: "${a.fictionalUniverseContext}". Combat consistent with its lore/power levels. Visuals in ${h==="Ink Painting"?"black and white traditional Chinese ink painting style":h}.`:p=`Game Setting: General FICTIONAL. Combat outcomes fit theme. Visuals in ${h==="Ink Painting"?"black and white traditional Chinese ink painting style":h}.`);const v=`You are an AI game master simulating combat.
Player Character: ${a.characterConcept} (Combat Lvl ${s}, Health: ${a.overallHealth}, Limbs: ${u}, Rarity: ${a.characterRarity}, Visual Style: ${h}).
Target NPC: ${e.name} (Combat Lvl ${g}, Health: ${e.currentHealth||100}, Rarity: ${e.rarity}, Disposition: ${e.disposition||"Neutral"}, Skills: ${f}). NPC ID: ${e.id}.
Player Action: ${t.actionType} on NPC ID ${t.targetNpcId}.
${o}
${p}
${Ht}

TASK: Determine combat outcome using 'generate_attack_consequences' tool.
- Title: E.g., "Skirmish with [NPC Name]".
- Narration: Cinematic description of player's attack & NPC's immediate reaction. Reflect skills. Focus on IMPACT and STORY, not just visual detail. This interaction is self-contained; do not describe subsequent rounds unless combat ends here.
- Combat Narration: Optional detailed blow-by-blow of this combat round.
- Visual Prompt: Optional, for dynamic FIRST-PERSON view of combat, suitable for ${h==="Ink Painting"?"black and white traditional Chinese ink painting style":h}.
- Resolution: 'requiresPlayerActionToResolve' (true if combat continues, false if NPC defeated or player defeated/flees in this single exchange). 'resolutionCriteriaPrompt' (hint for next player action, potential challenges if combat continues).
- Effects: On player (health/energy/limb changes) & NPC (health/status, potential defeat). NPC effect MUST target ID: ${e.id}. These should reflect a CHALLENGE or consequence.
- Item Effects: NPC might drop items if defeated (context-appropriate rarity/type).
- majorPlotPointSummary: IF the attack is plot-significant (e.g., a key NPC is defeated, a major betrayal occurs, a critical quest item is fought over), provide a concise summary (1-2 sentences) of this specific outcome for the game's chronicle. This should capture the narrative weight of the event.
- Consistency: Coherent with skills, rarities, setting/universe/style. Outcome depends on relative combat skills and context.

CRITICAL: Invoke 'generate_attack_consequences'. Tool call is ONLY valid output.
Replace '[CURRENT_GAME_STYLE]' in tool schema descriptions with '${h==="Ink Painting"?"black and white traditional Chinese ink painting style":h}'.`;return Rt(v,VN,Zh,"Invalid attack consequences structure (check title, narration, NPC effects targeting correct ID, consistency with context/skills/setting/universe/style)",`generatePlayerAttackNpcConsequences (Target: ${e.name})`)},FN=a=>a&&typeof a.resolved=="boolean"&&typeof a.resolutionNarration=="string"&&a.resolutionNarration.trim()!==""&&(a.majorPlotPointSummary===void 0||a.majorPlotPointSummary===null||typeof a.majorPlotPointSummary=="string")&&(a.updatedNpcDisposition===void 0||a.updatedNpcDisposition===null||typeof a.updatedNpcDisposition=="object"&&typeof a.updatedNpcDisposition.npcId=="string")&&(a.itemsAwardedToPlayer===void 0||a.itemsAwardedToPlayer===null||Array.isArray(a.itemsAwardedToPlayer))&&(a.progressed===void 0||typeof a.progressed=="boolean")&&(a.nextStageNarration===void 0||a.nextStageNarration===null||typeof a.nextStageNarration=="string")&&(a.updatedVisualPromptHintForEventImage===void 0||a.updatedVisualPromptHintForEventImage===null||typeof a.updatedVisualPromptHintForEventImage=="string")&&(a.updatedResolutionCriteriaPrompt===void 0||a.updatedResolutionCriteriaPrompt===null||typeof a.updatedResolutionCriteriaPrompt=="string"),YN={functionDeclarations:[{name:"evaluate_event_resolution_attempt",description:"Evaluates player's attempt to resolve/progress an event. Determines if action leads to full resolution, progression to new stage, or no change. Considers event's current criteria, player skills, items, game setting/universe. Outcomes (positive/negative/mixed) reflected in narration, effects, and story progression. Visual prompts for event/items must be for game's current visual style (e.g., 'Pixel Art', 'Anime', or 'black and white traditional Chinese ink painting style' if 'Ink Painting' is current style). The event's progression should allow for player agency and be thematically consistent with the original event concept.",parameters:{type:_.OBJECT,properties:{resolved:{type:_.BOOLEAN,description:"True if player's action FULLY resolves the event. False otherwise."},resolutionNarration:{type:_.STRING,description:"Briefly narrate the *direct impact and consequence* of the player's action on the event (1-2 sentences), not just a description of the action itself. E.g., 'The ancient mechanism shudders and a hidden door grinds open...' or 'Your attempt to reason with the spirit fails; it becomes more agitated.'. This narration should be CHRONICLE-FRIENDLY, summarizing the key outcome of the resolution."},majorPlotPointSummary:{type:_.STRING,nullable:!0,description:"If the resolution itself has distinct chronicle-worthy details not covered by resolutionNarration (e.g., a specific lore reveal during resolution), provide it here. (Optional)"},progressed:{type:_.BOOLEAN,description:"True if action causes event to change state or progress to a new stage, but isn't fully resolved. False if action fully resolves or has no significant impact. (Optional, defaults false)"},nextStageNarration:{type:_.STRING,nullable:!0,description:"CRITICAL: If 'progressed' is true, describe the *story progression* and how the event *evolves* (2-3 sentences), CONSIDERING THE PLAYER'S ACTION AND THE ORIGINAL EVENT CONCEPT. Introduce new story elements, challenges, dangers, NPC reactions, or lore revelations that are thematically consistent. What happens TO PLAYER or what CHANGES AROUND THEM? This should be DENSE with lore/change and actively involve the player. It's not a static re-description. (Optional)"},updatedVisualPromptHintForEventImage:{type:_.STRING,nullable:!0,description:"If 'progressed' is true AND the visual scene changes significantly, prompt for a new [CURRENT_GAME_STYLE] image reflecting the event's new state. (Optional)"},updatedResolutionCriteriaPrompt:{type:_.STRING,nullable:!0,description:"If 'progressed' is true, new criteria/hint/challenge for resolving the event from its new stage. This new criteria MUST remain thematically consistent with the player's successful thematic action and the original event concept. (Optional)"},updatedNpcDisposition:{type:_.OBJECT,nullable:!0,description:"If FULLY resolved AND causes NPC disposition change. (Optional)",properties:{npcId:{type:_.STRING},newDisposition:{type:_.STRING,description:"New disposition. Must be one of: 'Neutral', 'Friendly', 'Hostile', 'Afraid'."}},required:["npcId","newDisposition"]},itemsAwardedToPlayer:{type:_.ARRAY,nullable:!0,description:"If FULLY resolved AND items awarded. (Optional)",items:{type:_.OBJECT,properties:{name:{type:_.STRING},description:{type:_.STRING},itemTypeGuess:{type:_.STRING},rarity:{type:_.STRING,description:"Rarity. Must be one of: 'Common', 'Uncommon', 'Rare', 'Epic', 'Legendary'."},visualPromptHint:{type:_.STRING,nullable:!0,description:"(Optional)"}},required:["name","description","itemTypeGuess","rarity"]}}},required:["resolved","resolutionNarration"]}}]},rh=async(a,e,t,o,s,u,f)=>{if(!a.requiresPlayerActionToResolve)return{resolved:!0,resolutionNarration:"The event concludes on its own."};const g=zt(o.skills),h=va(o.limbs),p=f.map(I=>`${I.name} (Rarity: ${I.rarity}, Type: ${I.itemTypeGuess})`).join(", ")||"empty",v=s.map(I=>`${I.name} (ID: ${I.id}, Rarity: ${I.rarity}, Disposition: ${I.disposition||"Neutral"})`).join("; ")||"None apparent",T=o.visualStyle,C=`Original Event Concept Hint: The event '${a.eventTitle}' started with the narration: '${a.narration.substring(0,100)}...'`;let S="";o.gameSettingType==="Historical"&&o.initialHistoricalContext?S=`Game Setting: HISTORICAL - ${o.initialHistoricalContext}. Event resolution, NPC reactions, items must be plausible for this era/culture. Visuals in ${T==="Ink Painting"?"black and white traditional Chinese ink painting style":T}.`:o.gameSettingType==="Fictional"&&(o.fictionalUniverseContext?S=`Game Setting: FICTIONAL universe: "${o.fictionalUniverseContext}". Resolution consistent with its lore/power levels. Visuals in ${T==="Ink Painting"?"black and white traditional Chinese ink painting style":T}.`:S=`Game Setting: General FICTIONAL. Resolution fits theme. Visuals in ${T==="Ink Painting"?"black and white traditional Chinese ink painting style":T}.`);const w=`You are an AI game master. Player is trying to resolve/progress an event.
EVENT DETAILS:
Title: "${a.eventTitle}"
Current Narration/State: "${a.narration}"
Current Resolution Criteria Hint: "${a.resolutionCriteriaPrompt||"No specific hint available."}"
${C} 
Event Visual Style Context: ${T}

PLAYER & CONTEXT:
Player: ${o.characterConcept} (Health: ${o.overallHealth}, Energy: ${o.currentEnergy}, Skills: ${g}, Limbs: ${h}).
Inventory: ${p}.
Involved NPCs: ${v}.
Player Command: "${e}"
Parsed Action: ${JSON.stringify(t)}
${u}
${S}
${Ht}

TASK: Evaluate player's action. Determine if it resolves, progresses, or has no effect on event.
1.  Analyze Action: Does player's action (parsed: ${t.action}) and targets/params align with 'Resolution Criteria Hint'? OR, is the action a THEMATICALLY APPROPRIATE attempt to interact with the ORIGINAL EVENT CONCEPT (${C}) even if not perfectly matching the current hint? Consider skills, items. The OUTCOME (positive/negative/mixed) should depend on these factors and player's ingenuity. Not all attempts should succeed or be beneficial. Player's skills should DIRECTLY influence plausibility and success.
2.  Resolution ('resolved'): True if action FULLY ends event. False otherwise.
3.  Progression ('progressed'): True if action changes event state, moves to new stage, but not fully resolved. False if fully resolved or no significant impact. If the event has naturally reached its conclusion based on player's action (e.g., a meeting ends, a performance concludes), then 'resolved' can be true and 'progressed' false.
4.  Narrations:
    - 'resolutionNarration': IMPACT and CONSEQUENCE of player's action on event (1-2 sentences). Reflect success/failure/partial success based on skill checks, context, and THEMATIC RELEVANCE of the action. This narration should be CHRONICLE-FRIENDLY, summarizing the key outcome.
    - 'majorPlotPointSummary': If the resolution action itself introduces a new, distinct piece of lore or plot not covered by the main narration, summarize it here for the chronicle.
    - 'nextStageNarration': CRITICAL. If 'progressed' is true, describe STORY PROGRESSION (2-3 sentences). How does event EVOLVE *based on the player's specific (and potentially creative but thematic) action*? Introduce new story elements, challenges, dangers, NPC reactions, or lore revelations. What happens TO PLAYER or what CHANGES AROUND THEM? This should be DENSE with lore/change and actively involve the player. It's not a static re-description. If the player tries a valid thematic action, the event should progress ALONG THAT THEMATIC LINE. THIS FIELD IS NULL IF NOT PROGRESSED.
5.  Updates if Progressed:
    - 'updatedVisualPromptHintForEventImage': If scene changes significantly, prompt for NEW ${T==="Ink Painting"?"black and white traditional Chinese ink painting style":T} image.
    - 'updatedResolutionCriteriaPrompt': New hint/challenge if goalposts shift. This new criteria MUST remain thematically consistent with the player's successful thematic action and the original event concept.
6.  Rewards if Fully Resolved: 'updatedNpcDisposition', 'itemsAwardedToPlayer'.
7.  Consistency & Challenge: All outputs thematically coherent, fit event, context, game setting/universe. Event should feel challenging and outcomes earned (or consequences faced). The narrative should reflect the density of lore and the impact of change. Player agency in choosing a thematic path (if valid) should be respected.
8.  Potential Discoveries: If the event progression or resolution reveals new lore, entities, or clues, implicitly suggest them in the narration. The system handles generating explicit leads from these narrative hints.

CRITICAL: Invoke 'evaluate_event_resolution_attempt' tool. Tool call is ONLY valid output.
Replace '[CURRENT_GAME_STYLE]' in tool schema descriptions with '${T==="Ink Painting"?"black and white traditional Chinese ink painting style":T}'.`;return Rt(w,YN,FN,"Invalid event resolution structure (check resolved, narration, progression fields, consistency, challenge, lore density, thematic relevance, majorPlotPointSummary)",`checkEventResolution (Event: ${a.eventTitle})`)},BN=a=>{const e=["low","medium","high",null];return a&&typeof a.shouldTriggerEvent=="boolean"&&(a.eventConcept===null||typeof a.eventConcept=="string"&&a.eventConcept.trim()!=="")&&e.includes(a.eventIntensity)&&(a.shouldTriggerEvent?a.eventConcept!==null&&a.eventIntensity!==null:!0)},zN={functionDeclarations:[{name:"decide_event_trigger_and_concept",description:"Decides if an event should trigger based on player action and game context. Provides a concept and intensity if an event is warranted. Considers significance of trigger (rarity of involved entities: Epic/Legendary), character skills (Perception), location, inventory, recent logs, memory, and game setting. CRITICAL: Mundane actions or those involving Common/Uncommon entities should NOT trigger events unless context is exceptional. Events should be STORY-DRIVEN and impactful. If trigger context involves 'dialogue_interaction_with_', consider the dialogue content from Recent Log/Memory for significance.",parameters:{type:_.OBJECT,properties:{shouldTriggerEvent:{type:_.BOOLEAN,description:"True if an event is warranted (primarily for Epic/Legendary triggers, or significant dialogue with Epic/Legendary NPCs), false otherwise. False for mundane triggers."},eventConcept:{type:_.STRING,nullable:!0,description:"If true, a brief (3-10 word) evocative concept for the event, focusing on STORY or CHALLENGE. E.g., 'The ground trembles ominously', 'NPC Enraged by Insult', 'Secret Revealed to the Council'. Null if false. (Nullable)"},eventIntensity:{type:_.STRING,nullable:!0,description:"If true, suggested intensity: 'low' (atmospheric, minor choice), 'medium' (direct interaction, some consequence), 'high' (significant challenge/plot). Null if false. (Nullable, Enum: low, medium, high)"}},required:["shouldTriggerEvent","eventConcept","eventIntensity"]}}]},JN=async(a,e,t,o,s,u="")=>{const f=zt(e.skills),g=va(e.limbs),h=o.map(S=>`${S.name} (Rarity: ${S.rarity})`).join(", ")||"empty",p=s.slice(-3).map(S=>S.text).join(`
`),v=e.visualStyle;let T="";e.gameSettingType==="Historical"&&e.initialHistoricalContext?T=`Game Setting: HISTORICAL - ${e.initialHistoricalContext}. Event concepts MUST be plausible for this period/culture.`:e.gameSettingType==="Fictional"&&(e.fictionalUniverseContext?T=`Game Setting: FICTIONAL universe: "${e.fictionalUniverseContext}". Event concepts MUST be consistent with its lore and themes.`:T="Game Setting: General FICTIONAL. Event concepts should fit character/location themes.");const C=`You are an AI game master deciding if an event should occur based on a trigger.
TRIGGER CONTEXT: "${a}" (This string often includes entity type and rarity, e.g., 'item_pickup_epic_artifact_of_doom', 'dialogue_interaction_with_legendary_npc_gandalf')

CURRENT GAME STATE:
Player: ${e.characterConcept} (Health: ${e.overallHealth}, Energy: ${e.currentEnergy}, Skills: ${f}, Limbs: ${g}, Visual Style: ${v}).
Location: ${t.name} (Rarity: ${t.rarity}, Desc: ${t.description}, Tags: ${t.environmentTags.join(", ")}).
Inventory: ${h}.
Recent Log (Contains recent player/NPC dialogue): "${p}".
${u}
${T}
${Ht}

TASK: Decide if an event should trigger.
PRIMARY EVENT TRIGGER RULE:
-   Events should PRIMARILY trigger for actions involving 'Epic' or 'Legendary' entities (items, locations, NPCs) as indicated by the "TRIGGER CONTEXT" (e.g., contains "_epic_", "_legendary_") or current game state (e.g., player enters a Legendary location).
-   Actions involving 'Rare' entities MIGHT trigger 'low' or 'medium' intensity events, especially if player skills (e.g., high Perception) or a unique situation in the "TRIGGER CONTEXT" warrants it.
-   Actions involving 'Common' or 'Uncommon' entities, or mundane actions (e.g., "walked through empty field", "crafted common item"), should ALMOST ALWAYS result in 'shouldTriggerEvent: false', UNLESS the "TRIGGER CONTEXT" itself implies an extraordinary circumstance despite a typically low rarity trigger (e.g., "picked_up_common_rock_that_suddenly_glows_ominously").

DIALOGUE-SPECIFIC EVENT TRIGGER RULE (Applies if "TRIGGER CONTEXT" contains 'dialogue_interaction_with_'):
-   If the NPC involved is 'Epic' or 'Legendary' (as indicated in "TRIGGER CONTEXT"), 'shouldTriggerEvent: true' is only warranted if the dialogue content itself (analyze "Recent Log" and broader "Memory Context") is EXCEPTIONALLY significant. Examples of significant dialogue content include:
    -   A major secret being revealed or a critical admission/lie by the NPC.
    -   A plot-altering discussion that directly leads to a new quest, a significant plan, a betrayal, or a major turning point in the story.
    -   A strong emotional provocation from the player or a profound emotional reaction from the NPC (e.g., rage, deep fear, sudden inspiration, profound sorrow) that has IMMEDIATE and TANGIBLE consequences or leads to a distinct new situation.
    -   The discovery of critical, game-changing lore, prophecies, or information that recontextualizes major aspects of the world or ongoing plots.
-   MERE GREETINGS, simple questions, or commonplace statements, even to 'Epic'/'Legendary' characters, should result in 'shouldTriggerEvent: false' UNLESS the specific content of that mundane interaction unexpectedly unlocks one of the significant criteria above (e.g., a coded phrase in a greeting reveals a secret identity).
-   If triggering, the 'eventConcept' MUST reflect the nature of the significant dialogue (e.g., "NPC Enraged by Insult", "Secret Revealed to the Council", "Ancient Prophecy Uncovered", "Sudden Betrayal", "Guan Yu's Mountain Strategy Revealed").
-   'eventIntensity' should be 'medium' or 'high' for such dialogue-triggered events due to their narrative importance.

ADDITIONAL CONSIDERATIONS:
1.  Analyze Trigger Context & Recent Log: Based on the rules above, is "${a}" (and recent dialogue in logs) significant enough?
2.  Mundane Actions/Dialogue: If not meeting the criteria, set 'shouldTriggerEvent: false'.
3.  Contextual Relevance & Story Focus: If event triggers, concept MUST fit location, character, inventory, recent events, and game setting/universe. Focus on concepts that lead to story development, challenges, or interesting lore reveals.
4.  Intensity: 'low' (atmospheric, minor choice, observation, small lore drop), 'medium' (direct interaction, some consequence, minor challenge, notable lore), 'high' (significant challenge, plot development, major changes to world/character, dense lore). Intensity should generally correlate with the rarity of the trigger.
5.  Narrative Value: Events should add interest, challenge, or depth. Avoid repetitive or nonsensical events. They should feel like a natural consequence or a meaningful development in the story.

CRITICAL: Invoke 'decide_event_trigger_and_concept' tool. Adhere to schema.
If 'shouldTriggerEvent' is true, 'eventConcept' and 'eventIntensity' MUST be provided and align with the trigger (rarity and/or dialogue significance).
If 'shouldTriggerEvent' is false, 'eventConcept' and 'eventIntensity' MUST be null.`;return Rt(C,zN,BN,"Invalid event decision structure (check shouldTriggerEvent, eventConcept, eventIntensity, consistency, focus on story/challenge and rarity/dialogue rules)",`decideIfEventShouldTrigger (Trigger: ${a})`)},Xh=a=>{switch(a){case"Pixel Art":return"Pixel Art icon";case"Anime":return"Anime style icon";case"Ink Painting":return"black and white traditional Chinese ink painting style icon";case"Oil Painting":return"distinctive impasto oil painting style icon";case"Water Painting":return"luminous watercolor painting style icon";case"Low Poly":return"stylized low-poly 3D render style icon";default:return`${a} icon`}},hi=async(a,e,t,o)=>{var h,p,v;let s=`https://via.placeholder.com/64x64/777/fff?text=${encodeURIComponent(e.substring(0,3))}`;const u=Xh(t);let f="";switch(t){case"Pixel Art":f="on a simple, clean pixel art background suitable for an inventory icon, or a subtle thematic pixel art surface related to the item. The item is the SOLE FOCUS, front and center.";break;case"Anime":f="with a clean, minimalist anime-style background, or a soft, out-of-focus thematic backdrop appropriate for the item. Item is sharply detailed, front and center, and the SOLE FOCUS.";break;case"Ink Painting":f="on a simple, clean black and white Chinese ink painting style background, like textured paper or subtle ink wash, focusing on minimalism and traditional aesthetics. The item is the SOLE FOCUS, front and center, rendered with clear, expressive brush strokes.";break;case"Oil Painting":f="on a background that subtly evokes a Caspar David Friedrich atmosphere (e.g., a hint of misty texture, a muted color palette suggestive of his landscapes) but keeps the item as the SOLE FOCUS. The item itself should be rendered with the detail and lighting characteristic of a Romantic era oil painting, emphasizing its texture and form.";break;case"Water Painting":f="on a clean, light background, possibly suggesting textured watercolor paper, to complement the soft, translucent watercolor style. The item is the SOLE FOCUS, with characteristic soft edges, transparent washes, and a sense of light fluidity.";break;case"Low Poly":f="on a clean, minimalist background that complements the low-poly aesthetic. The item is the SOLE FOCUS, highlighting its geometric forms and stylized rendering.";break;default:f=`on a neutral background suitable for a ${u}, item is the SOLE FOCUS, front and center.`}const g=`A high-quality ${u} of: ${a}. ${f} The item MUST be front and center, clear, and distinct. IMPORTANT: Image MUST ONLY contain the icon itself on its described background. NO text, watermarks, labels, UI elements. Clean ${u}. Suitable for a 64x64 game inventory slot.`;try{const T=await Gn.models.generateImages({model:yr,prompt:g,config:{numberOfImages:1,outputMimeType:"image/png"}});(v=(p=(h=T.generatedImages)==null?void 0:h[0])==null?void 0:p.image)!=null&&v.imageBytes?s=`data:image/png;base64,${T.generatedImages[0].image.imageBytes}`:console.warn(`No icon image data for ${e} (Prompt: ${g}). Using placeholder.`)}catch(T){console.error(`Error generating icon for ${e} (Prompt: ${g}):`,T.message||T)}return s},KN={functionDeclarations:[{name:"suggest_items_for_location",description:"Suggests 1-4 plausible items for a location. Considers character Perception, location context, game setting (Historical/Fictional universe), memory context, AND active item-related leads. Epic/Legendary items should be distinct from memory unless fulfilling a lead. Descriptions are factual. Visual prompt hints MUST be for the game's current visual style (e.g., 'Pixel Art icon', 'Anime style icon', 'black and white traditional Chinese ink painting style icon', 'distinctive impasto oil painting style icon', 'luminous watercolor painting style icon', 'stylized low-poly 3D render style icon'), focusing on the item itself with a simple/neutral background.",parameters:{type:_.OBJECT,properties:{items:{type:_.ARRAY,description:"Array of 1-4 items. Items should be contextually relevant. Prioritize fulfilling an item-related lead if plausible. Epic/Legendary items must be distinct from known entities in memory unless matching a lead. Descriptions must be factual (what the item IS, what's written on textual items, etc.).",items:{type:_.OBJECT,properties:{name:{type:_.STRING,description:"Item name. If fulfilling a lead, this MUST match the lead's item name."},description:{type:_.STRING,description:"Factual description (1-2 sentences). What IS it? Appearance? For textual items: summarize content/what's written. If fulfilling a lead, description should align with the lead's hint."},itemTypeGuess:{type:_.STRING,description:"Category (e.g., 'key', 'weapon', 'food', 'document')."},rarity:{type:_.STRING,enum:["Common","Uncommon","Rare","Epic","Legendary"],description:"Rarity. Influenced by character Perception and location significance. If fulfilling a lead, rarity should match/be consistent with the lead's rarity hint. Epic/Legendary items must be distinct from known entities in memory (unless fulfilling a lead for such an item) and align with setting/universe."},visualPromptHint:{type:_.STRING,description:"Detailed visual description of THE ITEM ITSELF, suitable for a [CURRENT_GAME_STYLE_ICON] (e.g., 'Pixel Art icon of a gleaming steel longsword with a sapphire', 'Anime style icon of a swirling crimson potion', 'black and white traditional Chinese ink painting style icon of an ancient scroll', 'distinctive impasto oil painting style icon of a jeweled crown', 'luminous watercolor painting style icon of a delicate flower', 'stylized low-poly 3D render style icon of a crystal shard'). Item should be front and center. Background implied should be simple/neutral or subtly thematic TO THE ITEM for that style, item is SOLE focus."}},required:["name","description","itemTypeGuess","rarity","visualPromptHint"]}}},required:["items"]}}]},ZN=a=>{const e=["Common","Uncommon","Rare","Epic","Legendary"];return a&&Array.isArray(a.items)&&a.items.every(t=>t&&typeof t.name=="string"&&t.name.trim()!==""&&typeof t.description=="string"&&t.description.trim()!==""&&typeof t.itemTypeGuess=="string"&&t.itemTypeGuess.trim()!==""&&typeof t.rarity=="string"&&e.includes(t.rarity)&&typeof t.visualPromptHint=="string"&&t.visualPromptHint.trim()!=="")},XN=async(a,e,t,o="")=>{var I;const s=e.skills.find(b=>b.name==="Perception"),u=(s==null?void 0:s.level)||0,f=e.visualStyle,g=Xh(f);let h="",p="";e.gameSettingType==="Historical"&&e.initialHistoricalContext?(h=`Game Setting: HISTORICAL - ${e.initialHistoricalContext}. All suggested items MUST be historically plausible and authentic for this period and culture. Epic/Legendary items should be actual known artifacts or highly significant cultural objects, distinct from any existing in memory unless fulfilling a lead. Descriptions must be factual. Item visual prompt hints must describe the item itself, suitable for a ${g}.`,p=`Historical Context: ${e.initialHistoricalContext}. Current Visual Style: ${f}.`):e.gameSettingType==="Fictional"&&(e.fictionalUniverseContext?(h=`Game Setting: FICTIONAL within universe: "${e.fictionalUniverseContext}". Items MUST be consistent with this universe's lore, technology, and themes. Epic/Legendary items could be known artifacts from this universe, distinct from memory unless fulfilling a lead. Item visual prompt hints must describe the item itself, suitable for a ${g}.`,p=`Fictional Universe: ${e.fictionalUniverseContext}. Current Visual Style: ${f}.`):(h=`Game Setting: General FICTIONAL. Items should fit the character concept and location theme. Epic/Legendary items should be unique, lore-rich artifacts, distinct from memory unless fulfilling a lead. You may subtly draw inspiration from common fantasy/sci-fi/pop-culture tropes if they naturally fit and enhance the experience. Item visual prompt hints must describe the item itself, suitable for a ${g}.`,p=`Current Visual Style: ${f}.`));const v=`Current Location: "${a.name}" (Description: "${a.description}", Tags: [${a.environmentTags.join(", ")}], Rarity: ${a.rarity}). Items found MUST be thematically and functionally relevant to this specific location.`;let T="No specific item-related leads are currently active.";const C=t.filter(b=>b.type==="item"&&b.status==="mentioned");C.length>0&&(T=`Active Item-Related Leads (Rumors):
${C.map(b=>`- Rumored Item: "${b.name}" (Type: ${b.type}, Hint: ${b.descriptionHint}, Rarity Hint: ${b.rarityHint||"Unknown"}). Source: ${b.sourceTextSnippet.substring(0,50)}...`).join(`
`)}`);const S=`You are an AI game assistant. Your task is to suggest items for a location.
Context:
- ${v}
- Character: ${e.characterConcept} (Perception Level: ${u}).
- ${p}
- ${T}
- ${o}
- ${Ht}

PRIMARY DIRECTIVE: Items found MUST be thematically and functionally relevant to this specific location and consistent with the overall game setting (Historical context or Fictional Universe lore). Adherence to the established setting is PARAMOUNT. ${h}

Guidelines for Item Suggestion:
1.  Quantity: Suggest 1-4 plausible items.
2.  Relevance & Consistency: Items must be thematically/functionally relevant to the specific location and character context, and game setting/universe. This is the PRIMARY consideration.
3.  Lead Fulfillment (Secondary Consideration): If an active item-related lead from "${T}" can be FULFILLED *WITHOUT violating the PRIMARY DIRECTIVE* (contextual relevance, setting consistency), then you MAY suggest an item that fulfills it.
    - If fulfilling a lead, the generated item's name, description, and rarity MUST align closely with the lead's details.
    - However, if fulfilling a lead would result in an item that is out of place, anachronistic, or lore-breaking for the current location/setting, DO NOT fulfill that lead. Instead, generate other contextually appropriate items or no items if none fit. Leads are rumors, not guarantees.
4.  Rarity: Higher character Perception may increase chance of finding Uncommon/Rare items. Epic/Legendary items are very rare and typically found in significant locations or via high Perception, OR by fulfilling a lead for such an item. They must be distinct from entities in memory unless matching a lead for an Epic/Legendary item and align with setting/universe context.
5.  Descriptions: Item descriptions must be FACTUAL (e.g., what the item IS, what is written on a scroll).
6.  Visual Prompt Hint for Item: Provide a DETAILED visual description of THE ITEM ITSELF, suitable for a ${g}. Item should be front and center. Any implied background should be simple, neutral, or subtly thematic TO THE ITEM, in ${f} style, but item is SOLE focus. Replace '[CURRENT_GAME_STYLE_ICON]' in the tool schema with '${g}'. For example, for a potion in ${f}: 'a swirling crimson liquid in a clear glass vial with a silver stopper'.

CRITICAL: You MUST invoke the tool named 'suggest_items_for_location'. The arguments you provide to this tool MUST adhere strictly to its schema.
DO NOT output the item details as plain text or a JSON string within a text part. The tool call is the ONLY valid way to provide this information.`,w=await Rt(S,KN,ZN,"Invalid item suggestion (check rarity, description, distinction from memory, lead fulfillment, visual prompt for item, visual appeal, setting/universe consistency, contextual relevance)","generateItemsForLocation");return(I=w.items)!=null&&I.length?Promise.all(w.items.map(async b=>{const A=await hi(b.visualPromptHint,b.name,f,a.visualPromptHint);return{...b,id:crypto.randomUUID(),iconUrl:A}})):[]},jN={functionDeclarations:[{name:"provide_pickup_narration",description:"Generates brief narration for picking up an item.",parameters:{type:_.OBJECT,properties:{narration:{type:_.STRING,description:"Short (1 sentence) narration from the player's perspective (e.g., 'You snatch the Rusty Dagger.')."}},required:["narration"]}}]},QN=a=>a&&typeof a.narration=="string"&&a.narration.trim()!=="",WN=async(a,e,t="")=>{const o=`Character: ${e.characterConcept} (Skills: ${zt(e.skills)}) is picking up: ${a.name} (Description: ${a.description}, Rarity: ${a.rarity}).
${t}
Task: Generate a short, engaging narration (1 sentence) for this action, from the player's perspective (using "You"). For example: "You carefully pick up the Glimmering Shard."
CRITICAL: You MUST invoke the tool named 'provide_pickup_narration'. The tool expects a single 'narration' string. Adhere to this.`;return{narration:(await Rt(o,jN,QN,"Invalid pickup narration structure","narrateAndConfirmPickup")).narration,pickedUpItem:a}},eA={functionDeclarations:[{name:"determine_item_usage_effect",description:"Determines effect of using an item. Considers item properties, rarity (Epic/Legendary known items significant), character skills, targeted limb, memory context, game setting/universe. Provides narration, specifies changes. If targetLimbName NOT provided, isEquippedToLimb MUST be false. New visual prompt hint for item must be style-agnostic for the item itself if it changes.",parameters:{type:_.OBJECT,properties:{narration:{type:_.STRING,description:"Engaging narration (1-3 sentences, player's perspective 'You'). Impact/tone reflects item rarity, skills, memory context (INCLUDING IF CURRENTLY IN DIALOGUE WITH AN NPC), game setting/universe. Use of Epic/Legendary significant. If in dialogue, the narration should make sense in that context (e.g., player's action is visible to NPC)."},itemConsumed:{type:_.BOOLEAN,description:"Boolean indicating if item consumed."},isEquippedToLimb:{type:_.BOOLEAN,nullable:!0,description:"True if item equipped/worn/wielded. False if one-time use, not attached, or no targetLimbName. If true, item ADDED to limb's equipped items."},itemNewName:{type:_.STRING,nullable:!0,description:"New name if item changes. Null if unchanged."},itemNewDescription:{type:_.STRING,nullable:!0,description:"New description if item changes. Null if unchanged."},itemNewVisualPromptHint:{type:_.STRING,nullable:!0,description:"New STYLE-AGNOSTIC visual prompt for THE ITEM ITSELF if its appearance changes (e.g. 'a now cracked orb', 'a dagger glowing faintly'). Null if appearance unchanged. Focus on item, not background."},overallHealthChange:{type:_.NUMBER,nullable:!0,description:"Change in overall health. Magnitude reflects item rarity, skills, game setting/universe."},energyChange:{type:_.NUMBER,nullable:!0,description:"Change in energy. Magnitude reflects item rarity, skills, game setting/universe."},limbStatusChanges:{type:_.ARRAY,nullable:!0,description:"Array of changes to limb status/health. If limb targeted, primary effect here. Magnitude/type reflects item rarity, skills. 'newHealth' absolute (0-100).",items:{type:_.OBJECT,properties:{limbName:{type:_.STRING},newStatus:{type:_.STRING},newHealth:{type:_.NUMBER}},required:["limbName","newStatus","newHealth"]}},xpGain:{type:_.OBJECT,nullable:!0,description:"Optional skill XP gain. Null if no XP.",properties:{skillName:{type:_.STRING},amount:{type:_.NUMBER}},required:["skillName","amount"]}},required:["narration","itemConsumed"]}}]},tA=a=>a&&typeof a.narration=="string"&&a.narration.trim()!==""&&typeof a.itemConsumed=="boolean"&&(a.isEquippedToLimb===void 0||a.isEquippedToLimb===null||typeof a.isEquippedToLimb=="boolean")&&(a.itemNewName===void 0||a.itemNewName===null||typeof a.itemNewName=="string")&&(a.itemNewDescription===void 0||a.itemNewDescription===null||typeof a.itemNewDescription=="string")&&(a.itemNewVisualPromptHint===void 0||a.itemNewVisualPromptHint===null||typeof a.itemNewVisualPromptHint=="string")&&(a.overallHealthChange===void 0||a.overallHealthChange===null||typeof a.overallHealthChange=="number")&&(a.energyChange===void 0||a.energyChange===null||typeof a.energyChange=="number")&&(a.limbStatusChanges===void 0||a.limbStatusChanges===null||Array.isArray(a.limbStatusChanges)&&a.limbStatusChanges.every(e=>e&&typeof e.limbName=="string"&&typeof e.newStatus=="string"&&typeof e.newHealth=="number"&&e.newHealth>=0&&e.newHealth<=100))&&(a.xpGain===void 0||a.xpGain===null||typeof a.xpGain=="object"&&a.xpGain.skillName&&typeof a.xpGain.skillName=="string"&&typeof a.xpGain.amount=="number"),sh=async(a,e,t,o="")=>{var C;const s=zt(e.skills),u=va(e.limbs),f=`Char: ${e.characterConcept} (Visual Style: ${e.visualStyle}). Health: ${e.overallHealth}HP, Energy: ${e.currentEnergy}/${e.maxEnergy}EN. Limbs & Equipment: [${u}]. Defeated: ${e.isDefeated}. Skills: [${s}]. Setting: ${e.gameSettingType}.`,g=`Item: ${a.name} (Type: ${a.itemTypeGuess}, Rarity: ${a.rarity}). Desc: ${a.description}.`;let h="";if(t){const S=e.limbs.find(w=>w.name===t);h=S?` Player is attempting to use this item on their ${S.name} (Current Status: ${S.status}, Health: ${S.health}HP, Currently Equipped: ${((C=S.equippedItems)==null?void 0:C.map(w=>w.name).join(", "))||"None"})`:` Player is attempting to use this item on an unrecognized limb named '${t}'. Assume general use or flag as implausible.`}else h=" Player is using this item generally (not targeting a specific limb for equipping). 'isEquippedToLimb' MUST BE false in this case.";let p="";e.gameSettingType==="Historical"&&e.initialHistoricalContext?p=`Game Setting: HISTORICAL - ${e.initialHistoricalContext}. Item effect and narration MUST be historically plausible. If '${a.name}' is Epic/Legendary, effects align with known properties/legends from that period. Mundane items have mundane effects.`:e.gameSettingType==="Fictional"&&(e.fictionalUniverseContext?p=`Game Setting: FICTIONAL within universe: "${e.fictionalUniverseContext}". Item effect and narration MUST be consistent with this universe's lore/rules. If '${a.name}' is Epic/Legendary, effects should be significant and lore-appropriate.`:p="Game Setting: General FICTIONAL. Item effect and narration should fit its description and rarity. Epic/Legendary items have significant effects. You may subtly draw inspiration from common fantasy/sci-fi/pop-culture tropes if they naturally fit the item and enhance the experience.");const v=`Character (${f}) is using item (${g}).${h}
${o}
${p}
${Ht}

Task: Determine the effects of using this item.
-   Narration: Provide engaging narration (1-3 sentences, from "You" perspective).
    Impact/tone reflects item rarity ('${a.rarity}'), skills, memory context (INCLUDING IF CURRENTLY IN DIALOGUE WITH AN NPC - if so, your action is likely visible), game setting/universe.
    Use of Epic/Legendary significant. Consider player's equipped items if relevant to how the used item works.
-   Item Effects: Specify if item consumed, changes properties (name, desc). If item's visual appearance changes, provide a STYLE-AGNOSTIC description for 'itemNewVisualPromptHint' (e.g., 'a now cracked orb', 'a dagger glowing faintly'). Focus on ITEM itself, not background.
-   Character Effects: Specify changes to overall health, energy, or limb status. Limb status changes include new health (0-100 absolute) and descriptive status.
-   Equipping Logic (MUST be followed):
    -   If \`targetLimbName\` provided AND \`itemUsed.itemTypeGuess\` suggests WEAPON or ARMOR/CLOTHING suitable for that limb:
        -   \`isEquippedToLimb\` MUST be true. \`itemConsumed\` MUST be false. Narration describes equipping. \`limbStatusChanges\` reflects equipping. Other character effects usually null/0 unless magical.
    -   If \`targetLimbName\` provided but item is CONSUMABLE:
        -   \`isEquippedToLimb\` MUST be false. \`itemConsumed\` likely true. Effects depend on consumable.
    -   If \`targetLimbName\` provided but item inappropriate for limb:
        -   \`isEquippedToLimb\` MUST be false. Minimal/negative effect. Narration reflects failed attempt.
    -   If \`targetLimbName\` NOT provided (general use):
        -   \`isEquippedToLimb\` MUST BE false. Item likely consumable or general effect.
-   Nonsensical Use: If use clearly nonsensical, \`isEquippedToLimb\` false, minimal/negative effects. Narration reflects this.
-   XP: Optionally grant XP for skillful application.

CRITICAL: You MUST invoke tool 'determine_item_usage_effect'. Arguments MUST adhere strictly to schema.
DO NOT output details as text/JSON. Tool call is ONLY valid way.`,T=await Rt(v,eA,tA,"Invalid item usage effect structure (check effects align with rarity, type, skills, health/energy values, memory context, setting/universe consistency)","determineItemUsageEffect");return{narration:T.narration,itemEffect:{consumed:T.itemConsumed,isEquippedToLimb:T.isEquippedToLimb||!1,newNameIfChanged:T.itemNewName||null,newDescriptionIfChanged:T.itemNewDescription||null,newVisualPromptHintIfChanged:T.itemNewVisualPromptHint||null},characterEffect:{overallHealthChange:T.overallHealthChange||null,energyChange:T.energyChange||null,limbStatusChanges:T.limbStatusChanges||null,xpGain:T.xpGain||null}}},nA=async(a,e,t,o="")=>{const s=e.skills.find(T=>T.name==="Perception"),u=(s==null?void 0:s.level)||0,f=`Char: ${e.characterConcept} (Perception Lvl ${u}). Setting: ${e.gameSettingType}.`;["book","scroll","note","letter","manuscript","codex","journal","log","brochure","pamphlet","inscription","carving","tablet","map","document"].some(T=>a.itemTypeGuess.toLowerCase().includes(T));let h="";e.gameSettingType==="Historical"&&e.initialHistoricalContext?h=`Elaboration MUST be consistent with historical context: ${e.initialHistoricalContext}. If item is known artifact type, align with its REAL history/use. Focus on historical significance or connections.`:e.gameSettingType==="Fictional"&&(e.fictionalUniverseContext?h=`Elaboration MUST be consistent with the established lore of the fictional universe: "${e.fictionalUniverseContext}". If item is known artifact from this universe, expand on its specific IN-WORLD lore. Focus on its role or history within this universe.`:h="Elaboration should be consistent with a general fantasy/sci-fi theme fitting the item. You may subtly draw inspiration from common tropes if they naturally fit and enhance the experience. Focus on unique properties, origins, or connections to broader world lore.");let p=`Provide a CONCISE (1-2 short paragraphs) LORE-FOCUSED and FACT-RICH description. Avoid generic statements about its function (e.g., "This sword is for fighting"). Instead, focus on what makes THIS item unique or significant within the game world.

If NOT textual (e.g., weapon, tool, artifact):
-   Reveal its specific history, origin (e.g., who made it, when, why), notable past owners or significant events it was involved in.
-   Describe any unique magical properties, curses, blessings, or specific powers it holds, with details on how they manifest or were acquired.
-   Mention any distinguishing marks, inscriptions (and their meaning if known), or unique materials used in its construction.
-   Connect it to known entities, factions, or historical/lore events from the game's memory context if plausible, providing specific links.
-   What are some "fun facts", real historical details (if applicable), or intriguing pieces of in-world lore about this item that a knowledgeable character might recall?

If TEXTUAL (e.g., book, scroll, map, letter):
-   Extract and present specific, concrete information, key passages, names, dates, plans, observations, or secrets DIRECTLY from the text.
-   DO NOT just say 'This scroll contains battle plans.' Instead, DESCRIBE THE ACTUAL PLAN: 'The faded ink outlines a daring night raid on the Western Garrison, detailing a secret passage beneath the old aqueduct and specifying the use of silenced crossbows.' Or, if it's a historical document, 'This edict, dated 44 BCE, proclaims Caesar Dictator Perpetuo, outlining new public works projects including...'
-   If it's a map, describe key locations it reveals, real historical routes/sites (if applicable), or important symbols and their in-world lore meaning.
-   If it's a letter, summarize its specific contents, sender, recipient, and its real historical/in-world lore purpose and context.
-   What are some "fun facts", hidden meanings, historical context, or intriguing pieces of in-world lore one would glean from a careful reading?
`;(a.rarity==="Epic"||a.rarity==="Legendary")&&(p+=`
As this item is ${a.rarity}, its details should be particularly insightful, reflecting its unique history, profound power, or significant role in the world's lore. If it's a known historical artifact (for Historical setting) or a legendary item from the Fictional Universe, your description MUST align with and expand upon established REAL historical facts or IN-WORLD lore about it.`);const v=`Player learns more about item.
Item: ${a.name}, Current Desc: ${a.description}, Type: ${a.itemTypeGuess}, Rarity: ${a.rarity}.
${f} ${Ht} (Player Perception Lvl ${u} might reveal more).
${o}
Task: ${p} ${h} Output ONLY rich, descriptive factual text. No markdown. No player thoughts/feelings.
If you mention any specific named items, people, or locations that sound important, unique, or part of a legend/quest, make a mental note but DO NOT use any special formatting or markup in your direct speech output. The game system will handle identifying these hints separately.`;try{const T=await Gn.models.generateContent({model:ya,contents:v}),C=T.text;if(C!=null&&C.trim())return await Bi(C,"item_text",a.id,e,t,o);console.warn(`Elaboration for ${a.name} resulted in empty response.`,T);const S="Further examination reveals no additional significant details.";return{processedText:S,rawText:S,potentialDiscoveries:[]}}catch(T){console.error(`Error elaborating on item ${a.name}:`,T);const C=`Error recalling more about ${a.name}. Details hazy. (Error: ${T.message||"Unknown"})`;return{processedText:C,rawText:C,potentialDiscoveries:[]}}},iA={functionDeclarations:[{name:"select_item_from_inventory_by_phrase",description:"Given a player's textual phrase referring to an item and a list of items in their inventory, selects the single best matching item ID. Considers item names, types, descriptions, and context (player skills, recent actions/dialogue in memory).",parameters:{type:_.OBJECT,properties:{matchedItemId:{type:_.STRING,nullable:!0,description:"The ID of the item in the inventory that best matches the player's phrase. Null if no clear match or if the phrase is too ambiguous given the inventory contents."}},required:["matchedItemId"]}}]},aA=a=>a&&(a.matchedItemId===null||typeof a.matchedItemId=="string"),oA=async(a,e,t,o)=>{if(e.length===0)return null;const s=e.map(h=>`ID: ${h.id}, Name: "${h.name}", Type: ${h.itemTypeGuess}, Rarity: ${h.rarity}, Desc: "${h.description.substring(0,50)}..."`).join(`
`),u=zt(t.skills),f=`Player wants to use an item referred to as: "${a}".
Player Character: ${t.characterConcept}. Skills: [${u}].
Current Inventory:
${s}
Recent Game Context/Memory (may provide clues about intended item):
${o}
${Ht}

Task: Identify which item ID from the "Current Inventory" the player is most likely referring to with the phrase "${a}".
- Consider exact name matches first (case-insensitive).
- Then consider partial name matches (e.g., "healing pot" for "Healing Potion").
- Consider type matches (e.g., "potion" if they say "use potion" and have one; prioritize by rarity or more specific name if multiple).
- Use character skills and memory context to infer intent if the phrase is ambiguous (e.g., a character skilled in healing trying to "use bandage" likely means their specific "Herbal Bandage" item).
- If multiple items are plausible, pick the one that seems most relevant given the context or is generally more useful (e.g., a healing potion over a generic rock if player says "use item").
- If no item is a clear or strong match, return null for matchedItemId.

CRITICAL: You MUST invoke the tool 'select_item_from_inventory_by_phrase'.
Provide the ID of the best-matched item.
`,g=await Rt(f,iA,aA,"Invalid item identification structure from LLM.","identifyItemInInventoryByName");return g.matchedItemId&&e.find(h=>h.id===g.matchedItemId)||null},rA={functionDeclarations:[{name:"provide_crafted_item_details",description:"Provides narration for successfully crafting a predefined item.",parameters:{type:_.OBJECT,properties:{narration:{type:_.STRING,description:"Engaging narration (1-2 sentences) of successful crafting, reflecting character's skill."}},required:["narration"]}}]},sA=a=>a&&typeof a.narration=="string"&&a.narration.trim()!=="",lA=async(a,e,t,o,s="")=>{const u=t.skills.find(C=>C.name==="Crafting"),f=(u==null?void 0:u.level)||0,g=t.visualStyle,h=`Character: ${t.characterConcept} (Crafting Level: ${f}, Visual Style: ${g}) successfully crafted "${a.name}" (Rarity: ${a.rarity}) using [${e.join(", ")}]. The crafted item's description is "${a.description}".
${s}
${Ht}
Task: Generate engaging narration (1-2 sentences, from "You" perspective) for this successful crafting event. The narration should reflect the character's Crafting skill level. For example, high skill might be "You skillfully combine...", low skill "Despite fumbling...".
CRITICAL: You MUST invoke the tool named 'provide_crafted_item_details'. The tool expects a single 'narration' string. Ensure strict adherence.`,p=await Rt(h,rA,sA,"Invalid crafted item details structure","generateCraftedItemDetailsAndNarration"),v=await hi(a.visualPromptHint,a.name,g);return{craftedItem:{...a,id:crypto.randomUUID(),iconUrl:v},narration:p.narration}},uA={functionDeclarations:[{name:"determine_dynamic_crafting_outcome",description:"Determines outcome of experimental crafting. Quality/rarity HEAVILY influenced by Crafting skill, memory, game setting/universe. Epic/Legendary distinct unless fulfilling a lead. Item for lead MUST be contextually plausible. Visual prompt hint for item should be for the game's current visual style (e.g., 'Pixel Art icon', 'Anime style icon', or 'black and white traditional Chinese ink painting style icon' if 'Ink Painting' is current style), focusing on item itself with simple background.",parameters:{type:_.OBJECT,properties:{newItemName:{type:_.STRING,description:"Name of resulting item. If fulfilling lead, matches lead name."},newItemDescription:{type:_.STRING,description:"Description, hints at use/lore. If fulfilling lead, aligns with hint."},newItemItemTypeGuess:{type:_.STRING,description:"Category (e.g., 'tool', 'junk', 'potion', 'trinket')."},newItemRarity:{type:_.STRING,enum:["Common","Uncommon","Rare","Epic","Legendary"],description:"Rarity. Strongly influenced by Crafting skill, input rarity, memory, setting/universe. If fulfilling lead, matches/consistent with lead rarity. Epic/Legendary distinct (unless lead). Failures/junk 'Common'."},newItemVisualPromptHint:{type:_.STRING,description:"Detailed visual description of THE ITEM ITSELF, suitable for a [CURRENT_GAME_STYLE] icon (e.g., 'Pixel Art icon', 'Anime style icon', or 'black and white traditional Chinese ink painting style icon' if 'Ink Painting' is current style). Item should be front and center. Background implied should be simple/neutral or subtly thematic TO THE ITEM for that style, item is SOLE focus. Example for [CURRENT_GAME_STYLE]=Anime: 'a pulsing orb of dark energy with swirling patterns'."},narration:{type:_.STRING,description:"Narration (1-3 sentences) of process, outcome, reflecting Crafting skill, inputs, setting/universe."},fulfilledLeadId:{type:_.STRING,nullable:!0,description:"ID of item lead fulfilled, if any. ONLY if item is plausible from inputs & context AND matches lead."}},required:["newItemName","newItemDescription","newItemItemTypeGuess","newItemRarity","newItemVisualPromptHint","narration"]}}]},cA=a=>{const e=["Common","Uncommon","Rare","Epic","Legendary"];return a&&typeof a.newItemName=="string"&&a.newItemName.trim()!==""&&typeof a.newItemDescription=="string"&&a.newItemDescription.trim()!==""&&typeof a.newItemItemTypeGuess=="string"&&a.newItemItemTypeGuess.trim()!==""&&typeof a.newItemRarity=="string"&&e.includes(a.newItemRarity)&&typeof a.newItemVisualPromptHint=="string"&&a.newItemVisualPromptHint.trim()!==""&&typeof a.narration=="string"&&a.narration.trim()!==""&&(a.fulfilledLeadId===void 0||a.fulfilledLeadId===null||typeof a.fulfilledLeadId=="string")},dA=async(a,e,t,o,s="")=>{const u=e.skills.find(A=>A.name==="Crafting"),f=(u==null?void 0:u.level)||0,g=a.map(A=>`${A.name} (Type: ${A.itemTypeGuess}, Rarity: ${A.rarity}, Desc: ${A.description})`).join("; "),h=e.visualStyle;let p="",v="";e.gameSettingType==="Historical"&&e.initialHistoricalContext?(p=`Game Setting: HISTORICAL - ${e.initialHistoricalContext}. Dynamically crafted item MUST be plausible for this era. High Crafting (7+) with rare/thematic inputs and fitting memory might yield restored/empowered historical artifact type, not unique named artifacts unless inputs are its pieces or a lead suggests it and it's plausible. Item visual prompt hints must describe the item itself, suitable for a ${h==="Ink Painting"?"black and white traditional Chinese ink painting style":h} icon.`,v=`Historical Context: ${e.initialHistoricalContext}. Current Visual Style: ${h}.`):e.gameSettingType==="Fictional"&&(e.fictionalUniverseContext?(p=`Game Setting: FICTIONAL within universe: "${e.fictionalUniverseContext}". Crafted item MUST be consistent with universe lore. High Crafting (7+) with rare/thematic inputs might yield lore-appropriate Epic/Legendary item (new artifact or component, or lead fulfillment if plausible). Distinct from memory unless lead. Item visual prompt hints must describe the item itself, suitable for a ${h==="Ink Painting"?"black and white traditional Chinese ink painting style":h} icon.`,v=`Fictional Universe: ${e.fictionalUniverseContext}. Current Visual Style: ${h}.`):(p=`Game Setting: General FICTIONAL. Crafted item fits character/inputs. High Crafting (7+) with rare/thematic inputs might yield original Epic/Legendary item, or fulfill a lead if plausible. You may subtly draw inspiration from common fantasy/sci-fi tropes if they fit. Distinct from memory unless lead. Item visual prompt hints must describe the item itself, suitable for a ${h==="Ink Painting"?"black and white traditional Chinese ink painting style":h} icon.`,v=`Current Visual Style: ${h}.`));let T="No specific item-related leads active for crafting.";const C=o.filter(A=>A.type==="item"&&A.status==="mentioned");C.length>0&&(T=`Active Item-Related Leads (Rumors) to consider for crafting fulfillment:
${C.map(A=>`- Lead ID: ${A.id}, Rumored Item: "${A.name}" (Hint: ${A.descriptionHint}, Rarity Hint: ${A.rarityHint||"Unknown"}).`).join(`
`)}`);const S=`Character: ${e.characterConcept} (Crafting Level: ${f}, Visual Style: ${h}) is attempting to combine: [${g}].
${v}
${T}
${s}
${Ht}

PRIMARY DIRECTIVE: The outcome of crafting MUST be logically plausible given the input items, character's Crafting skill, and consistent with the game setting (Historical context or Fictional Universe lore). ${p}

Task: Determine the outcome of this experimental crafting.
-   Crafting skill (Level ${f}) is PARAMOUNT. Low skill (0-2) usually 'Common' junk/failure. Mid skill (3-6) 'Uncommon'/'Rare'. High skill (7+) 'Rare'/'Epic'. 'Legendary' exceptional, requires high skill, specific inputs, fitting context.
-   LEAD FULFILLMENT (Secondary): If inputs, skill, and context make it *highly plausible* to craft an item fulfilling an active lead from "${T}", you MAY do so. Provide 'fulfilledLeadId'. The crafted item MUST match lead's name/concept/rarity. DO NOT force lead fulfillment if implausible.
-   Be creative! Outcome based on inputs, skill, setting. Describe new item (name, desc, type, rarity).
-   Visual Prompt Hint for New Item: Provide a DETAILED visual description of THE ITEM ITSELF, suitable for a ${h==="Ink Painting"?"black and white traditional Chinese ink painting style":h} icon. Item should be front and center. Any implied background should be simple, neutral, or subtly thematic TO THE ITEM, in ${h} style, but item is SOLE focus. Replace '[CURRENT_GAME_STYLE]' in the tool schema with '${h==="Ink Painting"?"black and white traditional Chinese ink painting style":h}'.
-   Narration (1-3 sentences, "You" perspective) reflects process, outcome, skill.

CRITICAL: You MUST invoke tool 'determine_dynamic_crafting_outcome'. Arguments MUST adhere to schema.
DO NOT output details as text/JSON. Tool call is ONLY valid way.`,w=await Rt(S,uA,cA,"Invalid dynamic crafting outcome (check rarity, outcome interest, distinction from memory, skill adherence, lead fulfillment plausibility, visual appeal, setting/universe consistency)","guessDynamicCraftingOutcome"),I=await hi(w.newItemVisualPromptHint,w.newItemName,h);return{newItem:{id:crypto.randomUUID(),name:w.newItemName,description:w.newItemDescription,itemTypeGuess:w.newItemItemTypeGuess,rarity:w.newItemRarity,visualPromptHint:w.newItemVisualPromptHint,iconUrl:I},narration:w.narration,fulfilledLeadId:w.fulfilledLeadId}},Js=[{name:"Combat",description:"Proficiency in physical confrontations, including using weapons and unarmed techniques. Affects attack accuracy, damage, and defensive maneuvers."},{name:"Crafting",description:"Ability to create and repair items from raw materials. Influences quality and complexity of crafted items."},{name:"Survival",description:"Knowledge of tracking, foraging, and enduring harsh environments. Affects finding resources, navigating hazards, and effectiveness of certain consumables."},{name:"Perception",description:"Acuity in noticing details, hidden objects, or subtle clues. Helps in finding items, spotting danger, and discerning information."},{name:"Persuasion",description:"Skill in influencing others through dialogue, negotiation, or charm. Affects NPC reactions, quest outcomes, and trading."},{name:"Mobility",description:"Represents agility, nimbleness, and ease of movement. May influence future actions like evasion or navigating difficult terrain."}],jh=a=>{switch(a){case"Pixel Art":return"Pixel Art portrait/sprite";case"Anime":return"Anime style portrait/sprite";case"Ink Painting":return"black and white traditional Chinese ink painting style portrait/sprite";case"Oil Painting":return"distinctive impasto oil painting style portrait/sprite";case"Water Painting":return"luminous watercolor painting style portrait/sprite";case"Low Poly":return"stylized low-poly 3D render style portrait/sprite";default:return`${a} portrait/sprite`}},Qh=async(a,e,t,o)=>{var g,h,p;let s=`https://via.placeholder.com/128x128/777/fff?text=${encodeURIComponent(e.substring(0,3))}`;const u=jh(o);let f;try{let v=`a background thematically consistent with: "${t}" and rendered in a ${o} style`;o==="Ink Painting"?v=`a simple black and white Chinese ink painting style background, like textured paper, subtle ink wash, or minimalist traditional elements consistent with the location: "${t}"`:o==="Oil Painting"?v=`a simple, subtly textured background that complements an oil painting portrait, perhaps suggesting an environment consistent with: "${t}" without distracting from the NPC. Ensure the oily texture of the paint is apparent in the NPC's rendering.`:o==="Water Painting"?v=`a light, airy background with soft watercolor washes, or a suggestion of textured paper, consistent with the location: "${t}" and enhancing the watercolor portrait. The watery, transparent nature of the medium should be evident in the NPC's rendering.`:o==="Low Poly"?v=`a clean, minimalist background, possibly with simple geometric shapes or a flat color, consistent with the low-poly aesthetic and the location: "${t}"`:t.toLowerCase().includes(`a detailed ${o.toLowerCase()} style illustration`)&&(v=`a background matching the style of: "${t.replace(`A detailed ${o.toLowerCase()} style illustration for a fantasy adventure game.`,"").trim()}"`),f=`${u} of an NPC described as: "${a}". NPC is focus. Background: ${v}. Well-lit, distinct. Clean ${u.replace(" portrait/sprite","")}.
IMPORTANT: Image MUST ONLY contain NPC sprite on background. NO text, watermarks, labels, icons, borders, chat/dialogue boxes, UI elements. Features/attire clear.`;const T=await Gn.models.generateImages({model:yr,prompt:f,config:{numberOfImages:1,outputMimeType:"image/png"}});(p=(h=(g=T.generatedImages)==null?void 0:g[0])==null?void 0:h.image)!=null&&p.imageBytes?s=`data:image/png;base64,${T.generatedImages[0].image.imageBytes}`:console.warn(`No icon image data for NPC ${e}. Using placeholder. Prompt: ${f}`)}catch(v){console.error(`Error generating icon for NPC ${e} (Prompt: ${f}):`,v.message||v)}return s},fA=a=>{switch(a){case"Pixel Art":return"Pixel Art icon";case"Anime":return"Anime style icon";case"Ink Painting":return"black and white traditional Chinese ink painting style icon";case"Oil Painting":return"distinctive impasto oil painting style icon";case"Water Painting":return"luminous watercolor painting style icon";case"Low Poly":return"stylized low-poly 3D render style icon";default:return`${a} icon`}},mA={functionDeclarations:[{name:"suggest_npc_inventory_items",description:"Suggests 0-3 plausible starting inventory items for an NPC. Items lore-relevant, useful, or interesting. Rarity reflects value/importance. Considers memory context and game setting/universe for Epic/Legendary items. Visual prompt hints are for the game's current visual style (e.g., 'Pixel Art icon', 'Anime style icon', 'distinctive impasto oil painting style icon', 'luminous watercolor painting style icon'), item-focused.",parameters:{type:_.OBJECT,properties:{items:{type:_.ARRAY,description:'Array of 0-3 items. If none, MUST be empty array: {"items": []}. Items fit NPC role, needs, lore, game setting/universe. Epic/Legendary distinct from memory.',items:{type:_.OBJECT,properties:{name:{type:_.STRING,description:"Item name."},description:{type:_.STRING,description:"Brief, evocative description."},itemTypeGuess:{type:_.STRING,description:"Category (e.g., 'quest_item', 'armor', 'tool', 'trinket')."},rarity:{type:_.STRING,enum:["Common","Uncommon","Rare","Epic","Legendary"],description:"Rarity. Consider NPC status, role, item uniqueness, game setting/universe. Epic/Legendary distinct from memory."},visualPromptHint:{type:_.STRING,description:"Visual prompt for 32x32 [CURRENT_GAME_STYLE_ICON] (e.g., 'Pixel Art icon of a...', 'Anime style icon of...', 'distinctive impasto oil painting style icon of a thick, textured amulet', 'luminous watercolor painting style icon of a flowing, translucent silk scarf'). Item is SOLE FOCUS on simple/neutral or item-thematic background for that style. Ensure appealing, clear, interesting."}},required:["name","description","itemTypeGuess","rarity","visualPromptHint"]}}},required:["items"]}}]},pA=a=>{const e=["Common","Uncommon","Rare","Epic","Legendary"];return a&&Array.isArray(a.items)&&a.items.every(t=>t&&typeof t.name=="string"&&t.name.trim()!==""&&typeof t.description=="string"&&t.description.trim()!==""&&typeof t.itemTypeGuess=="string"&&t.itemTypeGuess.trim()!==""&&typeof t.rarity=="string"&&e.includes(t.rarity)&&typeof t.visualPromptHint=="string"&&t.visualPromptHint.trim()!=="")},gA=async(a,e,t="")=>{var g;if(!a.initialInventoryInstructions||a.initialInventoryInstructions.toLowerCase().includes("nothing of note"))return[];const o=(e==null?void 0:e.visualStyle)||"Pixel Art",s=fA(o);let u="";(e==null?void 0:e.gameSettingType)==="Historical"&&e.initialHistoricalContext?u=`Game Setting: HISTORICAL - ${e.initialHistoricalContext}. All suggested inventory items MUST be historically plausible and authentic for the NPC's role and rarity. Epic/Legendary items should be exceptionally fitting. Avoid anachronisms. Visual prompt hints for items must be suitable for a ${s}, item-focused.`:(e==null?void 0:e.gameSettingType)==="Fictional"&&(e.fictionalUniverseContext?u=`Game Setting: FICTIONAL within universe: "${e.fictionalUniverseContext}". Items MUST be consistent with this universe's lore and the NPC's role. Visual prompt hints for items must be suitable for a ${s}, item-focused.`:u=`Game Setting: General FICTIONAL. Items should fit NPC's character and lore. Visual prompt hints for items must be suitable for a ${s}, item-focused.`);const f=`You are an AI game assistant. Your task is to suggest inventory items for an NPC.
Context:
- NPC Details: Name: "${a.name}", Rarity: ${a.rarity}, Description: "${a.description}", Appearance: "${a.appearanceDetails}".
- NPC Inventory Instructions: "${a.initialInventoryInstructions}".
- Game Visual Style: ${o}.
- ${t}
- ${u}

Guidelines for Item Suggestion:
1.  Quantity: Suggest 0-3 items. If zero, provide an empty array for "items".
2.  Relevance: Items must fit NPC's character, role, stated inventory instructions, and game setting/universe. They should be interesting, lore-relevant, or useful.
3.  Rarity: Rarity reflects item value/importance, considering NPC status, role, game setting/universe. Epic/Legendary distinct from memory.
4.  Icons: Visual prompt hints for 32x32 ${s}. The hint must include '${s}'. Item must be SOLE FOCUS on simple/neutral or item-thematic background appropriate for ${o}. Ensure appealing, clear, interesting. Replace '[CURRENT_GAME_STYLE_ICON]' in tool schema description with '${s}'.

CRITICAL: You MUST invoke tool 'suggest_npc_inventory_items'. Arguments MUST adhere to schema.
DO NOT output item details as text/JSON. Tool call is ONLY valid way.`;try{const h=await Rt(f,mA,pA,"Invalid NPC inventory structure (check item rarity, description, distinction from memory, icon prompt, visual appeal, setting/universe consistency)",`generateNPCInventoryItems for ${a.name}`);return(g=h.items)!=null&&g.length?h.items.map(p=>({...p,id:crypto.randomUUID(),iconUrl:""})):[]}catch(h){return console.error(`Failed to generate inventory for NPC ${a.name}:`,h),[]}},hA={functionDeclarations:[{name:"suggest_npcs_for_location",description:"Suggests 0-2 plausible NPCs. Provides details including skill suggestions (levels 0-10 appropriate to concept/rarity/setting/universe). Epic/Legendary NPCs distinct from memory (unless fulfilling a lead); if in known universe, may be figures from it. Visual prompt hint for NPC portrait/sprite must be for the game's current visual style (e.g., 'Pixel Art portrait/sprite', 'Anime style portrait/sprite', 'distinctive impasto oil painting style portrait/sprite', 'luminous watercolor painting style portrait/sprite').",parameters:{type:_.OBJECT,properties:{npcs:{type:_.ARRAY,description:"Array of 0-2 NPCs. NPCs contextually appropriate. Prioritize fulfilling an NPC-related lead if plausible. Epic/Legendary NPCs distinct from memory unless they are established figures from the game's fictional universe context or fulfill a lead.",items:{type:_.OBJECT,properties:{name:{type:_.STRING,description:"NPC name or title. If fulfilling a lead, MUST match lead's NPC name."},description:{type:_.STRING,description:"Brief description of NPC's role/demeanor (1-2 sentences). If fulfilling a lead, description aligns with lead's hint."},appearanceDetails:{type:_.STRING,description:"Key visual details of appearance (1-2 sentences)."},dialogueGreeting:{type:_.STRING,description:"Characteristic greeting."},rarity:{type:_.STRING,enum:["Common","Uncommon","Rare","Epic","Legendary"],description:"Significance. If fulfilling a lead, rarity matches/consistent with lead's rarity hint. Epic/Legendary distinct from memory (unless known figure or fulfilling lead for one); if historical/fictional universe, could be known figures."},visualPromptHint:{type:_.STRING,description:"Prompt for 64x64 or 128x128 [CURRENT_GAME_STYLE_PORTRAIT_SPRITE] (e.g., 'Pixel Art portrait of...', 'Anime style sprite of...', 'distinctive impasto oil painting style portrait of an old general with a deeply lined face and thick, textured brushstrokes on his ornate uniform', 'luminous watercolor painting style portrait of a graceful elf with flowing, translucent hair and soft, blended features'). Reflect appearance, rarity, setting/universe. Must include '[CURRENT_GAME_STYLE_PORTRAIT_SPRITE]', 'simple background' or background consistent with role/location and style. Ensure appealing, clear, interesting."},initialInventoryInstructions:{type:_.STRING,nullable:!0,description:"Optional: Brief instructions for initial inventory (e.g., 'carries pouch of herbs'). Legendary/universe figures might possess iconic items."},skillSuggestions:{type:_.ARRAY,nullable:!0,description:`Optional array of skill suggestions. Assign levels (0-10) for PREDEFINED skills (${Js.map(a=>a.name).join(", ")}) HIGHLY APPROPRIATE to NPC concept, rarity, role, game setting/universe. E.g., 'Legendary Warrior' gets Combat 9-10. 'Common Peasant' low skills (0-2). 'Nimble scout' might get Mobility. Untrained 0. Skill proficiency scale: 0=Untrained, 1-2=Novice, 3-4=Apprentice, 5-6=Adept, 7-8=Expert, 9=Virtuoso, 10=Master. If omitted, skills default low. If fulfilling a lead, skills should align with NPC concept.`,items:{type:_.OBJECT,properties:{skillName:{type:_.STRING},level:{type:_.NUMBER}},required:["skillName","level"]}}},required:["name","description","appearanceDetails","dialogueGreeting","rarity","visualPromptHint"]}}},required:["npcs"]}}]},yA=a=>{const e=["Common","Uncommon","Rare","Epic","Legendary"];return a&&Array.isArray(a.npcs)&&a.npcs.every(t=>t&&typeof t.name=="string"&&t.name.trim()!==""&&typeof t.description=="string"&&t.description.trim()!==""&&typeof t.appearanceDetails=="string"&&t.appearanceDetails.trim()!==""&&typeof t.dialogueGreeting=="string"&&t.dialogueGreeting.trim()!==""&&typeof t.rarity=="string"&&e.includes(t.rarity)&&typeof t.visualPromptHint=="string"&&t.visualPromptHint.trim()!==""&&(t.initialInventoryInstructions===void 0||t.initialInventoryInstructions===null||typeof t.initialInventoryInstructions=="string")&&(t.skillSuggestions===void 0||t.skillSuggestions===null||Array.isArray(t.skillSuggestions)&&t.skillSuggestions.every(o=>o&&typeof o.skillName=="string"&&Js.some(s=>s.name===o.skillName)&&typeof o.level=="number"&&o.level>=0&&o.level<=10)))},vA=async(a,e,t,o="")=>{var b,A;const s=zt(e.skills),u=Ki(e.limbs),f=((b=e.skills.find(M=>M.name==="Perception"))==null?void 0:b.level)||0,g=`Player: ${e.characterConcept}. Health: ${e.overallHealth}HP, Energy: ${e.currentEnergy}/${e.maxEnergy}EN. Skills: [${s}]. Equipped: ${u}. Perception Level: ${f}.`,h=e.visualStyle,p=jh(h);let v="",T="";e.gameSettingType==="Historical"&&e.initialHistoricalContext?(v=`NPCs (names, roles, descriptions, appearances, dialogue, rarity, skills, inventory instructions) MUST be historically plausible and authentic for this period (${e.initialHistoricalContext}) and culture, rendered in ${p}. Epic/Legendary NPCs SHOULD be actual known historical figures if context/memory allow (unless fulfilling a lead for one), distinct from existing memorable entities. Their details (skills, status e.g. alive/dead) should reflect known persona.`,T=`Historical Context: ${e.initialHistoricalContext}. Game Visual Style: ${h}.`):e.gameSettingType==="Fictional"&&(e.fictionalUniverseContext?(v=`NPCs (names, roles, appearance, skills, inventory, rarity, dialogue) MUST be consistent with the universe of "${e.fictionalUniverseContext}" (its lore, character archetypes, and known character statuses e.g. alive/dead, origins, typical whereabouts), rendered in ${p}. Epic/Legendary NPCs could be established figures from this universe, distinct from memory (unless fulfilling a lead for one).`,T=`Fictional Universe: ${e.fictionalUniverseContext}. Game Visual Style: ${h}.`):(v=`NPCs should fit character concept and location theme, rendered in ${p}. Epic/Legendary NPCs should be unique, lore-rich figures, distinct from memory (unless fulfilling a lead for one). You may subtly draw inspiration from common fantasy/sci-fi tropes if they naturally fit the NPC and enhance experience. Skills reflect their concept/rarity.`,T=`Game Visual Style: ${h}.`));let C="No specific NPC-related leads are currently active.";const S=t.filter(M=>M.type==="npc"&&M.status==="mentioned");S.length>0&&(C=`Active NPC-Related Leads (Rumors):
${S.map(M=>`- Rumored NPC: "${M.name}" (Type: ${M.type}, Hint: ${M.descriptionHint}, Rarity Hint: ${M.rarityHint||"Unknown"}). Source: ${M.sourceTextSnippet.substring(0,50)}...`).join(`
`)}`);const w=`You are an AI game assistant. Your task is to suggest NPCs for a location.
Context:
- Player Character: ${g}
- Current Location: "${a.name}" (Description: "${a.description}", Tags: [${a.environmentTags.join(", ")}], Rarity: ${a.rarity}).
- ${T}
- ${C}
- ${o}
- ${Ht} (Applies to NPC skill assignment!)

PRIMARY DIRECTIVE: NPCs generated MUST be contextually appropriate for the current location AND strictly consistent with the game's established setting (Historical context or Fictional Universe lore, including known character statuses like being deceased, their origins, and typical whereabouts). Adherence to the established setting is PARAMOUNT. ${v} NPCs should also react plausibly to player's appearance (equipped items). Visual prompt hints for NPC portraits/sprites must be suitable for the game's visual style: ${h}.

Guidelines for NPC Suggestion:
1.  Quantity: Suggest 0-2 plausible NPCs.
2.  Appropriateness & Consistency: NPCs fit location theme, rarity, tags, game setting/universe. This is the PRIMARY consideration.
3.  Lead Fulfillment (Secondary Consideration): If an active NPC-related lead from "${C}" can be FULFILLED *WITHOUT violating the PRIMARY DIRECTIVE* (contextual appropriateness, setting consistency, lore accuracy e.g. character status), then you MAY suggest an NPC that fulfills it.
    - If fulfilling a lead, the generated NPC's name, description, rarity, and concept MUST align closely with the lead's details and still be plausible in the current context.
    - However, if fulfilling a lead would result in an NPC that is out of place, anachronistic, lore-breaking (e.g., a character known to be deceased in the Fictional Universe Context appearing alive without narrative justification), or thematically inconsistent, DO NOT fulfill that lead. Instead, generate other contextually appropriate NPCs (or no NPCs if none fit). Leads are rumors, not guarantees.
4.  Skills (Suggestions): For each NPC, assign levels (0-10) for relevant skills from ${Js.map(M=>M.name).join(", ")}. Skill levels MUST be appropriate for NPC concept, rarity, role, game setting/universe. If fulfilling a lead, skills must fit. (e.g. a nimble character might have some Mobility skill).
5.  Perception Influence: Higher player Perception (Level ${f}) might increase chance of noticing rarer/hidden NPCs, or those related to leads.
6.  Epic/Legendary NPCs: Rare, contextually fitting. Distinct from memory unless established figures from game's fictional universe context OR fulfilling a lead for such an NPC. Skills reflect status.
7.  Icon Hints: Visual prompt for 64x64 or 128x128 ${p}. The hint must include '${p}' and mention a 'simple background' or one consistent with their role/location and the ${h} style. Ensure appealing, clear, interesting image. Replace '[CURRENT_GAME_STYLE_PORTRAIT_SPRITE]' in tool schema description with '${p}'.
8.  Inventory: Optionally provide brief instructions for NPC initial inventory.

CRITICAL: You MUST invoke tool 'suggest_npcs_for_location'. Arguments MUST adhere strictly to schema.
DO NOT output NPC details as text/JSON. Tool call is ONLY valid way.`,I=await Rt(w,hA,yA,"Invalid NPC suggestion structure (check rarity, skills, distinction from memory, lead fulfillment plausibility/lore consistency, visual prompt format, visual appeal, setting/universe consistency, contextual appropriateness)","generateNPCsForLocation");return(A=I.npcs)!=null&&A.length?Promise.all(I.npcs.map(async M=>{const L=await Qh(M.visualPromptHint,M.name,a.visualPromptHint,h),R=await gA(M,e,o),$=Js.map(V=>{var F;const Q=(F=M.skillSuggestions)==null?void 0:F.find(ae=>ae.skillName===V.name);let te=0;return Q?te=Q.level:(M.rarity==="Legendary"?te=Math.floor(Math.random()*3)+3:M.rarity==="Epic"?te=Math.floor(Math.random()*3)+2:M.rarity==="Rare"?te=Math.floor(Math.random()*2)+1:te=Math.floor(Math.random()*2),Math.random()<.6&&!(V.name==="Combat"&&M.rarity==="Legendary")&&(te=0),V.name==="Combat"&&M.rarity==="Legendary"&&(!Q||Q.level<7)&&(te=Math.floor(Math.random()*2)+7)),{id:crypto.randomUUID(),name:V.name,description:V.description,level:te,experience:0,experienceToNextLevel:te*100+100}});return{...M,id:crypto.randomUUID(),iconUrl:L,inventory:R,skills:$,currentHealth:100,maxHealth:100,isDefeated:!1,disposition:"Neutral"}})):[]},Ms=new Map,TA=async(a,e,t,o,s="",u)=>{var T,C,S,w,I;if(a.isDefeated)return{rawText:`${a.name} lies defeated and cannot respond.`,processedText:`${a.name} lies defeated and cannot respond.`,potentialDiscoveries:[]};const f=Ms.get(a.id);let g=f==null?void 0:f.chat;const h=f==null?void 0:f.eventTitleContext,p=(u==null?void 0:u.eventTitle)||null;g&&h!==p&&(console.log(`Event context changed for NPC ${a.name}. Old: ${h}, New: ${p}. Re-initializing chat.`),g=void 0,Ms.delete(a.id));let v="";if(u&&(v=`
CURRENT EVENT: An event titled "${u.eventTitle}" is occurring. Narration: "${u.narration.substring(0,150)}...". You MUST acknowledge or react to this event if it's significant and relevant to the conversation, your role, or safety. Your dialogue should reflect awareness of this.`),!g){const b=zt(t.skills),A=Ki(t.limbs),M=zt(a.skills);let L="",R="";t.gameSettingType==="Historical"&&t.initialHistoricalContext?(L=`Game Setting: HISTORICAL - ${t.initialHistoricalContext}. Your language, knowledge, concerns MUST reflect this era, your rarity ('${a.rarity}'), disposition ('${a.disposition||"Neutral"}'), skills (${M}). If known historical figure (Epic/Legendary), responses align with known persona/context. Avoid modern idioms/anachronisms.`,R=`Historical Context: ${t.initialHistoricalContext}.`):t.gameSettingType==="Fictional"&&(t.fictionalUniverseContext?(L=`Game Setting: FICTIONAL within universe: "${t.fictionalUniverseContext}". Responses MUST be consistent with your character (rarity '${a.rarity}', disposition '${a.disposition||"Neutral"}', skills ${M}), this universe's lore (including your known status e.g. alive/dead, origins), and established tone. If you are a known figure from this universe, act accordingly.`,R=`Fictional Universe: ${t.fictionalUniverseContext}.`):L=`Game Setting: General FICTIONAL. Responses consistent with character (rarity '${a.rarity}', disposition '${a.disposition||"Neutral"}', skills ${M}), and general fantasy/sci-fi themes. You may subtly draw inspiration from common fantasy/sci-fi tropes if they naturally fit your persona.`);const $=`You are the NPC: ${a.name} (Rarity: ${a.rarity}, Disposition: ${a.disposition||"Neutral"}).
Your Character: "${a.description}". Your Appearance: "${a.appearanceDetails}". Your Skills: [${M}].
You are talking to player: "${t.characterConcept}" (Player Health: ${t.overallHealth}HP, Energy: ${t.currentEnergy}EN, Equipped: ${A}). Player Skills: [${b}].
Your reactions to the player (including their dialogue, appearance, and equipped items - ${A}) should be natural and influenced by your personality, disposition, rarity, skills, and the game setting.
Reactions/willingness influenced by skill comparison (e.g., your Persuasion vs. player's). If skill much higher, be dominant; if lower, easily influenced. Narrate accordingly.
${R}
${v} 
${s}
${L}
${Ht}
Maintain consistent personality. Keep responses concise (1-3 sentences).
ENTIRE response is ONLY what you, the NPC, say. You may include VERY brief, simple, non-verbal parenthetical cues like (shrugs), (nods), (sighs), (chuckles), (winces), (looks thoughtful), (glances around nervously). DO NOT narrate your own complex physical actions or movements in parentheses, even in the first person. Keep these cues to a minimum and ensure they are natural interjections, not full sentences describing actions.
NO third-person narration. Speak directly to player. No markdown.
Your inventory: ${a.inventory.length>0?a.inventory.map(V=>`${V.name} (${V.rarity})`).join(", "):"nothing of note"}.
GREETING RULE: If conversation history empty OR this is your FIRST turn speaking, respond with greeting: "${a.dialogueGreeting}", then address player's input. SUBSEQUENT turns, ONLY direct response; DO NOT repeat greeting.
Hostile/Afraid disposition reflected in greeting/responses.
If mentioning specific named items/people/locations sounding important/unique/legendary/quest-related, make mental note, NO special formatting. Game system handles hints.`;g=Gn.chats.create({model:ya,config:{systemInstruction:$}}),Ms.set(a.id,{chat:g,eventTitleContext:p})}try{const b=await g.sendMessage({message:e}),A=b.text;if(typeof A=="string"&&A.trim()){const L=await Bi(A,"dialogue",a.id,t,o,s);return{rawText:A,processedText:L.processedText,potentialDiscoveries:L.potentialDiscoveries}}let M="Empty/invalid response.";throw(C=(T=b.candidates)==null?void 0:T[0])!=null&&C.finishReason&&(M+=` Finish reason: ${b.candidates[0].finishReason}.`),(I=(w=(S=b.candidates)==null?void 0:S[0])==null?void 0:w.safetyRatings)!=null&&I.length&&(M+=` Safety: ${JSON.stringify(b.candidates[0].safetyRatings)}.`),new Error(`Received empty/invalid response from ${a.name}. ${M}`)}catch(b){throw console.error(`[NPC DIALOGUE - ${a.name}] SDK FAILED:`,b),Ms.delete(a.id),new Error(b.message||"Unknown dialogue SDK error. Try speaking to them again.")}},lh=async(a,e,t,o,s,u,f,g)=>{const h=zt(t.skills),p=Ki(t.limbs),v=t.visualStyle,T=`You are the narrator and embodiment of the currently active game event: "${a.eventTitle}".
Event Description: "${a.narration}"
${a.resolutionCriteriaPrompt?`Event Resolution Hint: "${a.resolutionCriteriaPrompt}"`:""}
Game Visual Style: ${v}.

Player Character: "${t.characterConcept}" (Equipped: ${p}, Skills: [${h}]).
World Concept: ${o}.
Known History (Chronicle - Major Plot Points):
${s.slice(-5).map(C=>`- ${C.summary} (at ${C.locationName||"Unknown"})`).join(`
`)||"No major plot points recorded recently."}
Current Leads/Rumors:
${u.filter(C=>C.status==="mentioned").slice(-5).map(C=>`- ${C.name} (${C.type}): ${C.descriptionHint}`).join(`
`)||"No active leads noted recently."}
Broader Game Memory: Use relevant parts of this for flavor or if the player references something from it. ${f.substring(0,500)}...

Your Role:
1.  Respond narratively to the player's input, reflecting the event's nature, tone, and progress. Your description should be consistent with the game's visual style: ${v==="Ink Painting"?"black and white traditional Chinese ink painting style":v}.
2.  Your response should be 1-3 sentences.
3.  You ARE THE EVENT'S VOICE. Do not act as a specific pre-existing NPC unless the event explicitly makes you embody one (e.g. if eventDetails.npcEffects introduces a temporary NPC and marks them as the primary interactor).
4.  You CANNOT perform game actions (e.g., "player picks up X", "NPC Y attacks"). Your role is to describe, react, and provide atmosphere. The main game system will evaluate if the player's stated action resolves the event based on your narrative response and the original command.
5.  If player's input is vague, provide an atmospheric response or a subtle hint related to the event's resolution criteria if it has one.
6.  If the player's input seems to directly interact with a key element of the event (e.g. "I touch the glowing rune"), describe what happens immediately as a result of that touch.
7.  If your response mentions any new specific named items, people, or locations that sound important, unique, or part of a legend/quest (and are not already obviously part of the event description or known leads/chronicle), make a mental note for lore processing.

Output ONLY your textual response. NO MARKDOWN.
Example: If event is "A Chasm Opens" and player says "I peek into the chasm", you might respond: "A gust of chilling air rises from the Stygian depths, carrying with it the faint sound of distant wails. The bottom is lost in impenetrable darkness."
`;try{const S=(await Gn.models.generateContent({model:ya,contents:`${T}

Player: "${e}"
Event Narrator:`})).text;if(typeof S=="string"&&S.trim()){const w=await Bi(S,"event_narration",a.eventTitle,t,g,f);return{rawText:S,processedText:w.processedText,potentialDiscoveries:w.potentialDiscoveries}}throw new Error("Event dialogue LLM returned empty/invalid response.")}catch(C){throw console.error(`[EVENT DIALOGUE - ${a.eventTitle}] SDK FAILED:`,C),new Error(C.message||"Unknown event dialogue SDK error.")}},CA={functionDeclarations:[{name:"determine_gift_outcome",description:"Determines NPC reaction to gift. Considers player Persuasion, NPC skills (Persuasion/Perception), NPC rarity/personality/disposition, item value, memory context, game setting/universe, AND ONGOING EVENTS.",parameters:{type:_.OBJECT,properties:{accepted:{type:_.BOOLEAN,description:"True if NPC accepts item, false otherwise."},narration:{type:_.STRING,description:"Player's action narration (e.g., 'You offer the apple to the guard.')."},npcReactionText:{type:_.STRING,description:"NPC's spoken response (e.g., 'Thank you, kind traveler.'). Reflects decision, personality, rarity, skills, disposition, reaction to player skills, game setting/universe, AND AWARENESS OF ONGOING EVENT (if any)."}},required:["accepted","narration","npcReactionText"]}}]},EA=a=>a&&typeof a.accepted=="boolean"&&typeof a.narration=="string"&&a.narration.trim()!==""&&typeof a.npcReactionText=="string"&&a.npcReactionText.trim()!=="",xA=async(a,e,t,o,s="",u)=>{var A,M,L;if(e.isDefeated)return{accepted:!1,narration:`You try to give ${t.name} to ${e.name}, but they are defeated.`,npcReactionText:"..."};const f=((A=a.skills.find(R=>R.name==="Persuasion"))==null?void 0:A.level)||0,g=Ki(a.limbs),h=((M=e.skills.find(R=>R.name==="Persuasion"))==null?void 0:M.level)||0,p=((L=e.skills.find(R=>R.name==="Perception"))==null?void 0:L.level)||0,v=`NPC Details: ${e.name} (Rarity: ${e.rarity}, Disposition: ${e.disposition||"Neutral"}, Desc: ${e.description}). NPC Skills: Persuasion Lvl ${h}, Perception Lvl ${p}. Current Inventory: ${e.inventory.map(R=>R.name).join(", ")||"none"}.`,T=`Player Character: ${a.characterConcept}. Player Persuasion Skill Level: ${f}. Equipped: ${g}.`,C=`Item Offered: ${t.name} (Rarity: ${t.rarity}, Description: ${t.description}).`,S=o.length>0?`Recent Conversation Snippet (last 3 relevant lines):
${o.join(`
`)}`:"No recent conversation history available.";let w="";u&&(w=`
ONGOING EVENT: "${u.eventTitle}" - ${u.narration.substring(0,100)}... NPC should react appropriately to this event while considering the gift.`);let I="";a.gameSettingType==="Historical"&&a.initialHistoricalContext?I=`Game Setting: HISTORICAL - ${a.initialHistoricalContext}. NPC (${e.rarity}, Disposition: ${e.disposition}) reaction and perceived value of item ('${t.name}') MUST align with historical plausibility. If '${e.name}' Legendary, specific reactions based on historical persona/skills.`:a.gameSettingType==="Fictional"&&(a.fictionalUniverseContext?I=`Game Setting: FICTIONAL within universe: "${a.fictionalUniverseContext}". NPC reaction MUST be consistent with their character, disposition, skills, and item's value in this universe.`:I="Game Setting: General FICTIONAL. NPC reaction consistent with character, disposition, skills, item's value.");const b=`You are an AI game logic assistant.
Context:
- ${v}
- ${T}
- ${C}
- ${S}
- ${w}
- ${s}
- ${I}
- ${Ht}

Task: Player gives item to NPC. Determine NPC's reaction.
-   Consider NPC personality, rarity, disposition, skills (Persuasion Lvl ${h}, Perception Lvl ${p}), current inventory.
-   Consider item type, rarity, potential usefulness/value to NPC within the game setting/universe.
-   Consider player Persuasion skill (Level ${f}) AND player's equipped items (${g}) as they might influence NPC's perception. Higher Player Persuasion vs NPC Persuasion/Perception increases acceptance.
-   Perceptive NPC (Perception Lvl ${p}) wary despite high player Persuasion. Gullible NPC (low Perception/Persuasion) might accept anything.
-   Consider memory context for relationships/plot points. Hostile/Afraid NPCs less likely to accept.
-   If an event is ongoing (${!!u}), NPC's reaction MUST reflect awareness of it. E.g., too distracted, scared, or focused on the event to care about the gift, or perhaps the gift is seen in light of the event.

CRITICAL: You MUST invoke tool 'determine_gift_outcome'. Arguments MUST adhere to schema.
DO NOT output details as text/JSON. Tool call is ONLY valid way.`;return Rt(b,CA,EA,"Invalid gift outcome structure",`gift to ${e.name}`)},SA={functionDeclarations:[{name:"determine_npc_item_offer",description:"Determines if NPC gives requested item. Considers Player Persuasion, NPC skills (Persuasion/Perception), NPC rarity/possessions/disposition, item value, memory context, game setting/universe, AND ONGOING EVENTS.",parameters:{type:_.OBJECT,properties:{willingToGive:{type:_.BOOLEAN,description:"True if NPC willing to give item (or substitute)."},itemNameGiven:{type:_.STRING,nullable:!0,description:"Exact name of item from NPC inventory IF willing and item exists. Null if unwilling or no suitable item."},narration:{type:_.STRING,description:"Player's request and NPC's initial reaction narration."},npcReactionText:{type:_.STRING,description:"NPC's spoken response. Reflects decision, rarity, skills, Persuasion, disposition, game setting/universe, AND AWARENESS OF ONGOING EVENT (if any)."}},required:["willingToGive","narration","npcReactionText"]}}]},bA=a=>a&&typeof a.willingToGive=="boolean"&&(a.itemNameGiven===null||typeof a.itemNameGiven=="string")&&typeof a.narration=="string"&&a.narration.trim()!==""&&typeof a.npcReactionText=="string"&&a.npcReactionText.trim()!=="",_A=async(a,e,t,o,s="",u)=>{var L,R,$;if(e.isDefeated)return{willingToGive:!1,itemNameGiven:null,itemGiven:null,narration:`${e.name} is defeated and cannot respond to your request for ${t}.`,npcReactionText:"..."};const f=((L=a.skills.find(V=>V.name==="Persuasion"))==null?void 0:L.level)||0,g=Ki(a.limbs),h=((R=e.skills.find(V=>V.name==="Persuasion"))==null?void 0:R.level)||0,p=(($=e.skills.find(V=>V.name==="Perception"))==null?void 0:$.level)||0,v=`NPC Details: ${e.name} (Rarity: ${e.rarity}, Disposition: ${e.disposition||"Neutral"}, Desc: ${e.description}). NPC Skills: Persuasion Lvl ${h}, Perception Lvl ${p}. Current Inventory: ${e.inventory.map(V=>V.name).join(", ")||"none"}.`,T=`Player Character: ${a.characterConcept}. Player Persuasion Skill Level: ${f}. Equipped: ${g}.`,C=`Player is requesting an item named "${t}" from the NPC.`,S=o.length>0?`Recent Conversation Snippet (last 3 relevant lines):
${o.join(`
`)}`:"No recent conversation history available.";let w="";u&&(w=`
ONGOING EVENT: "${u.eventTitle}" - ${u.narration.substring(0,100)}... NPC should react appropriately to this event when considering the request.`);let I="";a.gameSettingType==="Historical"&&a.initialHistoricalContext?I=`Game Setting: HISTORICAL - ${a.initialHistoricalContext}. NPC (${e.rarity}, Disposition: ${e.disposition}) willingness to part with items, items themselves, MUST align with historical plausibility/skills. If '${e.name}' Legendary, parts with significant items only for compelling reasons.`:a.gameSettingType==="Fictional"&&(a.fictionalUniverseContext?I=`Game Setting: FICTIONAL within universe: "${a.fictionalUniverseContext}". NPC willingness to part with items, and items themselves, MUST be consistent with their character, this universe's lore, and item's value.`:I="Game Setting: General FICTIONAL. NPC willingness consistent with character, disposition, skills, item's value.");let b=`You are an AI game logic assistant.
Context:
- ${v}
- ${T}
- ${C}
- ${S}
- ${w}
- ${s}
- ${I}
- ${Ht}

Task: Player asks NPC for an item. Determine NPC's response.
1.  Willingness: Decide if NPC willing to give requested item.
    -   Consider NPC personality, rarity, disposition (Hostile/Afraid NPCs very unlikely to give), skills (Persuasion Lvl ${h}, Perception Lvl ${p}).
    -   Persuasive NPC (Persuasion Lvl ${h}) might refuse/offer worse deal, even against persuasive player.
    -   Perceptive NPC (Perception Lvl ${p}) might understand player's true need/see through deception. Player's equipped items (${g}) might also influence this.
    -   Consider NPC current inventory (can only give what they possess).
    -   Consider requested item nature/value within game setting/universe.
    -   Consider player Persuasion skill (Level ${f}). Higher Player Persuasion vs NPC skills increases chances.
    -   Consider memory context and recent conversation.
    -   If an event is ongoing (${!!u}), NPC's decision MUST reflect awareness of it. E.g., too distracted, or request is seen in light of the event (e.g. needs item for event).
2.  Item Given: If willing and item (or suitable substitute from inventory) possessed, provide exact name of item given. If no exact match but willing to offer substitute, provide substitute's name. Otherwise, null.
3.  Narration: Describe player's request and NPC's initial reaction.
4.  NPC Spoken Response: NPC's verbal reply, aligning with decision, personality, rarity, skills, disposition, Persuasion, game setting/universe, AND AWARENESS OF EVENT.

CRITICAL: You MUST invoke tool 'determine_npc_item_offer'. Arguments MUST adhere to schema.
DO NOT output details as text/JSON. Tool call is ONLY valid way.`;const A=await Rt(b,SA,bA,"Invalid NPC item offer structure",`request from ${e.name}`);let M=null;return A.willingToGive&&A.itemNameGiven&&(M=e.inventory.find(V=>V.name.toLowerCase()===A.itemNameGiven.toLowerCase())||null,M||console.warn(`NPC ${e.name} offered '${A.itemNameGiven}', which was not found in their current inventory.`)),{willingToGive:A.willingToGive&&!!M,itemNameGiven:(M==null?void 0:M.name)||null,itemGiven:M,narration:A.narration,npcReactionText:A.npcReactionText}},NA=async(a,e,t,o="")=>{var v;const s=((v=e.skills.find(T=>T.name==="Perception"))==null?void 0:v.level)||0,u=Ki(e.limbs),f=`Char: ${e.characterConcept} (Perception Lvl ${s}, Equipped: ${u}). Setting: ${e.gameSettingType}.`;let g="";e.gameSettingType==="Historical"&&e.initialHistoricalContext?g=`Elaboration MUST be consistent with historical context: ${e.initialHistoricalContext}. If NPC is known figure, draw from/expand on their REAL historical biography/lore. Focus on verifiable facts or plausible historical interpretations.`:e.gameSettingType==="Fictional"&&(e.fictionalUniverseContext?g=`Elaboration MUST be consistent with the established lore of the fictional universe: "${e.fictionalUniverseContext}". If NPC is known figure from this universe, expand on their specific IN-WORLD lore, relationships, and history.`:g="Elaboration should be consistent with a general fantasy/sci-fi theme fitting the NPC. You may subtly draw inspiration from common tropes if they naturally fit the NPC's persona. Focus on unique origins, affiliations, or connections to broader world lore.");let h=`Provide DETAILED, FACTUAL, and LORE-RICH information about this NPC (2-4 paragraphs). Go beyond their immediate appearance or greeting. Avoid generic statements.
Focus on:
-   Specifics of their background: Where are they from? What significant events shaped them? What is their family or lineage known for? Provide real historical details if applicable and known.
-   Motivations and Goals: What are their *concrete* objectives, desires, fears, or ambitions? Why do they pursue these? Connect to historical/lore context.
-   Notable Past Actions & Accomplishments: What specific deeds or events are they known for (real historical events if applicable, or significant in-world lore events)? How did these impact the world or other characters?
-   Relationships: Details about their specific allies, enemies, mentors, or loved ones. What is the nature of these relationships (historical or in-world lore based)?
-   Skills & Abilities: (${zt(a.skills)}) - How did they acquire these skills? Are there any famous applications of their abilities according to history/lore?
-   Secrets or Hidden Knowledge: What non-obvious information, "fun facts", intriguing historical tidbits, or specific pieces of in-world lore might a perceptive character learn or recall about them?
-   Current Disposition Context: (${a.disposition||"Neutral"}) - Briefly, what recent events (historical or in-world) or interactions might have led to this current disposition?
Build upon existing information and connect them to known entities or events from the game's memory context if plausible, providing specific links.
`;(a.rarity==="Epic"||a.rarity==="Legendary")&&(h+=`
As this NPC is ${a.rarity}, the details should be particularly significant, reflecting their impact on the world, their deep history, or pivotal role in ongoing/past events. If they are a known historical figure (for Historical setting) or a major character from the Fictional Universe, your description MUST align with and expand upon established REAL historical facts or IN-WORLD lore about them. Reveal specific anecdotes or defining moments from their past, based on actual history or established lore.`);const p=`Player learns more about NPC.
NPC: ${a.name}, Desc: ${a.description}, Appearance: ${a.appearanceDetails}, Greeting: "${a.dialogueGreeting}", Rarity: ${a.rarity}, Disposition: ${a.disposition||"Neutral"}, NPC Skills: ${zt(a.skills)}.
${f} ${Ht} (Player Perception Lvl ${s} might reveal more, considering NPC skills like Mobility/Persuasion if hiding something). Player's equipped items (${u}) might provide context for NPC's past interactions or how they are perceived.
${o}
Task: ${h} ${g} Output ONLY rich, descriptive factual text. No markdown. No player thoughts/feelings.
If you mention any specific named items, people, or locations that sound important, unique, or part of a legend/quest, make a mental note but DO NOT use any special formatting or markup in your direct speech output. The game system will handle identifying these hints separately.`;try{const T=await Gn.models.generateContent({model:ya,contents:p}),C=T.text;if(C!=null&&C.trim())return await Bi(C,"item_text",a.id,e,t,o);console.warn(`Elaboration for NPC ${a.name} resulted in empty response.`,T);const S="Further recollection reveals no additional significant factual details.";return{rawText:S,processedText:S,potentialDiscoveries:[]}}catch(T){console.error(`Error elaborating on NPC ${a.name}:`,T);const C=`Error recalling more about ${a.name}. (Error: ${T.message||"Unknown"})`;return{rawText:C,processedText:C,potentialDiscoveries:[]}}},pr=[{name:"Combat",description:"Proficiency in physical confrontations, including using weapons and unarmed techniques. Affects attack accuracy, damage, and defensive maneuvers."},{name:"Crafting",description:"Ability to create and repair items from raw materials. Influences quality and complexity of crafted items."},{name:"Survival",description:"Knowledge of tracking, foraging, and enduring harsh environments. Affects finding resources, navigating hazards, and effectiveness of certain consumables."},{name:"Perception",description:"Acuity in noticing details, hidden objects, or subtle clues. Helps in finding items, spotting danger, and discerning information."},{name:"Persuasion",description:"Skill in influencing others through dialogue, negotiation, or charm. Affects NPC reactions, quest outcomes, and trading."},{name:"Mobility",description:"Represents agility, nimbleness, and ease of movement. May influence future actions like evasion or navigating difficult terrain."}],AA=a=>{const e=["Common","Uncommon","Rare","Epic","Legendary"],t=["Common","Uncommon","Rare","Epic","Legendary","Lore","Character_Self"],o=a.characterConcept?a.characterConcept.trim().split(/\s+/).length:0;return a&&typeof a.characterName=="string"&&a.characterName.trim()!==""&&typeof a.characterConcept=="string"&&a.characterConcept.trim()!==""&&o>=5&&o<=40&&typeof a.characterRarity=="string"&&t.includes(a.characterRarity)&&Array.isArray(a.limbs)&&a.limbs.length>0&&a.limbs.every(s=>s&&typeof s.name=="string"&&s.name.trim()!==""&&typeof s.status=="string"&&s.status.trim()!==""&&typeof s.health=="number"&&s.health>=0&&s.health<=100)&&(a.startingSkills===void 0||Array.isArray(a.startingSkills)&&a.startingSkills.every(s=>s&&typeof s.skillName=="string"&&pr.some(u=>u.name===s.skillName)&&typeof s.startingLevel=="number"&&s.startingLevel>=0&&s.startingLevel<=10))&&(a.initialItemSuggestions===void 0||Array.isArray(a.initialItemSuggestions)&&a.initialItemSuggestions.every(s=>s&&typeof s.name=="string"&&s.name.trim()!==""&&typeof s.description=="string"&&s.description.trim()!==""&&typeof s.itemTypeGuess=="string"&&s.itemTypeGuess.trim()!==""&&typeof s.rarity=="string"&&e.includes(s.rarity)&&typeof s.visualPromptHint=="string"&&s.visualPromptHint.trim()!==""))},wA=a=>{switch(a){case"Pixel Art":return"Pixel Art icon";case"Anime":return"Anime style icon";case"Ink Painting":return"black and white traditional Chinese ink painting style icon";case"Oil Painting":return"distinctive impasto oil painting style icon";case"Water Painting":return"luminous watercolor painting style icon";case"Low Poly":return"stylized low-poly 3D render style icon";default:return`${a} icon`}},IA={functionDeclarations:[{name:"provide_character_details_and_initial_items",description:"Generates conceptual details for a new game character, including their name, concept, rarity, limb statuses, suggested starting skills (levels 0-10, appropriate to concept), and 0-3 fitting initial inventory items for a fantasy or historical adventure game. Avoids duplicating known Epic/Legendary entities from memory context. The game's visual style (e.g., 'Pixel Art', 'Ink Painting', 'distinctive impasto oil painting style', 'luminous watercolor painting style') will be provided in the main prompt context. Visual prompt hints for items MUST be phrased for generating an icon in that specific game visual style (e.g., if game style is 'Ink Painting', the hint would be for a 'black and white traditional Chinese ink painting style icon').",parameters:{type:_.OBJECT,properties:{characterName:{type:_.STRING,description:"A plausible name for the character. If the characterConcept itself IS a famous name, then this characterName should be that exact name. This field IS MANDATORY."},characterConcept:{type:_.STRING,description:"The character's core concept or archetype (10-40 words long). MUST directly reflect and preserve the core elements of the input character concept."},characterRarity:{type:_.STRING,enum:["Common","Uncommon","Rare","Epic","Legendary","Character_Self"],description:"The character's overall significance/rarity (Common, Uncommon, Rare, Epic, Legendary, Character_Self) based on their concept, name, and historical/fictional context. 'Einstein' or 'a dragon lord' should be Epic/Legendary. A simple 'young squire' would be Common/Uncommon. 'Character_Self' implies their self-perceived or narrative-defined importance."},limbs:{type:_.ARRAY,description:"An array detailing the status of character's limbs (Head, Torso, Left Arm, Right Arm, Left Leg, Right Leg). All start with 100 health.",items:{type:_.OBJECT,properties:{name:{type:_.STRING,description:"Name of the limb."},status:{type:_.STRING,description:"Current status, including health (e.g., 'Healthy (100HP)')."},health:{type:_.NUMBER,description:"Numeric health (0-100). Should be 100 for new characters."}},required:["name","status","health"]}},startingSkills:{type:_.ARRAY,description:`Suggest 2-4 starting skills from predefined list: ${pr.map(a=>a.name).join(", ")}. Skill levels (0-10) MUST be highly appropriate for the character concept. **For most typical concepts, aim for a balanced distribution with many skills falling in the 2-6 (Novice to Adept) range.** Extreme values (0-1 or 9-10) should be reserved for concepts that explicitly suggest untrained/mastery in a skill, or for iconic figures. E.g., 'Lu Bu' concept gets Combat: 9-10. 'Young squire' gets Combat: 1-2. A 'seasoned traveler' might have Survival 4-5, Perception 3-4. Untrained skills are level 0. Skill proficiency scale: 0=Untrained, 1-2=Novice, 3-4=Apprentice, 5-6=Adept, 7-8=Expert, 9=Virtuoso, 10=Master. Omit if none fit.`,items:{type:_.OBJECT,properties:{skillName:{type:_.STRING,description:"Name of skill."},startingLevel:{type:_.NUMBER,description:"Starting level (0-10) reflecting concept's proficiency."}},required:["skillName","startingLevel"]}},initialItemSuggestions:{type:_.ARRAY,description:"Optional: Array of 0-3 suggested starting items. Must fit character concept and setting. If historical, items must be plausible. Rarity matches significance. If suggesting Epic/Legendary, ensure it's distinct from known entities in memory context unless they are iconic starting gear for a known character concept within a universe. Omit or empty array if none.",items:{type:_.OBJECT,properties:{name:{type:_.STRING,description:"Item name."},description:{type:_.STRING,description:"Brief description."},itemTypeGuess:{type:_.STRING,description:"Category (e.g., 'weapon', 'tool')."},rarity:{type:_.STRING,enum:["Common","Uncommon","Rare","Epic","Legendary"],description:"Rarity."},visualPromptHint:{type:_.STRING,description:"Detailed visual description for a [GAME_STYLE_ICON_TYPE] of THE ITEM ITSELF. For example, if the game style is 'Pixel Art', the prompt might be 'Pixel Art icon of a gleaming steel longsword with a sapphire embedded in the pommel'. The specific [GAME_STYLE_ICON_TYPE] (e.g., 'Pixel Art icon', 'black and white traditional Chinese ink painting style icon', 'distinctive impasto oil painting style icon', 'luminous watercolor painting style icon') will be determined by the game's visual style provided in the main prompt context. Focus on the item's appearance; background should be simple/neutral or subtly thematic for an icon. DO NOT describe a full scene, only the item icon."}},required:["name","description","itemTypeGuess","rarity","visualPromptHint"]}}},required:["characterName","characterConcept","characterRarity","limbs"]}}]},RA=a=>{switch(a){case"Pixel Art":return"Pixel Art style";case"Anime":return"Anime style";case"Ink Painting":return"black and white traditional Chinese ink painting style";case"Oil Painting":return"distinctive impasto oil painting style";case"Water Painting":return"luminous watercolor painting style";case"Low Poly":return"stylized low-poly 3D render style";default:return`${a} style`}},MA=a=>{switch(a){case"Ink Painting":return"Emphasize expressive brush strokes, minimalism, and the interplay of black ink and white space. Attire and features should reflect traditional Chinese aesthetics if culturally appropriate for the character, otherwise adapt the style to the character's concept.";case"Oil Painting":return"Render in the style of a Caspar David Friedrich oil painting. Emphasize sublime, atmospheric landscapes (mist, mountains, dramatic skies) as the backdrop. If the character is present, consider a 'Rckenfigur' pose (seen from behind, contemplating nature), or a pose that evokes introspection and yearning. Lighting should be dramatic (e.g., twilight, dawn, moonlight) creating long shadows and highlighting textures. Colors should be rich yet potentially muted to convey a melancholic or contemplative mood. Attire and features should be detailed, fitting a Romantic era aesthetic if appropriate for the character concept, with a focus on how the figure interacts with the vastness of the natural world.";case"Water Painting":return"Illustrate with soft, flowing colors and transparent washes typical of watercolor. Emphasize light and a sense of fluidity, with characteristic wet-on-wet or wet-on-dry techniques. Edges may be soft or bleed slightly. Paper white should be preserved for highlights. Attire and features should have a delicate, layered, and somewhat ethereal appearance due to the watery medium.";case"Low Poly":return"Render with a stylized low-polygon 3D aesthetic. Use flat shading or simple gradients. Emphasize geometric forms and a clean, modern look.";default:return""}},LA=async(a,e)=>{var t,o,s,u;try{const f=a.visualStyle||"Pixel Art",g=RA(f),h=MA(f);let p=`a background that is thematically consistent with this environment: "${e}" and rendered in a ${g}.`;e.toLowerCase().includes(`a detailed ${g.replace(" style","")} illustration`)&&(p=`a background matching the style of: "${e.replace(`A detailed ${g.replace(" style","")} illustration for a fantasy adventure game.`,"").trim()}"`);let v="";a.gameSettingType==="Historical"&&a.initialHistoricalContext?v=`The character's attire, hairstyle, and any visible accessories MUST be historically appropriate for the period and culture implied by their name '${a.characterName}', their concept '${a.characterConcept}', and the game's historical context of "${a.initialHistoricalContext}". Prioritize authenticity. If the concept includes anachronistic elements (e.g., 'cyborg'), creatively interpret how such elements might appear or be disguised within the historical setting, all rendered in ${g}.`:a.gameSettingType==="Fictional"?a.fictionalUniverseContext?v=`The character's attire, hairstyle, and accessories MUST be consistent with the established aesthetic of the fictional universe: "${a.fictionalUniverseContext}", rendered in ${g}. If the character is a known entity from this universe, their appearance should match.`:v=`The character's attire should be fitting for their concept: "${a.characterConcept}", rendered in ${g}.`:["emperor","dynasty","roman","viking","qing","tang","legionary","gladiator","samurai","medieval"].some(w=>a.characterConcept.toLowerCase().includes(w)||a.characterName.toLowerCase().includes(w)||a.initialHistoricalContext&&a.initialHistoricalContext.toLowerCase().includes(w))&&(v=`The character's attire, hairstyle, and accessories SHOULD be historically appropriate if the concept implies a historical basis, rendered in ${g}. Aim for authenticity. If the concept includes anachronistic elements (e.g., 'cyborg'), creatively interpret how such elements might appear or be disguised within the setting.`);const T=`Generate a full body ${g} illustration/sprite of a character named "${a.characterName}" whose concept is: "${a.characterConcept}".
${v} ${h}
A-pose or neutral standing pose, facing forward/slightly angled. Background: ${p}, character is focus. Ensure the overall image is visually appealing and interesting.
Style: ${g} for character sheet.
CRITICAL: Image MUST ONLY contain the character sprite on the background. NO text, watermarks, labels, icons, borders, UI elements. Limbs correct and clear. Roughly square canvas, full figure visible.`,C=await Gn.models.generateImages({model:yr,prompt:T,config:{numberOfImages:1,outputMimeType:"image/png"}});return(s=(o=(t=C.generatedImages)==null?void 0:t[0])==null?void 0:o.image)!=null&&s.imageBytes?`data:image/png;base64,${C.generatedImages[0].image.imageBytes}`:(console.warn("No image data from Gemini API for player character. Response:",JSON.stringify(C,null,2)),null)}catch(f){let g="Unknown error during image generation";return f instanceof Error?g=f.message:typeof f=="string"?g=f:(u=f==null?void 0:f.error)!=null&&u.message&&(g=f.error.message),console.error(`Error in generatePlayerCharacterImage (${g.includes("RESOURCE_EXHAUSTED")||g.includes("429")?"Quota Exceeded":"General Error"}):`,f),null}},kA=async(a,e,t,o="Fictional",s=null,u="")=>{var b;const f=wA(e);let g="";o==="Historical"&&s?g=`Game setting: HISTORICAL. Specific historical context: ${s}. All details (name, concept, skills, items, rarity) MUST be historically plausible and consistent with this context.`:o==="Fictional"&&s?g=`Game setting: FICTIONAL. Specific universe context: ${s}. All details (name, concept, skills, items, rarity) MUST be consistent with this universe's lore and themes. Epic/Legendary items/skills should align with known powerful entities/artifacts from this universe, while remaining distinct from memory.`:o==="Fictional"&&(g="Game setting: FICTIONAL (Generic). Details should fit a general fantasy/sci-fi theme based on the character concept. You may subtly draw inspiration from common tropes but do not force it into a specific pre-existing IP if no universe context is provided.");const h=`You are an AI for a fantasy/adventure game. Your task is to finalize details for a new player character based on a pre-defined concept.
Context:
- Game's Visual Style: ${e}. For any item's 'visualPromptHint' in the tool call, you MUST provide a detailed visual description specifically for a '${f}'. Focus on the item itself, with a simple/neutral background suitable for an icon. Do not describe a full scene.
- ${g}
- Memory: ${u||"No specific memorable entities or plot points yet."}
- Input Character Concept: "${a}"
- Input Character Name: "${t||"Not specified, please generate one fitting the concept."}"

Instructions for Character Detail Finalization:
1.  Character Identity:
    -   'characterName': Use the "Input Character Name" ("${t||"Not specified"}") if provided and plausible for the "Input Character Concept" and setting. Otherwise, generate a name that FITS THE PRECISE "Input Character Concept" ("${a}") and game setting/universe context. If the concept implies a famous name from the context, use that.
    -   'characterConcept': This MUST be a direct, concise version or slight creative elaboration of the "Input Character Concept" ("${a}"). It must be 10-40 words and RETAIN ALL KEY ELEMENTS of the input. DO NOT change the core idea.
    -   'characterRarity': Assign a rarity (Common, Uncommon, Rare, Epic, Legendary, Character_Self) based on the character's concept, name, and context (historical/fictional universe if any). E.g., 'Einstein' or 'a dragon lord' or 'Luke Skywalker' should be Epic/Legendary. A 'young squire' Common/Uncommon.
2.  Limbs: Define standard limbs (Head, Torso, Left Arm, Right Arm, Left Leg, Right Leg). Each limb MUST start with 100 health and a status like "Healthy (100HP)".
3.  Starting Skills: Suggest 2-4 skills from ${pr.map(A=>A.name).join(", ")}.
    - Skill levels (0-10) MUST be highly appropriate for the "Input Character Concept" AND the game setting/universe context.
    - **For most standard character concepts, distribute starting skills primarily within the 2-6 (Novice to Adept) range. Avoid overly concentrating skills at the extreme ends (0-1 or 9-10) unless the character concept strongly dictates it (e.g., a renowned master or a completely unskilled individual in a specific area).**
    - Examples: 'Lu Bu' gets Combat: 9-10. 'Young squire' gets Combat: 1-2. 'A seasoned mercenary' might have Combat: 4-5, Survival: 3-4. 'An apprentice scholar' might have Perception: 3-4, Crafting (Scrolls): 2-3.
    - Untrained is 0. Proficiency scale: 0=Untrained, 1-2=Novice, 3-4=Apprentice, 5-6=Adept, 7-8=Expert, 9=Virtuoso, 10=Master.
4.  Initial Items: Suggest 0-3 starting items, fitting the "Input Character Concept" and game setting/universe context.
    - If Historical, items MUST be plausible. If Fictional with universe context, items should be lore-appropriate.
    - Rarity reflects significance. Epic/Legendary items must be distinct from memory context unless they are iconic starting gear for a known character concept within a universe.
    - Item 'visualPromptHint' should be a detailed description of THE ITEM ITSELF formatted for a '${f}'. Do not describe background beyond simple/neutral for an icon or artistic style other than for the specified '${f}'.

CRITICAL: You MUST invoke the tool named 'provide_character_details_and_initial_items'. The arguments you provide to this tool MUST adhere strictly to its schema.
The 'characterConcept' MUST be directly based on "${a}".
The 'characterName' should be consistent with "${t}" (if given) or the concept and universe.`,p=await Rt(h,IA,AA,"Invalid character data (name, concept length/fidelity, rarity, limbs, skills levels, initial items). Check for known entity conflicts, skill level appropriateness (aim for 2-6 for typical concepts), and universe consistency.","generateCharacterDetails"),v=p.limbs.map(A=>({id:crypto.randomUUID(),name:A.name,status:A.status,health:A.health,equippedItems:[]})),T=v.reduce((A,M)=>A+M.health,0),C=v.length>0?Math.round(T/v.length):100,S=pr.map(A=>{var R;const M=(R=p.startingSkills)==null?void 0:R.find($=>$.skillName===A.name),L=M?M.startingLevel:0;return{id:crypto.randomUUID(),name:A.name,description:A.description,level:L,experience:0,experienceToNextLevel:L===0&&A.name!=="Combat"?50:L*100+100}});let w=(b=p.characterName)==null?void 0:b.trim();return w||(w=(t==null?void 0:t.trim())||a.split(/[,.]|\s-\s/)[0].trim()||(o==="Historical"?"Citizen":"Adventurer"),w.split(/\s+/).length>4&&(w=o==="Historical"?"Citizen":"Adventurer")),{characterDetails:{characterName:w,characterConcept:p.characterConcept,characterRarity:p.characterRarity,overallHealth:C,currentEnergy:100,maxEnergy:100,isDefeated:!1,limbs:v,skills:S,gameSettingType:o,initialHistoricalContext:o==="Historical"?s:null,fictionalUniverseContext:o==="Fictional"?s:null,visualStyle:e},initialItems:p.initialItemSuggestions||[]}},Mc=async(a,e,t,o)=>{var s,u,f;try{const g=o==="Ink Painting"?"black and white traditional Chinese ink painting style":`${o} style`,h=`Dynamic, first-person perspective ${g} of an event: ${a}. The event is happening in a place described as: ${e}. Image focus is the event itself. Ensure the overall image is visually appealing, intense, and interesting. Forbid any text, numbers, or UI elements. Clean ${g}.`,p=await Gn.models.generateImages({model:yr,prompt:h,config:{numberOfImages:1,outputMimeType:"image/jpeg"}});return(f=(u=(s=p.generatedImages)==null?void 0:s[0])==null?void 0:u.image)!=null&&f.imageBytes?`data:image/jpeg;base64,${p.generatedImages[0].image.imageBytes}`:(console.warn(`No image data from Gemini API for event image "${t}". Prompt: ${h}`),null)}catch(g){return console.error(`Error generating event image for "${t}":`,g),null}},$A=a=>{const{characterData:e,locationData:t,playerInventory:o,gameLog:s,currentCoordinates:u,talkingToNPC:f,locationNPCs:g,potentialDiscoveries:h,isGeneratingEvent:p,lastEventTimestamp:v,setCharacterData:T,setLocationData:C,setPlayerInventory:S,setVisitedLocations:w,setLocationItems:I,setLocationNPCs:b,setTalkingToNPC:A,setIsGeneratingEvent:M,setEventLoadingMessage:L,setLastEventTimestamp:R,addLogEntry:$,gainSkillExperienceLogic:V,addMajorPlotPointLogic:Q,addMemorableEntityLogic:te,getMemoryContextString:F,markPotentialDiscoveryFoundLogic:ae,addPotentialDiscovery:W,isEventActive:z,setIsEventActive:ue,currentEventImageUrl:re,setCurrentEventImageUrl:se,currentEventDetails:U,setCurrentEventDetails:X,currentDirectives:J}=a,he=Y.useCallback(async Z=>{var de;const ie=F();t!=null&&t.visualPromptHint;const fe=`${u.x},${u.y}`,ce=(e==null?void 0:e.visualStyle)||"Pixel Art";if(Z.characterEffects&&e){let le=!1;const me={...e},{healthChange:K,energyChange:Ve,limbEffects:Te,skillXpGains:we}=Z.characterEffects;if(K&&(me.overallHealth=Math.max(0,Math.min(100,me.overallHealth+K)),$("game_event",`Your overall health changes by ${K}. Now: ${me.overallHealth}HP.`),le=!0),Ve&&(me.currentEnergy=Math.max(0,Math.min(me.maxEnergy,me.currentEnergy+Ve)),$("game_event",`Your energy changes by ${Ve}. Now: ${me.currentEnergy}EN.`),le=!0),Te&&(Te.forEach(Me=>{const Ge=me.limbs.findIndex(be=>be.name===Me.limbName);if(Ge!==-1){const be={...me.limbs[Ge]};Me.healthChange&&(be.health=Math.max(0,Math.min(100,be.health+Me.healthChange))),Me.newHealthAbsolute!==void 0&&(be.health=Math.max(0,Math.min(100,Me.newHealthAbsolute))),Me.newStatus?be.status=Me.newStatus:be.status=`Affected (${be.health}HP)`,me.limbs[Ge]=be,$("game_event",`${be.name} is now ${be.status} (${be.health}HP).`),le=!0}}),le)){const Me=me.limbs.reduce((Ge,be)=>Ge+be.health,0);me.overallHealth=Math.round(Me/me.limbs.length),$("game_event",`Overall health recalculated to ${me.overallHealth}HP.`)}me.overallHealth<=0&&!me.isDefeated&&(me.isDefeated=!0,$("game_event","The effects are overwhelming. You have been defeated."),le=!0),le&&T(me),we&&we.forEach(Me=>V(Me.skillName,Me.amount,$))}if(Z.itemEffects&&e){const{itemsAddedToInventory:le,itemsRemovedFromInventoryByName:me,itemsAddedToLocation:K,itemsRemovedFromLocationByName:Ve}=Z.itemEffects,Te=h.filter(we=>we.type==="item"&&we.status==="mentioned");if(le!=null&&le.length){const we=[];for(const Me of le){const Ge=Me.visualPromptHint||`a ${Me.itemTypeGuess} called ${Me.name}`,be=await hi(Ge,Me.name,ce),Ke={...Me,visualPromptHint:Ge,id:crypto.randomUUID(),iconUrl:be};we.push(Ke);const Ze=await Fi(Ke,"item",Te,e,ie);Ze&&ae(Ze,Ke.id),$("game_event",`You acquired: ${Ke.name} (${Ke.rarity}).`),te(Ke.id,Ke.name,"item",Ke.rarity,Ke.description,"Acquired from event")}S(Me=>[...Me,...we])}if(me!=null&&me.length&&S(we=>we.filter(Me=>{const Ge=me.includes(Me.name);return Ge&&$("game_event",`You lost: ${Me.name}.`),!Ge})),K!=null&&K.length&&t){const we=[];for(const Ge of K){const be=Ge.visualPromptHint||`a ${Ge.itemTypeGuess} called ${Ge.name}`,Ke=await hi(be,Ge.name,ce),Ze={...Ge,visualPromptHint:be,id:crypto.randomUUID(),iconUrl:Ke};we.push(Ze);const Wt=await Fi(Ze,"item",Te,e,ie);Wt&&ae(Wt,Ze.id),$("game_event",`${Ze.name} (${Ze.rarity}) appeared in the area!`),te(Ze.id,Ze.name,"item",Ze.rarity,Ze.description,`Appeared in ${t.name} from event`)}I(Ge=>[...Ge||[],...we]);const Me=`${u.x},${u.y}`;w(Ge=>{const be=new Map(Ge),Ke=be.get(Me);return Ke&&be.set(Me,{...Ke,items:[...Ke.items||[],...we]}),be})}if(Ve!=null&&Ve.length){I(Me=>Me?Me.filter(Ge=>{const be=Ve.includes(Ge.name);return be&&$("game_event",`${Ge.name} vanished from the area.`),!be}):null);const we=`${u.x},${u.y}`;w(Me=>{const Ge=new Map(Me),be=Ge.get(we);return be&&be.items&&Ge.set(we,{...be,items:be.items.filter(Ke=>!Ve.includes(Ke.name))}),Ge})}}if(Z.locationEffects&&t&&e){const{descriptionChange:le,newTemporaryNpc:me,environmentTagAdded:K,environmentTagRemoved:Ve}=Z.locationEffects;let Te=!1;const we={...t};if(le&&(we.description+=`
${le}`,$("narration",`The area changes: ${le}`),Te=!0),K&&(we.environmentTags=[...new Set([...we.environmentTags,K])],$("system",`Area environment is now also: ${K}`),Te=!0),Ve&&(we.environmentTags=we.environmentTags.filter(Me=>Me!==Ve),$("system",`Area environment is no longer: ${Ve}`),Te=!0),Te&&C(we),me){const Me=await Qh(me.visualPromptHint,me.name,t.visualPromptHint,ce),Ge=pr.map(kt=>{var en;const xt=(en=me.skillSuggestions)==null?void 0:en.find(Wn=>Wn.skillName===kt.name);let St=0;return xt?St=xt.level:me.rarity==="Legendary"?St=Math.floor(Math.random()*4)+7:me.rarity==="Epic"?St=Math.floor(Math.random()*3)+5:me.rarity==="Rare"?St=Math.floor(Math.random()*3)+3:St=Math.floor(Math.random()*3)+1,{id:crypto.randomUUID(),name:kt.name,description:kt.description,level:St,experience:0,experienceToNextLevel:St*100+100}}),be={...me,id:crypto.randomUUID(),iconUrl:Me,inventory:[],skills:Ge,currentHealth:100,maxHealth:100,isDefeated:!1,disposition:"Neutral",isEventSpawned:!0,isHiddenDuringEvent:!1},Ke=h.filter(kt=>kt.type==="npc"&&kt.status==="mentioned"),Ze=await Fi(be,"npc",Ke,e,ie);Ze&&ae(Ze,be.id),$("game_event",`${be.name} (${be.rarity}) appears due to the event!`),te(be.id,be.name,"npc",be.rarity,be.description,`Appeared in ${t.name} during event`),b(kt=>[...kt||[],be]);const Wt=`${u.x},${u.y}`;w(kt=>{const xt=new Map(kt),St=xt.get(Wt);return St&&xt.set(Wt,{...St,npcs:[...St.npcs||[],be]}),xt})}}if((de=Z.npcEffects)!=null&&de.length&&g){let le=[...g];Z.npcEffects.forEach(K=>{const Ve=le.findIndex(Te=>Te.id===K.npcIdTargeted);if(Ve!==-1){const Te={...le[Ve]};let we=!1;K.healthChange&&(Te.currentHealth=Math.max(0,Math.min(Te.maxHealth||100,(Te.currentHealth||100)+K.healthChange)),$("combat",`${Te.name}'s health changes by ${K.healthChange}. Now: ${Te.currentHealth}HP.`),we=!0),K.isDefeated!==void 0&&(Te.isDefeated=K.isDefeated,$("combat",`${Te.name} is now ${K.isDefeated?"defeated":"no longer defeated"}.`),K.isDefeated&&(f==null?void 0:f.id)===Te.id&&A(null),we=!0),K.dispositionChange&&(Te.disposition=K.dispositionChange,$("system",`${Te.name}'s disposition towards you is now ${K.dispositionChange}.`),we=!0),K.dialogueOverride&&$("narration",`${Te.name} exclaims: "${K.dialogueOverride}"`),K.isHiddenDuringEvent!==void 0&&(Te.isHiddenDuringEvent=K.isHiddenDuringEvent,$("system",`${Te.name} is now ${K.isHiddenDuringEvent?"hidden by the event":"no longer hidden"}.`),K.isHiddenDuringEvent&&(f==null?void 0:f.id)===Te.id&&A(null),we=!0),we&&(le[Ve]=Te)}}),b(le);const me=`${u.x},${u.y}`;w(K=>{const Ve=new Map(K),Te=Ve.get(me);return Te&&Ve.set(me,{...Te,npcs:le}),Ve})}if(Z.worldEffects&&(Z.worldEffects.timePasses&&$("system",`Time passes: ${Z.worldEffects.timePasses}`),Z.worldEffects.weatherChanges&&$("system",`The weather changes: ${Z.worldEffects.weatherChanges}`)),Z.majorPlotPointSummary&&Q(Z.majorPlotPointSummary,Z.involvedEntityIdsForPlotPoint,t==null?void 0:t.name),Z.potentialDiscoveriesGenerated)for(const le of Z.potentialDiscoveriesGenerated)await W(le,Z.eventTitle,fe)},[e,t,o,u,g,f,h,T,C,S,w,I,b,A,$,V,Q,te,F,ae,W]),P=Y.useCallback(async Z=>{if(!e||!t||p||z)return;const ie=Z.toLowerCase(),fe=ie.includes("_epic_")||ie.includes("_legendary_"),ce=ie.startsWith("event_")||ie.startsWith("game_start");if(!fe&&!ce)return;M(!0),L("Sensing a disturbance..."),$("system","You feel a change in the air...");const de=F();try{const le=await JN(Z,e,t,o,s,de);if(!le.shouldTriggerEvent||!le.eventConcept||!le.eventIntensity){$("system","The feeling passes. Nothing significant seems to happen."),M(!1),L(null);return}let me="";if(J){const Te=J.promptEnhancements.find(we=>we.targetSystem==="EventGeneration");Te&&(me+=`
Game Director Suggestion for Event: ${Te.suggestion}`),(J.currentGameFocus===le.eventConcept||J.gameplayParameterSuggestions.increaseNarrativeLengthForScenario===le.eventConcept||J.gameplayParameterSuggestions.increaseNarrativeLengthForScenario===J.currentGameFocus&&J.currentGameFocus===le.eventConcept)&&(me+=`
Game Director Suggests: This event matches the current game focus or a scenario requiring longer narration. Please provide a more detailed and immersive event narration.`),J.gameplayParameterSuggestions.preferredEventType===le.eventConcept&&(me+=`
Game Director Notes: This event type (${le.eventConcept}) is currently preferred.`)}const K=await HN(e,t,o,s,le.eventConcept,le.eventIntensity,de+me);if(["a fleeting sensation","the moment passes","all remains calm","nothing noteworthy","nothing unusual"].some(Te=>K.eventTitle.toLowerCase().includes(Te))&&!K.characterEffects&&!K.itemEffects&&!K.locationEffects&&!K.npcEffects&&!K.majorPlotPointSummary&&!K.requiresPlayerActionToResolve){$("system","The feeling passes. Nothing significant seems to happen."),ue(!1),X(null),se(null),M(!1),L(null);return}if(ue(!0),X(K),$("game_event",`EVENT: ${K.eventTitle}`),$("narration",K.narration),K.combatNarration&&$("combat",K.combatNarration),K.visualPromptHintForEventImage&&(t!=null&&t.visualPromptHint)&&(e!=null&&e.visualStyle)){const Te=await Mc(K.visualPromptHintForEventImage,t.visualPromptHint,K.eventTitle,e.visualStyle);se(Te),Te&&$("system","Event image generated.")}else se(null);if(await he(K),R(Date.now()),K.requiresPlayerActionToResolve)$("system","This event requires your attention."),K.resolutionCriteriaPrompt&&$("system",`Hint: ${K.resolutionCriteriaPrompt}`);else{let Te=`Event Occurred: "${K.eventTitle}". ${K.narration}`;K.majorPlotPointSummary&&(Te+=` Lore/Plot: ${K.majorPlotPointSummary}`);const we=new Set;e&&we.add(e.characterName),K.involvedEntityIdsForPlotPoint&&K.involvedEntityIdsForPlotPoint.forEach(Me=>we.add(Me)),Q(Te,Array.from(we),t==null?void 0:t.name),ue(!1),X(null),se(null)}}catch(le){le.message==="NO_MAJOR_EVENT"?$("system","The feeling passes. Nothing significant seems to happen."):(console.error("Failed to trigger or apply event:",le),$("error",`Event generation failed: ${le.message||"A strange occurrence fizzled out."}`)),ue(!1),X(null),se(null)}finally{M(!1),L(null)}},[e,t,o,s,p,z,v,M,L,$,F,he,R,ue,X,se,Q,J]),j=Y.useCallback(async Z=>{var fe;if(!e||!t||p||z){$("system","Cannot initiate major actions now due to ongoing processes or events.");return}M(!0),L("Assessing the consequences...");const ie=F();try{let ce=null;if(Z.actionType==="attack_npc"){const de=g==null?void 0:g.find(le=>le.id===Z.targetNpcId);if(de&&e){let le="";if(J){const me=J.promptEnhancements.find(K=>K.targetSystem==="CombatResolution");me&&(le+=`
Game Director Suggestion for Combat: ${me.suggestion}`),J.currentGameFocus==="HighStakesCombat"&&(le+=`
Game Director Notes: This is a high stakes combat scenario. Emphasize danger and impactful outcomes.`)}ce=await qN(e,de,Z,ie+le)}else throw new Error("Target NPC for attack not found or character data missing.")}if(ce){if(ue(!0),X(ce),$("game_event",`PLAYER ACTION EVENT: ${ce.eventTitle}`),$("narration",ce.narration),ce.combatNarration&&$("combat",ce.combatNarration),ce.visualPromptHintForEventImage&&(t!=null&&t.visualPromptHint)&&(e!=null&&e.visualStyle)){const me=await Mc(ce.visualPromptHintForEventImage,t.visualPromptHint,ce.eventTitle,e.visualStyle);se(me)}else se(null);await he(ce),R(Date.now());const de=(fe=ce.npcEffects)==null?void 0:fe.find(me=>me.npcIdTargeted===Z.targetNpcId),le=e==null?void 0:e.isDefeated;if(de!=null&&de.isDefeated||le||!ce.requiresPlayerActionToResolve){$("system",de!=null&&de.isDefeated||le?"The confrontation has reached a conclusion.":"The immediate consequences of your action have played out.");let me=`Action Outcome: "${ce.eventTitle}". Final Result: ${ce.narration}`;ce.majorPlotPointSummary&&(me+=` Context/Lore: ${ce.majorPlotPointSummary}`);const K=new Set;e&&K.add(e.characterName),ce.involvedEntityIdsForPlotPoint&&ce.involvedEntityIdsForPlotPoint.forEach(Ve=>K.add(Ve)),de&&K.add(de.npcIdTargeted),Q(me,Array.from(K),t==null?void 0:t.name),ue(!1),X(null),se(null)}else ce.requiresPlayerActionToResolve&&($("system","The situation remains tense and requires further action."),ce.resolutionCriteriaPrompt&&$("system",`Hint: ${ce.resolutionCriteriaPrompt}`))}else $("system","Your action did not trigger a major consequence at this time.")}catch(ce){console.error("Failed to handle player-initiated significant action:",ce),$("error",`Action failed: ${ce.message||"An unexpected issue occurred."}`),ue(!1),X(null),se(null)}finally{M(!1),L(null)}},[e,t,g,p,z,v,M,L,$,F,he,R,ue,X,se,Q,J]);return{applyEventEffects:he,attemptToTriggerUnexpectedEvent:P,handlePlayerInitiatedSignificantAction:j}},Wh=Y.createContext(void 0),PA=({children:a})=>{const{gameLog:e,addLogEntry:t,setGameLog:o}=ST(),s=MN(),u=LN(),f=kN(),[g,h]=Y.useState(null),[p,v]=Y.useState(null),[T,C]=Y.useState(null),[S,w]=Y.useState(null),[I,b]=Y.useState(!1),[A,M]=Y.useState(null),[L,R]=Y.useState(null),[$,V]=Y.useState(null),[Q,te]=Y.useState(0),F=Y.useCallback(()=>{te(fe=>fe+1)},[]),ae=Y.useCallback(async(fe=!1)=>{console.log(`GameContext: Placeholder for triggerGameDirectorAnalysis (force: ${fe}) called. Command count: ${Q}`)},[Q]),W=Y.useCallback((fe,ce,de)=>{t(fe,ce,de)},[t]),z=Y.useCallback((fe,ce)=>{const{wasDefeated:de}=u.consumeEnergyLogic(fe,W,ce)},[u.consumeEnergyLogic,W]),ue=Y.useCallback((fe,ce)=>{var K,Ve,Te;const de=(Ve=(K=u.characterData)==null?void 0:K.skills.find(we=>we.name===fe))==null?void 0:Ve.level;u.gainSkillExperienceLogic(fe,ce,W);const le=u.characterData,me=(Te=le==null?void 0:le.skills.find(we=>we.name===fe))==null?void 0:Te.level;ce>0&&W("system",`Gained ${ce}XP in ${fe}.`),de!==void 0&&me!==void 0&&me>de&&(me===1&&de===0?W("game_event",`You learned ${fe} (Level ${me})!`):W("game_event",`${fe} increased to Level ${me}!`))},[u.gainSkillExperienceLogic,u.characterData,W]),re=Y.useCallback((fe,ce,de,le,me,K)=>{const{entityAddedOrUpdated:Ve,newEntity:Te}=s.addMemorableEntityLogic(fe,ce,de,le,me,K);Ve&&Te&&Te.type!=="lore_hint"&&W("system",`Key entity noted: ${Te.name} (${Te.type}, ${Te.rarity}).`)},[s.addMemorableEntityLogic,W]),se=Y.useCallback((fe,ce,de)=>{const{plotPointAdded:le,newPlotPoint:me}=s.addMajorPlotPointLogic(fe,ce,de);le&&me&&W("game_event",`PLOT UPDATE: ${me.summary}`)},[s.addMajorPlotPointLogic,W]),U=Y.useCallback(async(fe,ce,de)=>{const{newDiscovery:le,duplicatePrevented:me,preConfirmedLead:K}=await s.addPotentialDiscoveryLogic(fe,ce,de,s.getMemoryContextString,s.memorableEntities);K?W("system",`Hint for '${K.name}' already known and confirmed.`):le?W("system",`Lore hint: Heard of a ${le.type} named '${le.name}'.`):me&&W("system",`A similar hint about '${fe.name}' already exists.`)},[s.addPotentialDiscoveryLogic,s.getMemoryContextString,s.memorableEntities,W]),X=Y.useCallback((fe,ce)=>{const{updatedDiscovery:de}=s.markPotentialDiscoveryFoundLogic(fe,ce);de&&W("game_event",`Discovered: ${de.name} (previously hinted at)!`)},[s.markPotentialDiscoveryFoundLogic,W]),J=Y.useCallback(()=>{s.clearMemorySystemLogic(),W("system","Memory systems cleared for new game.")},[s.clearMemorySystemLogic,W]),he={characterData:u.characterData,locationData:f.locationData,playerInventory:f.playerInventory,gameLog:e,currentCoordinates:f.currentCoordinates,talkingToNPC:f.talkingToNPC,locationNPCs:f.locationNPCs,potentialDiscoveries:s.potentialDiscoveries,isGeneratingEvent:f.isGeneratingEvent,lastEventTimestamp:f.lastEventTimestamp,setCharacterData:u.setCharacterData,setLocationData:f.setLocationData,setPlayerInventory:f.setPlayerInventory,setVisitedLocations:f.setVisitedLocations,setLocationItems:f.setLocationItems,setLocationNPCs:f.setLocationNPCs,setTalkingToNPC:f.setTalkingToNPC,setIsGeneratingEvent:f.setIsGeneratingEvent,setEventLoadingMessage:f.setEventLoadingMessage,setLastEventTimestamp:f.setLastEventTimestamp,addLogEntry:W,gainSkillExperienceLogic:u.gainSkillExperienceLogic,addMajorPlotPointLogic:s.addMajorPlotPointLogic,addMemorableEntityLogic:s.addMemorableEntityLogic,getMemoryContextString:s.getMemoryContextString,markPotentialDiscoveryFoundLogic:s.markPotentialDiscoveryFoundLogic,consumeEnergyLogic:u.consumeEnergyLogic,addPotentialDiscovery:U,isEventActive:I,setIsEventActive:b,currentEventImageUrl:A,setCurrentEventImageUrl:M,currentEventDetails:L,setCurrentEventDetails:R,currentDirectives:$},{applyEventEffects:P,attemptToTriggerUnexpectedEvent:j,handlePlayerInitiatedSignificantAction:Z}=$A(he),ie={...s,...u,...f,gameLog:e,addLogEntry:W,setGameLog:o,addMemorableEntity:re,addMajorPlotPoint:se,addPotentialDiscovery:U,markPotentialDiscoveryFound:X,clearMemorySystem:J,_consumeEnergy:z,_gainSkillExperience:ue,applyEventEffects:P,attemptToTriggerUnexpectedEvent:j,handlePlayerInitiatedSignificantAction:Z,isEventActive:I,setIsEventActive:b,currentEventImageUrl:A,setCurrentEventImageUrl:M,currentEventDetails:L,setCurrentEventDetails:R,setItemToViewInModal:h,setNpcToViewInModal:v,setLocationToViewInModal:C,setSelectedLocationCoordinateKeyForModal:w,currentDirectives:$,setCurrentDirectives:V,triggerGameDirectorAnalysis:ae,playerCommandCount:Q,incrementPlayerCommandCount:F};return E.jsx(Wh.Provider,{value:ie,children:a})},wn=()=>{const a=Y.useContext(Wh);if(a===void 0)throw new Error("useGameContext must be used within a GameProvider");return a},ln=({className:a="w-8 h-8 text-sky-500"})=>E.jsxs("svg",{className:`animate-spin ${a}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[E.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),E.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),DA=a=>{if(!a)return"";const e=[];let t=0;const o=/\[lore entity_type="([^"]*)" entity_name="([^"]*)"\]([\s\S]*?)\[\/lore\]/g;let s,u=0;for(;(s=o.exec(a))!==null;){s.index>t&&e.push(a.substring(t,s.index));const[,f,g,h]=s;e.push(cr.createElement("span",{key:`lore-${u++}-${g}`,className:"text-yellow-400 hover:text-yellow-300 font-medium",title:`Lore: ${g} (${f})`},h)),t=o.lastIndex}return t<a.length&&e.push(a.substring(t)),cr.createElement(cr.Fragment,null,...e)},Oc=({entity:a,entityId:e,initialDescription:t,elaborationServiceFn:o,onSuccess:s,characterData:u,isTextualItemContext:f=!1})=>{const{addElaboratingEntityId:g,removeElaboratingEntityId:h,elaboratingEntityIds:p,getMemoryContextString:v,currentCoordinates:T}=wn(),[C,S]=Y.useState(t),[w,I]=Y.useState(!1),[b,A]=Y.useState(!1);Y.useEffect(()=>{S(t),I(!1),A(!1)},[e,t]),Y.useEffect(()=>{w||S(t)},[t,w]);const M=Y.useMemo(()=>DA(C),[C]),L=p.has(e),R=b||L,$=Y.useCallback(async()=>{if(!u||!a){console.warn("Cannot elaborate: missing character data or entity.");return}A(!0),g(e);try{const te=v(),F=`${T.x},${T.y}`,ae=await o(a,u,F,te);S(ae.processedText),I(!0),s(e,ae.rawText||ae.processedText,ae.processedText,ae.potentialDiscoveries)}catch(te){console.error(`Error elaborating on entity ${e}:`,te);const F=C+`

(Could not retrieve more details at this time.)`;S(F),I(!0)}finally{A(!1),h(e)}},[u,a,e,o,s,g,h,v,T,C]),V=Y.useMemo(()=>!w&&u&&(L||t.length<450),[w,u,L,t]);return{displayedDescriptionNode:M,handleTriggerElaboration:$,isElaborating:R,canElaborate:V,elaborationButtonText:f?"Read":"Learn More"}},UA=a=>{switch(a){case"Common":return"ring-slate-500";case"Uncommon":return"ring-green-500";case"Rare":return"ring-sky-500";case"Epic":return"ring-purple-500";case"Legendary":return"ring-amber-500";default:return"ring-slate-600"}},OA=a=>{switch(a){case"Common":return"text-slate-400";case"Uncommon":return"text-green-400";case"Rare":return"text-sky-400";case"Epic":return"text-purple-400";case"Legendary":return"text-amber-400";default:return"text-slate-500"}},GA=["book","scroll","note","letter","manuscript","codex","journal","log","brochure","pamphlet","inscription","carving","tablet","map","document"],HA=a=>a?GA.some(e=>a.toLowerCase().includes(e)):!1,VA=({item:a,onClose:e,characterData:t,onDescriptionElaborated:o,onSelectImageForViewing:s})=>{const u=UA(a.rarity),f=OA(a.rarity),g=t.visualStyle,{displayedDescriptionNode:h,handleTriggerElaboration:p,isElaborating:v,canElaborate:T,elaborationButtonText:C}=Oc({entity:a,entityId:a.id,initialDescription:a.description,elaborationServiceFn:nA,onSuccess:o,characterData:t,isTextualItemContext:HA(a.itemTypeGuess)}),S={imageRendering:g==="Pixel Art"?"pixelated":"auto"};return E.jsxs("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center p-4 z-50","aria-modal":"true",role:"dialog",onClick:e,children:[E.jsxs("div",{className:`bg-slate-800 p-6 rounded-lg shadow-2xl max-w-lg w-full ring-2 ${u} relative transform transition-all duration-300 ease-out scale-95 opacity-0 animate-modal-appear max-h-[90vh] flex flex-col`,onClick:w=>w.stopPropagation(),style:{animationName:"modal-appear-animation",animationDuration:"0.3s",animationFillMode:"forwards"},"aria-labelledby":"item-modal-title",children:[E.jsx("button",{onClick:e,className:"absolute top-3 right-3 text-slate-400 hover:text-slate-200 text-2xl leading-none z-10","aria-label":"Close item details",children:""}),E.jsxs("div",{className:"flex flex-col items-center text-center mb-4",children:[E.jsx("button",{type:"button",onClick:()=>s(a.iconUrl,a.name),className:`focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 ${u} rounded-md`,"aria-label":`View larger image of ${a.name}`,title:`View larger image of ${a.name}`,children:E.jsx("img",{src:a.iconUrl,alt:`${a.name} icon`,className:`w-24 h-24 object-contain rounded-md bg-slate-700 p-2 ring-1 ${u}`,style:S})}),E.jsx("h3",{id:"item-modal-title",className:"text-2xl font-semibold text-red-400 mt-3 mb-1",children:a.name}),E.jsx("p",{className:`text-sm ${f} font-medium mb-1`,children:a.rarity}),E.jsxs("p",{className:"text-sm text-slate-500 mb-4 italic",children:["(",a.itemTypeGuess,")"]})]}),E.jsx("div",{className:"text-slate-300 text-sm leading-relaxed whitespace-pre-wrap mb-3 text-left max-h-64 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-700/50 pr-2 flex-grow",children:h}),T&&E.jsx("button",{onClick:p,disabled:v,className:"w-full bg-teal-600 hover:bg-teal-500 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm mb-3 disabled:opacity-70 flex items-center justify-center","aria-label":`Elaborate on ${a.name}`,children:v?E.jsxs(E.Fragment,{children:[E.jsx(ln,{className:"w-4 h-4 mr-2"})," Thinking..."]}):C}),E.jsx("button",{onClick:e,className:"w-full bg-sky-600 hover:bg-sky-500 text-white font-semibold py-2.5 px-4 rounded-lg transition-colors","aria-label":"Confirm and close item details",children:"Close"})]}),E.jsx("style",{children:`
        @keyframes modal-appear-animation {
          to {
            transform: scale(1);
            opacity: 1;
          }
        }
      `})]})},qA=a=>{switch(a){case"Common":return{border:"ring-slate-500",text:"text-slate-400"};case"Uncommon":return{border:"ring-green-500",text:"text-green-400"};case"Rare":return{border:"ring-sky-500",text:"text-sky-400"};case"Epic":return{border:"ring-purple-500",text:"text-purple-400"};case"Legendary":return{border:"ring-amber-500",text:"text-amber-400"};default:return{border:"ring-slate-600",text:"text-slate-500"}}},FA=a=>{switch(a){case"Common":return"text-slate-400";case"Uncommon":return"text-green-400";case"Rare":return"text-sky-400";case"Epic":return"text-purple-400";case"Legendary":return"text-amber-400";default:return"text-slate-500"}},YA=({npc:a,onClose:e,characterData:t,onDescriptionElaborated:o,onSelectImageForViewing:s})=>{const u=qA(a.rarity),f=t.visualStyle,{displayedDescriptionNode:g,handleTriggerElaboration:h,isElaborating:p,canElaborate:v,elaborationButtonText:T}=Oc({entity:a,entityId:a.id,initialDescription:a.description,elaborationServiceFn:NA,onSuccess:o,characterData:t}),C={imageRendering:f==="Pixel Art"?"pixelated":"auto"};return E.jsxs("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center p-4 z-50","aria-modal":"true",role:"dialog",onClick:e,children:[E.jsxs("div",{className:"bg-slate-800 p-6 rounded-lg shadow-2xl max-w-xl w-full ring-1 ring-slate-700 relative transform transition-all duration-300 ease-out scale-95 opacity-0 animate-modal-appear max-h-[90vh] flex flex-col",onClick:S=>S.stopPropagation(),style:{animationName:"modal-appear-animation",animationDuration:"0.3s",animationFillMode:"forwards"},"aria-labelledby":"npc-modal-title",children:[E.jsx("button",{onClick:e,className:"absolute top-3 right-3 text-slate-400 hover:text-slate-200 text-2xl leading-none z-10","aria-label":`Close details for ${a.name}`,children:""}),E.jsxs("div",{className:"flex flex-col items-center text-center mb-4",children:[E.jsx("button",{type:"button",onClick:()=>s(a.iconUrl,a.name),className:`focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 ${u.border} rounded-md`,"aria-label":`View larger image of ${a.name}`,title:`View larger image of ${a.name}`,children:E.jsx("img",{src:a.iconUrl,alt:`${a.name} portrait`,className:"w-32 h-32 object-contain rounded-md bg-slate-700 p-2 ring-1 ring-slate-600",style:C})}),E.jsx("h3",{id:"npc-modal-title",className:"text-3xl font-semibold text-sky-400 mt-3 mb-1",children:a.name}),E.jsxs("p",{className:`text-sm ${u.text} mb-2`,children:["(",a.rarity,")"]})]}),E.jsxs("div",{className:"space-y-3 text-sm text-slate-300 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-700/50 pr-2 flex-grow",children:[E.jsxs("div",{children:[E.jsx("h4",{className:"font-semibold text-sky-500 mb-0.5",children:"Description:"}),E.jsx("div",{className:"leading-relaxed whitespace-pre-wrap",children:g}),v&&E.jsx("button",{onClick:h,disabled:p,className:"mt-2 text-xs bg-teal-700 hover:bg-teal-600 text-teal-200 font-semibold py-1 px-2.5 rounded-md transition-colors disabled:opacity-70 flex items-center","aria-label":`Learn more about ${a.name}`,children:p?E.jsxs(E.Fragment,{children:[E.jsx(ln,{className:"w-3 h-3 mr-1.5"})," Thinking..."]}):T})]}),E.jsxs("div",{children:[E.jsx("h4",{className:"font-semibold text-sky-500 mb-0.5 mt-2",children:"Appearance:"}),E.jsx("p",{className:"leading-relaxed whitespace-pre-wrap",children:a.appearanceDetails})]}),E.jsxs("div",{children:[E.jsx("h4",{className:"font-semibold text-sky-500 mb-0.5 mt-2",children:"Greeting:"}),E.jsxs("p",{className:"leading-relaxed whitespace-pre-wrap italic",children:['"',a.dialogueGreeting,'"']})]}),E.jsxs("div",{children:[E.jsx("h4",{className:"font-semibold text-sky-500 mb-0.5 mt-2",children:"Known Possessions:"}),a.inventory&&a.inventory.length>0?E.jsx("ul",{className:"list-disc list-inside pl-1 space-y-0.5",children:a.inventory.map(S=>E.jsxs("li",{className:"text-xs",children:[S.name," ",E.jsxs("span",{className:`${FA(S.rarity)}`,children:["(",S.rarity,")"]})]},S.id))}):E.jsx("p",{className:"text-xs italic text-slate-400",children:"Carrying nothing of note."})]})]}),E.jsx("button",{onClick:e,className:"mt-6 w-full bg-cyan-600 hover:bg-cyan-500 text-white font-semibold py-2.5 px-4 rounded-lg transition-colors","aria-label":`Confirm and close details for ${a.name}`,children:"Close"})]}),E.jsx("style",{children:`
        @keyframes modal-appear-animation {
          to {
            transform: scale(1);
            opacity: 1;
          }
        }
      `})]})},Gc=["north","south","east","west"],Hc=["Common","Uncommon","Rare","Epic","Legendary"],co=a=>{switch(a){case"Pixel Art":return"Pixel Art";case"Anime":return"Anime";case"Ink Painting":return"black and white traditional Chinese ink painting";case"Oil Painting":return"distinctive impasto oil painting";case"Water Painting":return"luminous watercolor painting";case"Low Poly":return"stylized low-poly 3D render";default:return a}},ey=a=>{switch(a){case"Ink Painting":return"This style emphasizes expressive brush strokes, minimalism, the interplay of black ink and white space (negative space), and often depicts subjects with a focus on their spirit or essence (shen). Backgrounds might be textured paper, subtle ink washes, or stylized traditional Chinese landscape elements if thematic.";case"Oil Painting":return"This style should evoke a Caspar David Friedrich oil painting. Focus on sublime, atmospheric landscapes: vast mountains, stormy seas, ancient forests, ruins, often veiled in mist or fog. Lighting should be dramatic (twilight, dawn, moonlight) creating a contemplative or melancholic mood. Emphasize depth and perspective. Colors are rich but can be subdued. Textures should suggest detailed brushwork characteristic of oil painting from the Romantic period.";case"Water Painting":return"This style should feature soft, flowing colors and transparent washes typical of watercolor. Emphasize light, airy qualities, and a sense of fluidity in the scene. Edges may be soft or bleed slightly, characteristic of wet-on-wet or wet-on-dry techniques. Preservation of paper white for highlights is key. The overall feel should be luminous and somewhat ethereal due to the watery medium.";case"Low Poly":return"Render with a stylized low-polygon 3D aesthetic. Use flat shading or simple gradients. Emphasize geometric forms and a clean, modern look for all elements in the scene.";default:return""}},BA=a=>a&&typeof a.name=="string"&&a.name.trim()!==""&&typeof a.description=="string"&&a.description.trim()!==""&&Array.isArray(a.environmentTags)&&a.environmentTags.every(e=>typeof e=="string"&&e.trim()!=="")&&typeof a.visualPromptHint=="string"&&a.visualPromptHint.trim()!==""&&Array.isArray(a.validExits)&&a.validExits.every(e=>typeof e=="string"&&Gc.includes(e.toLowerCase()))&&typeof a.rarity=="string"&&Hc.includes(a.rarity),ty=async(a,e,t)=>{var u,f,g;let o=`https://via.placeholder.com/512x512/334155/ffffff?text=${encodeURIComponent(e)}`;const s=co(t);try{const h=`${a.replace("[CHOSEN_STYLE]",s)} IMPORTANT: Image MUST ONLY contain scene. NO text, watermarks, labels, icons, borders, UI elements. Clean ${s} style. Visually appealing and interesting.`,p=await Gn.models.generateImages({model:yr,prompt:h,config:{numberOfImages:1,outputMimeType:"image/jpeg"}});(g=(f=(u=p.generatedImages)==null?void 0:u[0])==null?void 0:f.image)!=null&&g.imageBytes?o=`data:image/jpeg;base64,${p.generatedImages[0].image.imageBytes}`:console.warn(`No image data from Gemini API for location ${e}. Using placeholder.`)}catch(h){console.error(`Error generating image for location ${e}:`,h)}return o},zA=async(a,e,t="")=>{const o=e.visualStyle,s=co(o),u=ey(o);let f="";e.gameSettingType==="Historical"&&e.initialHistoricalContext?f=`This is a HISTORICAL setting: ${e.initialHistoricalContext}. All location details (name, description, tags, visual prompt hint, rarity) MUST be historically plausible and consistent with this context. For Rare/Epic/Legendary rarity, consider actual known historical sites or significant features from this period, referencing your knowledge base. Visual prompt must emphasize historical accuracy and be suitable for a ${s} style rendering.`:e.gameSettingType==="Fictional"&&(e.fictionalUniverseContext?f=`This is a FICTIONAL setting within the universe: "${e.fictionalUniverseContext}". Location details (name, description, tags, visual prompt, rarity) MUST be consistent with this universe's lore, aesthetic, and themes, suitable for a ${s} style rendering. Epic/Legendary locations could be known places from this universe, distinct from memory.`:f=`This is a general FICTIONAL setting. Generate a location fitting the concept and character theme, suitable for a ${s} style rendering. For Rare/Epic/Legendary locations, invent places with strong lore or significance, distinct from memory context.`);const g=`
You are an AI game world generator.
Player wants to start in a location based on this concept: "${a}"
Character providing thematic context: "${e.characterConcept}" (Game Setting: ${e.gameSettingType}, Visual Style: ${o})
${t} 
${f}

Output ONLY a valid JSON string with the following structure:
{
  "name": "EVOCATIVE_LOCATION_NAME",
  "description": "ATMOSPHERIC_DESCRIPTION_2_TO_3_SENTENCES",
  "environmentTags": ["TAG_1", "TAG_2", "TAG_3", "TAG_4", "TAG_5"],
  "visualPromptHint": "DETAILED_PROMPT_FOR_AI_IMAGE_GENERATION_IN_${s.toUpperCase().replace(/\s+/g,"_")}_STYLE",
  "validExits": ["EXIT_DIRECTION_1", "EXIT_DIRECTION_2"],
  "rarity": "RARITY_LEVEL"
}

REQUIREMENTS FOR JSON FIELDS (ALL ARE MANDATORY AND MUST BE NON-EMPTY):
1.  "name": (String) Evocative name for the location.
2.  "description": (String) Atmospheric and descriptive text, 2-3 sentences long.
3.  "environmentTags": (Array of Strings) Exactly 3 to 5 descriptive tags.
4.  "visualPromptHint": (String) A detailed prompt for an AI image generator.
    - MUST start with "A detailed ${s} style illustration of...". ${u}
    - MUST explicitly forbid text, UI elements, or watermarks in the generated image.
    - Describe the scene, lighting, key elements, and mood. Ensure the image is visually appealing, clear, and interesting, fitting the game's aesthetic and the chosen ${o}.
5.  "validExits": (Array of Strings) 1 to 3 valid cardinal directions for exits. Values MUST be from: "north", "south", "east", "west".
6.  "rarity": (String) The location's rarity. MUST be one of: "Common", "Uncommon", "Rare", "Epic", "Legendary". Rarity should reflect significance and be distinct from memory unless appropriate.

Your entire response MUST be ONLY the JSON object described above. No other text, explanations, or markdown.
Ensure ALL fields are present and contain plausible, non-empty values according to the requirements.
If "${a}" is vague, invent details fitting the character theme, visual style (${o}), and setting/universe context.
Example for ${o} (imagine visualStyle is Pixel Art):
{
  "name": "Whispering Caves Entrance (Pixel Art)",
  "description": "A narrow fissure in the cliff face, draped with ancient vines, whispers secrets on the wind. The air grows cooler as one ventures deeper, and strange echoes rebound from unseen depths, rendered in a Pixel Art style.",
  "environmentTags": ["cave", "dark", "ancient", "hidden", "echoing"],
  "visualPromptHint": "A detailed Pixel Art style illustration of a dark cave entrance in a rocky cliff, covered with vines. A faint mysterious glow emanates from within. Eerie atmosphere. Ensure the image is visually appealing. Forbid any text, numbers, or UI elements.",
  "validExits": ["south", "east"],
  "rarity": "Uncommon"
}
`,h=await Kh(g,BA,"Invalid initial location JSON (check name, desc, tags, visual prompt, exits, rarity; visual prompt must start with 'A detailed [CHOSEN_STYLE] style illustration of...', exits valid, rarity valid, consistency with context)","generateLocationDetailsAndImage (Initial - JSON Text)"),p=await ty(h.visualPromptHint,h.name,o);return{...h,imageUrl:p}},JA={functionDeclarations:[{name:"describe_new_location_and_movement_with_exits",description:"Generates details for a new location based on movement. Considers character skills, memory context, game setting (Historical/Fictional universe), visual style (e.g., 'Pixel Art', 'Anime', 'distinctive impasto oil painting', 'luminous watercolor painting'), AND active location-related leads and player's intended location hint. Epic/Legendary locations distinct unless fulfilling lead/intent. Narration reflects Survival skill. Visual prompt hint for 'newLocationVisualPromptHint' MUST be for the specified game visual style.",parameters:{type:_.OBJECT,properties:{newLocationName:{type:_.STRING,description:"Evocative name. If fulfilling lead/intent, this MUST match/align."},newLocationDescription:{type:_.STRING,description:"Atmospheric description (2-3 sentences). If fulfilling lead/intent, aligns with hint."},newLocationEnvironmentTags:{type:_.ARRAY,description:"3-5 tags.",items:{type:_.STRING}},newLocationVisualPromptHint:{type:_.STRING,description:"Detailed prompt for AI image generation. Crucially, this prompt MUST start with 'A detailed [CURRENT_VISUAL_STYLE_NAME] style illustration of...' where [CURRENT_VISUAL_STYLE_NAME] is the actual name of the game's visual style (e.g., 'Pixel Art', 'Anime', 'distinctive impasto oil painting', 'luminous watercolor painting'). Forbid text/UI. Ensure visually appealing, clear, interesting, and consistent with the specified style."},newLocationValidExits:{type:_.ARRAY,description:"1-3 cardinal exits. One MUST lead back. Others plausible.",items:{type:_.STRING,enum:Gc}},newLocationRarity:{type:_.STRING,enum:Hc,description:"Rarity. If fulfilling lead/intent, consistent. Epic/Legendary distinct from memory (unless matching lead/intent), influenced by Perception/plot points and game setting/universe."},movementNarration:{type:_.STRING,description:"Narration (1-2 sentences) of movement, reflecting Survival skill."}},required:["newLocationName","newLocationDescription","newLocationEnvironmentTags","newLocationVisualPromptHint","newLocationValidExits","newLocationRarity","movementNarration"]}}]},KA=(a,e)=>{const t=co(e).toLowerCase();return a&&typeof a.newLocationName=="string"&&a.newLocationName.trim()!==""&&typeof a.newLocationDescription=="string"&&a.newLocationDescription.trim()!==""&&Array.isArray(a.newLocationEnvironmentTags)&&a.newLocationEnvironmentTags.every(o=>typeof o=="string")&&typeof a.newLocationVisualPromptHint=="string"&&a.newLocationVisualPromptHint.trim()!==""&&a.newLocationVisualPromptHint.toLowerCase().startsWith(`a detailed ${t} style illustration of`)&&Array.isArray(a.newLocationValidExits)&&a.newLocationValidExits.length>0&&a.newLocationValidExits.every(o=>typeof o=="string"&&Gc.includes(o.toLowerCase()))&&typeof a.newLocationRarity=="string"&&Hc.includes(a.newLocationRarity)&&typeof a.movementNarration=="string"&&a.movementNarration.trim()!==""},ZA=async(a,e="")=>{var M;const t=a.visualStyle,o=co(t),s=ey(t),f={north:"south",south:"north",east:"west",west:"east"}[a.direction.toLowerCase()]||a.direction,g=a.skills.find(L=>L.name==="Survival"),h=(g==null?void 0:g.level)||0,p=a.skills.find(L=>L.name==="Perception"),v=(p==null?void 0:p.level)||0;let T="",C="";a.gameSettingType==="Historical"&&a.initialHistoricalContext?(T=`The game setting is HISTORICAL: ${a.initialHistoricalContext}. The NEW location (name, desc, tags, visual, RARITY) MUST be plausible and historically consistent. For Rare/Epic/Legendary, consider actual known sites or significant features from this period if they fit, otherwise invent plausibly. Avoid anachronisms. All visual descriptions should be suitable for a ${o} style rendering.`,C=`Historical Context: ${a.initialHistoricalContext}. Visual Style: ${t}.`):a.gameSettingType==="Fictional"&&(a.fictionalUniverseContext?(T=`The game setting is FICTIONAL within universe: "${a.fictionalUniverseContext}". The NEW location MUST be consistent with this universe's established lore, geography, and themes, suitable for a ${o} style rendering. Epic/Legendary locations could be iconic places from this universe, distinct from memory unless fulfilling a lead or a very plausible player intent.`,C=`Fictional Universe: ${a.fictionalUniverseContext}. Visual Style: ${t}.`):(T=`The game setting is general FICTIONAL. The NEW location should fit the character and prior location's theme, suitable for a ${o} style rendering. For Rare/Epic/Legendary, invent lore-rich places, distinct from memory unless fulfilling a lead or a very plausible player intent.`,C=`Visual Style: ${t}.`));let S="No specific location-related leads are currently active.";const w=((M=a.potentialDiscoveries)==null?void 0:M.filter(L=>L.type==="location"&&L.status==="mentioned"))||[];w.length>0&&(S=`Active Location-Related Leads (Rumors):
${w.map(L=>`- Rumored Location: "${L.name}" (Type: ${L.type}, Hint: ${L.descriptionHint}, Rarity Hint: ${L.rarityHint||"Unknown"}). Source: ${L.sourceTextSnippet.substring(0,50)}...`).join(`
`)}`);let I="";a.intendedLocationTypeHint&&(I=`Player has expressed a WEAK INTENT to find a location like: "${a.intendedLocationTypeHint}".`);const b=`Character ${a.characterConcept} (Survival Lvl ${h}, Perception Lvl ${v}) moves ${a.direction.toLowerCase()} from "${a.previousLocation.name}" (Rarity: ${a.previousLocation.rarity}). Game Visual Style: ${t}.
Skills: ${zt(a.skills)}. ${Ht}
Prev Loc: "${a.previousLocation.description}", Tags: [${a.previousLocation.environmentTags.join(", ")}], Exits: [${a.previousLocation.validExits.join(", ")}].
${C}
${S}
${I}
${e}
${a.recentStorySummary?`Recent context: ${a.recentStorySummary}`:""}

PRIMARY DIRECTIVE (Overrules everything else): The NEW location MUST be a logically plausible and geographically coherent continuation from the previous location, given the direction of travel. Adherence to the game's established setting (${a.gameSettingType==="Historical"?"Historical context":"Fictional Universe lore, including its known geography and travel limitations"}) and VISUAL STYLE (${t}) is PARAMOUNT. ${T} Player cannot "will" locations into existence if they don't make sense.

Generate NEW location details:
1.  CONTEXT & CONSISTENCY: Logical continuation from previous location, considering direction and character skills. New location makes sense as adjacent area.
2.  LEAD/INTENT FULFILLMENT (Secondary, WEAK Considerations):
    - Consider Player's Intent: If an 'intendedLocationTypeHint' ("${a.intendedLocationTypeHint||"None"}") is provided, you MAY try to generate a location of that type IF AND ONLY IF it perfectly aligns with the PRIMARY DIRECTIVE.
    - Consider Leads: If an active location-related lead from "${S}" can be FULFILLED *WITHOUT violating the PRIMARY DIRECTIVE*, then you MAY fulfill it.
    - PRIORITY: If both player intent and lead are plausible, lean towards one creating compelling narrative or aligning better with lore/setting/style, while adhering to PRIMARY DIRECTIVE.
    - REFUSAL: If fulfilling player intent or lead is implausible, DO NOT fulfill it. Generate a different, more fitting location based on the PRIMARY DIRECTIVE.
3.  VARIETY: Distinct from previous location, unless logically similar or fulfilling lead/plausible intent.
4.  RARITY: Influenced by prev rarity, direction, Perception, plot points, game setting/universe. If fulfilling lead/intent, rarity matches/consistent with hint. Epic/Legendary distinct from memory unless matching lead/plausible intent.
5.  EXITS: MUST include exit towards "${f}". 0-2 additional plausible exits. Total 1-3.
6.  NARRATION & VISUAL PROMPT:
    - Movement Narration: Journey/arrival (1-2 sentences). MUST reflect Survival skill Lvl ${h}.
    - New Location Visual Prompt Hint: This is for the 'newLocationVisualPromptHint' tool parameter. It MUST be a detailed prompt for an AI image generator. It MUST start with 'A detailed ${o} style illustration of...'. ${s}. Ensure the image would be visually appealing, clear, interesting, and consistent with the ${o} style. Forbid text/UI elements in the image.

DO NOT include 'unexpectedEventDetails'.

CRITICAL: You MUST invoke the tool named 'describe_new_location_and_movement_with_exits'. Arguments MUST adhere strictly to its schema. For 'newLocationVisualPromptHint', ensure it starts with 'A detailed ${o} style illustration of...' as required by the schema, where '${o}' is used as the actual style name.
DO NOT output details as plain text/JSON. Tool call is ONLY valid way.`,A=await Rt(b,JA,L=>KA(L,t),`Invalid new location (check exits, rarity, lead/intent fulfillment, Survival in narration, known entity conflicts, visual prompt for ${o} style, visual appeal, setting/universe/style consistency, logical continuation)`,"generateNewLocationDetailsAndNarration");return A.newLocationValidExits.map(L=>L.toLowerCase()).includes(f)||(console.warn(`LLM failed to include required exit '${f}'. Adding manually.`),A.newLocationValidExits.map(L=>L.toLowerCase()).includes(f)||A.newLocationValidExits.push(f)),{newLocationDetails:{name:A.newLocationName,description:A.newLocationDescription,environmentTags:A.newLocationEnvironmentTags,visualPromptHint:A.newLocationVisualPromptHint,validExits:[...new Set(A.newLocationValidExits.map(L=>L.toLowerCase()))],rarity:A.newLocationRarity},movementNarration:A.movementNarration}},XA=async(a,e,t,o="")=>{const s=e.skills.find(C=>C.name==="Perception"),u=(s==null?void 0:s.level)||0,f=e.visualStyle,g=co(f),h=`Character: ${e.characterConcept} (Perception Lvl ${u}). Game Setting: ${e.gameSettingType}. Visual Style: ${f}.`;let p="";e.gameSettingType==="Historical"&&e.initialHistoricalContext?p=`Elaboration MUST be consistent with historical context: ${e.initialHistoricalContext} and presented as if observed in a ${g} world. If location is a known historical site, draw from its history.`:e.gameSettingType==="Fictional"&&(e.fictionalUniverseContext?p=`Elaboration MUST be consistent with the lore of the fictional universe: "${e.fictionalUniverseContext}" and the game's ${g} style. If location is a known place in this universe, expand on its lore.`:p=`Elaboration should be consistent with a general fantasy/sci-fi theme fitting the location and character, and the game's ${g} style.`);let v="Provide more detailed description of this location (history, points of interest, lore). Build upon existing info. 2-4 paragraphs.";(a.rarity==="Epic"||a.rarity==="Legendary")&&(v+=` As location is ${a.rarity}, details reflect significance/history/lore.`);const T=`Player learns more about location.
Name: ${a.name}, Current Desc: ${a.description}, Tags: ${a.environmentTags.join(", ")}, Rarity: ${a.rarity}. Game Visual Style: ${f}.
${h} ${Ht} (Perception Lvl ${u} might reveal more).
${o}
Task: ${v} ${p} Output ONLY rich, descriptive factual text. No markdown.
If you mention any specific named items, people, or locations that sound important, unique, or part of a legend/quest, make a mental note but DO NOT use any special formatting or markup in your direct speech output. The game system will handle identifying these hints separately.`;try{const C=await Gn.models.generateContent({model:ya,contents:T}),S=C.text;if(S!=null&&S.trim())return await Bi(S,"item_text",t,e,t,o);console.warn(`Elaboration for location ${a.name} resulted in empty response.`,C);const w="Further observation reveals no additional significant details.";return{rawText:w,processedText:w,potentialDiscoveries:[]}}catch(C){console.error(`Error elaborating on location ${a.name}:`,C);const S=`Error recalling more about ${a.name}. (Error: ${C.message||"Unknown"})`;return{rawText:S,processedText:S,potentialDiscoveries:[]}}},jA={functionDeclarations:[{name:"describe_contextual_detail_examination",description:"Describes player's examination of a non-object detail mentioned in location/event text. Provides narration. May reveal lore hints. Considers Perception skill, game setting/universe, and visual style (e.g., 'Pixel Art', 'Anime', 'distinctive impasto oil painting', 'luminous watercolor painting').",parameters:{type:_.OBJECT,properties:{narration:{type:_.STRING,description:"Descriptive narration (1-3 sentences) of what player observes when examining the detail. Reflects Perception skill, game setting/universe, and visual style. If detail isn't truly present or significant, narration indicates this (e.g., 'You look closer at the fissure, but it seems to be a common crack in the rock.')."}},required:["narration"]}}]},QA=a=>a&&typeof a.narration=="string"&&a.narration.trim()!=="",WA=async(a,e,t,o,s,u)=>{const f=e.skills.find(w=>w.name==="Perception"),g=(f==null?void 0:f.level)||0,h=e.visualStyle,p=co(h),v=`Player: ${e.characterConcept} (Perception Lvl ${g}). Setting: ${e.gameSettingType}. Visual Style: ${h}.`;let T=`Current Location: "${t.name}". Description: "${t.description}". Tags: [${t.environmentTags.join(", ")}].`;o&&(T+=`
Ongoing Event: "${o.eventTitle}". Event Narration: "${o.narration}".`);let C="";e.gameSettingType==="Historical"&&e.initialHistoricalContext?C=`HISTORICAL setting: ${e.initialHistoricalContext}. Examination results must be plausible for this era and the ${p} style world.`:e.gameSettingType==="Fictional"&&e.fictionalUniverseContext?C=`FICTIONAL setting in universe: "${e.fictionalUniverseContext}". Examination results must be consistent with this universe's lore and the ${p} style world.`:C=`Examination results should fit the general theme and the ${p} style world.`;const S=`Player is examining a detail: "${a}".
${v}
${T}
${u}
${C}
${Ht}

Task: Provide a descriptive narration of what the player observes.
-   Consider if "${a}" is plausibly part of the location description or active event narration.
-   Player's Perception skill (Lvl ${g}) influences detail observed. Higher perception might reveal more, or link to lore.
-   Narration should be 1-3 sentences and reflect the game's visual style (${p}).
-   If the detail isn't truly present, significant, or examinable in a meaningful way, the narration should reflect that (e.g., "You look closer at the [detail], but it seems to be just a common [feature/shadow/sound].").
-   If the examination reveals information that could lead to a new discovery (item, NPC, location), hint at it within the narration. The system will process this narration for potential leads.

CRITICAL: You MUST invoke the tool 'describe_contextual_detail_examination'. Adhere strictly to schema.
`;try{const w=await Rt(S,jA,QA,"Invalid contextual examination structure. Must return narration.",`examineContextualDetail (Detail: ${a})`),I=await Bi(w.narration,"contextual_examination",`location_${s}_detail_${a.replace(/\s+/g,"_")}`,e,s,u);return{narration:I.processedText,potentialDiscoveries:I.potentialDiscoveries}}catch(w){return console.error(`Error examining contextual detail "${a}":`,w),{narration:`You try to examine the "${a}", but find nothing more of note.`,potentialDiscoveries:[]}}},ew=a=>{switch(a){case"Common":return{border:"ring-slate-500",text:"text-slate-400"};case"Uncommon":return{border:"ring-green-500",text:"text-green-400"};case"Rare":return{border:"ring-sky-500",text:"text-sky-400"};case"Epic":return{border:"ring-purple-500",text:"text-purple-400"};case"Legendary":return{border:"ring-amber-500",text:"text-amber-300"};default:return{border:"ring-slate-600",text:"text-slate-500"}}},tw=({location:a,onClose:e,characterData:t,coordinateKey:o,onDescriptionElaborated:s,onSelectImageForViewing:u})=>{const f=ew(a.rarity),g="text-yellow-400",h=t==null?void 0:t.visualStyle,{displayedDescriptionNode:p,handleTriggerElaboration:v,isElaborating:T,canElaborate:C,elaborationButtonText:S}=Oc({entity:a,entityId:o||`${a.name}-fallbackKey`,initialDescription:a.description,elaborationServiceFn:XA,onSuccess:s,characterData:t}),w={imageRendering:h==="Pixel Art"?"pixelated":"auto"};return E.jsxs("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center p-4 z-50","aria-modal":"true",role:"dialog",onClick:e,children:[E.jsxs("div",{className:`bg-slate-800 p-6 rounded-lg shadow-2xl max-w-2xl w-full ring-2 ${f.border} relative transform transition-all duration-300 ease-out scale-95 opacity-0 animate-modal-appear max-h-[90vh] flex flex-col`,onClick:I=>I.stopPropagation(),style:{animationName:"modal-appear-animation",animationDuration:"0.3s",animationFillMode:"forwards"},"aria-labelledby":"location-modal-title",children:[E.jsx("button",{onClick:e,className:"absolute top-3 right-3 text-slate-400 hover:text-slate-200 text-2xl leading-none z-10","aria-label":`Close details for ${a.name}`,children:""}),E.jsxs("div",{className:"flex items-center mb-4",children:[E.jsx("button",{type:"button",onClick:()=>u(a.imageUrl,a.name),className:`focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 ${f.border} rounded-md mr-4`,"aria-label":`View larger image of ${a.name}`,title:`View larger image of ${a.name}`,children:E.jsx("img",{src:a.imageUrl,alt:`${a.name}`,className:"w-20 h-20 object-contain rounded-md bg-slate-700 p-1 ring-1 ring-slate-600",style:w})}),E.jsxs("div",{children:[E.jsx("h3",{id:"location-modal-title",className:`text-3xl font-semibold ${g}`,children:a.name}),E.jsxs("p",{className:`text-sm font-medium ${f.text}`,children:["(",a.rarity,")"]})]})]}),E.jsxs("div",{className:"space-y-3 text-sm text-slate-300 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-700/50 pr-2 flex-grow",children:[E.jsxs("div",{children:[E.jsx("h4",{className:"font-semibold text-yellow-500 mb-0.5",children:"Description:"}),E.jsx("div",{className:"leading-relaxed whitespace-pre-wrap",children:p}),C&&E.jsx("button",{onClick:v,disabled:T,className:"mt-2 text-xs bg-teal-700 hover:bg-teal-600 text-teal-200 font-semibold py-1 px-2.5 rounded-md transition-colors disabled:opacity-70 flex items-center","aria-label":`Learn more about ${a.name}`,children:T?E.jsxs(E.Fragment,{children:[E.jsx(ln,{className:"w-3 h-3 mr-1.5"})," Thinking..."]}):S})]}),a.environmentTags&&a.environmentTags.length>0&&E.jsxs("div",{children:[E.jsx("h4",{className:"font-semibold text-yellow-500 mb-1 mt-2",children:"Environment Tags:"}),E.jsx("div",{className:"flex flex-wrap gap-2",children:a.environmentTags.map((I,b)=>E.jsx("span",{className:"bg-sky-700 text-sky-200 px-2 py-0.5 rounded-full text-xs font-medium shadow",children:I},b))})]}),a.validExits&&a.validExits.length>0&&E.jsxs("div",{children:[E.jsx("h4",{className:"font-semibold text-yellow-500 mb-0.5 mt-2",children:"Valid Exits:"}),E.jsx("p",{className:"leading-relaxed",children:a.validExits.join(", ")})]})]}),E.jsx("button",{onClick:e,className:"mt-6 w-full bg-amber-600 hover:bg-amber-500 text-white font-semibold py-2.5 px-4 rounded-lg transition-colors","aria-label":`Confirm and close details for ${a.name}`,children:"Close"})]}),E.jsx("style",{children:`
        @keyframes modal-appear-animation {
          to {
            transform: scale(1);
            opacity: 1;
          }
        }
      `})]})},nw=({imageUrl:a,altText:e,onClose:t})=>E.jsxs("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center p-4 z-[60]","aria-modal":"true",role:"dialog",onClick:t,children:[E.jsxs("div",{className:"relative bg-slate-900 p-2 rounded-lg shadow-2xl max-w-3xl max-h-[90vh] w-auto h-auto flex items-center justify-center transform transition-all duration-300 ease-out scale-95 opacity-0 animate-modal-appear",onClick:o=>o.stopPropagation(),style:{animationName:"modal-appear-animation",animationDuration:"0.3s",animationFillMode:"forwards"},"aria-labelledby":"image-view-modal-title",children:[E.jsx("button",{onClick:t,className:"absolute top-2 right-2 text-slate-300 hover:text-white bg-slate-800/70 hover:bg-slate-700 rounded-full p-1.5 leading-none z-10","aria-label":`Close image view for ${e}`,children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),E.jsx("img",{src:a,alt:e,className:"block max-w-full max-h-[85vh] object-contain rounded",style:{imageRendering:"pixelated"},"aria-describedby":"image-view-modal-title"}),E.jsx("h3",{id:"image-view-modal-title",className:"sr-only",children:e})]}),E.jsx("style",{children:`
        @keyframes modal-appear-animation {
          to {
            transform: scale(1);
            opacity: 1;
          }
        }
      `})]}),iw=({itemToViewInModal:a,onCloseItemModal:e,onItemDescriptionElaborated:t,npcToViewInModal:o,onCloseNpcModal:s,onNpcDescriptionElaborated:u,locationToViewInModal:f,onCloseLocationModal:g,selectedLocationCoordinateKeyForModal:h,onLocationDescriptionElaborated:p,characterData:v,imageUrlToView:T,imageAltTextToView:C,onCloseImageViewModal:S,onSelectImageForViewing:w})=>E.jsxs(E.Fragment,{children:[a&&v&&E.jsx(VA,{item:a,onClose:e,characterData:v,onDescriptionElaborated:t,onSelectImageForViewing:w}),o&&v&&E.jsx(YA,{npc:o,onClose:s,characterData:v,onDescriptionElaborated:u,onSelectImageForViewing:w}),f&&E.jsx(tw,{location:f,onClose:g,characterData:v,coordinateKey:h,onDescriptionElaborated:p,onSelectImageForViewing:w}),T&&C&&E.jsx(nw,{imageUrl:T,altText:C,onClose:S})]}),gr=({type:a,message:e,className:t=""})=>{const o="p-4 rounded-md text-sm";let s="";switch(a){case"error":s="bg-red-900/50 text-red-300 border border-red-700";break;case"success":s="bg-green-900/50 text-green-300 border border-green-700";break;case"warning":s="bg-yellow-900/50 text-yellow-300 border border-yellow-700";break;case"info":default:s="bg-sky-900/50 text-sky-300 border border-sky-700";break}return E.jsxs("div",{className:`${o} ${s} ${t}`,role:"alert",children:[E.jsx("p",{className:"font-medium",children:a.charAt(0).toUpperCase()+a.slice(1)}),E.jsx("p",{children:e})]})},aw={Head:{top:"15%",left:"50%",width:"25%",height:"20%"},Torso:{top:"40%",left:"50%",width:"30%",height:"30%"},"Left Arm":{top:"40%",left:"20%",width:"20%",height:"35%"},"Right Arm":{top:"40%",left:"80%",width:"20%",height:"35%"},"Left Leg":{top:"75%",left:"30%",width:"20%",height:"35%"},"Right Leg":{top:"75%",left:"70%",width:"20%",height:"35%"}},uh=a=>{if(!a)return"border-sky-500/30 hover:border-sky-400/70";switch(a){case"Common":return"border-slate-400";case"Uncommon":return"border-green-400";case"Rare":return"border-sky-400";case"Epic":return"border-purple-400";case"Legendary":return"border-amber-400";default:return"border-slate-500"}},ch=a=>a>70?"text-green-400":a>30?"text-yellow-400":"text-red-400",ow=({limbs:a,characterImageUrl:e,onApplyItemToLimb:t,isApplyingToLimbId:o,onUnequipItemFromLimb:s,visualStyle:u})=>{const[f,g]=Y.useState(null),[h,p]=Y.useState(null),v=Y.useRef(null),T=A=>{g(M=>M===A?null:A)};Y.useEffect(()=>{const A=M=>{v.current&&!v.current.contains(M.target)&&(Array.from(document.querySelectorAll("[data-limb-id]")).some(R=>R.contains(M.target)&&R.getAttribute("data-limb-id")===f)||g(null))};return f&&document.addEventListener("mousedown",A),()=>{document.removeEventListener("mousedown",A)}},[f]);const C=A=>{A.preventDefault(),A.dataTransfer.dropEffect="move"},S=(A,M)=>{A.preventDefault(),p(M)},w=A=>{A.preventDefault(),p(null)},I=(A,M)=>{A.preventDefault(),p(null),g(null);try{const L=A.dataTransfer.getData("application/json");if(L){const R=JSON.parse(L);R&&R.id?t(R.id,M):console.error("Dropped item data is invalid:",R)}}catch(L){console.error("Error parsing dropped item data:",L)}};if(!a||a.length===0)return E.jsx("p",{className:"text-slate-400 mt-3",children:"No limb data available."});const b={imageRendering:u==="Pixel Art"?"pixelated":"auto"};return E.jsxs("div",{className:"mt-3",children:[E.jsx("h3",{className:"text-xl font-semibold mb-3 text-sky-300",children:"Body Status"}),e?E.jsxs("div",{className:"relative w-full max-w-xs mx-auto aspect-square bg-slate-700/30 rounded-lg shadow-inner ring-1 ring-slate-600",children:[E.jsx("img",{src:e,alt:"Player Character",className:"w-full h-full object-contain",style:b}),a.map(A=>{const M=aw[A.name]||{top:"50%",left:"50%",width:"20%",height:"20%"},L=f===A.id,R=o===`${A.id}`||o&&o.endsWith(`-${A.id}`),$=h===A.id,V=A.equippedItems&&A.equippedItems.length>0,Q=V?A.equippedItems[A.equippedItems.length-1]:null;let te=`absolute rounded-sm focus:outline-none focus:ring-2 focus:ring-sky-400 transition-all duration-150 ease-in-out border-2 ${uh(Q==null?void 0:Q.rarity)}`;return $?te+=" bg-sky-500/30 ring-2 ring-sky-400 scale-105":L?te+=` ${V?"bg-opacity-30":"bg-sky-600/20"}`:V&&(te+=" shadow-md"),E.jsxs(cr.Fragment,{children:[E.jsxs("button",{type:"button","data-limb-id":A.id,className:te,style:{top:M.top,left:M.left,width:M.width,height:M.height,transform:"translate(-50%, -50%)"},onClick:()=>T(A.id),onDragOver:C,onDragEnter:F=>S(F,A.id),onDragLeave:w,onDrop:F=>I(F,A.id),"aria-label":`View status for ${A.name}. ${A.status}. Health: ${A.health}HP. ${V?`Equipped: ${A.equippedItems.map(F=>F.name).join(", ")}.`:""} Drop an item here to use on this limb.`,title:`${A.name}: ${A.status} (${A.health}HP)${V?`. Equipped: ${A.equippedItems.map(F=>`${F.name} (${F.rarity})`).join(", ")}`:""}. Drag item to use.`,children:[R&&E.jsx(ln,{className:"w-4 h-4 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-sky-300"}),V&&!R&&E.jsxs("div",{className:"w-full h-full flex items-center justify-center overflow-hidden p-0.5",children:[A.equippedItems.slice(0,3).map((F,ae)=>E.jsx("img",{src:F.iconUrl,alt:F.name,className:`w-1/2 h-1/2 object-contain opacity-80 ${A.equippedItems.length>1?"max-w-[50%] max-h-[50%]":""} ${ae>0?"ml-[-10%]":""}`,title:F.name,style:b},F.id)),A.equippedItems.length>3&&E.jsxs("span",{className:"text-xs text-slate-200 bg-slate-800/70 px-1 rounded-sm absolute bottom-0 right-0",children:["+",A.equippedItems.length-3]})]}),E.jsx("span",{className:"sr-only",children:A.name})]}),L&&!$&&E.jsxs("div",{ref:v,className:"absolute p-3 rounded-md bg-slate-800 shadow-xl ring-1 ring-slate-600 z-10 text-left",style:{top:`calc(${M.top} - 10px)`,left:`calc(${M.left} + ${parseFloat(M.width||"0")/2}px + 5px)`,minWidth:"200px"},role:"status",children:[E.jsx("button",{onClick:()=>g(null),className:"absolute top-1.5 right-1.5 text-slate-400 hover:text-slate-200 text-lg leading-none","aria-label":"Close limb status",children:""}),E.jsx("h5",{className:"text-md font-semibold text-sky-300 mb-1",children:A.name}),E.jsxs("p",{className:"text-xs text-slate-300",children:["Status: ",A.status]}),E.jsxs("p",{className:`text-xs font-medium ${ch(A.health)} mb-2`,children:["Health: ",A.health," / 100 HP"]}),A.equippedItems&&A.equippedItems.length>0&&E.jsxs("div",{className:"mt-2 pt-2 border-t border-slate-700",children:[E.jsx("h6",{className:"text-sm font-medium text-amber-400 mb-1",children:"Equipped Items:"}),A.equippedItems.map(F=>E.jsx("div",{className:"mb-2",children:E.jsxs("div",{className:"flex items-center justify-between",children:[E.jsxs("div",{className:"flex items-center",children:[E.jsx("img",{src:F.iconUrl,alt:F.name,className:"w-6 h-6 mr-2 rounded bg-slate-700 p-0.5",style:b}),E.jsxs("span",{className:"text-xs text-slate-300",children:[F.name," (",F.rarity,")"]})]}),E.jsx("button",{onClick:()=>{s(A.id,F.id),A.equippedItems&&A.equippedItems.length===1&&g(null)},className:"bg-red-700 hover:bg-red-600 text-white text-[0.65rem] font-semibold py-0.5 px-1.5 rounded-sm transition-colors","aria-label":`Unequip ${F.name} from ${A.name}`,children:"Unequip"})]})},F.id))]})]})]},A.id)})]}):E.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:a.map(A=>{const M=A.equippedItems&&A.equippedItems.length>0?A.equippedItems[A.equippedItems.length-1]:null;return E.jsxs("div",{className:`bg-slate-700 p-3 rounded-md shadow ring-1 ${uh(M==null?void 0:M.rarity)} transition-colors ${h===A.id?"bg-sky-700 ring-sky-500":""}`,role:"status","aria-labelledby":`limb-name-${A.id}`,"aria-describedby":`limb-status-${A.id} limb-health-${A.id}`,onDragOver:C,onDragEnter:L=>S(L,A.id),onDragLeave:w,onDrop:L=>I(L,A.id),onClick:()=>T(A.id),children:[E.jsx("h4",{id:`limb-name-${A.id}`,className:"text-md font-medium text-sky-400 mb-0.5",children:A.name}),E.jsxs("p",{id:`limb-status-${A.id}`,className:"text-slate-300 text-xs",children:["Status: ",A.status]}),E.jsxs("p",{id:`limb-health-${A.id}`,className:`text-xs font-medium ${ch(A.health)}`,children:["Health: ",A.health," / 100 HP"]}),A.equippedItems&&A.equippedItems.length>0&&E.jsxs("p",{className:"text-xs text-amber-400 mt-1",children:["Equipped: ",A.equippedItems.map(L=>`${L.name} (${L.rarity})`).join(", ")]}),o&&o.endsWith(`-${A.id}`)&&E.jsx(ln,{className:"w-4 h-4 ml-2 inline-block text-sky-300"}),f===A.id&&A.equippedItems&&A.equippedItems.length>0&&E.jsx("div",{className:"mt-2 pt-2 border-t border-slate-600 space-y-1",children:A.equippedItems.map(L=>E.jsxs("button",{onClick:R=>{R.stopPropagation(),s(A.id,L.id),A.equippedItems&&A.equippedItems.length===1&&g(null)},className:"w-full bg-red-600 hover:bg-red-500 text-white text-xs font-semibold py-1 px-2 rounded-md transition-colors","aria-label":`Unequip ${L.name} from ${A.name}`,children:["Unequip ",L.name]},L.id))})]},A.id)})})]})},rw=a=>{if(!a)return"border-transparent";switch(a){case"Common":return"border-slate-500";case"Uncommon":return"border-green-500";case"Rare":return"border-sky-500";case"Epic":return"border-purple-500";case"Legendary":return"border-amber-500";default:return"border-slate-600"}},sw=({imageUrl:a,imageAltText:e,onSelectLocationForModal:t,locationData:o,currentCoordinates:s,isEventActive:u,talkingToNPC:f,onDropItemOnNpcImage:g,visualStyle:h})=>{const[p,v]=Y.useState(!1),T=()=>{if(!u&&o){const R=`${s.x},${s.y}`;t(o,R)}},C=R=>{R.preventDefault(),f?R.dataTransfer.dropEffect="move":R.dataTransfer.dropEffect="none"},S=R=>{R.preventDefault(),f&&v(!0)},w=R=>{R.preventDefault(),v(!1)},I=async R=>{if(R.preventDefault(),v(!1),!!f)try{const $=R.dataTransfer.getData("application/json");if($){const V=JSON.parse($);V&&V.id&&f?await g(V,f):console.error("Dropped item data is invalid or NPC object missing:",V,f)}}catch($){console.error("Error parsing dropped item data for NPC:",$)}},b=u?"border-purple-500 shadow-lg shadow-purple-500/50":f?lw(f.rarity):o?rw(o.rarity):"border-transparent",A=f?`Drag item here to give to ${f.name}`:u?e:o?`Click to view details for ${e} (${o.rarity})`:e;let M=`flex justify-center items-center aspect-square p-1 rounded-lg border-4 ${b} bg-slate-700/20 relative transition-all duration-150`;f&&p&&(M+=" ring-4 ring-emerald-500 scale-105 shadow-emerald-500/50");const L={imageRendering:h==="Pixel Art"?"pixelated":"auto"};return E.jsx("div",{className:M,onDragOver:f?C:void 0,onDragEnter:f?S:void 0,onDragLeave:f?w:void 0,onDrop:f?I:void 0,children:E.jsx("button",{type:"button",onClick:T,className:"w-full h-full focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-opacity-75 rounded-md overflow-hidden","aria-label":u||f?e:`View details for ${e}`,disabled:u&&!o,title:A,children:E.jsx("img",{src:a,alt:e,"aria-label":`Visual representation of ${e}`,className:"max-w-full max-h-full h-auto w-auto rounded-sm shadow-md object-contain pointer-events-none",style:L})})})},lw=a=>{if(!a)return"border-slate-400";switch(a){case"Common":return"border-slate-500";case"Uncommon":return"border-green-500";case"Rare":return"border-sky-500";case"Epic":return"border-purple-500";case"Legendary":return"border-amber-500";default:return"border-slate-600"}},uw=a=>{switch(a){case"Common":return"border-slate-500 hover:border-slate-400";case"Uncommon":return"border-green-500 hover:border-green-400";case"Rare":return"border-sky-500 hover:border-sky-400";case"Epic":return"border-purple-500 hover:border-purple-400";case"Legendary":return"border-amber-500 hover:border-amber-400";default:return"border-slate-600 hover:border-slate-500"}},cw=({items:a,onPickupItem:e,isPickingUpItemId:t,onSelectItemForModal:o})=>a===null?E.jsx("p",{className:"text-slate-400 italic",children:"You haven't thoroughly searched this area for items yet. Try 'look around' or 'examine area'."}):a.length===0?E.jsx("p",{className:"text-slate-400 italic",children:"You look around but find no distinct items of interest here."}):E.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:a.map(s=>{const u=t===s.id,f=uw(s.rarity);return E.jsxs("div",{className:`bg-slate-700 p-3 rounded-lg shadow-md flex flex-col items-center text-center group relative min-h-[12rem] border-2 ${f} transition-colors`,"aria-label":`Item: ${s.name}, Rarity: ${s.rarity}`,children:[E.jsxs("button",{type:"button",onClick:()=>o(s),className:"w-full flex flex-col items-center focus:outline-none focus:ring-2 focus:ring-red-400 rounded-md p-1 flex-grow","aria-label":`View details for ${s.name}`,children:[E.jsx("img",{src:s.iconUrl,alt:`${s.name} icon`,className:"w-20 h-20 md:w-24 md:h-24 object-contain mb-2 rounded bg-slate-600/50 p-1 group-hover:scale-105 transition-transform"}),E.jsx("h4",{className:"text-base font-medium text-red-400 group-hover:text-red-300 mb-1",children:s.name}),E.jsxs("p",{className:"text-sm text-slate-400 overflow-hidden overflow-ellipsis whitespace-nowrap max-w-full",title:`${s.itemTypeGuess} - Rarity: ${s.rarity}`,children:[s.itemTypeGuess," (",s.rarity,")"]})]}),E.jsx("button",{onClick:g=>{g.stopPropagation(),e(s.id)},disabled:u||!!t,className:"mt-auto w-full bg-emerald-600 hover:bg-emerald-500 text-white text-sm font-semibold py-1.5 px-2.5 rounded-md transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-emerald-400 focus:ring-opacity-75 disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center","aria-label":`Pick up ${s.name}`,children:u?E.jsxs(E.Fragment,{children:[E.jsx(ln,{className:"w-4 h-4 mr-1.5"}),"Taking..."]}):"Pick Up"})]},s.id)})}),dw=4,dh=a=>{switch(a){case"Common":return{border:"border-slate-500",hoverBorder:"hover:border-slate-400",bg:"bg-slate-500",text:"text-slate-100"};case"Uncommon":return{border:"border-green-500",hoverBorder:"hover:border-green-400",bg:"bg-green-500",text:"text-green-100"};case"Rare":return{border:"border-sky-500",hoverBorder:"hover:border-sky-400",bg:"bg-sky-500",text:"text-sky-100"};case"Epic":return{border:"border-purple-500",hoverBorder:"hover:border-purple-400",bg:"bg-purple-500",text:"text-purple-100"};case"Legendary":return{border:"border-amber-500",hoverBorder:"hover:border-amber-400",bg:"bg-amber-500",text:"text-amber-100"};default:return{border:"border-slate-600",hoverBorder:"hover:border-slate-500",bg:"bg-slate-600",text:"text-slate-100"}}},fw=({items:a,onUseItem:e,isUsingItemId:t,onSelectItemForModal:o,craftingSlots:s,isApplyingToLimbId:u})=>{const[f,g]=Y.useState(null),{characterData:h}=wn(),p=(b,A)=>{b.dataTransfer.setData("application/json",JSON.stringify(A)),b.dataTransfer.effectAllowed="move",g(A.id);const M=document.createElement("div");M.style.position="absolute",M.style.top="-1000px",M.style.padding="0.5rem",M.style.borderRadius="0.375rem",M.style.display="flex",M.style.alignItems="center",M.style.gap="0.5rem",M.style.opacity="1",M.style.fontSize="0.875rem";const L=dh(A.rarity);M.style.backgroundColor=fh(L.bg||"bg-slate-600"),M.style.color=fh(L.text||"text-slate-100");const R=document.createElement("img");R.src=A.iconUrl,R.alt=A.name,R.style.width="2rem",R.style.height="2rem",R.style.objectFit="contain",R.style.borderRadius="0.25rem",M.appendChild(R);const $=document.createElement("span");$.textContent=A.name,$.style.fontWeight="500",M.appendChild($),document.body.appendChild(M),b.dataTransfer.setDragImage(M,20,20),setTimeout(()=>{document.body.contains(M)&&document.body.removeChild(M)},0)},v=()=>{g(null)},T=u?u.split("-")[0]:null,C=new Set(s.filter(Boolean).map(b=>b.id)),S=new Set(((h==null?void 0:h.limbs)||[]).flatMap(b=>b.equippedItems||[]).map(b=>b.id)),w=a.filter(b=>!(C.has(b.id)||b.id===T||S.has(b.id)));Y.useEffect(()=>{f&&w.some(b=>b.id===f)&&g(null)},[w,f]);const I=Array(dw).fill(null);return E.jsxs("div",{className:"mt-6",children:[E.jsx("h3",{id:"inventory-heading",className:"text-2xl font-semibold mb-4 text-red-400",children:"Your Inventory"}),a.length===0&&!C.size&&!T&&!S.size?E.jsx("p",{className:"text-slate-400 italic text-center col-span-full py-4",children:"Your backpack feels light... too light. It's empty."}):E.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[I.map((b,A)=>{const M=w[A];if(M){const L=t===M.id,R=M.id===f,$=dh(M.rarity),V=R?{opacity:.05,transform:"scale(0.95)",transition:"opacity 0.1s ease-out, transform 0.1s ease-out"}:{transition:"opacity 0.1s ease-in, transform 0.1s ease-in"};return E.jsxs("div",{draggable:!L,onDragStart:Q=>!L&&p(Q,M),onDragEnd:v,style:V,className:`bg-slate-700/70 p-3 rounded-lg shadow-md flex flex-col items-center text-center group relative min-h-[12rem] border-2 ${$.border} ${$.hoverBorder} transition-all duration-150 ease-out hover:shadow-red-500/30 ${!R&&!L?"cursor-grab":""} ${R?"cursor-grabbing":""} ${L?"opacity-50 cursor-default":""}`,"aria-label":`Inventory item: ${M.name}, Rarity: ${M.rarity}. ${L?"":"Draggable."}`,title:L?M.name:"Drag to use on self/limbs or combine in crafting. Click to view details.",children:[E.jsxs("button",{type:"button",onClick:()=>!R&&o(M),disabled:R||L,className:"w-full flex flex-col items-center focus:outline-none focus:ring-2 focus:ring-red-400 rounded-md p-1 flex-grow","aria-label":`View details for ${M.name}`,children:[E.jsx("img",{src:M.iconUrl,alt:`${M.name} icon`,className:"w-20 h-20 md:w-24 md:h-24 object-contain mb-2 rounded bg-slate-600/50 p-1 pointer-events-none"}),E.jsx("h4",{className:"text-base font-medium text-red-400 mb-1 pointer-events-none",children:M.name}),E.jsxs("p",{className:"text-sm text-slate-400 overflow-hidden overflow-ellipsis whitespace-nowrap max-w-full pointer-events-none",title:`${M.itemTypeGuess} - Rarity: ${M.rarity}`,children:[M.itemTypeGuess," (",M.rarity,")"]})]}),E.jsx("button",{onClick:Q=>{Q.stopPropagation(),R||e(M.id)},disabled:L||!!t||R,className:"mt-auto w-full bg-rose-600 hover:bg-rose-500 text-white text-sm font-semibold py-1.5 px-2.5 rounded-md transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-rose-400 focus:ring-opacity-75 disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center","aria-label":`Use ${M.name}`,children:L?E.jsxs(E.Fragment,{children:[E.jsx(ln,{className:"w-4 h-4 mr-1.5"}),"Using..."]}):"Use"})]},M.id)}else return E.jsx("div",{className:"bg-slate-700/20 p-3 rounded-lg shadow-inner min-h-[12rem] border-2 border-dashed border-slate-600 flex items-center justify-center","aria-label":"Empty inventory slot",children:E.jsx("span",{className:"text-slate-500 text-xs italic",children:"Empty Slot"})},`empty-slot-${A}`)}),w.length===0&&(C.size>0||!!T||S.size>0)&&E.jsx("p",{className:"text-slate-400 italic text-center col-span-full py-4",children:"All inventory items are currently in use (crafting/equipping) or all slots are empty."})]})]})},fh=a=>({"bg-slate-500":"#64748b","text-slate-100":"#f1f5f9","bg-green-500":"#22c55e","text-green-100":"#dcfce7","bg-sky-500":"#0ea5e9","text-sky-100":"#e0f2fe","bg-purple-500":"#a855f7","text-purple-100":"#f3e8ff","bg-amber-500":"#f59e0b","text-amber-100":"#fffbeb","bg-slate-600":"#475569"})[a]||"#475569",mh=a=>{switch(a){case"Common":return"border-slate-500";case"Uncommon":return"border-green-500";case"Rare":return"border-sky-500";case"Epic":return"border-purple-500";case"Legendary":return"border-amber-500";default:return"border-slate-600"}},ph=a=>{switch(a){case"Common":return"hover:border-slate-400";case"Uncommon":return"hover:border-green-400";case"Rare":return"hover:border-sky-400";case"Epic":return"hover:border-purple-400";case"Legendary":return"hover:border-amber-400";default:return"hover:border-slate-500"}},mw=({craftingSlots:a,playerInventory:e,onAddItemToSlot:t,onRemoveItemFromSlot:o,onAttemptCraft:s,isCrafting:u})=>{const[f,g]=Y.useState(!1),[h,p]=Y.useState(null),[v,T]=Y.useState(null),C=R=>{p(R),g(!0)},S=R=>{h!==null&&t(R,h),g(!1),p(null)},w=a.some(R=>R!==null)&&!u,I=e.filter(R=>!a.some($=>($==null?void 0:$.id)===R.id)),b=R=>{R.preventDefault(),R.dataTransfer.dropEffect="move"},A=(R,$)=>{R.preventDefault(),a[$]===null&&T($)},M=R=>{R.preventDefault(),T(null)},L=(R,$)=>{if(R.preventDefault(),T(null),a[$]===null)try{const V=R.dataTransfer.getData("application/json");if(V){const Q=JSON.parse(V);if(a.some(te=>(te==null?void 0:te.id)===Q.id))return;Q&&Q.id?t(Q,$):console.error("Dropped item data is invalid for crafting slot:",Q)}}catch(V){console.error("Error parsing dropped item data for crafting slot:",V)}};return E.jsxs("div",{className:"mt-6",children:[E.jsx("h3",{className:"text-2xl font-semibold mb-4 text-purple-400",children:"Crafting Area"}),E.jsx("div",{className:"grid grid-cols-3 gap-3 mb-4 p-3 bg-slate-700/50 rounded-lg ring-1 ring-slate-600",children:a.map((R,$)=>{const V=v===$&&!R,Q="aspect-square rounded-md flex flex-col items-center justify-center p-2 text-center transition-all duration-150 ease-in-out";let te=R?`${Q} border-2 ${mh(R.rarity)} bg-slate-600/50 ${ph(R.rarity)} cursor-default`:`${Q} border-2 border-dashed border-slate-500 hover:border-purple-400 hover:bg-slate-700 cursor-pointer`;return V&&(te=`${Q} border-2 border-purple-500 bg-purple-600/30 ring-2 ring-purple-400 scale-105`),E.jsx("div",{className:te,onClick:()=>!R&&C($),onDragOver:b,onDragEnter:F=>A(F,$),onDragLeave:M,onDrop:F=>L(F,$),role:"button",tabIndex:0,"aria-label":R?`Crafting slot ${$+1} contains ${R.name} (${R.rarity}). Click to remove.`:`Crafting slot ${$+1} is empty. Click or drag item to add.`,title:R?`Item: ${R.name}. Rarity: ${R.rarity}`:"Empty crafting slot. Add an item.",children:R?E.jsxs(E.Fragment,{children:[E.jsx("img",{src:R.iconUrl,alt:R.name,className:"w-12 h-12 object-contain mb-1 pointer-events-none"}),E.jsx("p",{className:"text-xs text-purple-300 truncate w-full pointer-events-none",children:R.name}),E.jsxs("p",{className:"text-[0.65rem] text-slate-400 truncate w-full pointer-events-none",children:["(",R.rarity,")"]}),E.jsx("button",{onClick:F=>{F.stopPropagation(),o($)},className:"mt-1 text-xs bg-red-700 hover:bg-red-600 px-2 py-0.5 rounded text-red-200","aria-label":`Remove ${R.name} from slot ${$+1}`,children:"Remove"})]}):E.jsx("span",{className:`text-slate-400 text-sm ${V?"text-purple-300 font-semibold":""}`,children:V?"Drop Here":"Empty Slot"})},$)})}),E.jsx("button",{onClick:s,disabled:!w||u,className:"w-full bg-purple-600 hover:bg-purple-500 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-opacity-75 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center","aria-label":"Attempt to craft items in slots",children:u?E.jsxs(E.Fragment,{children:[E.jsx(ln,{className:"w-5 h-5 mr-2"}),"Crafting..."]}):"Craft Items"}),f&&h!==null&&E.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50","aria-modal":"true",role:"dialog",children:E.jsxs("div",{className:"bg-slate-800 p-6 rounded-lg shadow-xl max-w-md w-full ring-1 ring-slate-700",children:[E.jsxs("h4",{className:"text-xl font-semibold mb-4 text-purple-300",children:["Select an Item for Slot ",h+1]}),I.length>0?E.jsx("div",{className:"grid grid-cols-3 gap-3 max-h-60 overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-700/50",children:I.map(R=>E.jsxs("button",{onClick:()=>S(R),className:`p-2 bg-slate-700 hover:bg-purple-600 rounded-md flex flex-col items-center text-center transition-colors border-2 ${mh(R.rarity)} ${ph(R.rarity)}`,"aria-label":`Select ${R.name} (${R.rarity})`,children:[E.jsx("img",{src:R.iconUrl,alt:R.name,className:"w-12 h-12 object-contain mb-1"}),E.jsx("span",{className:"text-xs text-slate-300 truncate w-full",children:R.name}),E.jsxs("span",{className:"text-[0.65rem] text-slate-400 truncate w-full",children:["(",R.rarity,")"]})]},R.id))}):E.jsx("p",{className:"text-slate-400",children:"No available items in inventory to add."}),E.jsx("button",{onClick:()=>g(!1),className:"mt-6 w-full bg-slate-600 hover:bg-slate-500 text-white font-semibold py-2 px-4 rounded-lg transition-colors","aria-label":"Close item selection",children:"Cancel"})]})})]})},pw=a=>{switch(a){case"Common":return{border:"border-slate-500 hover:border-slate-400"};case"Uncommon":return{border:"border-green-500 hover:border-green-400"};case"Rare":return{border:"border-sky-500 hover:border-sky-400"};case"Epic":return{border:"border-purple-500 hover:border-purple-400",shadow:"shadow-purple-500/30"};case"Legendary":return{border:"border-amber-500 hover:border-amber-400",shadow:"shadow-amber-500/30"};default:return{border:"border-slate-600 hover:border-slate-500"}}},gw=a=>{switch(a){case"Common":return"text-slate-300";case"Uncommon":return"text-green-300";case"Rare":return"text-sky-300";case"Epic":return"text-purple-300";case"Legendary":return"text-amber-300";default:return"text-slate-400"}},hw=({npcs:a,onStartConversation:e,onSelectNPCForModal:t,isInteracting:o,isEventActive:s,currentEventDetails:u,visualStyle:f})=>{var p,v;let g=[];if(a===null&&!s)return E.jsx("p",{className:"text-slate-400 italic",children:"You haven't looked for anyone here yet. Try 'look for people' or 'search for NPCs'."});if(s){new Set(((p=u==null?void 0:u.npcEffects)==null?void 0:p.map(C=>C.npcIdTargeted))||[]),g=(a||[]).filter(C=>{var w;if(C.isDefeated)return!1;if(C.isEventSpawned)return!0;const S=(w=u==null?void 0:u.npcEffects)==null?void 0:w.find(I=>I.npcIdTargeted===C.id);return S?S.isHiddenDuringEvent===!1||S.isHiddenDuringEvent===void 0:!1});const T=(v=u==null?void 0:u.locationEffects)==null?void 0:v.newTemporaryNpc;T&&g.find(C=>C.isEventSpawned&&C.name===T.name)}else g=(a||[]).filter(T=>!T.isDefeated);if(g.length===0){const T=s?"The area seems devoid of other people, or they are obscured by the ongoing event.":"You look around but see no one else of note here.";return E.jsx("p",{className:"text-slate-400 italic",children:T})}const h={imageRendering:f==="Pixel Art"?"pixelated":"auto"};return E.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:g.map(T=>{const C=pw(T.rarity),S=gw(T.rarity),w=T.isEventSpawned?"text-purple-400":"text-sky-400";return E.jsxs("div",{className:`bg-slate-700 rounded-lg shadow-md overflow-hidden group relative aspect-[3/4] border-2 ${C.border} ${C.shadow?`hover:${C.shadow}`:""} transition-all duration-150 ease-in-out cursor-pointer`,"aria-label":`Character: ${T.name}, Rarity: ${T.rarity}`,onClick:()=>t(T),children:[E.jsx("img",{src:T.iconUrl,alt:`${T.name}`,className:"absolute inset-0 w-full h-full object-cover transition-transform duration-300 ease-in-out group-hover:scale-105 pointer-events-none",style:h}),E.jsxs("div",{className:"absolute inset-0 flex flex-col justify-end p-3 bg-gradient-to-t from-slate-900/80 via-slate-900/50 to-transparent",children:[E.jsxs("button",{type:"button",onClick:I=>{I.stopPropagation(),t(T)},className:"w-full text-left focus:outline-none mb-2","aria-label":`View details for ${T.name}`,children:[E.jsx("h4",{className:`text-lg font-semibold ${w} group-hover:underline mb-0.5 truncate`,title:T.name,children:T.name}),E.jsxs("p",{className:"text-xs text-slate-300 overflow-hidden overflow-ellipsis whitespace-nowrap max-w-full",title:T.description,children:[T.description.length>30?T.description.substring(0,27)+"...":T.description,E.jsxs("span",{className:`ml-1 font-medium ${S}`,children:["(",T.rarity,")"]})]})]}),E.jsx("button",{onClick:I=>{I.stopPropagation(),e(T.id)},disabled:o,className:"w-full bg-cyan-600 hover:bg-cyan-500 text-white text-sm font-semibold py-2 px-3 rounded-md transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 ring-offset-2 ring-offset-black/50 focus:ring-cyan-400 disabled:opacity-70 disabled:cursor-not-allowed","aria-label":`Talk to ${T.name}`,children:"Talk"})]})]},T.id)})})},gh=3,yw=({visitedLocations:a,currentCoordinates:e,onSelectLocationForModal:t,visualStyle:o})=>{var f,g,h,p;const s=[],u={imageRendering:o==="Pixel Art"?"pixelated":"auto"};for(let v=gh;v>=-3;v--){const T=[];for(let C=-3;C<=gh;C++){const S=e.x+C,w=e.y+v,I=`${S},${w}`,b=a.get(I),A=S===e.x&&w===e.y,M=[];let L="w-14 h-14 border border-slate-700 flex items-center justify-center relative text-xs",R=`${S},${w}`,$=`Location at ${S},${w}`;if(b){L+=" bg-slate-600/50",R=`${b.location.name} (${b.location.rarity}) (${S},${w})`,$=`View details for ${b.location.name} at ${S},${w}`,M.push(E.jsx("img",{src:b.location.imageUrl,alt:b.location.name,className:"w-full h-full object-contain pointer-events-none",style:u},`${I}-img`));const V=b.location.validExits||[],Q="absolute bg-lime-500/80 pointer-events-none",te={north:`${S},${w+1}`,south:`${S},${w-1}`,east:`${S+1},${w}`,west:`${S-1},${w}`};V.includes("north")&&M.push(E.jsx("div",{className:`${Q} h-1.5 w-4 top-0 left-1/2 -translate-x-1/2 rounded-b-sm`,title:`Exit North to ${((f=a.get(te.north))==null?void 0:f.location.name)||"Unexplored"}`},`${I}-exit-n`)),V.includes("south")&&M.push(E.jsx("div",{className:`${Q} h-1.5 w-4 bottom-0 left-1/2 -translate-x-1/2 rounded-t-sm`,title:`Exit South to ${((g=a.get(te.south))==null?void 0:g.location.name)||"Unexplored"}`},`${I}-exit-s`)),V.includes("east")&&M.push(E.jsx("div",{className:`${Q} w-1.5 h-4 top-1/2 right-0 -translate-y-1/2 rounded-l-sm`,title:`Exit East to ${((h=a.get(te.east))==null?void 0:h.location.name)||"Unexplored"}`},`${I}-exit-e`)),V.includes("west")&&M.push(E.jsx("div",{className:`${Q} w-1.5 h-4 top-1/2 left-0 -translate-y-1/2 rounded-r-sm`,title:`Exit West to ${((p=a.get(te.west))==null?void 0:p.location.name)||"Unexplored"}`},`${I}-exit-w`))}else L+=" bg-slate-800",M.push(E.jsx("span",{className:"text-slate-600 pointer-events-none",children:"?"},`${I}-fog`)),R=`Unexplored (${S},${w})`,$=`Unexplored area at ${S},${w}`;A?(L+=" ring-2 ring-amber-400 shadow-lg shadow-amber-500/30 z-10",M.push(E.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-amber-300 font-bold text-2xl pointer-events-none","aria-hidden":"true",children:""},`${I}-current-marker`))):b&&(L+=" ring-1 ring-slate-500 hover:ring-sky-400 transition-all"),T.push(E.jsx("button",{type:"button",className:`${L} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-700 ${b?"focus:ring-sky-500":"focus:ring-slate-500 cursor-default"}`,title:R,"aria-label":$,onClick:()=>b&&t(b.location,I),disabled:!b,children:M},I))}s.push(E.jsx("div",{className:"flex",children:T},`row-${v}`))}return E.jsx("div",{className:"flex flex-col items-center p-2 bg-slate-700/30 rounded-md shadow-inner",children:E.jsx("div",{className:"grid grid-cols-1 gap-0",children:s})})},vw=({overallHealth:a,currentEnergy:e,maxEnergy:t})=>{const o=Math.max(0,Math.min(100,a/100*100)),s=Math.max(0,Math.min(100,e/t*100)),u=f=>f>70?"bg-green-500":f>30?"bg-yellow-500":"bg-red-500";return E.jsxs("div",{className:"space-y-3 mb-4",children:[E.jsxs("div",{children:[E.jsxs("div",{className:"flex justify-between items-baseline mb-0.5",children:[E.jsx("h4",{className:"text-md font-semibold text-rose-400",children:"Overall Health"}),E.jsxs("span",{className:"text-sm text-rose-300 font-mono",children:[a," / 100 HP"]})]}),E.jsx("div",{className:"w-full bg-slate-600 rounded-full h-3.5 shadow-inner",children:E.jsx("div",{className:`h-3.5 rounded-full transition-all duration-300 ease-out ${u(o)}`,style:{width:`${o}%`},role:"progressbar","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100,"aria-label":`Overall health: ${a} out of 100`})})]}),E.jsxs("div",{children:[E.jsxs("div",{className:"flex justify-between items-baseline mb-0.5",children:[E.jsx("h4",{className:"text-md font-semibold text-sky-400",children:"Energy"}),E.jsxs("span",{className:"text-sm text-sky-300 font-mono",children:[e," / ",t," EN"]})]}),E.jsx("div",{className:"w-full bg-slate-600 rounded-full h-3.5 shadow-inner",children:E.jsx("div",{className:"bg-sky-500 h-3.5 rounded-full transition-all duration-300 ease-out",style:{width:`${s}%`},role:"progressbar","aria-valuenow":e,"aria-valuemin":0,"aria-valuemax":t,"aria-label":`Current energy: ${e} out of ${t}`})})]})]})},Tw={Combat:"Improves effectiveness in fights, influencing attack success and damage dealt.",Crafting:"Determines the quality and complexity of crafted items. Higher skill can result in rarer or more potent creations.",Survival:"Aids in navigating the world and enduring its challenges. May affect energy consumption during exploration.",Perception:"Increases the likelihood of finding hidden items or people, and discerning subtle details or lore.",Persuasion:"Enhances ability to influence NPCs through dialogue, potentially leading to more favorable outcomes.",Mobility:"Represents agility and ease of movement. Currently enhances narrative flavor, may impact future actions like evasion or traversing difficult terrain."},Cw=({skills:a})=>{const[e,t]=Y.useState(null),o=Y.useRef(null),s=Y.useRef({}),u=(f,g)=>{f.stopPropagation(),t(h=>(h==null?void 0:h.id)===g.id?null:g)};return Y.useEffect(()=>{const f=g=>{let h=!1;Object.values(s.current).forEach(p=>{p&&p.contains(g.target)&&(h=!0)}),o.current&&!o.current.contains(g.target)&&!h&&t(null)};return e&&document.addEventListener("mousedown",f),()=>{document.removeEventListener("mousedown",f)}},[e]),!a||a.length===0?E.jsx("p",{className:"text-slate-400 mt-3 text-sm italic",children:"No skill data available."}):E.jsxs("div",{className:"mt-4",children:[E.jsx("h3",{className:"text-xl font-semibold mb-3 text-teal-300",children:"Skills"}),E.jsx("div",{className:"space-y-3",children:a.map(f=>E.jsxs("div",{className:"bg-slate-600/40 p-2.5 rounded-md shadow-sm group relative",children:[E.jsxs("div",{className:"flex justify-between items-center mb-1",children:[E.jsxs("div",{className:"flex items-center",children:[E.jsx("span",{className:"text-sm font-medium text-teal-200",children:f.name}),E.jsx("button",{ref:g=>{s.current[f.id]=g},onClick:g=>u(g,f),className:"ml-2 text-teal-400 hover:text-teal-200 focus:outline-none p-0.5 rounded-full hover:bg-slate-700/50","aria-label":`More information about ${f.name}`,title:`Info about ${f.name}`,children:E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})})})]}),E.jsxs("span",{className:"text-xs text-teal-400 font-mono",children:["Lvl ",f.level]})]}),E.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2.5 shadow-inner",children:E.jsx("div",{className:"bg-teal-500 h-2.5 rounded-full transition-all duration-300 ease-out",style:{width:`${f.experienceToNextLevel>0?f.experience/f.experienceToNextLevel*100:f.level>0?100:0}%`},role:"progressbar","aria-valuenow":f.experience,"aria-valuemin":0,"aria-valuemax":f.experienceToNextLevel,"aria-label":`${f.name} experience: ${f.experience} out of ${f.experienceToNextLevel}`})}),E.jsxs("p",{className:"text-xs text-slate-400 text-right mt-0.5",children:[f.experience," / ",f.experienceToNextLevel>0?f.experienceToNextLevel:"MAX"," XP"]}),(e==null?void 0:e.id)===f.id&&E.jsxs("div",{ref:o,className:"absolute left-full top-0 ml-2 w-64 z-20 p-3 rounded-md bg-slate-800 shadow-xl ring-1 ring-slate-600 text-sm",role:"tooltip",children:[E.jsx("h4",{className:"font-semibold text-teal-200 mb-1.5",children:e.name}),E.jsx("p",{className:"text-slate-300 leading-snug",children:Tw[e.name]||e.description}),E.jsxs("p",{className:"text-xs text-slate-400 mt-2",children:["Current Level: ",e.level]})]})]},f.id))})]})},Ls={Legendary:5,Epic:4,Character_Self:3,Rare:3,Uncommon:2,Common:1,Lore:0},hh=a=>{if(!a)return"text-slate-400";switch(a){case"Common":return"text-slate-300";case"Uncommon":return"text-green-300";case"Rare":return"text-sky-300";case"Epic":return"text-purple-300";case"Legendary":return"text-amber-300";case"Lore":return"text-yellow-300";case"Character_Self":return"text-rose-300";default:return"text-slate-400"}},yh=a=>{if(!a)return"border-slate-600";switch(a){case"Common":return"border-slate-500";case"Uncommon":return"border-green-500";case"Rare":return"border-sky-500";case"Epic":return"border-purple-500";case"Legendary":return"border-amber-500";case"Lore":return"border-yellow-500";case"Character_Self":return"border-rose-500";default:return"border-slate-600"}},vh=a=>{switch(a){case"item":return"text-red-400";case"npc":return"text-sky-400";case"location":return"text-yellow-400";case"lore_hint":return"text-yellow-300";case"character":return"text-sky-400";default:return"text-slate-400"}},Ew=({memorableEntities:a,potentialDiscoveries:e,majorPlotPoints:t,onSelectKnowledgeEntry:o})=>{const[s,u]=Y.useState(null),f=p=>{u(v=>v===p?null:p)},g=Array.from(a.values()).filter(p=>p.type!=="lore_hint").sort((p,v)=>{const T=Ls[p.rarity]??0,C=Ls[v.rarity]??0;return C!==T?C-T:p.name.localeCompare(v.name)}),h=[...e].sort((p,v)=>{if(p.status!==v.status)return p.status==="mentioned"?-1:1;const T=Ls[p.rarityHint||"Lore"]??0,C=Ls[v.rarityHint||"Lore"]??0;return C!==T?C-T:p.name.localeCompare(v.name)});return E.jsxs("div",{className:"w-full text-sm",children:[E.jsx("h3",{id:"knowledge-archives-heading",className:"text-2xl font-semibold mb-4 text-indigo-300",children:"Knowledge Archives"}),E.jsxs("div",{className:"mb-3",children:[E.jsxs("button",{onClick:()=>f("entities"),className:"w-full text-left text-lg font-medium text-indigo-200 hover:text-indigo-100 focus:outline-none py-1.5 px-2 rounded bg-indigo-700/30 hover:bg-indigo-700/50 transition-colors","aria-expanded":s==="entities","aria-controls":"known-entities-content",children:["Known Entities (",g.length,")",E.jsx("span",{className:`float-right transform transition-transform ${s==="entities"?"rotate-180":""}`,children:""})]}),s==="entities"&&E.jsx("div",{id:"known-entities-content",className:"mt-2 space-y-1.5 max-h-48 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-700/50 pr-1",children:g.length>0?g.map(p=>E.jsxs("button",{onClick:()=>o(p.id,p.type),className:`w-full text-left p-1.5 rounded-md bg-slate-800/60 hover:bg-slate-700/80 border-l-2 ${yh(p.rarity)} transition-all focus:outline-none focus:ring-1 focus:ring-indigo-400`,title:`Click to view details for ${p.name}`,children:[E.jsxs("div",{className:"flex justify-between items-baseline",children:[E.jsx("span",{className:`font-medium ${vh(p.type)}`,children:p.name}),E.jsxs("span",{className:`text-xs ${hh(p.rarity)}`,children:["(",p.rarity,")"]})]}),E.jsx("p",{className:"text-xs text-slate-400 truncate",title:p.descriptionHint,children:p.descriptionHint})]},p.id)):E.jsx("p",{className:"text-slate-400 italic p-1.5",children:"No specific entities recorded yet."})})]}),E.jsxs("div",{className:"mb-3",children:[E.jsxs("button",{onClick:()=>f("discoveries"),className:"w-full text-left text-lg font-medium text-yellow-200 hover:text-yellow-100 focus:outline-none py-1.5 px-2 rounded bg-yellow-700/30 hover:bg-yellow-700/50 transition-colors","aria-expanded":s==="discoveries","aria-controls":"rumored-leads-content",children:["Leads & Discoveries (",e.length,")",E.jsx("span",{className:`float-right transform transition-transform ${s==="discoveries"?"rotate-180":""}`,children:""})]}),s==="discoveries"&&E.jsx("div",{id:"rumored-leads-content",className:"mt-2 space-y-1.5 max-h-48 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-700/50 pr-1",children:h.length>0?h.map(p=>{const v=p.rarityHint&&p.rarityHint!=="Lore"?p.rarityHint:p.rarityHint==="Lore"?"Lore Hint":"Unk. Rarity",T=hh(p.rarityHint||"Lore"),C=yh(p.rarityHint||"Lore");return E.jsxs("button",{onClick:()=>o(p.id,p.type,p.status),className:`w-full text-left p-1.5 rounded-md bg-slate-800/60 hover:bg-slate-700/80 border-l-2 ${C} transition-all focus:outline-none focus:ring-1 focus:ring-yellow-400 ${p.status==="discovered"?"opacity-70 hover:opacity-100":""}`,title:`Source: ${p.sourceTextSnippet}`,children:[E.jsxs("div",{className:"flex justify-between items-baseline",children:[E.jsxs("span",{className:`font-medium ${vh(p.type)}`,children:[p.name,p.status==="discovered"&&E.jsx("span",{className:"text-xs text-green-400 ml-1",children:"(Confirmed)"})]}),E.jsxs("span",{className:`text-xs ${T}`,children:["(",v,") - ",p.status==="discovered"?E.jsx("span",{className:"text-green-400",children:"Discovered"}):E.jsx("span",{className:"text-yellow-400",children:"Mentioned"})]})]}),E.jsx("p",{className:"text-xs text-slate-400 italic truncate",title:p.descriptionHint,children:p.descriptionHint})]},p.id)}):E.jsx("p",{className:"text-slate-400 italic p-1.5",children:"No active rumors or leads yet."})})]}),E.jsxs("div",{children:[E.jsxs("button",{onClick:()=>f("chronicle"),className:"w-full text-left text-lg font-medium text-purple-200 hover:text-purple-100 focus:outline-none py-1.5 px-2 rounded bg-purple-700/30 hover:bg-purple-700/50 transition-colors","aria-expanded":s==="chronicle","aria-controls":"chronicle-content",children:["Chronicle (",t.length,")",E.jsx("span",{className:`float-right transform transition-transform ${s==="chronicle"?"rotate-180":""}`,children:""})]}),s==="chronicle"&&E.jsx("div",{id:"chronicle-content",className:"mt-2 space-y-1.5 max-h-48 overflow-y-auto scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-700/50 pr-1",children:t.length>0?[...t].reverse().map(p=>E.jsxs("div",{className:"p-1.5 rounded-md bg-slate-800/60 border-l-2 border-purple-500",children:[E.jsxs("span",{className:"text-xs text-purple-300 block",children:[new Date(p.timestamp).toLocaleDateString()," - ",p.locationName||"Various Locations"]}),E.jsx("p",{className:"text-xs text-slate-300",children:p.summary})]},p.id)):E.jsx("p",{className:"text-slate-400 italic p-1.5",children:"The story is yet to unfold."})})]})]})},xw=({itemProps:a,npcProps:e,craftingProps:t,characterProps:o,onSelectLocationForModal:s,currentCoordinates:u,onSelectKnowledgeEntry:f,onDropItemOnNpcImage:g})=>{var Q,te;const{characterData:h,locationData:p,playerInventory:v,visitedLocations:T,memorableEntities:C,potentialDiscoveries:S,majorPlotPoints:w,isEventActive:I,currentEventImageUrl:b,currentEventDetails:A}=wn();if(!h||!p)return E.jsxs("div",{className:"w-full p-4 md:p-6 space-y-6 bg-slate-850 shadow-2xl rounded-lg ring-1 ring-slate-700 relative text-center",children:[E.jsx(ln,{className:"w-12 h-12 mx-auto text-sky-500"}),E.jsx("p",{className:"text-slate-300",children:"Loading game data..."})]});const M=a.locationItems!==null,L=e.locationNPCs!==null,R=I&&b?b:((Q=e.talkingToNPC)==null?void 0:Q.iconUrl)||p.imageUrl,$=I&&(A!=null&&A.eventTitle)?A.eventTitle:((te=e.talkingToNPC)==null?void 0:te.name)||p.name,V=h.visualStyle;return E.jsxs("div",{className:"w-full p-4 md:p-6 space-y-6 bg-slate-850 shadow-2xl rounded-lg ring-1 ring-slate-700 relative",children:[E.jsxs("h2",{id:"location-main-heading",className:"text-3xl font-bold text-center",children:[I&&(A!=null&&A.eventTitle)?E.jsxs("span",{className:"text-purple-400",children:["EVENT: ",A.eventTitle]}):e.talkingToNPC?E.jsxs(E.Fragment,{children:[E.jsx("span",{className:"text-slate-300",children:"Talking to: "}),E.jsx("span",{className:"text-sky-400",children:e.talkingToNPC.name})]}):E.jsx("span",{className:"text-yellow-400",children:p.name}),!I&&!e.talkingToNPC&&p&&E.jsxs("span",{className:"text-xl text-slate-400 ml-2",children:["(",p.rarity,")"]})]}),E.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 md:gap-8",children:[E.jsxs("div",{className:"space-y-6 lg:col-span-4",children:[E.jsxs("section",{"aria-labelledby":"character-info-heading",className:"bg-slate-700/30 p-4 rounded-lg shadow",children:[E.jsx("h3",{id:"character-info-heading",className:"text-2xl font-semibold mb-3 text-sky-400",children:h.characterName||"Character Status"}),E.jsxs("div",{className:"prose prose-sm prose-invert max-w-none prose-p:text-slate-300 my-3",children:[E.jsx("p",{className:"font-medium text-sky-300",children:"Concept:"}),E.jsx("p",{className:"italic text-sm",children:h.characterConcept})]}),E.jsx(ow,{limbs:h.limbs,characterImageUrl:h.characterImageUrl,onApplyItemToLimb:o.onApplyItemToLimb,isApplyingToLimbId:o.isApplyingToLimbId,onUnequipItemFromLimb:o.onUnequipItemFromLimb,visualStyle:V})]}),E.jsxs("section",{"aria-labelledby":"character-vitals-skills-heading",className:"bg-slate-700/30 p-4 rounded-lg shadow",children:[E.jsx("h3",{id:"character-vitals-skills-heading",className:"text-2xl font-semibold mb-3 text-teal-400 sr-only",children:"Vitals & Skills"}),E.jsx(vw,{overallHealth:o.overallHealth,currentEnergy:o.currentEnergy,maxEnergy:o.maxEnergy}),E.jsx(Cw,{skills:h.skills})]}),E.jsx("section",{"aria-labelledby":"knowledge-archives-heading",className:"bg-slate-700/30 p-4 rounded-lg shadow",children:E.jsx(Ew,{memorableEntities:C,potentialDiscoveries:S,majorPlotPoints:w,onSelectKnowledgeEntry:f})})]}),E.jsxs("div",{className:"lg:col-span-4 space-y-6",children:[E.jsxs("section",{"aria-labelledby":"location-visual-heading",className:"bg-slate-700/30 p-4 rounded-lg shadow relative",children:[E.jsx("h3",{id:"location-visual-heading",className:"text-2xl font-semibold mb-3 text-amber-300 sr-only",children:"Visuals"}),E.jsx(sw,{imageUrl:R,imageAltText:$,onSelectLocationForModal:s,locationData:I||e.talkingToNPC?null:p,currentCoordinates:u,isEventActive:I,talkingToNPC:e.talkingToNPC,onDropItemOnNpcImage:g,visualStyle:V}),!I&&p.environmentTags&&p.environmentTags.length>0&&!e.talkingToNPC&&E.jsxs("div",{className:"mt-4 text-center",children:[E.jsx("h4",{className:"text-md font-medium text-slate-400 mb-2",children:"Environment:"}),E.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:p.environmentTags.map((F,ae)=>E.jsx("span",{className:"bg-sky-700 text-sky-200 px-3 py-1 rounded-full text-xs font-medium shadow","aria-label":`Environment tag: ${F}`,children:F},ae))})]}),!I&&u&&!e.talkingToNPC&&E.jsxs("div",{className:"mt-2 text-center",children:[E.jsx("h4",{className:"text-md font-medium text-slate-400",children:"Coordinates:"}),E.jsxs("p",{className:"text-sm text-slate-300 tabular-nums",children:["(",u.x,", ",u.y,")"]})]}),!I&&p.validExits&&!e.talkingToNPC&&E.jsxs("div",{className:"mt-2 text-center",children:[E.jsx("h4",{className:"text-md font-medium text-slate-400",children:"Exits:"}),E.jsx("p",{className:"text-sm text-slate-300",children:p.validExits.length>0?p.validExits.join(", "):"None apparent"})]}),I&&(A==null?void 0:A.narration)&&E.jsxs("div",{className:"mt-2 text-center p-2 bg-slate-700/50 rounded",children:[E.jsx("h4",{className:"text-md font-medium text-purple-300 mb-1",children:"Event Details:"}),E.jsx("p",{className:"text-sm text-slate-300 italic",children:A.narration})]})]}),E.jsxs("section",{"aria-labelledby":"world-map-heading",className:"bg-slate-700/30 p-4 rounded-lg shadow",children:[E.jsx("h3",{id:"world-map-heading",className:"text-2xl font-semibold mb-3 text-lime-400",children:"World Map"}),E.jsx(yw,{visitedLocations:T,currentCoordinates:u,onSelectLocationForModal:s,visualStyle:V})]})]}),E.jsxs("div",{className:"space-y-6 lg:col-span-4",children:[E.jsxs("section",{"aria-labelledby":"location-items-heading",className:"bg-slate-700/30 p-4 rounded-lg shadow",children:[E.jsxs("div",{className:"flex justify-between items-center mb-4",children:[E.jsx("h3",{id:"location-items-heading",className:"text-2xl font-semibold text-red-400",children:"Items Here"}),E.jsx("button",{onClick:a.onTriggerLookForItems,disabled:I||a.isLoadingItems||M||!!e.talkingToNPC||h.isDefeated,className:"bg-emerald-700 hover:bg-emerald-600 text-white text-xs font-semibold py-1.5 px-3 rounded-md transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-emerald-500 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":M?"Items already searched/found":"Search for items in this area",children:a.isLoadingItems?E.jsx(ln,{className:"w-4 h-4"}):M?"Searched":"Search Area"})]}),a.isLoadingItems&&!M&&E.jsxs("div",{className:"flex items-center text-slate-400",children:[E.jsx(ln,{className:"w-5 h-5 mr-2 text-emerald-500"}),E.jsx("span",{children:"Searching for items..."})]}),a.itemsError&&!a.isLoadingItems&&E.jsx(gr,{type:"error",message:`Failed to load items: ${a.itemsError}`}),!a.isLoadingItems&&!a.itemsError&&E.jsx(cw,{items:a.locationItems,onPickupItem:a.onPickupItem,isPickingUpItemId:a.isPickingUpItemId,onSelectItemForModal:a.onSelectItemForModal})]}),E.jsxs("section",{"aria-labelledby":"location-npcs-heading",className:"bg-slate-700/30 p-4 rounded-lg shadow",children:[E.jsxs("div",{className:"flex justify-between items-center mb-4",children:[E.jsx("h3",{id:"location-npcs-heading",className:"text-2xl font-semibold text-sky-400",children:"People Here"}),E.jsx("button",{onClick:e.onTriggerLookForPeople,disabled:I||e.isLoadingNPCs||L||!!e.talkingToNPC||h.isDefeated,className:"bg-cyan-700 hover:bg-cyan-600 text-white text-xs font-semibold py-1.5 px-3 rounded-md transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-cyan-500 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":L?"People already searched/found":"Look for people in this area",children:e.isLoadingNPCs?E.jsx(ln,{className:"w-4 h-4"}):L?"Searched":"Look for People"})]}),e.isLoadingNPCs&&!L&&E.jsxs("div",{className:"flex items-center text-slate-400",children:[E.jsx(ln,{className:"w-5 h-5 mr-2 text-cyan-500"}),E.jsx("span",{children:"Looking for people..."})]}),e.npcsError&&!e.isLoadingNPCs&&E.jsx(gr,{type:"error",message:`Failed to find NPCs: ${e.npcsError}`}),!e.isLoadingNPCs&&!e.npcsError&&E.jsx(hw,{npcs:e.locationNPCs,onStartConversation:e.onStartConversation,onSelectNPCForModal:e.onSelectNPCForModal,isInteracting:!!e.talkingToNPC,isEventActive:I,currentEventDetails:A,visualStyle:V})]}),E.jsx("section",{"aria-labelledby":"player-inventory-heading",className:"bg-slate-700/30 p-4 rounded-lg shadow",children:E.jsx(fw,{items:v,onUseItem:o.onUseItem,isUsingItemId:o.isUsingItemId,onSelectItemForModal:a.onSelectItemForModal,craftingSlots:t.craftingSlots,isApplyingToLimbId:o.isApplyingToLimbId})}),E.jsx("section",{"aria-labelledby":"crafting-area-heading",className:"bg-slate-700/30 p-4 rounded-lg shadow",children:E.jsx(mw,{craftingSlots:t.craftingSlots,playerInventory:v,onAddItemToSlot:t.onAddItemToCraftingSlot,onRemoveItemFromSlot:t.onRemoveItemFromSlot,onAttemptCraft:t.onAttemptCraft,isCrafting:t.isCrafting})})]})]})]})},Sw=({onCustomStart:a,onQuickStart:e,isLoading:t,apiKeyMissing:o})=>{const[s,u]=Y.useState("Historical"),[f,g]=Y.useState(""),[h,p]=Y.useState("Pixel Art"),v="e.g., Being Plato orating in the Parthenon. OR A eunuch in the Chinese imperial court. OR A farmer in Cleopatra's age. OR A knight at King Arthur's table.",T="e.g., A lone cyborg scavenger in a neon-drenched metropolis. OR A young sorcerer discovering a hidden portal in an enchanted forest.",[C,S]=Y.useState(v);Y.useEffect(()=>{S(s==="Historical"?v:T)},[s]);const w=I=>{if(I.preventDefault(),!f.trim()){alert("Please describe your desired world and character.");return}a(s,f,h)};return E.jsxs("form",{onSubmit:w,className:"space-y-6",children:[E.jsxs("div",{children:[E.jsx("label",{htmlFor:"settingType",className:"block text-sm font-medium text-slate-300 mb-1",children:"Setting Type"}),E.jsxs("select",{id:"settingType",value:s,onChange:I=>u(I.target.value),className:"w-full bg-slate-700 text-slate-200 border border-slate-600 rounded-lg py-2.5 px-3 focus:ring-2 focus:ring-sky-500 focus:border-sky-500","aria-label":"Choose game setting type: Historical or Fictional",children:[E.jsx("option",{value:"Historical",children:"Historical"}),E.jsx("option",{value:"Fictional",children:"Fictional"})]})]}),E.jsxs("div",{children:[E.jsx("label",{htmlFor:"visualStyle",className:"block text-sm font-medium text-slate-300 mb-1",children:"Visual Style"}),E.jsxs("select",{id:"visualStyle",value:h,onChange:I=>p(I.target.value),className:"w-full bg-slate-700 text-slate-200 border border-slate-600 rounded-lg py-2.5 px-3 focus:ring-2 focus:ring-sky-500 focus:border-sky-500","aria-label":"Choose visual style",children:[E.jsx("option",{value:"Pixel Art",children:"Pixel Art"}),E.jsx("option",{value:"Anime",children:"Anime"}),E.jsx("option",{value:"Ink Painting",children:"Ink Painting"}),E.jsx("option",{value:"Low Poly",children:"Low Poly"}),E.jsx("option",{value:"Oil Painting",children:"Oil Painting"}),E.jsx("option",{value:"Water Painting",children:"Water Painting"})]})]}),E.jsxs("div",{children:[E.jsx("label",{htmlFor:"userWorldAndCharacterIdea",className:"block text-sm font-medium text-slate-300 mb-1",children:"Describe Your Desired World & Character"}),E.jsx("textarea",{id:"userWorldAndCharacterIdea",value:f,onChange:I=>g(I.target.value),placeholder:C,rows:4,className:"w-full bg-slate-700 text-slate-200 placeholder-slate-500 border border-slate-600 rounded-lg py-2.5 px-3 focus:ring-2 focus:ring-sky-500 focus:border-sky-500","aria-label":"Enter your desired world and character description",required:!0})]}),E.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[E.jsx("button",{type:"submit",disabled:t||o||!f.trim(),className:"flex-1 bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-emerald-400 disabled:opacity-50 disabled:cursor-not-allowed text-lg","aria-label":"Generate my custom world",children:"Generate My World"}),E.jsx("button",{type:"button",onClick:e,disabled:t||o||s==="Historical",className:"flex-1 bg-sky-600 hover:bg-sky-500 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-sky-400 disabled:opacity-50 disabled:cursor-not-allowed text-lg","aria-label":s==="Historical"?"Quick Start is disabled for Historical settings":"Start a new game with a random character and location",title:s==="Historical"?"For Historical settings, please describe your world and character.":"Quick Start (Random Fictional)",children:"Quick Start (Random)"})]})]})},bw=({isGlobalBlockingLoad:a,loadingMessage:e,error:t,gameStarted:o,apiKeyMissing:s,characterData:u,locationData:f,gameInterfaceProps:g,handleStartNewGame:h,handleCustomStartGame:p})=>a?E.jsx("div",{className:"p-4 w-full max-w-7xl mx-auto mt-8 md:mt-12",children:E.jsx("main",{children:E.jsxs("div",{className:"flex flex-col items-center justify-center p-10 bg-slate-800/70 rounded-lg shadow-xl",children:[E.jsx(ln,{className:"w-16 h-16 text-sky-500"}),E.jsx("p",{className:"mt-4 text-lg text-slate-300",children:e||"Loading..."})]})})}):t?E.jsx("div",{className:"p-4 w-full max-w-7xl mx-auto mt-8 md:mt-12",children:E.jsx("main",{children:E.jsxs("div",{className:"mb-6",children:[E.jsx(gr,{type:"error",message:t}),!o&&!s&&E.jsx("button",{onClick:h,className:"mt-6 w-full bg-red-600 hover:bg-red-500 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-75 flex items-center justify-center","aria-label":"Retry starting a new game",children:"Try Again"})]})})}):o?u&&f?E.jsx("section",{className:"w-full bg-slate-800 py-4 md:py-6 px-4 sm:px-6 lg:px-8",children:E.jsx(xw,{...g})}):E.jsx("div",{className:"p-4 w-full max-w-7xl mx-auto mt-8 md:mt-12",children:E.jsx("main",{children:E.jsxs("div",{className:"flex flex-col items-center justify-center p-10 bg-slate-800/70 rounded-lg shadow-xl",children:[E.jsx(ln,{className:"w-16 h-16 text-sky-500"}),E.jsx("p",{className:"mt-4 text-lg text-slate-300",children:"Preparing game world..."})]})})}):E.jsx("div",{className:"p-4 w-full max-w-2xl mx-auto mt-8 md:mt-12",children:E.jsx("main",{children:E.jsxs("div",{className:"bg-slate-800/70 shadow-2xl rounded-lg p-6 md:p-8 ring-1 ring-slate-700",children:[E.jsx("h2",{className:"text-3xl font-semibold mb-6 text-sky-300 text-center",children:"Create Your World"}),E.jsx(Sw,{onCustomStart:p,onQuickStart:h,isLoading:a,apiKeyMissing:s}),s&&E.jsx(gr,{type:"warning",message:"API Key is missing. Game generation might not work.",className:"mt-6"})]})})});function ny(){return null}const _w=({characterData:a,gameLog:e,onTryAgain:t})=>{const o={imageRendering:a.visualStyle==="Pixel Art"?"pixelated":"auto"};return E.jsxs("div",{className:"min-h-screen bg-slate-900 text-red-400 flex flex-col items-center justify-center p-8",children:[E.jsx("h1",{className:"text-6xl font-bold mb-4",children:"GAME OVER"}),E.jsxs("p",{className:"text-2xl mb-8 text-slate-300",children:[a.characterName," - ",a.characterConcept," has fallen."]}),E.jsx("img",{src:a.characterImageUrl||"",alt:"Defeated Character",className:"w-48 h-48 object-contain rounded-lg mb-8 opacity-70 grayscale",style:o}),E.jsxs("div",{className:"mb-6 max-h-60 overflow-y-auto p-4 bg-slate-800 rounded-md w-full max-w-2xl scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-700/50",children:[E.jsx("h2",{className:"text-xl text-slate-200 mb-2 text-center",children:"Final Log Entries:"}),e.slice(-10).map(s=>E.jsxs("div",{className:`text-sm ${s.type==="error"?"text-red-400":s.type==="game_event"?"text-emerald-400":s.type==="combat"?"text-orange-400":s.type==="system"?"text-sky-400":"text-slate-400"} mb-1`,children:[E.jsxs("span",{className:"text-slate-500 mr-2",children:["[",new Date(s.timestamp).toLocaleTimeString(),"]"]}),s.text]},s.id))]}),E.jsx("button",{onClick:t,className:"bg-sky-600 hover:bg-sky-500 text-white font-bold py-3 px-8 rounded-lg text-xl transition-colors","aria-label":"Start a new game",children:"Try Again?"}),E.jsx(ny,{})]})},Nw=({isGlobalBlockingLoad:a,loadingMessage:e,error:t,gameStarted:o,apiKeyMissing:s,characterData:u,locationData:f,gameLog:g,gameInterfaceProps:h,onQuickStart:p,onCustomStart:v,onTryAgain:T})=>u!=null&&u.isDefeated?E.jsx(_w,{characterData:u,gameLog:g,onTryAgain:T}):E.jsx(bw,{isGlobalBlockingLoad:a,loadingMessage:e,error:t,gameStarted:o,apiKeyMissing:s,characterData:u,locationData:f,gameInterfaceProps:h,handleStartNewGame:p,handleCustomStartGame:v}),Aw=({isLoading:a,loadingMessage:e,currentPhaseTitle:t,apiKeyMissing:o,isGeneratingEvent:s,eventLoadingMessage:u})=>{let f=t;return s&&u?f=u:a&&e&&(f=e),E.jsxs("div",{className:"w-full bg-slate-900/80 border-b border-slate-700/60 shadow-md relative",children:[E.jsxs("div",{className:"p-4 w-full max-w-7xl mx-auto",children:[E.jsxs("header",{className:"text-center",children:[E.jsx("h1",{className:"text-4xl font-bold text-sky-400 tracking-tight",children:"LostWorld"}),E.jsx("p",{className:`text-xl text-slate-400 mt-2 min-h-[1.75rem] ${s?"italic text-purple-300":a?"italic text-sky-300":""}`,children:f})]}),o&&E.jsx("div",{className:"w-full max-w-xl mt-4 mb-2 mx-auto",children:E.jsx(gr,{type:"error",message:"API_KEY is not set. Please configure the API_KEY environment variable for the application to work."})})]}),E.jsx("style",{children:".pixelated-render { image-rendering: pixelated; image-rendering: -moz-crisp-edges; image-rendering: crisp-edges; }"})]})},ww=({onSubmit:a,isProcessing:e})=>{const[t,o]=Y.useState(""),s=u=>{u.preventDefault(),t.trim()&&!e&&(a(t.trim()),o(""))};return E.jsxs("form",{onSubmit:s,className:"mt-4 flex items-center gap-3",children:[E.jsx("label",{htmlFor:"command-input",className:"sr-only",children:"Enter command"}),E.jsx("input",{id:"command-input",type:"text",value:t,onChange:u=>o(u.target.value),placeholder:"What do you do?",disabled:e,className:"flex-grow bg-slate-700 text-slate-200 placeholder-slate-500 border border-slate-600 rounded-lg py-2.5 px-4 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-shadow duration-150 ease-in-out shadow-sm disabled:opacity-70","aria-label":"Player command input",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false"}),E.jsx("button",{type:"submit",disabled:e||!t.trim(),className:"bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-2.5 px-6 rounded-lg transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-opacity-75 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center shadow-md hover:shadow-lg","aria-label":"Submit command",children:e?E.jsxs(E.Fragment,{children:[E.jsx(ln,{className:"w-5 h-5 mr-2"}),"Sending..."]}):"Send"})]})},Iw=a=>{const e=[];let t=0;const o=/\[lore entity_type="([^"]*)" entity_name="([^"]*)"\](.*?)\[\/lore\]/g;let s;for(;(s=o.exec(a))!==null;){s.index>t&&e.push(a.substring(t,s.index));const[u,f,g,h]=s;e.push(E.jsx("span",{className:"text-yellow-400 hover:text-yellow-300 font-medium",title:`Lore: ${g} (${f})`,children:h},`${s.index}-${g}`)),t=o.lastIndex}return t<a.length&&e.push(a.substring(t)),e},Rw=({entries:a})=>{const e=Y.useRef(null);Y.useEffect(()=>{e.current&&(e.current.scrollTop=e.current.scrollHeight)},[a]);const t=s=>{switch(s){case"command":return"text-indigo-300 italic";case"narration":return"text-slate-300";case"error":return"text-red-400";case"system":return"text-sky-400";case"game_event":return"text-emerald-400";case"combat":return"text-orange-400 font-medium";default:return"text-slate-400"}},o=s=>s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return E.jsxs("div",{ref:e,className:"h-64 bg-slate-800/70 p-4 rounded-lg shadow-inner ring-1 ring-slate-700 overflow-y-auto space-y-2 scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-700/50 overscroll-contain","aria-live":"polite","aria-atomic":"false",role:"log","aria-label":"Game log and narrative",children:[a.length===0&&E.jsx("p",{className:"text-slate-500 italic text-center py-4",children:"Your adventure begins here..."}),a.map(s=>E.jsxs("div",{className:`text-sm ${t(s.type)}`,children:[E.jsxs("span",{className:"text-slate-500 mr-2 select-none","aria-hidden":"true",children:["[",o(s.timestamp),"]"]}),s.type==="command"&&E.jsx("span",{className:"font-medium mr-1 select-none","aria-hidden":"true",children:">"}),E.jsx("span",{children:s.processedText?Iw(s.processedText):s.text})]},s.id))]})},Mw=({gameStarted:a,talkingToNPC:e,handleEndConversation:t,processPlayerCommand:o,isProcessing:s,gameLog:u,isConsoleMinimized:f,onToggleMinimize:g})=>{const{isEventActive:h,currentEventDetails:p,currentDirectives:v}=wn();if(!a)return null;let T="Context: World Interaction",C="text-indigo-400";h&&(p!=null&&p.requiresPlayerActionToResolve)?(T=`Context: Event - ${p.eventTitle||"Active Event"}`,C="text-purple-400"):e&&(T=`Context: Talking to ${e.name}`,C="text-sky-400");const S=(v==null?void 0:v.reasoning)||"Game Director's current strategic focus.",w=v?`${v.currentGameFocus}${v.currentGameFocus==="CustomScenario"&&v.gameplayParameterSuggestions.customFocusDescription?` (${v.gameplayParameterSuggestions.customFocusDescription.substring(0,30)}...)`:""}`:"No specific focus";return E.jsx("section",{"aria-labelledby":"interactive-console-heading",className:"w-full mt-auto sticky bottom-0 py-3 md:py-4 pointer-events-none z-30",children:E.jsxs("div",{className:"p-3 md:p-4 w-full max-w-7xl mx-auto bg-slate-800 rounded-lg shadow-2xl ring-1 ring-slate-600/70 pointer-events-auto relative",children:[E.jsx("button",{onClick:g,className:"absolute top-2 right-2 z-40 p-1.5 bg-slate-700 hover:bg-slate-600 text-slate-300 hover:text-slate-100 rounded-md transition-colors","aria-label":f?"Show console":"Hide console","aria-expanded":!f,title:f?"Show console":"Hide console",children:f?E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 15.75l7.5-7.5 7.5 7.5"})}):E.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:E.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"})})}),E.jsx("h2",{id:"interactive-console-heading",className:"text-xl font-semibold mb-1 text-indigo-300 sr-only",children:"Console"}),!f&&E.jsxs(E.Fragment,{children:[E.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1 mb-2 items-center text-xs",children:[e&&(!h||!(p!=null&&p.requiresPlayerActionToResolve))&&E.jsx("button",{onClick:t,disabled:s,className:"bg-orange-600 hover:bg-orange-500 text-white font-semibold py-1.5 px-3 rounded-md transition-colors duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-orange-400 focus:ring-opacity-75 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":`End conversation with ${e.name}`,children:"End Conversation"}),v&&E.jsxs("div",{className:"font-medium px-2 py-1 rounded-md text-purple-300 bg-slate-700/50",title:S,"aria-label":`Game Director Focus: ${w}. Reasoning: ${S}`,children:["Director Focus: ",E.jsx("span",{className:"font-semibold",children:w})]}),E.jsx("div",{className:`font-medium px-2 py-1 rounded-md ${C} bg-slate-700/50 ml-auto`,children:T})]}),E.jsx(ww,{onSubmit:o,isProcessing:s}),E.jsx("div",{className:"mt-3",children:E.jsx(Rw,{entries:u})})]}),f&&E.jsxs("div",{className:"text-sm text-center text-slate-400 py-2 h-10 flex items-center justify-center gap-x-3",children:[E.jsx("span",{children:"Console Minimized."}),v&&E.jsxs("span",{className:"text-xs text-purple-300",title:S,"aria-label":`Current Game Director Focus: ${w}. Reasoning: ${S}`,children:["(Focus: ",w,")"]}),E.jsxs("span",{className:`text-xs ${C}`,children:["(Context: ",T.split(": ")[1],")"]})]})]})})},Lw=a=>{if(!a)return console.error("Validation failed: data object is null or undefined."),!1;if(!(typeof a.refinedCharConcept=="string"&&a.refinedCharConcept.trim()!==""))return console.error("Validation failed: refinedCharConcept is not a non-empty string. Received:",a.refinedCharConcept),!1;const e=a.refinedCharConcept.trim().split(/\s+/).length;if(!(e>=5))return console.error(`Validation failed: refinedCharConcept word count is ${e} (requires >= 5). Content: "${a.refinedCharConcept}"`),!1;if(!(typeof a.refinedStartLocationConcept=="string"&&a.refinedStartLocationConcept.trim()!==""))return console.error("Validation failed: refinedStartLocationConcept is not a non-empty string. Received:",a.refinedStartLocationConcept),!1;const t=a.refinedStartLocationConcept.trim().split(/\s+/).length;return t>=2?a.refinedCharName!==void 0&&a.refinedCharName!==null&&typeof a.refinedCharName!="string"?(console.error("Validation failed: refinedCharName is present but not a string. Received:",a.refinedCharName),!1):a.fictionalUniverseContext!==void 0&&a.fictionalUniverseContext!==null&&typeof a.fictionalUniverseContext!="string"?(console.error("Validation failed: fictionalUniverseContext is present but not a string or null. Received:",a.fictionalUniverseContext),!1):!0:(console.error(`Validation failed: refinedStartLocationConcept word count is ${t} (requires >= 2). Content: "${a.refinedStartLocationConcept}"`),!1)},kw=async(a,e,t="")=>{var g,h,p;const u=`
You are an AI assistant for a game. The user provides an idea for their character and world.
Your task is to refine this idea into specific JSON fields.

User Idea: "${e}"
Setting Type: ${a}
${t} 
${a==="Historical"?"This is a HISTORICAL setting. Ensure outputs are plausible for history. If user mentioned a specific historical figure or period, align with that.":"This is a FICTIONAL setting. Be creative."}
${a==="Fictional"?`If the "User Idea" clearly implies a well-known fictional universe (e.g., "Star Wars", "Middle-earth", "Game of Thrones" if 'John Snow' is mentioned), provide the name of that universe in "fictionalUniverseContext". Otherwise, "fictionalUniverseContext" MUST be null. Ensure "refinedCharConcept" and "refinedStartLocationConcept" are consistent with this identified universe if one is provided.`:'The "fictionalUniverseContext" field MUST be null.'}

Output ONLY a valid JSON string with the following structure:
{
  "refinedCharName": "CHARACTER_NAME_HERE_OR_NULL",
  "refinedCharConcept": "CHARACTER_CONCEPT_HERE",
  "refinedStartLocationConcept": "LOCATION_CONCEPT_HERE",
  "fictionalUniverseContext": "UNIVERSE_NAME_OR_NULL"
}

REQUIREMENTS:
1.  "refinedCharName": (String or Null)
    - If the user's idea clearly specifies a character name (especially a known historical/fictional one), use that name.
    - If not, you can generate a fitting name OR provide null if the character concept is a unique identifier.
    - If the user idea is too vague, invent a plausible name for the '${a}' setting or use null.
2.  "refinedCharConcept": (String - MANDATORY)
    - A descriptive character concept.
    - MUST be a non-empty string, MINIMUM 5 words.
    - If the user's idea is too vague, YOU MUST INVENT a suitable character concept for the '${a}' setting.
3.  "refinedStartLocationConcept": (String - MANDATORY)
    - A descriptive starting location concept (a phrase or 1-2 sentences).
    - MUST be a non-empty string, MINIMUM 2 words.
    - Must align with the character concept and setting type.
    - If the user's idea is too vague, YOU MUST INVENT a suitable location concept for the '${a}' setting.
4.  "fictionalUniverseContext": (String or Null)
    - Only for 'Fictional' settingType: If a known fictional universe is clearly implied by the "User Idea", provide its name (e.g., "Star Wars", "Game of Thrones"). Otherwise, MUST be null.
    - For 'Historical' settingType: This MUST always be null.

Your entire response MUST be ONLY the JSON object described above. No other text, explanations, or markdown.
Ensure "refinedCharConcept" and "refinedStartLocationConcept" are ALWAYS provided and are non-empty strings meeting the minimum word counts.
If the user input is very vague (e.g., "I don't know"), invent plausible defaults for the '${a}' setting.
Example for vague input like "fantasy":
{
  "refinedCharName": "Elara Meadowlight",
  "refinedCharConcept": "A nimble elven archer seeking an ancient artifact in a sun-dappled forest.",
  "refinedStartLocationConcept": "An ancient, overgrown elven ruin at the edge of a sprawling, mystical forest.",
  "fictionalUniverseContext": null
}
Example for HISTORICAL vague input like "Roman times":
{
  "refinedCharName": "Marcus Drusus",
  "refinedCharConcept": "A tough Roman legionary stationed at a remote fort on the empire's northern frontier.",
  "refinedStartLocationConcept": "A windswept Roman auxiliary fort built of timber and earth, overlooking a misty barbarian forest.",
  "fictionalUniverseContext": null
}
`,f=await Kh(u,Lw,"Validation failed: refinedCharConcept and/or refinedStartLocationConcept are missing, empty, or too short. Or refinedCharName is not a string if present. Check fictionalUniverseContext.","refineUserStartInputs");if(!((g=f.refinedCharName)!=null&&g.trim())&&f.refinedCharConcept){const v=f.refinedCharConcept.split(/[,.]|\s-\s/);if(v.length>0){const T=v[0].trim();T.split(/\s+/).length<=3&&T.length>1&&!T.endsWith(".")&&(f.refinedCharName=T)}(h=f.refinedCharName)!=null&&h.trim()||(f.refinedCharName=a==="Historical"?"Citizen":"Adventurer")}else(p=f.refinedCharName)!=null&&p.trim()||(f.refinedCharName=a==="Historical"?"Citizen":"Adventurer");return{refinedCharName:f.refinedCharName,refinedCharConcept:f.refinedCharConcept,refinedStartLocationConcept:f.refinedStartLocationConcept,fictionalUniverseContext:f.fictionalUniverseContext}},Hi=3,$w=({handleCloseItemModal:a,handleCloseNPCModal:e,handleCloseLocationModal:t,handleCloseImageViewModal:o,setSelectedLocationCoordinateKeyForModal:s,setCraftingSlots:u,setIsCrafting:f,setIsPickingUpItem:g,setIsUsingItem:h,setIsApplyingToLimb:p,setPreviousMovementSourceCoordinates:v,setIsConsoleMinimized:T})=>{const{setGameStarted:C,setCharacterData:S,setLocationData:w,setPlayerInventory:I,setCurrentCoordinates:b,setVisitedLocations:A,setGameLog:M,addLogEntry:L,setIsLoading:R,setLoadingMessage:$,setError:V,setLocationNPCs:Q,setTalkingToNPC:te,setLocationItems:F,attemptToTriggerUnexpectedEvent:ae,addMemorableEntity:W,addMajorPlotPoint:z,getMemoryContextString:ue,clearMemorySystem:re,visitedLocations:se,addPotentialDiscovery:U}=wn(),X=Y.useCallback(()=>{V(null),C(!1),S(null),w(null),I([]),u(Array(3).fill(null)),f(!1),g(null),h(null),p(null),M([]),b({x:0,y:0}),A(new Map),v(null),Q(null),te(null),F(null),a(),e(),t(),o(),s(null),T(!1),re&&re()},[V,C,S,w,I,M,b,A,a,e,t,o,u,f,g,h,p,v,T,Q,te,F,re]),J=Y.useCallback(async(j,Z,ie,fe,ce,de)=>{var kt;let le=null,me=[],K=null;const Ve=ue();$("Conceptualizing your character...");const Te=await kA(j,de,Z,fe,ce,Ve);le=Te.characterDetails,me=Te.initialItems,le.visualStyle=de,fe==="Fictional"&&ce&&(le.fictionalUniverseContext=ce),W(le.characterName,le.characterName,"character",le.characterRarity,le.characterConcept,"Player Character - Game Start"),L("game_event",`Character: ${le.characterName} - ${le.characterConcept} (Rarity: ${le.characterRarity}, Style: ${de})`),le.fictionalUniverseContext&&L("system",`Playing in the universe of: ${le.fictionalUniverseContext}`),(kt=le.skills)!=null&&kt.length&&L("system",`Initial skills: ${le.skills.filter(xt=>xt.level>0).map(xt=>`${xt.name} (Lvl ${xt.level})`).join(", ")||"None notable"}`),$("Creating your world...");const we={...le,characterImageUrl:null,fictionalUniverseContext:fe==="Fictional"?ce:null,visualStyle:de};K=await zA(ie,we,ue()),W(K.name,K.name,"location",K.rarity,K.description,"Game Start Location");const Me=[];if(me!=null&&me.length){for(const xt of me){const St=await hi(xt.visualPromptHint,xt.name,de),en={...xt,id:crypto.randomUUID(),iconUrl:St||""};Me.push(en),W(en.id,en.name,"item",en.rarity,en.description.substring(0,50)+"...","Starting Equipment"),L("game_event",`Starts with: ${en.name} (${en.rarity}).`)}I(Me)}$("Generating character appearance...");const Ge=await LA(we,K.visualPromptHint),be={...le,characterImageUrl:Ge,visualStyle:de};S(be),w(K),L("system",Ge?`Character appearance generated for ${be.characterName}.`:`Character appearance for ${be.characterName} could not be generated. Using placeholder.`),L("narration",`${K.description}`),L("game_event",`You find yourself in: ${K.name} (Rarity: ${K.rarity}).`);const Ke={x:0,y:0};b(Ke),F(null),Q(null),v(null);const Ze=`${Ke.x},${Ke.y}`;A(xt=>{const St=new Map(xt);return St.set(Ze,{location:K,items:null,npcs:null}),St}),$("Discovering initial leads...");const Wt=await RN(be,K,fe,ce,de,ue());if(Wt.length>0){L("system","Initial rumors and leads surface...");for(const xt of Wt)await U(xt,`game_start-${be.characterName}`,Ze)}z(`Game started for character '${be.characterName}' (${be.characterRarity}) in '${K.name}'. Setting: ${fe}, Style: ${de}. Initial leads: ${Wt.length}.`,[be.characterName,K.name],K.name),C(!0),await ae(`game_start_in_${K.name.replace(/\s+/g,"_")}_${K.rarity}`)},[$,ue,W,L,I,S,w,b,F,Q,v,A,z,C,ae,U]),he=Y.useCallback(async()=>{R(!0),X(),L("system","Starting new adventure...");let j=!1;for(let Z=1;Z<=Hi;Z++)try{await J("A mysterious adventurer concept",null,"A mysterious place","Fictional",null,"Pixel Art"),j=!0;break}catch(ie){console.error(`World creation attempt ${Z} failed:`,ie),V(`World creation failed (attempt ${Z}/${Hi}): ${ie.message||"Unknown error"}. Retrying...`),Z===Hi&&V(`Failed to create world after ${Hi} attempts: ${ie.message||"Unknown error"}. Please try again.`),await new Promise(fe=>setTimeout(fe,500*Z))}R(!1),$("")},[L,X,R,$,V,J]),P=Y.useCallback(async(j,Z,ie)=>{if(!Z.trim()){V("Please describe your desired world and character idea."),L("error","World/Character idea cannot be empty for custom start.");return}R(!0),X(),L("system",`Starting custom adventure: ${j} setting, ${ie} style...`);let fe=!1;for(let ce=1;ce<=Hi;ce++)try{$(`Refining your ideas (attempt ${ce})...`);const de=await kw(j,Z,ue()),le=j==="Historical"?Z:de.fictionalUniverseContext;await J(de.refinedCharConcept,de.refinedCharName,de.refinedStartLocationConcept,j,le,ie),fe=!0;break}catch(de){console.error(`Custom world creation attempt ${ce} failed:`,de),V(`World creation failed (attempt ${ce}/${Hi}): ${de.message||"Unknown error"}. Retrying...`),ce===Hi&&V(`Failed to create custom world after ${Hi} attempts: ${de.message||"Unknown error"}. Please try again.`),await new Promise(le=>setTimeout(le,500*ce))}R(!1),$("")},[L,X,R,$,V,ue,J]);return{handleStartNewGame:he,handleCustomStartGame:P}},Pw=({isPickingUpItem:a,setIsPickingUpItem:e,isUsingItem:t,setIsUsingItem:o,isApplyingToLimb:s,setIsApplyingToLimb:u})=>{const{characterData:f,setCharacterData:g,locationData:h,locationItems:p,setLocationItems:v,playerInventory:T,setPlayerInventory:C,currentCoordinates:S,visitedLocations:w,setVisitedLocations:I,addLogEntry:b,_consumeEnergy:A,_gainSkillExperience:M,attemptToTriggerUnexpectedEvent:L,addMajorPlotPoint:R,getMemoryContextString:$}=wn(),V=Y.useCallback(async W=>{if(!f||!p||!h){b("error","No items visible or area not searched to pick up from.");return}const z=p.find(re=>re.id===W);if(!z){b("error","Could not find the item to pick up.");return}if(A(0),f.isDefeated&&z.itemTypeGuess.toLowerCase()!=="revival_item_type"){b("system","You are too weak to pick that up.");return}e(W);const ue=$();try{const re=await WN(z,f,ue),se=p.filter(J=>J.id!==W);v(se),C(J=>[...J,re.pickedUpItem]),b("narration",re.narration);const U=`${S.x},${S.y}`,X=w.get(U);X&&I(J=>new Map(J).set(U,{...X,items:se})),(z.rarity==="Epic"||z.rarity==="Legendary")&&R(`Player acquired ${z.rarity} item: '${z.name}'.`,[z.id],h==null?void 0:h.name),await L(`item_pickup_${z.rarity.toLowerCase()}_${z.name.replace(/\s+/g,"_")}_from_${h.name.replace(/\s+/g,"_")}`)}catch(re){console.error("Failed to pick up item:",re),b("error",`Pickup failed: ${re.message||"An error occurred while picking up the item."}`)}finally{e(null)}},[f,p,h,A,b,S,w,C,I,v,e,L,$,R]),Q=Y.useCallback((W,z,ue,re)=>{var X;if(!f||!h)return;let se=!1,U=[...T];z.itemEffect.consumed?(U=U.filter(J=>J.id!==W.id),se=!0):(z.itemEffect.newNameIfChanged||z.itemEffect.newDescriptionIfChanged||z.itemEffect.newVisualPromptHintIfChanged)&&(U=U.map(J=>J.id===W.id?(se=!0,{...J,name:z.itemEffect.newNameIfChanged||J.name,description:z.itemEffect.newDescriptionIfChanged||J.description,visualPromptHint:z.itemEffect.newVisualPromptHintIfChanged||J.visualPromptHint}):J)),g(J=>{if(!J)return null;let he={...J},P=!1;if(z.characterEffect.overallHealthChange&&(he.overallHealth=Math.max(0,Math.min(100,he.overallHealth+z.characterEffect.overallHealthChange)),b("game_event",`Overall health changed by ${z.characterEffect.overallHealthChange}. Now: ${he.overallHealth}HP.`)),z.characterEffect.energyChange&&(he.currentEnergy=Math.max(0,Math.min(he.maxEnergy,he.currentEnergy+z.characterEffect.energyChange)),b("game_event",`Energy changed by ${z.characterEffect.energyChange}. Now: ${he.currentEnergy}EN.`)),z.characterEffect.limbStatusChanges&&(he.limbs=he.limbs.map(j=>{const Z=z.characterEffect.limbStatusChanges.find(ie=>ie.limbName===j.name);return Z?(P=!0,{...j,status:Z.newStatus,health:Z.newHealth}):j})),z.itemEffect.isEquippedToLimb&&re&&(he.limbs=he.limbs.map(j=>{if(j.name===re){const Z=T.find(ie=>ie.id===W.id);if(Z)return se=!0,U=U.filter(ie=>ie.id!==Z.id),{...j,equippedItems:[...j.equippedItems||[],Z]}}return j}),b("game_event",`${W.name} equipped to ${re}.`)),P){const j=he.limbs.reduce((Z,ie)=>Z+ie.health,0);he.overallHealth=Math.round(j/he.limbs.length)}return he.overallHealth<=0&&!he.isDefeated&&(he.isDefeated=!0,b("game_event","The effects are devastating. You have been defeated.")),he}),se&&C(U),z.characterEffect.xpGain&&M(z.characterEffect.xpGain.skillName,z.characterEffect.xpGain.amount),(W.rarity==="Epic"||W.rarity==="Legendary")&&(z.itemEffect.isEquippedToLimb||z.characterEffect.overallHealthChange||(X=z.characterEffect.limbStatusChanges)!=null&&X.length)&&R(`Player used ${W.rarity} item '${W.name}', causing significant effect.`,[W.id],h==null?void 0:h.name)},[b,g,C,T,M,f,h,R]),te=Y.useCallback(async(W,z)=>{if(!f||!h){b("error","Character data not available.");return}const ue=T.find(se=>se.id===W);if(!ue){b("error","Item not found in inventory.");return}if(A(1),f.isDefeated&&ue.itemTypeGuess.toLowerCase()!=="revival_item_type"){b("system","You are too weak to use that item.");return}o(W),b("system",`Attempting to use ${ue.name}...`);const re=(z==null?void 0:z._augmentedMemoryContext)||$();try{const se={...f},U=await sh(ue,se,z!=null&&z.is_limb_target?z.on_target:void 0,re);b("narration",U.narration),Q(ue,U,`item_used_${ue.name.replace(/\s+/g,"_")}`),await L(`used_item_${ue.rarity.toLowerCase()}_${ue.name.replace(/\s+/g,"_")}_in_${h.name.replace(/\s+/g,"_")}`)}catch(se){console.error("Item usage error:",se),b("error",`Item usage failed: ${se.message||"An unexpected error occurred."}`)}finally{o(null)}},[f,T,h,b,o,Q,A,$,L]),F=Y.useCallback(async(W,z,ue)=>{if(!f||!h){b("error","Character data not available to apply item to limb.");return}const re=T.find(X=>X.id===W);if(!re){b("error",`Item with ID ${W} not found in inventory.`);return}const se=f.limbs.find(X=>X.id===z);if(!se){b("error",`Limb with ID ${z} not found.`);return}if(A(1),f.isDefeated&&re.itemTypeGuess.toLowerCase()!=="revival_item_type"){b("system","You are too weak to apply that item.");return}u(`${W}-${z}`),b("system",`Attempting to use ${re.name} on your ${se.name}...`);const U=(ue==null?void 0:ue._augmentedMemoryContext)||$();try{const X={...f},J=await sh(re,X,se.name,U);b("narration",J.narration),Q(re,J,`item_applied_to_limb_${se.name.replace(/\s+/g,"_")}`,se.name),await L(`applied_item_${re.rarity.toLowerCase()}_to_limb_${se.name.replace(/\s+/g,"_")}_in_${h.name.replace(/\s+/g,"_")}`)}catch(X){console.error(`Error applying item ${re.name} to ${se.name}:`,X),b("error",`Failed to apply ${re.name} to ${se.name}: ${X.message||"An unexpected error occurred."}`)}finally{u(null)}},[f,T,h,b,u,Q,A,$,L]),ae=Y.useCallback((W,z)=>{if(!f||!h){b("error","Character data not available to unequip item.");return}if(A(0),f.isDefeated){b("system","You are too weak to change equipment.");return}let ue=null;g(re=>{if(!re)return null;const se=re.limbs.map(U=>{var X;if(U.id===W){const J=(X=U.equippedItems)==null?void 0:X.findIndex(he=>he.id===z);if(J!==void 0&&J>-1){ue=U.equippedItems[J];const he=U.equippedItems.filter((P,j)=>j!==J);return b("system",`Unequipped ${ue.name} from your ${U.name}.`),{...U,equippedItems:he}}else b("error",`Item to unequip not found on ${U.name}.`)}return U});return{...re,limbs:se}}),ue&&(C(re=>[...re,ue]),(ue.rarity==="Epic"||ue.rarity==="Legendary")&&R(`Player unequipped ${ue.rarity} item '${ue.name}'.`,[ue.id],h.name),L(`unequipped_item_${ue.rarity.toLowerCase()}_from_limb_in_${h.name.replace(/\s+/g,"_")}`))},[f,h,C,g,b,A,L,R]);return{handlePickupItem:V,handleUseItem:te,handleApplyItemToLimb:F,handleUnequipItemFromLimb:ae}},Dw=({contextIsLoading:a,contextLoadingMessage:e,hookIsLoadingItems:t,hookIsLoadingNPCs:o,isGeneratingEvent:s,eventLoadingMessage:u,isCharacterDefeated:f})=>{const{isConsoleBusy:g}=wn(),h=Y.useMemo(()=>a||t||o||s,[a,t,o,s]),p=Y.useMemo(()=>a&&e?e:t?"Searching for items...":o?"Looking for people...":s&&u?u:null,[a,e,t,o,s,u]),v=Y.useMemo(()=>a||g||s||f,[a,g,s,f]);return{appHeaderIsLoading:h,appHeaderLoadingMessage:p,consoleIsProcessing:v}},Uw=()=>{const[a,e]=Y.useState(null),[t,o]=Y.useState(null),[s,u]=Y.useState(null),[f,g]=Y.useState(null),[h,p]=Y.useState(null),[v,T]=Y.useState(null),C=Y.useCallback(R=>{e(R)},[]),S=Y.useCallback(()=>{e(null)},[]),w=Y.useCallback(R=>{o(R)},[]),I=Y.useCallback(()=>{o(null)},[]),b=Y.useCallback((R,$)=>{u(R),g($||null)},[]),A=Y.useCallback(()=>{u(null),g(null)},[]),M=Y.useCallback((R,$)=>{p(R),T($)},[]),L=Y.useCallback(()=>{p(null),T(null)},[]);return{itemToViewInModal:a,setItemToViewInModal:e,npcToViewInModal:t,setNpcToViewInModal:o,locationToViewInModal:s,setLocationToViewInModal:u,selectedLocationCoordinateKeyForModal:f,setSelectedLocationCoordinateKeyForModal:g,imageUrlToView:h,setImageUrlToView:p,imageAltTextToView:v,setImageAltTextToView:T,handleSelectItemForModal:C,handleCloseItemModal:S,handleSelectNPCForModal:w,handleCloseNPCModal:I,handleSelectLocationForModal:b,handleCloseLocationModal:A,handleSelectImageForViewing:M,handleCloseImageViewModal:L}},Ow=[],ks=3,Gw=({})=>{const{characterData:a,playerInventory:e,setPlayerInventory:t,addLogEntry:o,_consumeEnergy:s,_gainSkillExperience:u,attemptToTriggerUnexpectedEvent:f,addMemorableEntity:g,getMemoryContextString:h,locationData:p,potentialDiscoveries:v,markPotentialDiscoveryFound:T}=wn(),[C,S]=Y.useState(Array(ks).fill(null)),[w,I]=Y.useState(!1),b=Y.useCallback((R,$)=>{if(C.some(Q=>(Q==null?void 0:Q.id)===R.id)){o("system",`${R.name} is already in a slot.`);return}const V=[...C];V[$]=R,S(V),o("system",`Added ${R.name} to crafting slot ${$+1}.`)},[C,o]),A=Y.useCallback(R=>{const $=C[R],V=[...C];V[R]=null,S(V),$&&o("system",`Removed ${$.name} from slot ${R+1}.`)},[C,o]),M=R=>{switch(R){case"Common":return 5;case"Uncommon":return 10;case"Rare":return 20;case"Epic":return 50;case"Legendary":return 100;default:return 0}},L=Y.useCallback(async()=>{if(!a)return;if(a.isDefeated){o("system","Too weak to craft.");return}const R=C.filter(W=>W!==null);if(R.length===0){o("system","Place items in slots.");return}s(3,"Crafting");const $=a;if($.isDefeated)return;I(!0),o("system",`Attempting craft with: ${R.map(W=>W.name).join(", ")}...`);const V=h(),Q=(p==null?void 0:p.visualPromptHint)||null;let te=null,F=[];const ae=v.filter(W=>W.type==="item"&&W.status==="mentioned");for(const W of Ow){const z=[...R],ue=[];let re=!0;for(const se of W.inputs){let U=se.quantity;for(let X=0;X<U;X++){const J=z.findIndex(he=>he.name===se.itemName);if(J!==-1){const he=C.findIndex(P=>(P==null?void 0:P.id)===z[J].id);he!==-1&&!ue.includes(he)&&ue.push(he),z.splice(J,1)}else{re=!1;break}}if(!re)break}if(re&&z.length===0&&R.length===W.inputs.reduce((se,U)=>se+U.quantity,0)){te=W,F=ue.sort((se,U)=>se-U);break}}try{if(te){const W=F.map(se=>C[se].name),z=await lA(te.output,W,$,Q,V),ue=F.map(se=>{var U;return(U=C[se])==null?void 0:U.id}).filter(se=>!!se);t(se=>se.filter(U=>!ue.includes(U.id))),t(se=>[...se,z.craftedItem]),g(z.craftedItem.id,z.craftedItem.name,"item",z.craftedItem.rarity,z.craftedItem.description.substring(0,50)+"...",`Crafted in ${(p==null?void 0:p.name)||"current area"}`),o("narration",z.narration),o("game_event",`Crafted ${z.craftedItem.name} (Rarity: ${z.craftedItem.rarity}).`),u("Crafting",M(z.craftedItem.rarity)*.5),S(Array(ks).fill(null));const re=await Fi(z.craftedItem,"item",ae,$,V);re&&T(re,z.craftedItem.id),await f(`crafted_recipe_item_${z.craftedItem.rarity.toLowerCase()}_in_${(p==null?void 0:p.name.toLowerCase().replace(/\s+/g,"_"))||"unknown_loc"}`)}else if(R.length>=2){const W=[...R],z=W.map(re=>re.id);t(re=>re.filter(se=>!z.includes(se.id))),S(Array(ks).fill(null));const ue=await dA(W,$,Q,ae,V);if(t(re=>[...re,ue.newItem]),g(ue.newItem.id,ue.newItem.name,"item",ue.newItem.rarity,ue.newItem.description.substring(0,50)+"...",`Dynamically crafted in ${(p==null?void 0:p.name)||"current area"}`),o("narration",ue.narration),o("game_event",`Experimentally crafted ${ue.newItem.name} (Rarity: ${ue.newItem.rarity}).`),u("Crafting",M(ue.newItem.rarity)),ue.fulfilledLeadId)T(ue.fulfilledLeadId,ue.newItem.id);else{const re=await Fi(ue.newItem,"item",ae,$,V);re&&T(re,ue.newItem.id)}await f(`crafted_dynamic_item_${ue.newItem.rarity.toLowerCase()}_in_${(p==null?void 0:p.name.toLowerCase().replace(/\s+/g,"_"))||"unknown_loc"}`)}else o("system","Items don't combine, not enough for experiment.")}catch(W){console.error("Crafting error:",W);const z=W.message||(te?"Error during predefined crafting.":"Combination yielded smoke. Items lost.");if(o("error",`Crafting failed: ${z}`),!te&&R.length>=2){const ue=R.map(re=>re.id);t(re=>re.filter(se=>!ue.includes(se.id))),S(Array(ks).fill(null))}}finally{I(!1)}},[C,a,e,t,o,s,u,f,g,h,p==null?void 0:p.name,p==null?void 0:p.visualPromptHint,v,T]);return{craftingSlots:C,setCraftingSlots:S,isCrafting:w,setIsCrafting:I,handleAddItemToCraftingSlot:b,handleRemoveItemFromCraftingSlot:A,handleAttemptCraft:L}},Hw=({})=>{const{locationData:a,characterData:e,currentCoordinates:t,visitedLocations:o,setVisitedLocations:s,addLogEntry:u,locationNPCs:f,setLocationNPCs:g,talkingToNPC:h,setTalkingToNPC:p,_consumeEnergy:v,_gainSkillExperience:T,attemptToTriggerUnexpectedEvent:C,addMemorableEntity:S,getMemoryContextString:w,potentialDiscoveries:I,markPotentialDiscoveryFound:b}=wn(),[A,M]=Y.useState(!1),[L,R]=Y.useState(null),$=Y.useCallback(te=>{if(!f)return;const F=f.find(ae=>ae.id===te);F&&(p(F),u("system",`You begin talking to ${F.name}.`))},[f,u,p]),V=Y.useCallback(()=>{h&&(u("system",`You end conversation with ${h.name}.`),C(`end_talk_with_${h.name.replace(/\s+/g,"_")}_${h.rarity}`),p(null))},[h,u,p,C]),Q=Y.useCallback(async()=>{var re;if(!e){u("error","Character data not available.");return}if(e.isDefeated){u("system","You are too weak to search.");return}v(2,"Perception");const te=e;if(te.isDefeated)return;const F={...t},ae=a,W=ae==null?void 0:ae.name;if(!ae||L){L&&t.x===F.x&&t.y===F.y&&u("error",`Cannot look for people in ${W||"current area"}: ${L}`);return}const z=`${F.x},${F.y}`,ue=o.get(z);if(!ue){u("error",`Cannot look in ${W||"current area"}: location data missing.`);return}if(ue.npcs===null){R(null),M(!0);const se=w();try{const U=I.filter(J=>J.type==="npc"&&J.status==="mentioned");let X=await vA(ae,te,U,se);X=X.map(J=>({...J,currentHealth:J.currentHealth??100,maxHealth:J.maxHealth??100,isDefeated:J.isDefeated??!1,disposition:J.disposition??"Neutral"}));for(const J of X){const he=await Fi(J,"npc",U,te,se);he&&b(he,J.id),S(J.id,J.name,"npc",J.rarity,J.description.substring(0,50)+"...",`Encountered in ${ae.name}`)}s(J=>{const he=new Map(J),P=he.get(z);return P&&he.set(z,{...P,npcs:X}),he}),t.x===F.x&&t.y===F.y?(g(X),X.length>0?(u("game_event",`You notice: ${X.map(J=>`${J.name} (${J.rarity})`).join(", ")} in ${W||"this area"}.`),ue.npcs===null&&(T("Perception",3),await C(`npcs_found_first_time_count_${X.length}_in_${ae.name.replace(/\s+/g,"_")}`))):(u("game_event",`After looking around in ${W||"this area"}, you don't see anyone else here.`),ue.npcs===null&&await C(`npcs_searched_area_empty_in_${ae.name.replace(/\s+/g,"_")}`))):u("system",`NPC search for ${W||"a previous area"} completed, results cached.`)}catch(U){console.error(`Failed to generate NPCs for ${W}:`,U);const X=U.message||"Error looking for people.";s(J=>{const he=new Map(J),P=he.get(z);return P&&he.set(z,{...P,npcs:[]}),he}),t.x===F.x&&t.y===F.y?(R(X),u("error",`Search failed: ${X}`),g([])):u("system",`NPC search for ${W||"a previous area"} failed. Error logged.`)}finally{M(!1)}}else(re=ue.npcs)!=null&&re.length?u("narration",`You recall seeing: ${ue.npcs.map(se=>`${se.name} (${se.rarity})`).join(", ")} here.`):u("narration","You reconfirm no one else is around here."),f===null&&ue.npcs!==null&&t.x===F.x&&t.y===F.y&&g(ue.npcs),await C(`npcs_reconfirm_search_in_${ae.name.replace(/\s+/g,"_")}`)},[a,e,L,t,o,u,s,g,f,v,T,C,S,w,I,b]);return{locationNPCs:f,isLoadingNPCs:A,npcsError:L,talkingToNPC:h,handleStartConversation:$,handleEndConversation:V,handleTriggerLookForPeople:Q,setLocationNPCs:g,setIsLoadingNPCs:M,setNpcsError:R,setTalkingToNPC:p}},Vw=({})=>{const{locationData:a,characterData:e,currentCoordinates:t,visitedLocations:o,setVisitedLocations:s,addLogEntry:u,locationItems:f,setLocationItems:g,_consumeEnergy:h,_gainSkillExperience:p,attemptToTriggerUnexpectedEvent:v,addMemorableEntity:T,getMemoryContextString:C,potentialDiscoveries:S,markPotentialDiscoveryFound:w}=wn(),[I,b]=Y.useState(!1),[A,M]=Y.useState(null),L=Y.useCallback(async()=>{var ae;if(!e){u("error","Character data not available.");return}if(e.isDefeated){u("system","Your wounds are too severe to search.");return}h(2,"Perception");const R=e;if(R.isDefeated)return;const $={...t},V=a,Q=V==null?void 0:V.name;if(!V||A){A&&t.x===$.x&&t.y===$.y&&u("error",`Cannot search in ${Q||"current area"}: ${A}`);return}const te=`${$.x},${$.y}`,F=o.get(te);if(!F){u("error",`Cannot look in ${Q||"current area"}: location data missing.`);return}if(F.items===null){M(null),b(!0);const W=C();try{const z=S.filter(re=>re.type==="item"&&re.status==="mentioned");let ue=await XN(V,R,z,W);for(const re of ue){const se=await Fi(re,"item",z,R,W);se&&w(se,re.id),T(re.id,re.name,"item",re.rarity,re.description.substring(0,50)+"...",`Found in ${V.name}`)}s(re=>{const se=new Map(re),U=se.get(te);return U&&se.set(te,{...U,items:ue}),se}),t.x===$.x&&t.y===$.y?(g(ue),ue.length>0?(u("game_event",`You find: ${ue.map(re=>`${re.name} (${re.rarity})`).join(", ")} in ${Q||"this area"}.`),F.items===null&&(p("Perception",5),await v(`items_found_first_time_count_${ue.length}_in_${V.name.replace(/\s+/g,"_")}`))):(u("game_event",`After a thorough search of ${Q||"this area"}, you find nothing of particular interest.`),F.items===null&&await v(`items_searched_area_empty_in_${V.name.replace(/\s+/g,"_")}`))):u("system",`Item search for ${Q||"a previous area"} completed, results cached.`)}catch(z){console.error(`Failed to generate items for ${Q}:`,z);const ue=z.message||"Error searching for items.";s(re=>{const se=new Map(re),U=se.get(te);return U&&se.set(te,{...U,items:[]}),se}),t.x===$.x&&t.y===$.y?(M(ue),u("error",`Item search failed: ${ue}`),g([])):u("system",`Item search for ${Q||"a previous area"} failed. Error logged.`)}finally{b(!1)}}else(ae=F.items)!=null&&ae.length?u("narration",`You recall seeing: ${F.items.map(W=>`${W.name} (${W.rarity})`).join(", ")} here.`):u("narration","You reconfirm no distinct items here."),f===null&&F.items!==null&&t.x===$.x&&t.y===$.y&&g(F.items),await v(`items_reconfirm_search_in_${V.name.replace(/\s+/g,"_")}`)},[a,e,A,t,o,u,s,g,f,h,p,v,T,C,S,w]);return{locationItems:f,isLoadingItems:I,itemsError:A,handleTriggerLookForItems:L,setLocationItems:g,setIsLoadingItems:b,setItemsError:M}},gt={DIALOGUE_INPUT:"dialogue_input",END_CONVERSATION:"end_conversation",TALK:"talk",GIVE_ITEM:"give_item",REQUEST_ITEM_FROM_NPC:"request_item_from_npc",ATTACK_NPC:"attack_npc",PICKUP:"pickup",TAKE:"take",GET:"get",USE:"use",EXAMINE:"examine",LOOK:"look",INSPECT:"inspect",DISCOVER_ITEMS:"discover_items",SEARCH_AREA_FOR_ITEMS:"search_area_for_items",DISCOVER_NPCS:"discover_npcs",LOOK_FOR_PEOPLE:"look_for_people",GO:"go",MOVE:"move",WALK:"walk",RUN:"run",LEAVE_AREA:"leave_area",INVENTORY:"inventory",CHECK_INVENTORY:"check_inventory",STATUS:"status",HEALTH:"health",CHECK_SELF:"check_self",CRAFT:"craft",UNKNOWN:"unknown",EVENT_DIALOGUE_INPUT:"event_dialogue_input"},qw={functionDeclarations:[{name:"interpret_player_action",description:"Interprets player command in fantasy/historical game. Identifies action, targets, params. Checks plausibility (skills like Perception/Mobility, memory context, game setting/universe, ACTIVE EVENT CONTEXT). Provides narration. Skills, memory, setting/universe, AND ACTIVE EVENT CONTEXT influence plausibility/narration.",parameters:{type:_.OBJECT,properties:{action:{type:_.STRING,description:"Core action verb (e.g., 'go', 'take', 'dialogue_input', 'attack_npc', 'leave_area', 'event_dialogue_input'). For examining non-objects, use 'examine'."},targets:{type:_.ARRAY,description:"Primary targets (item names, directions, NPC names/IDs, 'area', 'self', '0,0', 'current_location'). Empty if general. For 'examine' of non-objects, this can be empty or contain the detail phrase.",items:{type:_.STRING}},parameters:{type:_.OBJECT,description:"Additional parameters. All optional.",properties:{withItem:{type:_.STRING,nullable:!0,description:"Item used with the action, if any."},on_target:{type:_.STRING,nullable:!0,description:"Secondary target of an action, if any (e.g. 'apply bandage on arm')."},is_limb_target:{type:_.BOOLEAN,nullable:!0,description:"True if 'on_target' refers to a character's limb."},interaction_type:{type:_.STRING,nullable:!0,description:"Type of interaction (e.g., 'inspect', 'read')."},npc_target_name:{type:_.STRING,nullable:!0,description:"Name of the NPC being interacted with directly for non-dialogue actions (e.g. examine NPC, attack NPC). This should be the primary target for actions like 'attack'."},dialogue_text:{type:_.STRING,nullable:!0,description:"The text of the player's speech if the action is 'dialogue_input', 'event_dialogue_input', or an initial utterance with 'talk'."},item_to_give_name:{type:_.STRING,nullable:!0,description:"Name of the item to give an NPC."},target_npc_name_for_interaction:{type:_.STRING,nullable:!0,description:"Name of the NPC to give an item to."},item_to_request_name:{type:_.STRING,nullable:!0,description:"Name of the item being requested from an NPC."},target_npc_name_for_request:{type:_.STRING,nullable:!0,description:"Name of the NPC from whom an item is requested."},direct_object_npc_id:{type:_.STRING,nullable:!0,description:"ID of NPC being targeted if 'npc_target_name' resolved to a known NPC ID from context. Crucial for 'attack_npc'."},intendedLocationTypeHint:{type:_.STRING,nullable:!0,description:"If moving, a player-suggested location type (e.g., 'forest', 'market', 'cave'). Null otherwise."},examine_detail_target:{type:_.STRING,nullable:!0,description:"If player examines a detail not an item/NPC (e.g., 'examine fissure', 'look at carvings'), this field holds the detail string (e.g., 'fissure', 'carvings'). 'action' is 'examine', 'targets' may be empty or hold the detail. If this is populated, narrationForPlausibleAction should be null as specific handling is needed."}}},isPlausible:{type:_.BOOLEAN,description:"Contextually plausible (game state, skills, equipped items, MEMORY CONTEXT, game setting/universe, ACTIVE EVENT CONTEXT). E.g., picking complex lock with 0 Lockpicking & no memory of a key is implausible."},reasonIfNotPlausible:{type:_.STRING,nullable:!0,description:"Brief reason if not plausible."},narrationForPlausibleAction:{type:_.STRING,nullable:!0,description:"Optional brief narration IF PLAUSIBLE SIMPLE ACTION (e.g., 'You scan surroundings.'). CRITICALLY, IF action IS 'dialogue_input', 'event_dialogue_input', 'attack_npc', 'leave_area', 'give_item', 'request_item_from_npc', OR ('talk' AND parameters.dialogue_text is present), OR IF 'examine_detail_target' is populated, THIS FIELD MUST BE NULL or empty, as these actions have their own dedicated narration mechanisms that will be invoked by the game system based on the parsed action type and parameters. This field is ONLY for simple, self-contained actions that don't trigger complex downstream logic. Reflects skills, memory, game setting/universe, AND ACTIVE EVENT CONTEXT."}},required:["action","targets","isPlausible"]}}]},Fw=a=>{var t,o,s,u,f,g;return!a||typeof a.action!="string"||!Array.isArray(a.targets)||typeof a.isPlausible!="boolean"||a.parameters!==void 0&&a.parameters!==null&&typeof a.parameters!="object"?!1:((t=a.parameters)==null?void 0:t.intendedLocationTypeHint)!==void 0&&((o=a.parameters)==null?void 0:o.intendedLocationTypeHint)!==null&&typeof a.parameters.intendedLocationTypeHint!="string"?(console.warn(`Validation Warning: intendedLocationTypeHint should be string or null, but was: '${a.parameters.intendedLocationTypeHint}'`),!1):((s=a.parameters)==null?void 0:s.examine_detail_target)!==void 0&&((u=a.parameters)==null?void 0:u.examine_detail_target)!==null&&typeof a.parameters.examine_detail_target!="string"?(console.warn(`Validation Warning: examine_detail_target should be string or null, but was: '${a.parameters.examine_detail_target}'`),!1):(["dialogue_input","event_dialogue_input","attack_npc","leave_area","give_item","request_item_from_npc"].includes(a.action)&&a.narrationForPlausibleAction&&a.narrationForPlausibleAction.trim()!==""&&console.warn(`Validation Warning: narrationForPlausibleAction should be null/empty for action '${a.action}', but was: '${a.narrationForPlausibleAction}'`),a.action==="talk"&&((f=a.parameters)!=null&&f.dialogue_text)&&a.narrationForPlausibleAction&&a.narrationForPlausibleAction.trim()!==""&&console.warn(`Validation Warning: narrationForPlausibleAction should be null/empty for 'talk' with dialogue_text, but was: '${a.narrationForPlausibleAction}'`),(g=a.parameters)!=null&&g.examine_detail_target&&a.narrationForPlausibleAction&&a.narrationForPlausibleAction.trim()!==""&&console.warn(`Validation Warning: narrationForPlausibleAction should be null/empty when 'examine_detail_target' is present, but was: '${a.narrationForPlausibleAction}'`),!0)},Yw=async(a,e,t,o,s,u,f,g,h="",p)=>{const v=zt(e.skills);Ki(e.limbs);const T=va(e.limbs);let C=`Game Setting: ${e.gameSettingType}.`;e.gameSettingType==="Historical"&&e.initialHistoricalContext?C+=` Historical Context: ${e.initialHistoricalContext}.`:e.gameSettingType==="Fictional"&&e.fictionalUniverseContext?C+=` Fictional Universe: ${e.fictionalUniverseContext}.`:e.gameSettingType==="Fictional"&&(C+=" This is a general fictional world.");let S=`Player: ${e.characterConcept}. Vitals: Health ${e.overallHealth}HP, Energy ${e.currentEnergy}/${e.maxEnergy}EN. Limbs & Equipment: [${T}]. Defeated: ${e.isDefeated}. Skills: [${v}]. ${C} ${Ht}`;S+=`
Location: ${t.name} (Description: "${t.description}"). Env: ${t.environmentTags.join(", ")}. Exits: [${t.validExits.join(", ")||"None"}].`,o!=null&&o.length?S+=`
Items here: ${o.map(M=>M.name).join(", ")}.`:o===null?S+=`
Items here: Unknown (not searched).`:S+=`
Items here: None.`,s.length?S+=`
Inventory: ${s.map(M=>M.name).join(", ")}.`:S+=`
Inventory: Empty.`;let w=null,I="";f!=null&&f.length?(I=`
NPCs present: ${f.map(M=>`${M.name} (ID: ${M.id}, Defeated: ${M.isDefeated??!1}, Disposition: ${M.disposition||"Neutral"})`).join("; ")}.`,g?(w=g.name,I+=`
CRITICAL: Player IS CURRENTLY TALKING TO: ${w} (ID: ${g.id}). Assume player's input is dialogue FOR THIS NPC unless clearly an attack or global command.`):I+=`
Not currently talking to any specific NPC.`):f===null?I=`
NPCs here: Unknown (not searched).`:I=`
NPCs here: None.`,S+=I,u.length&&(S+=`
Recent events/dialogue (last 5 relevant):
${u.map(M=>`- ${M}`).join(`
`)}`);let b="";p&&p.requiresPlayerActionToResolve&&(b=`
ACTIVE EVENT: "${p.eventTitle}". Event State: "${p.narration.substring(0,150)}...". Resolution Hint: "${p.resolutionCriteriaPrompt||"None specified"}". Your command interpretation MUST consider this active event. Simple dialogue inputs should be action: 'event_dialogue_input'.`,S+=b),e.isDefeated&&(S+=`
CRITICAL: Player DEFEATED. Most actions implausible (unless 'try again'/'restart').`);const A=`${S}
${h}
Player command: "${a}"

Interpret this command. Determine action, target(s), parameters. Assess plausibility (game state, skills, equipped items, MEMORY CONTEXT, game setting/universe, ACTIVE EVENT CONTEXT).

PRIMARY RULES:
1.  ACTIVE EVENT MODE (If "ACTIVE EVENT" is in context):
    - Player's input ("${a}") is likely an attempt to interact with or resolve the event.
        - Action: 'event_dialogue_input'. Parameters.dialogue_text: "${a}". narrationForPlausibleAction: null.
    - EXCEPTIONS:
        - Unambiguous global command (e.g., "inventory", "status") not plausible as event interaction: Parse as that command. Avoid movement unless event explicitly allows/ends.
2.  CONVERSATION MODE (If "Player IS CURRENTLY TALKING TO: [NPC NAME (ID: NPC_ID)]" is in context AND NO ACTIVE EVENT requires player action):
    - Player's input ("${a}") is dialogue FOR that NPC.
        - Action: 'dialogue_input'. Parameters.dialogue_text: "${a}". narrationForPlausibleAction: null.
    - EXCEPTIONS (as before): "bye", giving item, requesting item, attacking current NPC, unambiguous global commands.
3.  INITIATING ACTIONS (Not in Event/Conversation Mode OR as an exception):
    - "talk to [NPC_NAME]", "attack [NPC_NAME]", general commands (go, take, use, examine), movement with hint, contextual details examination, "leave area" -- rules largely as before.
4.  TARGETING & NARRATION: Rules largely as before. Remember narrationForPlausibleAction IS NULL for complex actions or event_dialogue_input.

STRICT INSTRUCTION: You MUST invoke the tool 'interpret_player_action'. Your entire response MUST be a call to this tool. Do not provide any direct text response.
The field 'narrationForPlausibleAction' MUST BE NULL OR EMPTY for actions like 'dialogue_input', 'event_dialogue_input', 'attack_npc', 'leave_area', 'give_item', 'request_item_from_npc', 'talk' (if it includes an initial utterance), or 'examine' (if 'examine_detail_target' is populated).
If an NPC is attacked and their ID is available in the "NPCs present" context, YOU MUST provide this ID in 'parameters.direct_object_npc_id'.
ALWAYS call the 'interpret_player_action' tool to structure your response.
`;return Rt(A,qw,Fw,"Invalid player action parse (check conversation/event mode, memory context, attack handling, ID provision, 'leave_area' handling, narration rule for complex actions, or game setting/universe consistency, examine_detail_target)","parsePlayerCommandAndDetermineAction")},Bw=a=>{const{onPickupItemRequested:e,onUseItemRequested:t,onSelectItemForModal:o,onSelectNPCForModal:s,onStartConversation:u,onEndConversation:f,onTriggerLookForItems:g,onTriggerLookForPeople:h,previousMovementSourceCoordinates:p,setPreviousMovementSourceCoordinates:v}=a,{gameStarted:T,characterData:C,locationData:S,playerInventory:w,gameLog:I,addLogEntry:b,setIsLoading:A,setLoadingMessage:M,setIsConsoleBusy:L,currentCoordinates:R,setCurrentCoordinates:$,visitedLocations:V,setVisitedLocations:Q,locationNPCs:te,setLocationNPCs:F,talkingToNPC:ae,setTalkingToNPC:W,locationItems:z,setLocationItems:ue,setPlayerInventory:re,setLocationData:se,_consumeEnergy:U,_gainSkillExperience:X,attemptToTriggerUnexpectedEvent:J,handlePlayerInitiatedSignificantAction:he,applyEventEffects:P,addMemorableEntity:j,addMajorPlotPoint:Z,getMemoryContextString:ie,potentialDiscoveries:fe,addPotentialDiscovery:ce,markPotentialDiscoveryFound:de,isEventActive:le,setIsEventActive:me,currentEventDetails:K,setCurrentEventDetails:Ve,setCurrentEventImageUrl:Te,majorPlotPoints:we,incrementPlayerCommandCount:Me,triggerGameDirectorAnalysis:Ge}=wn(),be=Y.useCallback((Ne,Ie,qe)=>{const pe=qe.toLowerCase();let Pe=0,Be=0,Se=qe;if(["north","n","forwards","forward"].includes(pe))Be=1,Se="north";else if(["south","s","backwards","backward"].includes(pe))Be=-1,Se="south";else if(["east","e","right"].includes(pe))Pe=1,Se="east";else if(["west","w","left"].includes(pe))Pe=-1,Se="west";else if(["up","u"].includes(pe))Se="up";else if(["down","d"].includes(pe))Se="down";else return{x:Ne,y:Ie,normalizedDirection:"an_unknown_direction"};return{x:Ne+Pe,y:Ie+Be,normalizedDirection:Se}},[]),Ke=Y.useCallback(()=>{var Ne;return te?le&&K?(new Set(((Ne=K.npcEffects)==null?void 0:Ne.map(Ie=>Ie.npcIdTargeted))||[]),te.filter(Ie=>{var pe;if(Ie.isDefeated)return!1;if(Ie.isEventSpawned)return!0;const qe=(pe=K.npcEffects)==null?void 0:pe.find(Pe=>Pe.npcIdTargeted===Ie.id);return qe?qe.isHiddenDuringEvent===!1||qe.isHiddenDuringEvent===void 0:!1})):te.filter(Ie=>!Ie.isDefeated):[]},[te,le,K]),Ze=async(Ne,Ie)=>{const qe=Ke(),pe=Ie||ae&&qe.find(Pe=>Pe.id===ae.id);if(pe&&Ne.dialogue_text&&C&&!C.isDefeated){const Pe=ie(),Be=`${R.x},${R.y}`;try{const Se=await TA(pe,Ne.dialogue_text,C,Be,Pe,K);b("narration",`${pe.name} says: ${Se.rawText}`,`${pe.name} says: ${Se.processedText}`);for(const ht of Se.potentialDiscoveries)await ce(ht,pe.id,Be);if((Ne.dialogue_text.toLowerCase().includes("secret")||Ne.dialogue_text.toLowerCase().includes("plan to assassinate"))&&Z(`Player revealed to ${pe.name}: "${Ne.dialogue_text.substring(0,70)}..."`,[C.characterName,pe.id],S==null?void 0:S.name),pe.rarity==="Epic"||pe.rarity==="Legendary"){const ht=`dialogue_interaction_with_${pe.rarity.toLowerCase()}_npc_${pe.name.replace(/\s+/g,"_")}`;await J(ht)}else await J(`dialogue_response_from_${pe.name.toLowerCase().replace(/\s+/g,"_")}_rarity_${pe.rarity}`)}catch(Se){b("error",`Error with ${pe==null?void 0:pe.name}: ${(Se==null?void 0:Se.message)||"Unknown dialogue error"}`)}}else C!=null&&C.isDefeated?b("system","Too weak to speak."):pe?Ne.dialogue_text?b("error","Dialogue error (NPC, text, or char data missing)."):b("error","What do you want to say?"):b("error","No one is currently being spoken to for this dialogue, or they are obscured by the event.")},Wt=async(Ne,Ie)=>{if(C!=null&&C.isDefeated){b("system","You are too weak to initiate conversations.");return}if(!Ne){b("error","Who do you want to talk to?");return}const pe=Ke().find(Pe=>Pe.name.toLowerCase()===Ne.toLowerCase());if(!pe){b("error",`Cannot find ${Ne} here or they are not currently interactable.`);return}if((ae==null?void 0:ae.id)===pe.id){b("system",`You are already talking to ${pe.name}.`),Ie&&Ie.trim()!==""&&await Ze({dialogue_text:Ie},pe);return}ae&&(b("system",`You first end your conversation with ${ae.name}.`),f()),u(pe.id),Ie&&Ie.trim()!==""&&await Ze({dialogue_text:Ie},pe)},kt=()=>{ae?f():b("system","You are not currently talking to anyone.")},xt=async Ne=>{if(le){b("system","You are too focused on the event to pick up items now.");return}if(!Ne){b("error","What do you want to pick up?");return}if(!z){b("error","You haven't searched for items here, or there are none.");return}const Ie=z.find(qe=>qe.name.toLowerCase()===Ne.toLowerCase());if(!Ie){b("error",`Cannot find "${Ne}" here.`);return}await e(Ie.id)},St=async(Ne,Ie)=>{if(!Ne){b("error","What do you want to use?");return}if(!C){b("error","Character data not available.");return}L(!0);let qe=null,pe=ie();try{if(w.length>0&&(M(`Thinking about using "${Ne}"...`),qe=await oA(Ne,w,C,pe),M("")),!qe){b("error",`You don't seem to have anything like a "${Ne}" to use.`),L(!1);return}ae&&(pe+=`
CURRENTLY IN DIALOGUE WITH: ${ae.name} (ID: ${ae.id}, Rarity: ${ae.rarity}, Disposition: ${ae.disposition||"Neutral"}). Their current inventory: ${ae.inventory.map(Be=>Be.name).join(", ")||"none"}.`),le&&K&&(pe+=`
ACTIVE EVENT: "${K.eventTitle}". Event State: "${K.narration.substring(0,100)}...". This item usage might be relevant to resolving or interacting with the event.`);const Pe={...Ie||{},_augmentedMemoryContext:pe};await t(qe.id,Pe)}catch(Pe){b("error",`Error identifying or using item: ${Pe.message}`)}finally{L(!1),M("")}},en=async(Ne,Ie)=>{if(!Ne&&!(Ie!=null&&Ie.examine_detail_target)){b("error","What do you want to examine?");return}const qe=(Ie==null?void 0:Ie.examine_detail_target)||Ne,pe=qe.toLowerCase(),Pe=Ke();if(["area","location","surroundings","room","here","around"].includes(pe)){if(le&&K){b("narration",K.narration||"You survey the chaotic scene of the event."),b("system",`Contextual examination of event: ${K.eventTitle}`);return}b("system","You scan your surroundings..."),await g(),await h(),S&&b("narration",S.description);return}const Be=w.find(et=>et.name.toLowerCase()===pe);if(Be){o(Be);return}const Se=z==null?void 0:z.find(et=>et.name.toLowerCase()===pe);if(Se){o(Se);return}const ht=Pe.find(et=>et.name.toLowerCase()===pe);if(ht){s(ht);return}if(C&&S){L(!0),M(`Examining ${qe}...`);try{const et=ie(),Le=`${R.x},${R.y}`,Ut=await WA(qe,C,S,K,Le,et);b("narration",Ut.narration);for(const ft of Ut.potentialDiscoveries)await ce(ft,`examine_${qe.replace(/\s+/g,"_")}`,Le);X("Perception",1),await J(`examined_detail_${qe.replace(/\s+/g,"_")}_in_${S.name.replace(/\s+/g,"_")}`)}catch(et){b("error",`Cannot examine "${qe}": ${et.message||"Nothing noteworthy observed."}`)}finally{L(!1),M("")}}else b("error",`You don't see a "${qe}" to examine closely here, or they are currently obscured.`)},Wn=async()=>{if(le){b("system","Your attention is fixed on the current event; you cannot search for others now.");return}await h()},Ta=async()=>{if(le){b("system","The unfolding event prevents you from searching for items.");return}await g()},Zi=async(Ne,Ie,qe,pe)=>{if(!C||C.isDefeated){b("system","You are too weak to interact.");return}if(U(1,"Persuasion"),!C.isDefeated){L(!0);try{const Pe=Ne||w.find(Ae=>Ae.name.toLowerCase()===(qe||"").toLowerCase());if(!Pe){b("error",`You don't have a "${qe||"specified item"}".`);return}const Be=Ke(),Se=Ie||Be.find(Ae=>Ae.name.toLowerCase()===(pe||"").toLowerCase());if(!Se){b("error",`Cannot find ${pe||"specified NPC"} here or they are not currently interactable.`);return}const ht=I.filter(Ae=>Ae.type==="command"&&Ae.text.toLowerCase().startsWith("you say:")||Ae.type==="narration"&&Ae.text.toLowerCase().startsWith(`${Se.name.toLowerCase()} says:`)).slice(-3).map(Ae=>Ae.text),et=ie(),Le=await xA(C,Se,Pe,ht,et,K),Ut=`${R.x},${R.y}`,ft=await Bi(Le.npcReactionText,"dialogue",Se.id,C,Ut,et);for(const Ae of ft.potentialDiscoveries)await ce(Ae,Se.id,Ut);if(b("narration",Le.narration),b("narration",`${Se.name} says: ${Le.npcReactionText}`,`${Se.name} says: ${ft.processedText}`),Le.accepted){let Ae={...Pe};if(!Ae.iconUrl||Ae.iconUrl.startsWith("https://via.placeholder.com")){b("system",`Generating icon for ${Ae.name} as it's given...`);try{const ve=await hi(Ae.visualPromptHint,Ae.name,C.visualStyle,null);Ae.iconUrl=ve}catch(ve){console.error(`Failed to generate icon for given item ${Ae.name}:`,ve),b("error",`Could not create icon for ${Ae.name}.`)}}re(ve=>ve.filter(lt=>lt.id!==Ae.id)),F(ve=>ve?ve.map(lt=>lt.id===Se.id?{...lt,inventory:[...lt.inventory,Ae]}:lt):null);const Kt=`${R.x},${R.y}`;Q(ve=>{var un;const lt=new Map(ve),tt=lt.get(Kt);if(tt){const vn=((un=tt.npcs)==null?void 0:un.map(ut=>ut.id===Se.id?{...ut,inventory:[...ut.inventory,Ae]}:ut))||null;lt.set(Kt,{...tt,npcs:vn})}return lt}),b("game_event",`${Se.name} accepted the ${Ae.name}.`),X("Persuasion",10),Z(`Player gave '${Ae.name}' (${Ae.rarity}) to ${Se.name}. NPC accepted.`,[C.characterName,Se.id,Ae.id],S==null?void 0:S.name),await J(`gave_item_${Ae.rarity.toLowerCase()}_to_${Se.name.toLowerCase().replace(/\s+/g,"_")}_accepted`)}else b("system",`${Se.name} did not accept the ${Pe.name}.`),Z(`Player offered '${Pe.name}' to ${Se.name}. NPC refused.`,[C.characterName,Se.id,Pe.id],S==null?void 0:S.name),await J(`gave_item_${Pe.rarity.toLowerCase()}_to_${Se.name.toLowerCase().replace(/\s+/g,"_")}_refused`)}catch(Pe){b("error",`Error giving item: ${Pe.message||"Unknown error"}`)}finally{L(!1)}}},Yn=async(Ne,Ie)=>{if(!C||C.isDefeated){b("system","You are too weak to make requests.");return}if(U(1,"Persuasion"),!C.isDefeated){L(!0);try{if(!Ne||!Ie){b("error","Specify item and NPC (e.g., 'ask Bob for key').");return}const pe=Ke().find(Le=>Le.name.toLowerCase()===Ie.toLowerCase());if(!pe){b("error",`Cannot find ${Ie} here or they are not currently interactable.`);return}const Pe=I.filter(Le=>Le.type==="command"&&Le.text.toLowerCase().startsWith("you say:")||Le.type==="narration"&&Le.text.toLowerCase().startsWith(`${pe.name.toLowerCase()} says:`)).slice(-3).map(Le=>Le.text),Be=ie(),Se=await _A(C,pe,Ne,Pe,Be,K),ht=`${R.x},${R.y}`,et=await Bi(Se.npcReactionText,"dialogue",pe.id,C,ht,Be);for(const Le of et.potentialDiscoveries)await ce(Le,pe.id,ht);if(b("narration",Se.narration),b("narration",`${pe.name} says: ${Se.npcReactionText}`,`${pe.name} says: ${et.processedText}`),Se.willingToGive&&Se.itemGiven){let Le={...Se.itemGiven};if(!Le.iconUrl||Le.iconUrl.startsWith("https://via.placeholder.com")){b("system",`Generating icon for ${Le.name}...`);try{const ft=await hi(Le.visualPromptHint,Le.name,C.visualStyle,null);Le.iconUrl=ft}catch(ft){console.error(`Failed to generate icon for acquired item ${Le.name}:`,ft),b("error",`Could not create icon for ${Le.name}.`)}}re(ft=>[...ft,Le]),F(ft=>ft?ft.map(Ae=>Ae.id===pe.id?{...Ae,inventory:Ae.inventory.filter(Kt=>Kt.id!==Le.id)}:Ae):null);const Ut=`${R.x},${R.y}`;Q(ft=>{var ve;const Ae=new Map(ft),Kt=Ae.get(Ut);if(Kt){const lt=((ve=Kt.npcs)==null?void 0:ve.map(tt=>tt.id===pe.id?{...tt,inventory:tt.inventory.filter(un=>un.id!==Le.id)}:tt))||null;Ae.set(Ut,{...Kt,npcs:lt})}return Ae}),b("game_event",`${pe.name} gave you ${Le.name}.`),X("Persuasion",10),Z(`${pe.name} gave '${Le.name}' (${Le.rarity}) to player.`,[C.characterName,pe.id,Le.id],S==null?void 0:S.name),await J(`npc_${pe.name.toLowerCase().replace(/\s+/g,"_")}_gave_item_${Le.rarity.toLowerCase()}`)}else b("system",`${pe.name} did not give you the ${Ne}.`),Z(`${pe.name} did not give '${Ne}' to player.`,[C.characterName,pe.id],S==null?void 0:S.name),await J(`npc_${pe.name.toLowerCase().replace(/\s+/g,"_")}_refused_item_${Ne.toLowerCase().replace(/\s+/g,"_")}`)}catch(qe){b("error",`Error requesting item: ${qe.message||"Unknown error"}`)}finally{L(!1)}}},Jt=async(Ne,Ie,qe)=>{if(le){b("system","You must deal with the current event before moving!");return}if(!C||!S){b("error","Game state not ready for movement.");return}if(C.isDefeated&&!S.name.toLowerCase().includes("afterlife")&&!S.name.toLowerCase().includes("limbo")){b("system","You are too weak to move.");return}if(U(2,"Survival"),C.isDefeated&&!S.name.toLowerCase().includes("afterlife")&&!S.name.toLowerCase().includes("limbo"))return;let pe=Ne.toLowerCase();const Pe=S.validExits.map(ve=>ve.toLowerCase());if(Ie===gt.LEAVE_AREA||pe==="random_exit")if(Pe.length>0)pe=Pe[Math.floor(Math.random()*Pe.length)];else{b("error","There are no apparent exits from this location to 'leave' through.");return}const Be=pe.match(/^(-?\d+),(-?\d+)$/);let Se,ht,et;if(Be)Se=parseInt(Be[1],10),ht=parseInt(Be[2],10),et=`to coordinates ${pe}`;else{const ve=be(R.x,R.y,pe);Se=ve.x,ht=ve.y,et=ve.normalizedDirection}if(et==="an_unknown_direction"){b("error",`Cannot interpret direction: "${pe}". Try N, S, E, W or use the map.`);return}if(!Be&&!Pe.includes(et)){b("error",`Cannot move ${et} from ${S.name}. Valid exits: ${Pe.join(", ")||"none"}.`);return}if(Se===R.x&&ht===R.y&&!Be){b("error",`Cannot move ${et} from here, it seems you'd stay in place.`);return}A(!0),M(`Moving ${et}...`);const Le=`${Se},${ht}`,Ut={...R},ft=!V.has(Le);let Ae=!1;const Kt=ie();try{let ve,lt;if(V.has(Le)){const tt=V.get(Le);ve=tt.location,lt=`You head ${et} and arrive at ${ve.name}.`,b("narration",lt),b("narration",ve.description),ue(tt.items),F(tt.npcs),Ae=!0}else{const tt=fe.filter(ct=>ct.type==="location"&&ct.status==="mentioned"),un={previousLocation:S,direction:et,characterConcept:C.characterConcept,characterName:C.characterName,skills:C.skills,gameSettingType:C.gameSettingType,initialHistoricalContext:C.initialHistoricalContext,fictionalUniverseContext:C.fictionalUniverseContext,recentStorySummary:I.slice(-5).map(ct=>ct.text).join(" "),potentialDiscoveries:tt,intendedLocationTypeHint:qe||null,visualStyle:C.visualStyle},vn=await ZA(un,Kt),ut=vn.newLocationDetails,yt=await ty(ut.visualPromptHint,ut.name,C.visualStyle);ve={...ut,imageUrl:yt},lt=vn.movementNarration,b("narration",lt),b("narration",ve.description),b("game_event",`Discovered: ${ve.name} (Rarity: ${ve.rarity}).`),Q(ct=>new Map(ct).set(Le,{location:ve,items:null,npcs:null})),ue(null),F(null);const rt=await Fi(ve,"location",tt,C,Kt);rt&&de(rt,Le),j(Le,ve.name,"location",ve.rarity,ve.description.substring(0,70)+"...",`Discovered by moving ${et} from ${S.name}`),Ae=!0}if(Ae){se(ve),$({x:Se,y:ht}),v(Ut),X("Survival",1);const tt=ft?`moved_to_new_location_${ve.rarity.toLowerCase()}_${ve.environmentTags.join("_")||"unknown_env"}`:`revisited_location_${ve.name.toLowerCase().replace(/\s+/g,"_")}`;await J(tt)}}catch(ve){console.error("Error during movement: ",ve),b("error",`Movement failed: ${ve.message||"An unknown error occurred while trying to move."}`)}finally{A(!1),M("")}},yn=async(Ne,Ie)=>{if(!C||C.isDefeated){b("system","You are too weak to attack.");return}if(!Ne&&!Ie){b("error","Who do you want to attack?");return}const qe=Ke();let pe;if(Ie&&(pe=qe.find(Be=>Be.id===Ie)),!pe&&Ne&&(pe=qe.find(Be=>Be.name.toLowerCase()===Ne.toLowerCase())),!pe){b("error",`Cannot find "${Ne||"target"}" here to attack or they are not currently interactable.`);return}if(pe.isDefeated){b("system",`${pe.name} is already defeated.`);return}const Pe={actionType:"attack_npc",targetNpcId:pe.id};await he(Pe)};return{processPlayerCommand:Y.useCallback(async Ne=>{var Ie,qe,pe,Pe,Be,Se,ht,et,Le;if(!C||!S||!T){b("error","Game not ready for commands.");return}b("command",`You say: "${Ne}"`,Ne),Me(),L(!0);try{const Ut=I.slice(-5).map(tt=>tt.text),ft=ie(),Ae=Ke(),Kt=le&&(K!=null&&K.requiresPlayerActionToResolve)?K:null,ve=await Yw(Ne,C,S,z,w,Ut,Ae,ae,ft,Kt);if(!ve.isPlausible){b("error",ve.reasonIfNotPlausible||"That action doesn't seem possible right now."),L(!1);return}ve.narrationForPlausibleAction&&b("narration",ve.narrationForPlausibleAction);const lt=ve.targets[0];switch(ve.action){case gt.EVENT_DIALOGUE_INPUT:if(K&&K.requiresPlayerActionToResolve){const tt=((Ie=ve.parameters)==null?void 0:Ie.dialogue_text)||Ne,un=`${R.x},${R.y}`,vn=await lh(K,tt,C,S.name,we,fe,ft,un);b("narration",vn.rawText,vn.processedText);for(const yt of vn.potentialDiscoveries)await ce(yt,K.eventTitle,un);const ut=await rh(K,Ne,ve,C,Ae,ft,w);if(b("narration",ut.resolutionNarration),ut.majorPlotPointSummary&&Z(ut.majorPlotPointSummary,[C.characterName,K.eventTitle],S.name),ut.resolved){if(b("game_event",`Event "${K.eventTitle}" has been resolved!`),ut.updatedNpcDisposition&&C){const yt=te==null?void 0:te.find(rt=>rt.id===ut.updatedNpcDisposition.npcId);if(yt){const rt={...yt,disposition:ut.updatedNpcDisposition.newDisposition};F(ct=>ct?ct.map(Tn=>Tn.id===rt.id?rt:Tn):null),b("system",`${yt.name}'s disposition is now ${rt.disposition}.`)}}if((qe=ut.itemsAwardedToPlayer)!=null&&qe.length&&C)for(const yt of ut.itemsAwardedToPlayer){const rt=await hi(yt.visualPromptHint||yt.name,yt.name,C.visualStyle,null),ct={...yt,visualPromptHint:yt.visualPromptHint||yt.name,id:crypto.randomUUID(),iconUrl:rt};re(Tn=>[...Tn,ct]),b("game_event",`You received: ${ct.name} (${ct.rarity}).`)}me(!1),Ve(null),Te(null),Ge(!0)}else if(ut.progressed){b("game_event",`Event "${K.eventTitle}" has progressed!`);const yt={...K,narration:ut.nextStageNarration||K.narration,visualPromptHintForEventImage:ut.updatedVisualPromptHintForEventImage||K.visualPromptHintForEventImage,resolutionCriteriaPrompt:ut.updatedResolutionCriteriaPrompt||K.resolutionCriteriaPrompt};if(Ve(yt),ut.nextStageNarration&&b("narration",ut.nextStageNarration),ut.updatedVisualPromptHintForEventImage&&(S!=null&&S.visualPromptHint)&&(C!=null&&C.visualStyle)){const rt=await Mc(ut.updatedVisualPromptHintForEventImage,S.visualPromptHint,yt.eventTitle,C.visualStyle);Te(rt)}}else b("system","Your action didn't seem to change the course of the event.")}else b("error","Tried to send event dialogue, but no resolvable event is active.");break;case gt.DIALOGUE_INPUT:await Ze(ve.parameters);break;case gt.TALK:await Wt(lt,(pe=ve.parameters)==null?void 0:pe.dialogue_text);break;case gt.END_CONVERSATION:kt();break;case gt.PICKUP:case gt.TAKE:case gt.GET:await xt(lt);break;case gt.USE:await St(lt,ve.parameters||void 0);break;case gt.EXAMINE:case gt.LOOK:case gt.INSPECT:await en(lt,ve.parameters||void 0);break;case gt.DISCOVER_ITEMS:case gt.SEARCH_AREA_FOR_ITEMS:await Ta();break;case gt.DISCOVER_NPCS:case gt.LOOK_FOR_PEOPLE:await Wn();break;case gt.GO:case gt.MOVE:case gt.WALK:case gt.RUN:case gt.LEAVE_AREA:await Jt(lt,ve.action,(Pe=ve.parameters)==null?void 0:Pe.intendedLocationTypeHint);break;case gt.GIVE_ITEM:await Zi(void 0,void 0,(Be=ve.parameters)==null?void 0:Be.item_to_give_name,(Se=ve.parameters)==null?void 0:Se.target_npc_name_for_interaction);break;case gt.REQUEST_ITEM_FROM_NPC:await Yn((ht=ve.parameters)==null?void 0:ht.item_to_request_name,(et=ve.parameters)==null?void 0:et.target_npc_name_for_request);break;case gt.ATTACK_NPC:await yn(lt,(Le=ve.parameters)==null?void 0:Le.direct_object_npc_id);break;case gt.INVENTORY:case gt.CHECK_INVENTORY:b("system",w.length>0?`You have: ${w.map(tt=>`${tt.name} (${tt.rarity})`).join(", ")}.`:"Your inventory is empty.");break;case gt.STATUS:case gt.HEALTH:case gt.CHECK_SELF:b("system",`Overall Health: ${C.overallHealth}HP. Energy: ${C.currentEnergy}/${C.maxEnergy}EN. Limbs: ${C.limbs.map(tt=>`${tt.name} (${tt.status}, ${tt.health}HP)`).join("; ")}.`);break;default:b("error",`Unknown action: ${ve.action}`);break}}catch(Ut){b("error",`Command processing error: ${Ut.message}`),console.error("Command processing error:",Ut)}finally{L(!1),Ge()}},[C,S,T,b,I,z,w,ae,L,ie,Ke,Ze,Wt,kt,xt,St,en,Ta,Wn,Jt,Zi,Yn,yn,le,K,we,fe,R,lh,rh,me,Ve,Te,Z,ce,he,P,F,re,X,te,Me,Ge,e,t,o,s,u,f,g,h,p,v,se,A,M,Q]),handleGiveItemToNpc:Zi}},Lc=["SurvivalHorror","DetectiveMystery","HighStakesCombat","SocialIntrigue","ExplorationAdventure","ResourceManagement","PuzzleSolving","SportsMatchFocus","PoliticalIntrigue","StealthOperations","HumorousAdventure","PhilosophicalDebate","RomanticPursuit","TragedyUnfolding","PersonalGrowthJourney","FactionConflict","BaseBuildingDefense","NoSpecificFocus","CustomScenario"],iy=["EventGeneration","NPCInteraction","CombatResolution","LocationDescription","ItemGeneration","PlayerVitals","GameLogNarration","WorldProgression"],zw={functionDeclarations:[{name:"provide_game_direction_suggestions",description:"Analyzes the comprehensive game state and player interaction patterns to determine the current gameplay focus. Based on this focus, suggests directives to enhance player immersion and experience. These directives include general prompt enhancements for various game AI systems and specific gameplay parameter adjustments.",parameters:{type:_.OBJECT,properties:{currentGameFocus:{type:_.STRING,enum:Lc,description:"The primary gameplay style or genre the player seems to be engaged in or the game is leaning towards. If 'CustomScenario', provide details in 'customFocusDescription'."},promptEnhancements:{type:_.ARRAY,description:"Array of suggestions to modify prompts for other AI systems to align with the current game focus.",items:{type:_.OBJECT,properties:{targetSystem:{type:_.STRING,enum:iy,description:"The game system this suggestion targets."},suggestion:{type:_.STRING,description:"Specific textual advice for the target system's LLM prompts (e.g., 'For EventGeneration, emphasize a sense of urgency and danger.')."},priority:{type:_.STRING,enum:["low","medium","high"],nullable:!0,description:"Optional priority for this enhancement."}},required:["targetSystem","suggestion"]}},gameplayParameterSuggestions:{type:_.OBJECT,description:"Specific suggestions for adjusting game parameters to match the focus.",properties:{focusOnResourceScarcity:{type:_.BOOLEAN,nullable:!0,description:"True if survival/resource management is key."},adjustEnergyDecayRate:{type:_.STRING,enum:["normal","increased","decreased","none"],nullable:!0,description:"Suggest change to player energy decay."},adjustHealthRegenRate:{type:_.STRING,enum:["normal","slowed","none","event_driven"],nullable:!0,description:"Suggest change to health regeneration."},preferredEventType:{type:_.STRING,enum:[...Lc,"balanced",null],nullable:!0,description:"Suggest preferred type of event to generate."},increaseNarrativeLengthForScenario:{type:_.STRING,nullable:!0,description:"Suggest specific scenario (e.g., a GameFocusType or a unique string like 'BossBattle') where narration should be longer."},triggerChanceModifierForGoodEvents:{type:_.NUMBER,nullable:!0,description:"Multiplier for good events (e.g., 1.2 for +20%)."},triggerChanceModifierForBadEvents:{type:_.NUMBER,nullable:!0,description:"Multiplier for bad events."},npcDispositionVolatility:{type:_.STRING,enum:["low","medium","high"],nullable:!0,description:"How easily NPC dispositions might change."},customFocusDescription:{type:_.STRING,nullable:!0,description:"Detailed description if currentGameFocus is 'CustomScenario'."},attentionToDetailLevel:{type:_.STRING,enum:["low","medium","high"],nullable:!0,description:"Suggested level for perception detail."},dialogueStyle:{type:_.STRING,enum:["concise","descriptive","action_oriented","introspective"],nullable:!0,description:"Preferred NPC dialogue style."},pacing:{type:_.STRING,enum:["fast","medium","slow"],nullable:!0,description:"Overall game pacing."}}},reasoning:{type:_.STRING,nullable:!0,description:"Brief explanation for the suggested directives based on the game state analysis."}},required:["currentGameFocus","promptEnhancements","gameplayParameterSuggestions"]}}]},Jw=a=>{if(!a||!Lc.includes(a.currentGameFocus)||!Array.isArray(a.promptEnhancements))return!1;for(const e of a.promptEnhancements)if(!iy.includes(e.targetSystem)||typeof e.suggestion!="string"||e.priority&&!["low","medium","high"].includes(e.priority))return!1;if(typeof a.gameplayParameterSuggestions!="object"||a.gameplayParameterSuggestions===null)return!1;for(const e in a.gameplayParameterSuggestions);return!(a.reasoning!==void 0&&a.reasoning!==null&&typeof a.reasoning!="string")},Kw=async(a,e,t,o,s,u,f)=>{if(!a||!e)return console.warn("GameDirectorService: Missing character or location data."),null;const g=zt(a.skills);Ki(a.limbs);const h=va(a.limbs);let p=`Game Setting: ${a.gameSettingType}.`;a.gameSettingType==="Historical"&&a.initialHistoricalContext?p+=` Historical Context: ${a.initialHistoricalContext}.`:a.gameSettingType==="Fictional"&&a.fictionalUniverseContext&&(p+=` Fictional Universe: ${a.fictionalUniverseContext}.`);const v=o.slice(-20).map(C=>`[${C.type}] ${C.text.substring(0,100)}...`).join(`
`),T=`You are a sophisticated Game Director AI for a text-based adventure game.
Your goal is to analyze the complete game state and player's recent actions to determine the current emergent gameplay focus.
Based on this focus, you will provide directives to enhance player immersion and guide other AI systems.

CURRENT GAME STATE SNAPSHOT:
Character: ${a.characterName} - ${a.characterConcept}
  Rarity: ${a.characterRarity}, Visual Style: ${a.visualStyle}
  Health: ${a.overallHealth}HP, Energy: ${a.currentEnergy}/${a.maxEnergy}EN
  Limbs & Equipment: [${h}]
  Defeated: ${a.isDefeated}
  Skills: [${g}]
  ${p}

Current Location: ${e.name} (Rarity: ${e.rarity})
  Description: "${e.description.substring(0,150)}..."
  Environment Tags: ${e.environmentTags.join(", ")}
  Exits: [${e.validExits.join(", ")||"None"}]

Player Inventory: ${t.length>0?t.map(C=>`${C.name} (${C.rarity})`).join(", "):"Empty"}

${u?`Active Event: "${u.eventTitle}" - ${u.narration.substring(0,100)}... (Requires Action: ${u.requiresPlayerActionToResolve??!1})`:"No active event."}

Game Memory & Chronicle (Summary):
${s.substring(0,1e3)}...

Recent Game Log (Last 20 entries):
${v}

${f?`Previous Game Director Focus: ${f.currentGameFocus}`:"No previous game director focus."}

${Ht}

YOUR TASK:
1.  Analyze ALL provided context: player stats, skills, inventory, location, ongoing event, memory, recent log.
    What is the player *actually doing*? What themes are emerging? Is there a clear objective or gameplay loop forming?

2.  Determine 'currentGameFocus': Select the most fitting GameFocusType. If it's a unique scenario not covered by predefined types, use 'CustomScenario' and describe it in 'customFocusDescription'. 'NoSpecificFocus' if gameplay is generic.

3.  Suggest 'promptEnhancements' (0-3 suggestions):
    Provide specific, actionable advice for other AI systems (EventGeneration, NPCInteraction, CombatResolution, LocationDescription, ItemGeneration, PlayerVitals, GameLogNarration, WorldProgression).
    These suggestions should guide the *style, tone, and content* of generations to align with the 'currentGameFocus'.

4.  Suggest 'gameplayParameterSuggestions' (optional adjustments):
    These are more direct tweaks. Only suggest parameters relevant to the 'currentGameFocus'.

5.  Provide 'reasoning' (optional): Briefly explain why you chose this focus and these directives.

IMPORTANT: The "Example Scenarios" below are for ILLUSTRATIVE PURPOSES ONLY, to show the type of thinking and output structure.
DO NOT copy-paste the examples. You MUST generate your own unique directives based ON THE CURRENT ACTUAL GAME STATE provided above. Your suggestions should be tailored and responsive to the player's specific situation and emergent narrative.

Example Scenarios & Desired Directives (Illustrative Examples - DO NOT COPY):
    - Scenario (Example): Player is low on health/energy, in a dangerous area, recently fought monsters.
      Focus: 'SurvivalHorror'
      Enhancement (EventGeneration): "Generate events that emphasize resource scarcity (food, medical supplies) and create a sense of dread or pursuit. Minor negative outcomes are more frequent."
      Parameter: 'focusOnResourceScarcity: true', 'adjustEnergyDecayRate: "increased"', 'triggerChanceModifierForBadEvents: 1.2'

    - Scenario (Example): Player is questioning multiple NPCs, examining notes, and exploring a series of interconnected clues related to a crime.
      Focus: 'DetectiveMystery'
      Enhancement (NPCInteraction): "NPCs should be more guarded with information, requiring persuasion or evidence. Dialogue should contain subtle clues of varying difficulty to uncover based on player skill (Perception, Persuasion)."
      Parameter: 'attentionToDetailLevel: "high"', 'dialogueStyle: "introspective"', 'preferredEventType: "DetectiveMystery"'

    - Scenario (Example): Player has a 'Football' item, is in a 'Stadium' location, and log shows commands like "kick football", "pass to teammate".
      Focus: 'SportsMatchFocus'
      CustomFocusDescription: "Player is in a critical football match, score is tied, final minutes."
      Enhancement (EventGeneration): "For events related to the football match, provide longer, more immersive narrations detailing plays, crowd reactions, and match progression."
      Enhancement (GameLogNarration): "Use more active and exciting language for game log entries related to the match."
      Parameter: 'increaseNarrativeLengthForScenario: "SportsMatchFocus_FinalMinutes"', 'preferredEventType: "SportsMatchFocus"', 'pacing: "fast"'

    - Scenario (Example): Player is at a royal ball, speaking to many nobles, trying to gain influence or uncover plots.
      Focus: 'SocialIntrigue'
      CustomFocusDescription: "Player is navigating a royal ball, attempting to gather secrets and influence key figures."
      Enhancement (NPCInteraction): "NPC dialogue should be layered with subtext. NPCs might react strongly to social faux pas or clever compliments. Player's Persuasion skill is key."
      Parameter: 'npcDispositionVolatility: "high"', 'triggerChanceModifierForGoodEvents: 1.1', 'triggerChanceModifierForBadEvents: 1.1', 'preferredEventType: "SocialIntrigue"'

    - Scenario (Example): Player is carefully searching ancient ruins, finding old inscriptions and avoiding traps.
      Focus: 'ExplorationAdventure'
      CustomFocusDescription: "Player is methodically exploring ancient, trap-laden ruins, seeking lost knowledge."
      Enhancement (LocationDescription): "Emphasize details about ancient architecture, potential hidden mechanisms, subtle environmental clues, and the passage of time in location descriptions. Make sure Perception skill can unlock more details."
      Enhancement (ItemGeneration): "Items found should be ancient relics, tools for exploration, or lore-rich fragments."
      Parameter: 'preferredEventType: "PuzzleSolving"', 'attentionToDetailLevel: "high"', 'focusOnResourceScarcity: false'

    - Scenario (Example): Player is in a prolonged, difficult fight with a powerful, unique enemy (e.g., a dragon).
      Focus: 'HighStakesCombat'
      CustomFocusDescription: "Player is engaged in a challenging boss battle against a legendary beast that has multiple phases or unique abilities."
      Enhancement (CombatResolution): "Make combat descriptions more vivid and cinematic. Emphasize the power of the boss and the impact of player's successful hits or misses. Describe the boss's reactions and changing tactics."
      Enhancement (EventGeneration): "Trigger small, dynamic events during the boss fight based on player actions or boss health thresholds (e.g., boss enrages, environment changes slightly)."
      Parameter: 'adjustHealthRegenRate: "none"', 'increaseNarrativeLengthForScenario: "BossBattlePhaseChange"', 'triggerChanceModifierForBadEvents: 1.3'

CRITICAL: Invoke the 'provide_game_direction_suggestions' tool. Ensure all outputs are consistent and logical.
Your suggestions should be subtle nudges to the game systems, not drastic overhauls unless the game state strongly indicates a major shift.
Consider the 'Previous Game Director Focus' to ensure smooth transitions or deliberate shifts, rather than rapidly oscillating directives.
If an active event is present, the game focus should heavily consider the nature of that event.
`;try{return await Rt(T,zw,Jw,"Invalid Game Director directive structure.","analyzeAndSuggestGameDirectives")}catch(C){return console.error("GameDirectorService: Error analyzing game state:",C),null}},Th=21,Zw=6*60*1e3,Xw=()=>{const{characterData:a,locationData:e,playerInventory:t,gameLog:o,getMemoryContextString:s,currentEventDetails:u,setCurrentDirectives:f,currentDirectives:g,playerCommandCount:h,addLogEntry:p,gameStarted:v}=wn(),[T,C]=Y.useState(0),[S,w]=Y.useState(0),[I,b]=Y.useState(!1),[A,M]=Y.useState(!1),L=Y.useCallback(async(R=!1)=>{if(I||!a||!e)return;const $=Date.now(),V=h-S,Q=$-T>Zw,te=V>=Th;if(!(!R&&(!Q||!te)&&A)){b(!0),p("system","The winds of fate shift... (Game Director is contemplating...)");try{const F=s(),ae=await Kw(a,e,t,o,F,u,g);if(ae){const W={...ae,directiveId:crypto.randomUUID(),timestamp:$,analyzedCommandCount:h,lastGameLogEntryIdAnalyzed:o.length>0?o[o.length-1].id:"none"};f(W),C($),w(h);let z=`Game Director's Focus: ${W.currentGameFocus}`;W.currentGameFocus==="CustomScenario"&&W.gameplayParameterSuggestions.customFocusDescription&&(z+=` (${W.gameplayParameterSuggestions.customFocusDescription.substring(0,50)}...)`),W.reasoning&&(z+=` Reasoning: ${W.reasoning.substring(0,100)}...`),p("system",z)}else p("system","Game Director's contemplation yielded no new directives at this moment.")}catch(F){console.error("GameDirector: Error during analysis:",F),p("error","Game Director encountered an issue during contemplation.")}finally{b(!1),A||M(!0)}}},[I,a,e,t,o,u,s,g,h,T,S,p,f,A]);return Y.useEffect(()=>{v&&!A&&a&&e&&!I&&L(!0)},[v,A,a,e,L,I]),Y.useEffect(()=>{v&&A&&h>0&&h%Th===0&&h!==S&&L()},[h,v,A,S,L]),{currentDirectives:g,triggerGameDirectorAnalysis:L,lastAnalysisCommandCount:S}},jw=()=>{const a=wn(),{gameStarted:e,characterData:t,locationData:o,playerInventory:s,currentCoordinates:u,gameLog:f,isLoading:g,loadingMessage:h,error:p,locationNPCs:v,talkingToNPC:T,locationItems:C,isGeneratingEvent:S,eventLoadingMessage:w,memorableEntities:I,potentialDiscoveries:b,visitedLocations:A,addLogEntry:M,addPotentialDiscovery:L,setPlayerInventory:R,setLocationItems:$,setLocationNPCs:V,setVisitedLocations:Q,setLocationData:te,currentDirectives:F,setCurrentDirectives:ae,playerCommandCount:W}=a;Xw();const{itemToViewInModal:z,setItemToViewInModal:ue,npcToViewInModal:re,setNpcToViewInModal:se,locationToViewInModal:U,setLocationToViewInModal:X,selectedLocationCoordinateKeyForModal:J,setSelectedLocationCoordinateKeyForModal:he,imageUrlToView:P,imageAltTextToView:j,handleSelectItemForModal:Z,handleCloseItemModal:ie,handleSelectNPCForModal:fe,handleCloseNPCModal:ce,handleSelectLocationForModal:de,handleCloseLocationModal:le,handleSelectImageForViewing:me,handleCloseImageViewModal:K}=Uw(),[Ve,Te]=Y.useState(!1),[we,Me]=Y.useState(!1),[Ge,be]=Y.useState(null),[Ke,Ze]=Y.useState(null),[Wt,kt]=Y.useState(null),[xt,St]=Y.useState(null);Y.useEffect(()=>{},[]);const en=Y.useCallback(()=>{Me(it=>!it)},[]),{craftingSlots:Wn,setCraftingSlots:Ta,isCrafting:Zi,setIsCrafting:Yn,handleAddItemToCraftingSlot:Jt,handleRemoveItemFromCraftingSlot:yn,handleAttemptCraft:on}=Gw({}),Ne=$w({handleCloseItemModal:ie,handleCloseNPCModal:ce,handleCloseLocationModal:le,handleCloseImageViewModal:K,setSelectedLocationCoordinateKeyForModal:he,setCraftingSlots:Ta,setIsCrafting:Yn,setIsPickingUpItem:be,setIsUsingItem:Ze,setIsApplyingToLimb:kt,setPreviousMovementSourceCoordinates:St,setIsConsoleMinimized:Me}),{handlePickupItem:Ie,handleUseItem:qe,handleApplyItemToLimb:pe,handleUnequipItemFromLimb:Pe}=Pw({isPickingUpItem:Ge,setIsPickingUpItem:be,isUsingItem:Ke,setIsUsingItem:Ze,isApplyingToLimb:Wt,setIsApplyingToLimb:kt}),Be=Y.useCallback((it,Zt,_t,$t)=>{ue(He=>He&&He.id===it?{...He,description:_t}:He),R(He=>He.map(Nt=>Nt.id===it?{...Nt,description:_t}:Nt)),$(He=>He?He.map(Nt=>Nt.id===it?{...Nt,description:_t}:Nt):null);const vt=`${u.x},${u.y}`;Q(He=>{const Nt=new Map(He),dt=Nt.get(vt);if(dt&&dt.items){const Cn=dt.items.map(ei=>ei.id===it?{...ei,description:_t}:ei);Nt.set(vt,{...dt,items:Cn})}return Nt}),M("system",`Learned more about ${(z==null?void 0:z.name)||"item"}.`);const Qe=`${u.x},${u.y}`;$t.forEach(He=>L(He,it,Qe))},[ue,R,$,M,L,u,z==null?void 0:z.name,Q]),Se=Y.useCallback((it,Zt,_t,$t)=>{se(He=>He&&He.id===it?{...He,description:_t}:He),V(He=>He?He.map(Nt=>Nt.id===it?{...Nt,description:_t}:Nt):null);const vt=`${u.x},${u.y}`;Q(He=>{const Nt=new Map(He),dt=Nt.get(vt);if(dt&&dt.npcs){const Cn=dt.npcs.map(ei=>ei.id===it?{...ei,description:_t}:ei);Nt.set(vt,{...dt,npcs:Cn})}return Nt}),M("system",`Learned more about ${(re==null?void 0:re.name)||"NPC"}.`);const Qe=`${u.x},${u.y}`;$t.forEach(He=>L(He,it,Qe))},[se,V,Q,M,L,u,re==null?void 0:re.name]),ht=Y.useCallback((it,Zt,_t,$t)=>{X(vt=>vt&&J===it?{...vt,description:_t}:vt),Q(vt=>{const Qe=new Map(vt),He=Qe.get(it);return He&&Qe.set(it,{...He,location:{...He.location,description:_t}}),Qe}),o&&`${u.x},${u.y}`===it&&te(vt=>vt?{...vt,description:_t}:null),M("system",`Learned more about ${(U==null?void 0:U.name)||"location"}.`),$t.forEach(vt=>L(vt,it,it))},[X,J,Q,te,o,u,M,L,U==null?void 0:U.name]),{isLoadingNPCs:et,npcsError:Le,handleStartConversation:Ut,handleEndConversation:ft,handleTriggerLookForPeople:Ae}=Hw({}),{isLoadingItems:Kt,itemsError:ve,handleTriggerLookForItems:lt}=Vw({}),{processPlayerCommand:tt,handleGiveItemToNpc:un}=Bw({onPickupItemRequested:Ie,onUseItemRequested:(it,Zt)=>qe(it,Zt),onSelectItemForModal:Z,onSelectNPCForModal:fe,onStartConversation:Ut,onEndConversation:ft,onTriggerLookForItems:lt,onTriggerLookForPeople:Ae,previousMovementSourceCoordinates:xt,setPreviousMovementSourceCoordinates:St}),{appHeaderIsLoading:vn,appHeaderLoadingMessage:ut,consoleIsProcessing:yt}=Dw({contextIsLoading:g,contextLoadingMessage:h,hookIsLoadingItems:Kt,hookIsLoadingNPCs:et,isGeneratingEvent:S,eventLoadingMessage:w,isCharacterDefeated:(t==null?void 0:t.isDefeated)??!1}),rt=it=>{if(!it||it.length===0)return 100;const Zt=it.reduce((_t,$t)=>_t+$t.health,0);return Math.round(Zt/it.length)},ct=Y.useCallback((it,Zt,_t)=>{let $t=it,vt=Zt;if(Zt==="lore_hint"&&_t!=="discovered"){M("system","This is a piece of general lore or a hint. No specific details modal available yet.");return}const Qe=b.find(dt=>dt.id===it);if(Qe&&_t==="discovered"&&Qe.fulfilledById)$t=Qe.fulfilledById,vt=Qe.type;else if(_t==="mentioned"){M("system",`Details for ${(Qe==null?void 0:Qe.name)||"this lead"} are still unknown or unconfirmed.`);return}else if(_t==="discovered"&&(!Qe||!Qe.fulfilledById)){M("system",`Details for this discovered ${Zt} are confirmed but not directly linkable to a modal via this entry yet.`);return}let He=null,Nt=null;switch(vt){case"item":He=s.find(dt=>dt.id===$t)||(C==null?void 0:C.find(dt=>dt.id===$t))||null,He&&Z(He);break;case"npc":He=(v==null?void 0:v.find(dt=>dt.id===$t))||null,He&&fe(He);break;case"location":if($t.includes(",")){const dt=A.get($t);dt&&(He=dt.location,Nt=$t)}else for(const[dt,Cn]of A.entries())if(Cn.location.name===$t){He=Cn.location,Nt=dt;break}He&&de(He,Nt);break;default:Zt!=="lore_hint"&&M("error",`Cannot open details for unknown knowledge type: ${vt}`);return}He||M("system",`Details for this ${vt} are not currently available or the link is missing.`)},[s,C,v,A,b,Z,fe,de,M]),Tn="Phase 12: ReadMe & New Visual Styles",fo={locationItems:C,isLoadingItems:Kt,itemsError:ve,onSelectItemForModal:Z,onTriggerLookForItems:lt,onPickupItem:Ie,isPickingUpItemId:Ge},Qs={locationNPCs:v,isLoadingNPCs:et,npcsError:Le,talkingToNPC:T,onStartConversation:Ut,onSelectNPCForModal:fe,onTriggerLookForPeople:Ae,onEndConversation:ft},Ws={craftingSlots:Wn,onAddItemToCraftingSlot:Jt,onRemoveItemFromSlot:yn,onAttemptCraft:on,isCrafting:Zi},vr={onUseItem:qe,isUsingItemId:Ke,onApplyItemToLimb:pe,isApplyingToLimbId:Wt,onUnequipItemFromLimb:Pe,overallHealth:t?rt(t.limbs):100,currentEnergy:(t==null?void 0:t.currentEnergy)??100,maxEnergy:(t==null?void 0:t.maxEnergy)??100},Xi={itemProps:fo,npcProps:Qs,craftingProps:Ws,characterProps:vr,onSelectLocationForModal:de,currentCoordinates:u,onSelectKnowledgeEntry:ct,onDropItemOnNpcImage:un};return E.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-slate-100 flex flex-col selection:bg-sky-500 selection:text-white",children:[E.jsx(Aw,{isLoading:vn,loadingMessage:ut,currentPhaseTitle:Tn,apiKeyMissing:Ve,isGeneratingEvent:S,eventLoadingMessage:w}),E.jsx("div",{className:"flex-grow overflow-y-auto",children:E.jsx(Nw,{isGlobalBlockingLoad:g,loadingMessage:h,error:p,gameStarted:e,apiKeyMissing:Ve,characterData:t,locationData:o,gameLog:f,gameInterfaceProps:Xi,onQuickStart:Ne.handleStartNewGame,onCustomStart:Ne.handleCustomStartGame,onTryAgain:Ne.handleStartNewGame})}),E.jsx(iw,{itemToViewInModal:z,onCloseItemModal:ie,onItemDescriptionElaborated:Be,npcToViewInModal:re,onCloseNpcModal:ce,onNpcDescriptionElaborated:Se,locationToViewInModal:U,onCloseLocationModal:le,onLocationDescriptionElaborated:ht,selectedLocationCoordinateKeyForModal:J,characterData:t,imageUrlToView:P,imageAltTextToView:j,onCloseImageViewModal:K,onSelectImageForViewing:me}),E.jsx(Mw,{gameStarted:e,talkingToNPC:T,handleEndConversation:ft,processPlayerCommand:tt,isProcessing:yt,gameLog:f,isConsoleMinimized:we,onToggleMinimize:en}),E.jsx(ny,{})]})},Qw=()=>E.jsx(PA,{children:E.jsx(jw,{})}),ay=document.getElementById("root");if(!ay)throw new Error("Could not find root element to mount to");const Ww=xT.createRoot(ay);Ww.render(E.jsx(cr.StrictMode,{children:E.jsx(Qw,{})}));
